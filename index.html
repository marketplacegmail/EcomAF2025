
<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="utf-8"/>
<title>Trang Chủ Công Cụ iBasic</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #ff00ff, #00ffcc);
      min-height: 100vh;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      padding: 40px;
    }
    h1 {
      text-align: center;
      font-size: 2.5em;
      background: linear-gradient(45deg, #ff33cc, #00ff99);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
    }
    .nav button {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #ff33cc, #00ff99);
      color: white;
      cursor: pointer;
    }
    .nav button:hover {
      background: linear-gradient(135deg, #00ff99, #ff33cc);
    }
    .iframe-container {
      display: none;
    }
    .iframe-container.active {
      display: block;
    }
    iframe {
      width: 100%;
      height: 85vh;
      border: none;
    }
    footer {
      margin-top: 20px;
      text-align: center;
      font-size: 14px;
      color: #555;
    }
  </style>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        h1::before {
            content: '🎨';
            position: absolute;
            left: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            animation: rotate 4s linear infinite;
        }

        h1::after {
            content: '✨';
            position: absolute;
            right: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes rotate {
            from { transform: translateY(-50%) rotate(0deg); }
            to { transform: translateY(-50%) rotate(360deg); }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: translateY(-50%) scale(1); }
            50% { opacity: 0.5; transform: translateY(-50%) scale(1.2); }
        }

        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .upload-box {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            transition: all 0.3s ease;
        }

        .upload-box:hover {
            border-color: #764ba2;
            background: rgba(118, 75, 162, 0.1);
            transform: translateY(-2px);
        }

        .upload-box h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .status.error {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .controls-section {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .controls-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-item label {
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        .control-item input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .control-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .control-item input[type="number"] {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .control-item input[type="number"]:focus {
            border-color: #667eea;
            outline: none;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .download-section {
            background: rgba(118, 75, 162, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .download-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .download-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .download-btn {
            background: linear-gradient(45deg, #764ba2, #667eea);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.4);
        }

        .download-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(45deg, transparent 33%, rgba(255,255,255,0.3) 33%, rgba(255,255,255,0.3) 66%, transparent 66%);
            animation: progress-animation 1s linear infinite;
        }

        @keyframes progress-animation {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .thumbnails-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .thumbnail-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            border: 3px solid transparent;
        }

        .thumbnail-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .thumbnail-item.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        }

        .thumbnail-canvas {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            object-fit: cover;
            margin: 0 auto;
        }

        .thumbnail-info {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .thumbnail-name {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #d32f2f;
            transform: scale(1.05);
        }

        .workspace-info {
            text-align: center;
            color: #666;
            margin-top: 20px;
            font-size: 14px;
        }

        .copyright-section {
            margin-top: 40px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 20px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.2);
            position: relative;
            overflow: hidden;
        }

        .copyright-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .copyright-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .copyright-text {
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
        }

        .copyright-icon {
            font-size: 20px;
            animation: bounce 2s infinite;
        }

        .copyright-icon:nth-child(1) {
            animation-delay: 0s;
        }

        .copyright-icon:nth-child(3) {
            animation-delay: 0.3s;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }

        .cute-icons {
            display: flex;
            justify-content: center;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .cute-icon {
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

        .cute-icon:nth-child(1) { animation-delay: 0s; }
        .cute-icon:nth-child(2) { animation-delay: 0.6s; }
        .cute-icon:nth-child(3) { animation-delay: 1.2s; }
        .cute-icon:nth-child(4) { animation-delay: 1.8s; }
        .cute-icon:nth-child(5) { animation-delay: 2.4s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(5deg); }
            50% { transform: translateY(-5px) rotate(-5deg); }
            75% { transform: translateY(-15px) rotate(3deg); }
        }

        .cute-icon:hover {
            transform: scale(1.5) rotate(360deg);
            filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5));
        }

        .selected-info {
            background: rgba(102, 126, 234, 0.2);
            border: 3px solid rgba(102, 126, 234, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            animation: pulse-selection 2s infinite;
        }

        @keyframes pulse-selection {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
            }
        }

        .current-editing {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #333;
        }

        @media (max-width: 768px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                grid-template-columns: 1fr;
            }
            
            .thumbnails-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
        }
    </style><style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            width: 100%;
        }

        .output-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            width: 100%;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #34495e;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
            margin-bottom: 15px;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: block;
            padding: 12px;
            background: #4ecdc4;
            color: white;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .file-upload-label:hover {
            background: #45b7aa;
            transform: translateY(-2px);
        }

        .file-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .file-preview img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .generate-btn {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .output-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            min-height: 400px;
            border: 1px solid #e9ecef;
        }

        .product-title {
            font-size: 14pt;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .product-description {
            font-size: 12pt;
            line-height: 1.6;
            color: #34495e;
        }

        .product-description ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .product-description li {
            font-size: 12pt;
            margin-bottom: 10px;
        }

        .specs {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .specs p {
            font-size: 12pt;
            margin-bottom: 5px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .copy-btn, .download-btn, .regenerate-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 14px;
            font-weight: 500;
        }

        .download-btn {
            background: #007bff;
        }

        .regenerate-btn {
            background: #ff6b6b;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .download-btn:hover {
            background: #0056b3;
        }

        .regenerate-btn:hover {
            background: #e55a5a;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4ecdc4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ai-note {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }

        .ai-note strong {
            color: #d63384;
        }

        .copyright {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            color: #6c757d;
            font-size: 14px;
            margin-top: 20px;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
                gap: 10px;
            }

            .header h1 {
                font-size: 24px;
            }
        }
    </style></head>
<body>
<div class="container">
<h1>✨ Công Cụ Hỗ Trợ iBasic ✨</h1>
<div class="nav">
<button onclick="showFrame('frame1')">🎬 Kịch Bản Livestream</button>
<button onclick="showFrame('frame2')">🖼️ Tạo Thumbnail</button>
<button onclick="showFrame('frame3')">📝 Mô Tả Sản Phẩm</button>
</div>
<div class="iframe-container active" id="frame1">
<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Tạo Kịch Bản Livestream AI</title>
<script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff00ff 0%, #00ffcc 100%); /* Y2K gradient: neon pink to cyan */
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff33cc, #00ff99); /* Y2K neon gradient */
            color: white;
            text-align: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-100px); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .api-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            border-left: 4px solid #ff33cc; /* Y2K neon pink */
        }

        .api-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .api-input:focus {
            outline: none;
            border-color: #ff33cc; /* Y2K neon pink */
        }

        .api-status {
            font-size: 14px;
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }

        .api-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .api-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .main-content {
            display: flex;
            flex-direction: column; /* Stack sections vertically */
            gap: 30px;
            padding: 40px;
        }

        .input-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .input-section:hover {
            transform: translateY(-5px);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f9f9f9;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff33cc; /* Y2K neon pink */
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 51, 204, 0.1); /* Y2K neon pink shadow */
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .product-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .product-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .product-item label {
            font-size: 0.9em;
            margin-bottom: 5px;
            color: #666;
        }

        .product-item textarea {
            min-height: 80px;
            font-size: 14px;
            padding: 10px;
        }

        .style-options {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .style-option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .style-option:hover {
            border-color: #ff33cc; /* Y2K neon pink */
            background: #fff0f5; /* Light pink Y2K accent */
        }

        .style-option.selected {
            border-color: #ff33cc; /* Y2K neon pink */
            background: #ff33cc; /* Y2K neon pink */
            color: white;
        }

        .style-option h4 {
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .style-option p {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .brand-policy-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Side-by-side for Brand Story and Policy */
            gap: 15px;
            margin-bottom: 25px;
        }

        .cta-promotion-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Side-by-side for CTA and Promotion */
            gap: 15px;
            margin-bottom: 25px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .generate-btn,
        .regenerate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #ff33cc, #00ff99); /* Y2K neon gradient */
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .regenerate-btn {
            background: linear-gradient(135deg, #00ff99, #ff33cc); /* Reversed Y2K gradient */
        }

        .generate-btn:hover,
        .regenerate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 51, 204, 0.3); /* Y2K neon pink shadow */
        }

        .generate-btn:active,
        .regenerate-btn:active {
            transform: translateY(0);
        }

        .generate-btn:disabled,
        .regenerate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .output-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .output-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff33cc, #00ff99, #ff00ff, #00ccff); /* Y2K neon gradient */
            animation: gradient-shift 3s linear infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .output-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .script-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .tab-btn.active {
            background: #ff33cc; /* Y2K neon pink */
            color: white;
            border-color: #ff33cc; /* Y2K neon pink */
        }

        .script-output {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            border-left: 4px solid #ff33cc; /* Y2K neon pink */
            font-family: 'Consolas', 'Monaco', monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            color: #333;
            display: none;
        }

        .script-output.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 50px 0;
        }

        .loading {
            display: none;
            text-align: center;
            color: #ff33cc; /* Y2K neon pink */
            font-style: italic;
        }

        .loading::after {
            content: '...';
            animation: loading-dots 1.5s infinite;
        }

        @keyframes loading-dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .circle-nav {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
            display: none;
        }

        .circle-nav.active {
            display: block;
        }

        .circle-point {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff33cc; /* Y2K neon pink */
            border-radius: 50%;
            transform-origin: 50% 150px;
            transition: transform 0.3s ease, background 0.3s ease;
            cursor: pointer;
        }

        .circle-point:hover {
            background: #00ff99; /* Y2K neon green */
            transform: scale(1.2);
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            white-space: normal;
            max-width: 200px;
            display: none;
            z-index: 10;
        }

        .copy-btn,
        .download-btn {
            padding: 10px 15px;
            background: #00ff99; /* Y2K neon green */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .copy-btn:hover,
        .download-btn:hover {
            background: #00cc88; /* Darker Y2K neon green */
            transform: scale(1.05);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column; /* Ensure vertical stacking on mobile */
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .header p {
                font-size: 1em;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }

            .brand-policy-grid {
                grid-template-columns: 1fr; /* Stack Brand Story and Policy on mobile */
            }

            .cta-promotion-grid {
                grid-template-columns: 1fr; /* Stack CTA and Promotion on mobile */
            }

            .style-options {
                grid-template-columns: 1fr; /* Stack style options vertically on mobile */
            }

            .script-tabs {
                flex-direction: column;
            }

            .button-group {
                flex-direction: column;
                gap: 10px;
            }

            .circle-nav {
                width: 200px;
                height: 200px;
            }

            .circle-point {
                width: 15px;
                height: 15px;
                transform-origin: 50% 100px;
            }
        }
    </style>
</head>
<body>
<div class="container">
<div class="header">
<h1>🎬 Tạo Kịch Bản Livestream AI</h1>
<p>Công cụ thông minh tích hợp Google Gemini AI để tạo kịch bản livestream chuyên nghiệp</p>
</div>
<div class="api-section">
<h3>🔑 Cấu hình API Google Gemini</h3>
<input class="api-input" id="apiKey" placeholder="Nhập API Key của bạn (AIza...)" type="password"/>
<div class="api-status" id="apiStatus" style="display: none;"></div>
<p style="font-size: 12px; color: #666; margin-top: 5px;">
                API Key sẽ chỉ lưu trong session này và không được gửi đến máy chủ nào khác.
                <a href="https://makersuite.google.com/app/apikey" target="_blank">Lấy API Key tại đây</a>
</p>
</div>
<div class="main-content">
<div class="input-section">
<h2>📝 Thông Tin Đầu Vào</h2>
<form id="scriptForm">
<div class="form-group">
<label for="topic">🎯 Chủ đề live:</label>
<input id="topic" name="topic" placeholder="Ví dụ: Giảm giá sốc Black Friday, Ra mắt sản phẩm mới..." type="text"/>
</div>
<div class="form-group">
<label>🎭 Phong cách kịch bản:</label>
<div class="style-options">
<div class="style-option" data-style="friendly">
<h4>🌟 Thân thiện</h4>
<p>Dễ thương, gần gũi với khán giả</p>
</div>
<div class="style-option" data-style="professional">
<h4>💼 Chuyên nghiệp</h4>
<p>Lịch sự, tin cậy, thuyết phục</p>
</div>
<div class="style-option" data-style="energetic">
<h4>⚡ Năng động</h4>
<p>Sôi động, tạo cảm giác khẩn cấp, thúc đẩy hành động</p>
</div>
</div>
</div>
<div class="form-group">
<label>📦 Mô tả Hot Products:</label>
<div class="product-grid">
<div class="product-item">
<label>Sản phẩm 1:</label>
<textarea id="product1" placeholder="Tên sản phẩm, giá, tính năng nổi bật..."></textarea>
</div>
<div class="product-item">
<label>Sản phẩm 2:</label>
<textarea id="product2" placeholder="Tên sản phẩm, giá, tính năng nổi bật..."></textarea>
</div>
<div class="product-item">
<label>Sản phẩm 3:</label>
<textarea id="product3" placeholder="Tên sản phẩm, giá, tính năng nổi bật..."></textarea>
</div>
<div class="product-item">
<label>Sản phẩm 4:</label>
<textarea id="product4" placeholder="Tên sản phẩm, giá, tính năng nổi bật..."></textarea>
</div>
</div>
<div class="product-item">
<label>Sản phẩm 5:</label>
<textarea id="product5" placeholder="Tên sản phẩm, giá, tính năng nổi bật..."></textarea>
</div>
</div>
<div class="form-group">
<label for="seasonality">🌸 Seasonality:</label>
<textarea id="seasonality" name="seasonality" placeholder="Sự kiện theo mùa hoặc dịp đặc biệt:
- Dịp lễ (Tết, Giáng sinh, v.v.)
- Chủ đề theo mùa (Hè, Đông, v.v.)
- Sự kiện đặc biệt (Back to School, Black Friday, v.v.)"></textarea>
</div>
<div class="form-group">
<label for="gamification">🎮 Gamification:</label>
<textarea id="gamification" name="gamification" placeholder="Trò chơi hoặc hoạt động giải trí trong livestream:
- Mini-game (bốc thăm may mắn, đoán giá, v.v.)
- Câu đố tương tác
- Thử thách cho khán giả
- Phần thưởng (quà tặng, mã giảm giá, v.v.)"></textarea>
</div>
<div class="form-group">
<label for="tipsHacks">💡 TIP/HACK:</label>
<textarea id="tipsHacks" name="tipsHacks" placeholder="Mẹo hoặc thủ thuật liên quan livestream:
- Mẹo mua sắm
- Cách sử dụng sản phẩm
- Lời khuyên cho khán giả"></textarea>
</div>
<div class="brand-policy-grid">
<div class="form-group">
<label for="brandStory">🏢 Brand Story:</label>
<textarea id="brandStory" name="brandStory" placeholder="Câu chuyện thương hiệu:
- Lịch sử hình thành
- Sứ mệnh, tầm nhìn
- Giá trị cốt lõi
- Thành tựu đáng tự hào
- Cam kết với khách hàng"></textarea>
</div>
<div class="form-group">
<label for="policy">📋 Policy Product:</label>
<textarea id="policy" name="policy" placeholder="Chính sách sản phẩm:
- Chính sách bảo hành
- Chính sách đổi trả
- Chính sách giao hàng
- Chính sách thanh toán
- Hỗ trợ khách hàng"></textarea>
</div>
</div>
<div class="cta-promotion-grid">
<div class="form-group">
<label for="cta">🎯 CTA (Call to Action):</label>
<textarea id="cta" name="cta" placeholder="Kêu gọi hành động:
- Hướng dẫn đặt hàng
- Kêu gọi tương tác (comment, share, v.v.)
- Lời thúc đẩy mua hàng"></textarea>
</div>
<div class="form-group">
<label for="promotion">🎁 Promotion:</label>
<textarea id="promotion" name="promotion" placeholder="Khuyến mãi đặc biệt:
- Mã giảm giá
- Quà tặng kèm
- Ưu đãi đặc biệt
- Thời gian có hạn"></textarea>
</div>
</div>
<div class="button-group">
<button class="generate-btn" id="generateBtn" type="submit">
                            🚀 Tạo Kịch Bản AI
                        </button>
<button class="regenerate-btn" disabled="" id="regenerateBtn" type="button">
                            🔄 Tạo Lại Kịch Bản
                        </button>
</div>
</form>
</div>
<div class="output-section">
<h2>📜 Kịch Bản Livestream</h2>
<div class="button-group">
<button class="copy-btn" disabled="" id="copyBtn" onclick="copyScript()">📋 Copy</button>
<button class="download-btn" disabled="" id="downloadBtn" onclick="downloadScript()">📥 Tải DOCX</button>
</div>
<div class="script-tabs" id="scriptTabs" style="display: none;">
<button class="tab-btn active" onclick="showScript(1)">Kịch bản 1</button>
<button class="tab-btn" onclick="showScript(2)">Kịch bản 2</button>
</div>
<div class="script-output active" id="script1">
<div class="empty-state">
                        Kịch bản sẽ xuất hiện ở đây sau khi bạn điền thông tin và nhấn "Tạo Kịch Bản AI"
                    </div>
</div>
<div class="script-output" id="script2"></div>
<div class="circle-nav" id="circleNav1"></div>
<div class="circle-nav" id="circleNav2"></div>
<div class="loading" id="loading">Gemini AI đang tạo kịch bản...</div>
<div class="error-message" id="errorMessage" style="display: none;"></div>
</div>
</div>
</div>
<script>
        let currentScript = 1;
        let selectedStyle = 'friendly';
        let scriptGenerationCount = 0;
        let scriptContent = { 1: '', 2: '' }; // Store script content for circle navigation

        // Xử lý chọn phong cách
        document.querySelectorAll('.style-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.style-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedStyle = this.getAttribute('data-style');
            });
        });

        // Mặc định chọn phong cách thân thiện
        document.querySelector('.style-option[data-style="friendly"]').classList.add('selected');

        document.getElementById('scriptForm').addEventListener('submit', function(e) {
            e.preventDefault();
            generateScript();
        });

        document.getElementById('regenerateBtn').addEventListener('click', function() {
            generateScript(true); // Pass true to indicate regeneration
        });

        async function generateScript(isRegenerate = false) {
            const apiKey = document.getElementById('apiKey').value;
            const topic = document.getElementById('topic').value;
            const product1 = document.getElementById('product1').value;
            const product2 = document.getElementById('product2').value;
            const product3 = document.getElementById('product3').value;
            const product4 = document.getElementById('product4').value;
            const product5 = document.getElementById('product5').value;
            const seasonality = document.getElementById('seasonality').value;
            const gamification = document.getElementById('gamification').value;
            const tipsHacks = document.getElementById('tipsHacks').value;
            const brandStory = document.getElementById('brandStory').value;
            const policy = document.getElementById('policy').value;
            const cta = document.getElementById('cta').value;
            const promotion = document.getElementById('promotion').value;

            // Kiểm tra API key
            if (!apiKey) {
                showError('Vui lòng nhập API Key của Google Gemini!');
                return;
            }

            // Kiểm tra các trường bắt buộc
            if (!topic || !product1 || !brandStory || !policy || !cta || !promotion) {
                showError('Vui lòng điền đầy đủ thông tin: Chủ đề live, ít nhất 1 sản phẩm, Brand Story, Policy, CTA và Promotion!');
                return;
            }

            const products = [product1, product2, product3, product4, product5].filter(p => p.trim());
            
            const script1Element = document.getElementById('script1');
            const script2Element = document.getElementById('script2');
            const circleNav1 = document.getElementById('circleNav1');
            const circleNav2 = document.getElementById('circleNav2');
            const loading = document.getElementById('loading');
            const scriptTabs = document.getElementById('scriptTabs');
            const errorMessage = document.getElementById('errorMessage');
            const generateBtn = document.getElementById('generateBtn');
            const regenerateBtn = document.getElementById('regenerateBtn');
            const copyBtn = document.getElementById('copyBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // Hiển thị loading
            script1Element.style.display = 'none';
            script2Element.style.display = 'none';
            circleNav1.style.display = 'none';
            circleNav2.style.display = 'none';
            scriptTabs.style.display = 'none';
            errorMessage.style.display = 'none';
            loading.style.display = 'block';
            generateBtn.disabled = true;
            regenerateBtn.disabled = true;
            copyBtn.disabled = true;
            downloadBtn.disabled = true;
            generateBtn.textContent = isRegenerate ? 'Đang tạo lại...' : 'Đang tạo...';

            try {
                // Tăng số lần tạo để thay đổi cách diễn đạt
                scriptGenerationCount++;
                
                // Tạo 2 kịch bản khác nhau
                const script1 = await generateScriptWithGemini(apiKey, topic, products, seasonality, gamification, tipsHacks, brandStory, policy, cta, promotion, selectedStyle, 1, scriptGenerationCount);
                const script2 = await generateScriptWithGemini(apiKey, topic, products, seasonality, gamification, tipsHacks, brandStory, policy, cta, promotion, selectedStyle, 2, scriptGenerationCount);
                
                scriptContent[1] = script1;
                scriptContent[2] = script2;
                
                script1Element.innerHTML = script1;
                script2Element.innerHTML = script2;
                createCircleNavigation(1, script1);
                createCircleNavigation(2, script2);
                
                scriptTabs.style.display = 'flex';
                showScript(1);
                loading.style.display = 'none';
                
                // Bật nút Tạo lại, Copy và Tải xuống
                regenerateBtn.disabled = false;
                copyBtn.disabled = false;
                downloadBtn.disabled = false;
                
            } catch (error) {
                console.error('Error:', error);
                showError('Lỗi khi tạo kịch bản: ' + error.message);
                loading.style.display = 'none';
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '🚀 Tạo Kịch Bản AI';
            }
        }

        async function generateScriptWithGemini(apiKey, topic, products, seasonality, gamification, tipsHacks, brandStory, policy, cta, promotion, style, version, generationCount) {
            const styleDescriptions = {
                'friendly': 'thân thiện, dễ thương, gần gũi với khán giả',
                'professional': 'chuyên nghiệp, lịch sự, tin cậy và thuyết phục',
                'energetic': 'năng động, sôi nổi, tạo cảm giác khẩn cấp và thúc đẩy hành động'
            };

            const versionPrompts = {
                1: 'Tạo kịch bản với cấu trúc rõ ràng, tập trung vào tương tác và xây dựng niềm tin',
                2: 'Tạo kịch bản với cách tiếp cận khác, tập trung vào việc tạo urgency và call-to-action mạnh mẽ'
            };

            const productList = products.map((product, index) => `Sản phẩm ${index + 1}: ${product}`).join('\n');

            const prompt = `
Tôi cần bạn tạo một kịch bản livestream hoàn chỉnh với các yêu cầu sau:

THÔNG TIN CƠ BẢN:
- Chủ đề: ${topic}
- Phong cách: ${styleDescriptions[style]}
- Yêu cầu đặc biệt: ${versionPrompts[version]}
- Lần tạo: ${generationCount} (Đảm bảo cách diễn đạt và từ ngữ khác biệt so với các lần tạo trước, nhưng vẫn giữ cấu trúc và nội dung cốt lõi)

SẢN PHẨM:
${productList}

THEO MÙA:
${seasonality}

TRÒ CHƠI & GIẢI TRÍ:
${gamification}

TIP/HACK:
${tipsHacks}

THÔNG TIN THƯƠNG HIỆU:
${brandStory}

CHÍNH SÁCH:
${policy}

KÊU GỌI HÀNH ĐỘNG:
${cta}

KHUYẾN MÃI:
${promotion}

YÊU CẦU KỊCH BẢN:
1. Tạo kịch bản livestream hoàn chỉnh khoảng 60 phút
2. Chia thành các phần rõ ràng: Khai mạc, Giới thiệu thương hiệu, Trình bày sản phẩm, Theo mùa, Trò chơi & Giải trí, TIP/HACK, Chính sách, Khuyến mãi và CTA, Kết thúc
3. Bao gồm timing cụ thể cho từng phần
4. Có dialogue tự nhiên, phù hợp với phong cách ${styleDescriptions[style]}
5. Tích hợp các câu tương tác với khán giả, đặc biệt trong phần Trò chơi & Giải trí
6. Bao gồm call-to-action hiệu quả
7. Định dạng rõ ràng, dễ đọc
8. Sử dụng tiếng Việt chuẩn Unicode để đảm bảo hiển thị đúng trên mọi nền tảng
9. Thêm một phần mới liên kết nội dung kịch bản thành một vòng tròn, với mỗi phần (Khai mạc, Giới thiệu thương hiệu, v.v.) là một điểm trên vòng tròn, và khi hover vào điểm đó, hiển thị nội dung chi tiết của phần tương ứng

Hãy tạo kịch bản chi tiết và chuyên nghiệp.
`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.9, // Tăng temperature để tăng tính đa dạng trong cách diễn đạt
                        topK: 1,
                        topP: 1,
                        maxOutputTokens: 4096,
                    },
                    safetySettings: [
                        {
                            category: "HARM_CATEGORY_HARASSMENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_HATE_SPEECH",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        }
                    ]
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'Lỗi khi gọi API Gemini');
            }

            const data = await response.json();
            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                return data.candidates[0].content.parts[0].text;
            } else {
                throw new Error('Không nhận được phản hồi từ Gemini AI');
            }
        }

        function showScript(scriptNumber) {
            currentScript = scriptNumber;
            
            // Ẩn tất cả script và circle navigation
            document.getElementById('script1').style.display = 'none';
            document.getElementById('script2').style.display = 'none';
            document.getElementById('circleNav1').classList.remove('active');
            document.getElementById('circleNav2').classList.remove('active');
            
            // Hiển thị script và circle navigation được chọn
            document.getElementById('script' + scriptNumber).style.display = 'block';
            document.getElementById('circleNav' + scriptNumber).classList.add('active');
            
            // Cập nhật tab active
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-btn')[scriptNumber - 1].classList.add('active');
        }

        function copyScript() {
            const currentScriptElement = document.getElementById('script' + currentScript);
            const text = currentScriptElement.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const copyBtn = document.getElementById('copyBtn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '✅ Đã copy';
                copyBtn.style.background = '#00cc88'; /* Darker Y2K neon green */
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '#00ff99'; /* Y2K neon green */
                }, 2000);
            });
        }

        function downloadScript() {
            const currentScriptElement = document.getElementById('script' + currentScript);
            const scriptText = currentScriptElement.textContent;

            // Tạo tài liệu DOCX với font Arial và kích thước 12
            const doc = new docx.Document({
                sections: [{
                    properties: {},
                    children: [
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: "Kịch Bản Livestream",
                                    bold: true,
                                    size: 24, // Title size 12pt in half-points (1pt = 2 half-points)
                                    font: "Arial"
                                })
                            ],
                            spacing: { after: 200 }
                        }),
                        ...scriptText.split('\n').map(line => 
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: line,
                                        size: 24, // Body text size 12pt in half-points
                                        font: "Arial"
                                    })
                                ],
                                spacing: { after: 100 }
                            })
                        )
                    ]
                }]
            });

            // Tạo và tải file DOCX
            docx.Packer.toBlob(doc).then(blob => {
                saveAs(blob, `KichBanLivestream_${currentScript}.docx`);
            }).catch(error => {
                console.error('Error generating DOCX:', error);
                showError('Lỗi khi tạo file DOCX: ' + error.message);
            });
        }

        function createCircleNavigation(scriptNumber, scriptText) {
            const circleNav = document.getElementById(`circleNav${scriptNumber}`);
            circleNav.innerHTML = ''; // Clear existing content

            const sections = [
                "Khai mạc", "Giới thiệu thương hiệu", "Trình bày sản phẩm",
                "Theo mùa", "Trò chơi & Giải trí", "TIP/HACK", "Chính sách",
                "Khuyến mãi và CTA", "Kết thúc"
            ];

            const sectionContent = {};
            let currentSection = null;
            scriptText.split('\n').forEach(line => {
                const trimmedLine = line.trim();
                if (sections.includes(trimmedLine)) {
                    currentSection = trimmedLine;
                    sectionContent[currentSection] = [];
                } else if (currentSection && trimmedLine) {
                    sectionContent[currentSection].push(trimmedLine);
                }
            });

            const radius = 100; // Radius of the circle
            const centerX = 150;
            const centerY = 150;

            sections.forEach((section, index) => {
                const angle = (index / sections.length) * 2 * Math.PI - Math.PI / 2; // Start from top
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                const point = document.createElement('div');
                point.className = 'circle-point';
                point.style.left = `${x}px`;
                point.style.top = `${y}px`;
                point.dataset.section = section;

                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.textContent = sectionContent[section] ? sectionContent[section].join('\n') : 'Nội dung không có';
                tooltip.style.left = `${x + 20}px`;
                tooltip.style.top = `${y - 10}px`;

                point.addEventListener('mouseover', () => {
                    tooltip.style.display = 'block';
                });

                point.addEventListener('mouseout', () => {
                    tooltip.style.display = 'none';
                });

                circleNav.appendChild(point);
                circleNav.appendChild(tooltip);
            });
        }

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
</div>
<div class="iframe-container" id="frame2"><div class="container">
<h1>🎨 Thumbnail Maker Tool - Professional</h1>
<!-- Upload Section -->
<div class="upload-section">
<div class="upload-box">
<h3>📷 Upload Phông Nền</h3>
<p>Kích thước khuyến nghị: 1200x1200px</p>
<input accept="image/*" class="file-input" id="backgroundInput" type="file"/>
<button class="upload-btn" onclick="document.getElementById('backgroundInput').click()">
                    Chọn Phông Nền
                </button>
<div class="status" id="backgroundStatus"></div>
</div>
<div class="upload-box">
<h3>🛍️ Upload Sản Phẩm</h3>
<p>Chọn nhiều file, tự động xóa phông nền</p>
<input accept="image/*" class="file-input" id="productInput" multiple="" type="file"/>
<button class="upload-btn" onclick="document.getElementById('productInput').click()">
                    Chọn Sản Phẩm
                </button>
<div class="status" id="productStatus"></div>
</div>
</div>
<!-- Controls Section -->
<div class="controls-section">
<h3>⚙️ Chỉnh Sửa</h3>
<div class="current-editing" id="currentEditing" style="display: none;">
<strong>Đang chỉnh sửa:</strong> <span id="currentProductName">Không có</span>
</div>
<div class="selected-info" id="selectedInfo" style="display: none;">
<strong>🎯 ĐÃ CHỌN HÀNG LOẠT:</strong> <span id="selectedCount">0</span> thumbnail(s) - Sẵn sàng chỉnh sửa!
            </div>
<div class="control-group">
<div class="control-item">
<label>Scale (0.1x - 3x)</label>
<input id="globalScale" max="3" min="0.1" step="0.1" type="range" value="0.6"/>
<span id="globalScaleValue">0.6x</span>
</div>
<div class="control-item">
<label>Vị Trí X</label>
<input id="globalX" max="600" min="-600" placeholder="Vị trí X" type="number" value="0"/>
</div>
<div class="control-item">
<label>Vị Trí Y</label>
<input id="globalY" max="600" min="-600" placeholder="Vị trí Y" type="number" value="0"/>
</div>
</div>
<div class="control-buttons">
<button class="control-btn" onclick="applyChanges()">Áp Dụng</button>
<button class="control-btn" onclick="centerProducts()">Căn Giữa</button>
<button class="control-btn" onclick="resetPositions()">Reset Vị Trí</button>
<button class="control-btn" onclick="selectAllThumbnails()">Chọn Tất Cả</button>
<button class="control-btn" onclick="deselectAllThumbnails()">Bỏ Chọn Tất Cả</button>
</div>
</div>
<!-- Download Section -->
<div class="download-section">
<h3>💾 Tải Xuống</h3>
<div class="download-buttons">
<button class="download-btn" disabled="" id="downloadSelected" onclick="downloadSelected()">
                    Tải Thumbnail Đã Chọn
                </button>
<button class="download-btn" disabled="" id="downloadAll" onclick="downloadAll()">
                    Tải Tất Cả Thumbnail
                </button>
</div>
<div class="progress-bar" id="progressBar">
<div class="progress-fill" id="progressFill"></div>
</div>
</div>
<!-- Thumbnails Grid -->
<div class="thumbnails-grid" id="thumbnailsGrid"></div>
<div class="workspace-info" id="workspaceInfo">
            Tải lên phông nền và sản phẩm để bắt đầu tạo thumbnail
        </div>
<!-- Copyright Section -->
<div class="copyright-section">
<div class="copyright-content">
<span class="copyright-icon">🎨</span>
<span class="copyright-text">Copyright © 2025 Tien Hoang</span>
<span class="copyright-icon">✨</span>
</div>
<div class="cute-icons">
<span class="cute-icon">🐱</span>
<span class="cute-icon">🌸</span>
<span class="cute-icon">💫</span>
<span class="cute-icon">🦄</span>
<span class="cute-icon">🌈</span>
</div>
</div>
</div><script>
        let backgroundImage = null;
        let products = [];
        let selectedThumbnails = new Set();
        let currentEditingProduct = null;

        // Remove background from image
        function removeBackground(imageData, canvas) {
            const ctx = canvas.getContext('2d');
            const data = imageData.data;
            
            // Sample corner colors to detect background
            const corners = [
                [0, 0], [canvas.width - 1, 0], 
                [0, canvas.height - 1], [canvas.width - 1, canvas.height - 1]
            ];
            
            let bgColors = [];
            corners.forEach(([x, y]) => {
                const idx = (y * canvas.width + x) * 4;
                bgColors.push([data[idx], data[idx + 1], data[idx + 2]]);
            });
            
            // Find most common background color
            let bgColor = bgColors[0];
            
            // Remove background
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Check if pixel is similar to background color
                const colorDiff = Math.abs(r - bgColor[0]) + Math.abs(g - bgColor[1]) + Math.abs(b - bgColor[2]);
                
                // If similar to background or white-ish, make transparent
                if (colorDiff < 50 || (r > 240 && g > 240 && b > 240)) {
                    data[i + 3] = 0; // Make transparent
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            return canvas;
        }

        // Handle background upload
        document.getElementById('backgroundInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        backgroundImage = img;
                        showStatus('backgroundStatus', 'Phông nền đã tải lên thành công!', 'success');
                        updateDownloadButtons();
                        updateWorkspaceInfo();
                        generateThumbnails();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Handle product upload
        document.getElementById('productInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            
            showStatus('productStatus', `Đang xử lý ${files.length} sản phẩm...`, 'success');
            
            let processed = 0;
            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        // Create canvas for background removal
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        
                        ctx.drawImage(img, 0, 0);
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        
                        // Remove background
                        removeBackground(imageData, canvas);
                        
                        // Create product object
                        const product = {
                            id: Date.now() + index,
                            name: file.name.replace(/\.[^/.]+$/, ""),
                            image: img,
                            canvas: canvas,
                            scale: 0.6,
                            x: 0,
                            y: 0
                        };
                        
                        products.push(product);
                        processed++;
                        
                        if (processed === files.length) {
                            showStatus('productStatus', `Đã tải lên ${files.length} sản phẩm thành công!`, 'success');
                            generateThumbnails();
                            updateDownloadButtons();
                            updateWorkspaceInfo();
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        });

        // Generate thumbnails
        function generateThumbnails() {
            const grid = document.getElementById('thumbnailsGrid');
            grid.innerHTML = '';
            
            products.forEach(product => {
                const thumbnailDiv = document.createElement('div');
                thumbnailDiv.className = 'thumbnail-item';
                thumbnailDiv.setAttribute('data-id', product.id);
                
                // Update selection state
                if (selectedThumbnails.has(product.id)) {
                    thumbnailDiv.classList.add('selected');
                }
                
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                canvas.className = 'thumbnail-canvas';
                
                const ctx = canvas.getContext('2d');
                
                // Clear canvas with white background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw background if available (fit to square)
                if (backgroundImage) {
                    // Calculate scale to fit square while maintaining aspect ratio
                    const bgScale = Math.min(canvas.width / backgroundImage.width, canvas.height / backgroundImage.height);
                    const bgWidth = backgroundImage.width * bgScale;
                    const bgHeight = backgroundImage.height * bgScale;
                    const bgX = (canvas.width - bgWidth) / 2;
                    const bgY = (canvas.height - bgHeight) / 2;
                    
                    ctx.drawImage(backgroundImage, bgX, bgY, bgWidth, bgHeight);
                }
                
                // Draw product
                const productCanvas = product.canvas;
                const scale = product.scale;
                const x = product.x * (canvas.width / 1200) + canvas.width / 2;
                const y = product.y * (canvas.height / 1200) + canvas.height / 2;
                
                const scaledWidth = productCanvas.width * scale * (canvas.width / 1200);
                const scaledHeight = productCanvas.height * scale * (canvas.height / 1200);
                
                ctx.drawImage(
                    productCanvas,
                    x - scaledWidth / 2,
                    y - scaledHeight / 2,
                    scaledWidth,
                    scaledHeight
                );
                
                // Create thumbnail info
                const info = document.createElement('div');
                info.className = 'thumbnail-info';
                info.innerHTML = `
                    <span class="thumbnail-name">${product.name}</span>
                    <button class="delete-btn" onclick="deleteProduct(${product.id})">Xóa</button>
                `;
                
                thumbnailDiv.appendChild(canvas);
                thumbnailDiv.appendChild(info);
                
                // Add click event for selection/editing
                thumbnailDiv.addEventListener('click', function(e) {
                    if (e.target.classList.contains('delete-btn')) return;
                    
                    // If holding Ctrl/Cmd, toggle selection for batch editing
                    if (e.ctrlKey || e.metaKey) {
                        toggleThumbnailSelection(product.id);
                    } else {
                        // Single click - select for individual editing
                        setCurrentEditingProduct(product.id);
                    }
                });
                
                grid.appendChild(thumbnailDiv);
            });
        }

        // Set current editing product
        function setCurrentEditingProduct(productId) {
            currentEditingProduct = productId;
            const product = products.find(p => p.id === productId);
            
            if (product) {
                // Update control values to match current product
                document.getElementById('globalScale').value = product.scale;
                document.getElementById('globalX').value = product.x;
                document.getElementById('globalY').value = product.y;
                document.getElementById('globalScaleValue').textContent = product.scale + 'x';
                
                // Update current editing display
                document.getElementById('currentEditing').style.display = 'block';
                document.getElementById('currentProductName').textContent = product.name;
                
                // Clear batch selection when editing individual product
                selectedThumbnails.clear();
                updateSelectedInfo();
                updateDownloadButtons();
                
                // Remove all selection highlights and add editing highlight
                document.querySelectorAll('.thumbnail-item').forEach(item => {
                    item.classList.remove('selected');
                    if (item.getAttribute('data-id') == productId) {
                        item.style.border = '3px solid #ffc107';
                    } else {
                        item.style.border = '3px solid transparent';
                    }
                });
            }
        }

        // Toggle thumbnail selection for batch editing
        function toggleThumbnailSelection(productId) {
            // Clear individual editing mode
            currentEditingProduct = null;
            document.getElementById('currentEditing').style.display = 'none';
            document.querySelectorAll('.thumbnail-item').forEach(item => {
                item.style.border = '3px solid transparent';
            });
            
            const thumbnailDiv = document.querySelector(`[data-id="${productId}"]`);
            
            if (selectedThumbnails.has(productId)) {
                selectedThumbnails.delete(productId);
                thumbnailDiv.classList.remove('selected');
            } else {
                selectedThumbnails.add(productId);
                thumbnailDiv.classList.add('selected');
            }
            
            updateSelectedInfo();
            updateDownloadButtons();
        }

        // Select all thumbnails
        function selectAllThumbnails() {
            currentEditingProduct = null;
            document.getElementById('currentEditing').style.display = 'none';
            document.querySelectorAll('.thumbnail-item').forEach(item => {
                item.style.border = '3px solid transparent';
            });
            
            products.forEach(product => {
                selectedThumbnails.add(product.id);
                const thumbnailDiv = document.querySelector(`[data-id="${product.id}"]`);
                thumbnailDiv.classList.add('selected');
            });
            updateSelectedInfo();
            updateDownloadButtons();
        }

        // Deselect all thumbnails
        function deselectAllThumbnails() {
            currentEditingProduct = null;
            document.getElementById('currentEditing').style.display = 'none';
            
            selectedThumbnails.clear();
            document.querySelectorAll('.thumbnail-item').forEach(item => {
                item.classList.remove('selected');
                item.style.border = '3px solid transparent';
            });
            updateSelectedInfo();
            updateDownloadButtons();
        }

        // Update selected info
        function updateSelectedInfo() {
            const selectedInfo = document.getElementById('selectedInfo');
            const selectedCount = document.getElementById('selectedCount');
            
            if (selectedThumbnails.size > 0) {
                selectedInfo.style.display = 'block';
                selectedCount.textContent = selectedThumbnails.size;
            } else {
                selectedInfo.style.display = 'none';
            }
        }

        // Delete product
        function deleteProduct(productId) {
            products = products.filter(p => p.id !== productId);
            selectedThumbnails.delete(productId);
            if (currentEditingProduct === productId) {
                currentEditingProduct = null;
                document.getElementById('currentEditing').style.display = 'none';
            }
            generateThumbnails();
            updateSelectedInfo();
            updateDownloadButtons();
            updateWorkspaceInfo();
        }

        // Apply changes (works for both individual and batch editing)
        function applyChanges() {
            const scale = parseFloat(document.getElementById('globalScale').value);
            const x = parseInt(document.getElementById('globalX').value) || 0;
            const y = parseInt(document.getElementById('globalY').value) || 0;
            
            let targetProducts = [];
            
            // If editing individual product
            if (currentEditingProduct) {
                targetProducts = products.filter(p => p.id === currentEditingProduct);
            }
            // If batch editing selected products
            else if (selectedThumbnails.size > 0) {
                targetProducts = products.filter(p => selectedThumbnails.has(p.id));
            }
            // If nothing selected, apply to all
            else {
                targetProducts = products;
            }
            
            targetProducts.forEach(product => {
                product.scale = scale;
                product.x = x;
                product.y = y;
            });
            
            generateThumbnails();
        }

        // Center products
        function centerProducts() {
            let targetProducts = [];
            
            // If editing individual product
            if (currentEditingProduct) {
                targetProducts = products.filter(p => p.id === currentEditingProduct);
            }
            // If batch editing selected products
            else if (selectedThumbnails.size > 0) {
                targetProducts = products.filter(p => selectedThumbnails.has(p.id));
            }
            // If nothing selected, apply to all
            else {
                targetProducts = products;
            }
            
            targetProducts.forEach(product => {
                product.x = 0;
                product.y = 0;
            });
            
            document.getElementById('globalX').value = 0;
            document.getElementById('globalY').value = 0;
            
            generateThumbnails();
        }

        // Reset positions
        function resetPositions() {
            let targetProducts = [];
            
            // If editing individual product
            if (currentEditingProduct) {
                targetProducts = products.filter(p => p.id === currentEditingProduct);
            }
            // If batch editing selected products
            else if (selectedThumbnails.size > 0) {
                targetProducts = products.filter(p => selectedThumbnails.has(p.id));
            }
            // If nothing selected, apply to all
            else {
                targetProducts = products;
            }
            
            targetProducts.forEach(product => {
                product.scale = 0.6;
                product.x = 0;
                product.y = 0;
            });
            
            document.getElementById('globalScale').value = 0.6;
            document.getElementById('globalX').value = 0;
            document.getElementById('globalY').value = 0;
            document.getElementById('globalScaleValue').textContent = '0.6x';
            
            generateThumbnails();
        }

        // Update scale value display
        document.getElementById('globalScale').addEventListener('input', function() {
            document.getElementById('globalScaleValue').textContent = this.value + 'x';
        });

        // Download selected thumbnails
        function downloadSelected() {
            if (selectedThumbnails.size === 0) return;
            
            const selectedProducts = products.filter(p => selectedThumbnails.has(p.id));
            
            if (selectedProducts.length === 1) {
                // Download single file
                downloadSingleThumbnail(selectedProducts[0]);
            } else {
                // Download multiple files
                downloadMultipleThumbnails(selectedProducts);
            }
        }

        // Download all thumbnails
        function downloadAll() {
            if (products.length === 0) return;
            
            if (products.length === 1) {
                downloadSingleThumbnail(products[0]);
            } else {
                downloadMultipleThumbnails(products);
            }
        }

        // Download single thumbnail
        function downloadSingleThumbnail(product) {
            const canvas = document.createElement('canvas');
            canvas.width = 1200;
            canvas.height = 1200;
            const ctx = canvas.getContext('2d');
            
            // Draw background
            if (backgroundImage) {
                ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
            }
            
            // Draw product
            const productCanvas = product.canvas;
            const scale = product.scale;
            const x = product.x + canvas.width / 2;
            const y = product.y + canvas.height / 2;
            
            const scaledWidth = productCanvas.width * scale;
            const scaledHeight = productCanvas.height * scale;
            
            ctx.drawImage(
                productCanvas,
                x - scaledWidth / 2,
                y - scaledHeight / 2,
                scaledWidth,
                scaledHeight
            );
            
            // Download
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${product.name}_thumbnail.png`;
                a.click();
                URL.revokeObjectURL(url);
            }, 'image/png');
        }

        // Download multiple thumbnails
        function downloadMultipleThumbnails(targetProducts) {
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';
            
            let processed = 0;
            
            targetProducts.forEach((product, index) => {
                setTimeout(() => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 1200;
                    canvas.height = 1200;
                    const ctx = canvas.getContext('2d');
                    
                    // Draw background
                    if (backgroundImage) {
                        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                    }
                    
                    // Draw product
                    const productCanvas = product.canvas;
                    const scale = product.scale;
                    const x = product.x + canvas.width / 2;
                    const y = product.y + canvas.height / 2;
                    
                    const scaledWidth = productCanvas.width * scale;
                    const scaledHeight = productCanvas.height * scale;
                    
                    ctx.drawImage(
                        productCanvas,
                        x - scaledWidth / 2,
                        y - scaledHeight / 2,
                        scaledWidth,
                        scaledHeight
                    );
                    
                    // Download
                    canvas.toBlob(function(blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${product.name}_thumbnail.png`;
                        a.click();
                        URL.revokeObjectURL(url);
                        
                        processed++;
                        const progress = (processed / targetProducts.length) * 100;
                        progressFill.style.width = progress + '%';
                        
                        if (processed === targetProducts.length) {
                            setTimeout(() => {
                                progressBar.style.display = 'none';
                            }, 1000);
                        }
                    }, 'image/png');
                }, index * 100); // Delay each download by 100ms
            });
        }

        // Show status message
        function showStatus(elementId, message, type) {
            const statusEl = document.getElementById(elementId);
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            }
        }

        // Update download buttons
        function updateDownloadButtons() {
            const downloadSelected = document.getElementById('downloadSelected');
            const downloadAll = document.getElementById('downloadAll');
            
            downloadSelected.disabled = selectedThumbnails.size === 0 || !backgroundImage;
            downloadAll.disabled = products.length === 0 || !backgroundImage;
        }

        // Update workspace info
        function updateWorkspaceInfo() {
            const info = document.getElementById('workspaceInfo');
            if (products.length === 0) {
                info.textContent = 'Tải lên phông nền và sản phẩm để bắt đầu tạo thumbnail';
            } else {
                info.textContent = `Workspace: ${products.length} sản phẩm đã tải lên${backgroundImage ? ' | Phông nền: Đã sẵn sàng' : ' | Cần tải phông nền'}`;
            }
        }

        // Initialize
        updateDownloadButtons();
        updateWorkspaceInfo();
    </script></div>
<div class="iframe-container" id="frame3"><div class="container">
<div class="header">
<h1>🌙 Tạo Mô Tả Sản Phẩm - iBasic Việt Nam</h1>
<p>Công cụ tạo mô tả sản phẩm chuyên nghiệp với AI</p>
</div>
<div class="main-content">
<div class="input-section">
<div class="section-title">
                    📝 INPUT A - Thông tin sản phẩm
                </div>
<div class="section-title" style="margin-bottom: 10px;">
                    🔧 Cấu hình API Google Gemini
                </div>
<div class="form-group">
<label for="apiKey">API Key Google Gemini:</label>
<input id="apiKey" placeholder="Nhập API Key của bạn (AIza...)" style="font-family: monospace;" type="password"/>
<small style="color: #6c757d; font-size: 12px;">
                        API Key sẽ chỉ lưu trong session này và không được gửi đến máy chủ nào khác. 
                        <a href="https://makersuite.google.com/app/apikey" style="color: #4ecdc4;" target="_blank">Lấy API Key tại đây</a>
</small>
</div>
<div class="ai-note">
<strong>Hướng dẫn:</strong> Nhập API Key Google Gemini để sử dụng AI thực tế. Nếu để trống, hệ thống sẽ tạo mô tả mẫu.
                </div>
<form id="productForm">
<div class="form-group">
<label for="productType">Loại sản phẩm:</label>
<select id="productType" name="productType" required="">
<option value="">Chọn loại sản phẩm</option>
<option value="quần lót">Quần lót</option>
<option value="áo ngực">Áo ngực</option>
<option value="pyjama">Pyjama</option>
<option value="đầm ngủ">Đầm ngủ</option>
<option value="khác">Khác</option>
</select>
</div>
<div class="form-group">
<label for="productName">Tên sản phẩm:</label>
<input id="productName" name="productName" required="" type="text"/>
</div>
<div class="form-group">
<label for="material">Chất liệu:</label>
<input id="material" name="material" required="" type="text"/>
</div>
<div class="form-row">
<div class="form-group">
<label for="style">Kiểu dáng:</label>
<textarea id="style" name="style" placeholder="Mô tả kiểu dáng tổng quát"></textarea>
</div>
<div class="form-group">
<label for="design">Thiết kế:</label>
<textarea id="design" name="design" placeholder="Mô tả thiết kế chi tiết"></textarea>
</div>
</div>
<div class="form-group">
<label for="topFit">Phom áo:</label>
<input id="topFit" name="topFit" type="text"/>
</div>
<div class="form-group">
<label for="bottomFit">Phom quần:</label>
<input id="bottomFit" name="bottomFit" type="text"/>
</div>
<div class="form-group">
<label for="padding">Mút:</label>
<input id="padding" name="padding" type="text"/>
</div>
<div class="form-group">
<label for="straps">Dây vai:</label>
<input id="straps" name="straps" type="text"/>
</div>
<div class="form-group">
<label for="waistband">Bản lưng:</label>
<input id="waistband" name="waistband" type="text"/>
</div>
<div class="form-group">
<label for="clasp">Mắc cài:</label>
<input id="clasp" name="clasp" type="text"/>
</div>
<div class="form-group">
<label for="color">Màu sắc:</label>
<input id="color" name="color" required="" type="text"/>
</div>
<div class="form-group">
<label for="size">Kích thước:</label>
<input id="size" name="size" required="" type="text"/>
</div>
<div class="form-group">
<label for="gender">Giới tính:</label>
<select id="gender" name="gender" required="">
<option value="">Chọn giới tính</option>
<option value="nữ">Nữ</option>
<option value="nam">Nam</option>
<option value="bé gái">Bé gái</option>
<option value="bé trai">Bé trai</option>
</select>
</div>
<div class="form-group">
<label for="age">Độ tuổi:</label>
<select id="age" name="age">
<option value="">Không xác định</option>
<option value="học sinh">Học sinh</option>
<option value="người lớn">Người lớn</option>
<option value="trẻ em">Trẻ em</option>
<option value="mọi lứa tuổi">Mọi lứa tuổi</option>
</select>
</div>
<div class="form-group">
<label for="descriptionStyle">Loại mô tả theo phong cách:</label>
<select id="descriptionStyle" name="descriptionStyle">
<option value="">Chọn phong cách</option>
<option value="storytelling">Phong cách kể chuyện (Storytelling)</option>
<option value="minimalist">Phong cách tối giản (Minimalist)</option>
<option value="luxury">Phong cách sang trọng, cao cấp (Luxury/Exclusive)</option>
<option value="friendly">Phong cách thân thiện, gần gũi (Friendly, Approachable)</option>
</select>
</div>
<div class="form-group">
<label for="other">Nội dung khác:</label>
<textarea id="other" name="other"></textarea>
</div>
<div class="form-group">
<label for="mixMatch">Mix - Match:</label>
<textarea id="mixMatch" name="mixMatch"></textarea>
</div>
<div class="form-group">
<label for="composition">Thành phần:</label>
<textarea id="composition" name="composition"></textarea>
</div>
</form>
<div class="section-title" style="margin-top: 30px;">
                    📷 INPUT B - Hình ảnh sản phẩm
                </div>
<div class="form-group">
<label>Hình ảnh sản phẩm (tối đa 3 hình):</label>
<div class="file-upload">
<input accept="image/*" id="images" multiple="" type="file"/>
<label class="file-upload-label" for="images">📸 Chọn hình ảnh sản phẩm</label>
</div>
<div class="file-preview" id="imagePreview"></div>
</div>
<button class="generate-btn" onclick="generateDescription()" type="button">
                    🤖 Tạo Mô Tả Sản Phẩm với AI
                </button>
</div>
<div class="output-section">
<div class="section-title">
                    ✨ Kết quả mô tả sản phẩm
                </div>
<div class="output-content" id="outputContent">
<p style="text-align: center; color: #6c757d; padding: 40px;">
                        Nhập thông tin sản phẩm và nhấn "Tạo Mô Tả Sản Phẩm" để xem kết quả
                    </p>
</div>
<div class="button-group">
<button class="copy-btn" id="copyBtn" onclick="copyToClipboard()" style="display: none;">
                        📋 Sao chép mô tả
                    </button>
<button class="regenerate-btn" id="regenerateBtn" onclick="regenerateDescription()" style="display: none;">
                        🔄 Tạo lại mô tả
                    </button>
<button class="download-btn" id="downloadBtn" onclick="downloadDocx()" style="display: none;">
                        📥 Tải xuống DOCX
                    </button>
</div>
</div>
</div>
<div class="copyright">
            © 2025 by Tien Hoang 🌟
        </div>
</div><script>
        // Store product data and API key for regeneration
        let lastProductData = null;
        let lastApiKey = null;

        // Preview images with limit of 3
        document.getElementById('images').addEventListener('change', function(e) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            const files = Array.from(e.target.files);
            
            if (files.length > 3) {
                alert('Vui lòng chỉ tải lên tối đa 3 hình ảnh!');
                e.target.value = ''; // Reset input
                return;
            }

            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    preview.appendChild(img);
                }
            });
        });

        async function generateDescription() {
            const outputContent = document.getElementById('outputContent');
            const copyBtn = document.getElementById('copyBtn');
            const regenerateBtn = document.getElementById('regenerateBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const apiKey = document.getElementById('apiKey').value.trim();
            
            // Show loading
            outputContent.innerHTML = '<div class="loading">Đang tạo mô tả sản phẩm với AI...</div>';
            copyBtn.style.display = 'none';
            regenerateBtn.style.display = 'none';
            downloadBtn.style.display = 'none';
            
            // Get form data
            const formData = new FormData(document.getElementById('productForm'));
            lastProductData = {
                productType: formData.get('productType'),
                productName: formData.get('productName'),
                material: formData.get('material'),
                style: formData.get('style'),
                topFit: formData.get('topFit'),
                bottomFit: formData.get('bottomFit'),
                design: formData.get('design'),
                padding: formData.get('padding'),
                straps: formData.get('straps'),
                waistband: formData.get('waistband'),
                clasp: formData.get('clasp'),
                color: formData.get('color'),
                size: formData.get('size'),
                gender: formData.get('gender'),
                age: formData.get('age'),
                descriptionStyle: formData.get('descriptionStyle'),
                other: formData.get('other'),
                mixMatch: formData.get('mixMatch'),
                composition: formData.get('composition')
            };
            lastApiKey = apiKey;
            
            // Validation
            if (!lastProductData.productType || !lastProductData.productName || !lastProductData.material || !lastProductData.color || !lastProductData.size || !lastProductData.gender) {
                outputContent.innerHTML = '<p style="color: #dc3545; text-align: center;">Vui lòng điền đầy đủ các thông tin bắt buộc (loại sản phẩm, tên sản phẩm, chất liệu, màu sắc, kích thước, giới tính)</p>';
                return;
            }
            
            try {
                let description;
                
                if (apiKey && apiKey.startsWith('AIza')) {
                    // Use real Gemini API
                    description = await generateWithGeminiAPI(apiKey, lastProductData, false);
                } else {
                    // Use simulated description
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    description = generateSimulatedDescription(lastProductData);
                }
                
                outputContent.innerHTML = description;
                copyBtn.style.display = 'block';
                regenerateBtn.style.display = 'block';
                downloadBtn.style.display = 'block';
                
            } catch (error) {
                console.error('Error generating description:', error);
                outputContent.innerHTML = `
                    <p style="color: #dc3545; text-align: center;">
                        Lỗi khi tạo mô tả: ${error.message}<br>
                        <small>Đang chuyển sang chế độ mô phỏng...</small>
                    </p>
                `;
                
                // Fallback to simulated description
                setTimeout(() => {
                    const description = generateSimulatedDescription(lastProductData);
                    outputContent.innerHTML = description;
                    copyBtn.style.display = 'block';
                    regenerateBtn.style.display = 'block';
                    downloadBtn.style.display = 'block';
                }, 1000);
            }
        }

        async function regenerateDescription() {
            if (!lastProductData) {
                alert('Vui lòng tạo mô tả ban đầu trước khi tạo lại!');
                return;
            }

            const outputContent = document.getElementById('outputContent');
            const copyBtn = document.getElementById('copyBtn');
            const regenerateBtn = document.getElementById('regenerateBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // Show loading
            outputContent.innerHTML = '<div class="loading">Đang tạo lại mô tả sản phẩm với AI...</div>';
            copyBtn.style.display = 'none';
            regenerateBtn.style.display = 'none';
            downloadBtn.style.display = 'none';
            
            try {
                let description;
                
                if (lastApiKey && lastApiKey.startsWith('AIza')) {
                    // Use real Gemini API with regeneration flag
                    description = await generateWithGeminiAPI(lastApiKey, lastProductData, true);
                } else {
                    // Use simulated description
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    description = generateSimulatedDescription(lastProductData);
                }
                
                outputContent.innerHTML = description;
                copyBtn.style.display = 'block';
                regenerateBtn.style.display = 'block';
                downloadBtn.style.display = 'block';
                
            } catch (error) {
                console.error('Error regenerating description:', error);
                outputContent.innerHTML = `
                    <p style="color: #dc3545; text-align: center;">
                        Lỗi khi tạo lại mô tả: ${error.message}<br>
                        <small>Đang chuyển sang chế độ mô phỏng...</small>
                    </p>
                `;
                
                // Fallback to simulated description
                setTimeout(() => {
                    const description = generateSimulatedDescription(lastProductData);
                    outputContent.innerHTML = description;
                    copyBtn.style.display = 'block';
                    regenerateBtn.style.display = 'block';
                    downloadBtn.style.display = 'block';
                }, 1000);
            }
        }

        async function generateWithGeminiAPI(apiKey, productData, isRegenerate) {
            const prompt = createPromptForGemini(productData, isRegenerate);
            const imageFiles = document.getElementById('images').files;
            const contents = [{
                parts: [{ text: prompt }]
            }];

            // Add up to 3 images to the request
            let imageCount = 0;
            for (let file of imageFiles) {
                if (file.type.startsWith('image/') && imageCount < 3) {
                    const base64Image = await new Promise(resolve => {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result.split(',')[1]);
                        reader.readAsDataURL(file);
                    });
                    contents[0].parts.push({
                        inlineData: {
                            mimeType: file.type,
                            data: base64Image
                        }
                    });
                    imageCount++;
                }
            }

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents,
                    generationConfig: {
                        temperature: isRegenerate ? 0.9 : 0.7, // Higher temperature for varied wording
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 512
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.status} - ${response.statusText}`);
            }

            const data = await response.json();
            if (!data.candidates || !data.candidates[0].content) {
                throw new Error('Không nhận được phản hồi từ Gemini AI');
            }

            const aiResponse = data.candidates[0].content.parts[0].text;
            return formatAIResponse(aiResponse, productData);
        }

        function createPromptForGemini(productData, isRegenerate = false) {
            const regenerateInstruction = isRegenerate ? "Sử dụng câu từ mới, khác với mô tả trước đó, nhưng giữ nguyên ý nghĩa và phong cách." : "";
            // Only include non-empty fields in the prompt
            const productInfo = [];
            if (productData.productType) productInfo.push(`- Loại sản phẩm: ${productData.productType}`);
            if (productData.productName) productInfo.push(`- Tên sản phẩm: ${productData.productName}`);
            if (productData.material) productInfo.push(`- Chất liệu: ${productData.material}`);
            if (productData.style) productInfo.push(`- Kiểu dáng: ${productData.style}`);
            if (productData.topFit) productInfo.push(`- Phom áo: ${productData.topFit}`);
            if (productData.bottomFit) productInfo.push(`- Phom quần: ${productData.bottomFit}`);
            if (productData.design) productInfo.push(`- Thiết kế: ${productData.design}`);
            if (productData.padding) productInfo.push(`- Mút: ${productData.padding}`);
            if (productData.straps) productInfo.push(`- Dây vai: ${productData.straps}`);
            if (productData.waistband) productInfo.push(`- Bản lưng: ${productData.waistband}`);
            if (productData.clasp) productInfo.push(`- Mắc cài: ${productData.clasp}`);
            if (productData.color) productInfo.push(`- Màu sắc: ${productData.color}`);
            if (productData.size) productInfo.push(`- Kích thước: ${productData.size}`);
            if (productData.gender) productInfo.push(`- Giới tính: ${productData.gender}`);
            if (productData.age) productInfo.push(`- Độ tuổi: ${productData.age}`);
            if (productData.descriptionStyle) productInfo.push(`- Phong cách mô tả: ${productData.descriptionStyle}`);
            if (productData.other) productInfo.push(`- Nội dung khác: ${productData.other}`);
            if (productData.mixMatch) productInfo.push(`- Mix-Match: ${productData.mixMatch}`);
            if (productData.composition) productInfo.push(`- Thành phần: ${productData.composition}`);

            const descriptionStyleText = productData.descriptionStyle ? 
                `Viết mô tả theo phong cách ${productData.descriptionStyle} (storytelling: kể một câu chuyện ngắn liên quan đến sản phẩm, nhấn mạnh cảm xúc; minimalist: ngắn gọn, súc tích, tập trung vào yếu tố cốt lõi; luxury: tinh tế, cao cấp, sử dụng ngôn ngữ sang trọng; friendly: thân thiện, gần gũi, dễ hiểu với mọi người).` : 
                "Viết mô tả với giọng văn chuyên nghiệp, tinh tế, phù hợp thời trang iBasic Việt Nam.";

            return `
Bạn là chuyên gia viết mô tả sản phẩm thời trang chuyên nghiệp cho iBasic Việt Nam. 
Chỉ tập trung mô tả sản phẩm chính là "${productData.productType}" (ví dụ: quần lót, áo ngực, pyjama, đầm ngủ), không đề cập đến các sản phẩm khác.
Phân tích tối đa 3 hình ảnh sản phẩm (nếu có) và thông tin sau để tạo mô tả chuẩn SEO:

THÔNG TIN SẢN PHẨM:
${productInfo.join('\n')}

YÊU CẦU:
1. ${regenerateInstruction}
2. Chỉ sử dụng các trường thông tin được cung cấp ở trên, bỏ qua các trường không có nội dung.
3. Viết mô tả chuẩn SEO, mỗi gạch đầu dòng dưới 150 từ, tích hợp chi tiết từ tối đa 3 hình ảnh (kiểu dáng, thiết kế, màu sắc).
4. Tích hợp từ khóa SEO: "${productData.productName}", "${productData.productType} ${productData.gender}", "iBasic Việt Nam", "thời trang ${productData.gender}", "chất liệu ${productData.material}", "màu ${productData.color}".
5. Cấu trúc:
   - Tên sản phẩm: In đậm, cỡ chữ 14pt.
   - 3 gạch đầu dòng (cỡ chữ 12pt, dưới 150 từ mỗi dòng):
     - Kiểu dáng: Mô tả phom dáng từ hình ảnh và thông tin kiểu dáng/phom áo/phom quần, phù hợp "${productData.productType}", "${productData.gender}", "${productData.age || 'mọi lứa tuổi'}".
     - Thiết kế: Mô tả chi tiết từ hình ảnh và thông tin thiết kế (mút, dây vai, bản lưng, mắc cài) liên quan đến "${productData.productType}".
     - Màu sắc & Mix-Match: Mô tả màu sắc từ hình ảnh, gợi ý phối đồ phù hợp "${productData.productType}".
   - Thông số kỹ thuật (cỡ chữ 12pt): Chỉ liệt kê các trường có nội dung (chất liệu, thành phần, kích thước, màu sắc).
6. ${descriptionStyleText}
7. Tránh lặp từ, sử dụng ngôn ngữ tự nhiên, tránh quảng cáo quá mức.
8. Không thêm CTA.

Chỉ trả về nội dung mô tả, không cần giải thích thêm.
            `;
        }

        function formatAIResponse(aiResponse, productData) {
            const cleanResponse = aiResponse.replace(/\*\*/g, '').replace(/\*/g, '').trim();
            const lines = cleanResponse.split('\n').filter(line => line.trim());
            let bulletPoints = lines.filter(line => line.startsWith('-') || line.includes('•')).slice(0, 3);
            
            // Ensure each bullet point is under 150 words and remove duplicate titles
            const formattedBullets = bulletPoints.map((point, index) => {
                let text = point.replace(/^[-•]\s*/, '').trim();
                const titles = ['Kiểu dáng:', 'Thiết kế:', 'Màu sắc & Mix-Match:'];
                const title = titles[index];
                if (text.startsWith(title)) {
                    text = text.replace(new RegExp(`^${title}\\s*`), ''); // Remove duplicate title if present
                }
                const words = text.split(' ');
                if (words.length > 150) {
                    text = words.slice(0, 150).join(' ');
                } else if (words.length < 30) {
                    text += ' ' + generateFillerText(index, productData, 30 - words.length);
                }
                return text;
            });
            
            // If fewer than 3 bullet points, generate defaults
            while (formattedBullets.length < 3) {
                formattedBullets.push(generateFillerText(formattedBullets.length, productData, 30));
            }

            // Only include non-empty fields in specs
            const specs = [];
            if (productData.material) specs.push(`<p><strong>Chất liệu:</strong> ${productData.material}</p>`);
            if (productData.composition) specs.push(`<p><strong>Thành phần:</strong> ${productData.composition}</p>`);
            if (productData.size) specs.push(`<p><strong>Kích thước:</strong> ${productData.size}</p>`);
            if (productData.color) specs.push(`<p><strong>Màu sắc:</strong> ${productData.color}</p>`);

            return `
                <div class="product-title" style="font-size: 14pt; font-weight: bold;">${productData.productName}</div>
                <div class="product-description">
                    <ul>
                        <li style="font-size: 12pt;"><strong>Kiểu dáng:</strong> ${formattedBullets[0]}</li>
                        <li style="font-size: 12pt;"><strong>Thiết kế:</strong> ${formattedBullets[1]}</li>
                        <li style="font-size: 12pt;"><strong>Màu sắc & Mix-Match:</strong> ${formattedBullets[2]}</li>
                    </ul>
                    
                    <div class="specs" style="font-size: 12pt;">
                        ${specs.join('\n')}
                    </div>
                </div>
            `;
        }

        function generateFillerText(typeIndex, productData, wordCount) {
            const ageText = productData.age === 'học sinh' ? 'học sinh năng động' : 
                           productData.age === 'người lớn' ? 'người lớn hiện đại' : 
                           productData.age === 'trẻ em' ? 'trẻ em đáng yêu' : 
                           productData.age === 'mọi lứa tuổi' ? 'mọi lứa tuổi' : 'mọi lứa tuổi';
            const styleText = productData.descriptionStyle === 'storytelling' ? 'một câu chuyện về sự thoải mái' :
                             productData.descriptionStyle === 'minimalist' ? 'thiết kế đơn giản, tinh tế' :
                             productData.descriptionStyle === 'luxury' ? 'phong cách cao cấp, sang trọng' :
                             productData.descriptionStyle === 'friendly' ? 'thân thiện, gần gũi' : 'chuyên nghiệp, thời trang';
            const baseText = {
                0: `${styleText}. Phom ${productData.productType === 'áo ngực' ? 'áo' : 'quần'} ${productData.topFit || productData.bottomFit || 'chuẩn'}. Chất liệu ${productData.material} mềm mại, phù hợp ${ageText}.`,
                1: `${styleText}. ${productData.padding ? `Mút ${productData.padding}, ` : ''}${productData.straps ? `dây vai ${productData.straps}, ` : ''}${productData.waistband ? `bản lưng ${productData.waistband}, ` : ''}${productData.clasp ? `mắc cài ${productData.clasp}. ` : ''}Chất liệu ${productData.material} thoáng khí.`,
                2: `Màu ${productData.color} linh hoạt, dễ phối đồ. ${productData.mixMatch ? productData.mixMatch : 'Phù hợp nhiều phong cách'}. ${styleText} cho ${productData.productType} ${productData.gender}, lý tưởng cho ${ageText}.`
            };

            let text = baseText[typeIndex];
            const currentWordCount = text.split(' ').length;
            if (currentWordCount < wordCount) {
                const fillerText = `${styleText}. ${productData.productType} ${productData.gender} iBasic Việt Nam với chất liệu ${productData.material} cao cấp, màu ${productData.color} thời thượng. ${productData.productName} mang lại sự thoải mái và phong cách cho ${ageText}.`;
                const fillerWords = fillerText.split(' ');
                const neededWords = wordCount - currentWordCount;
                text += ' ' + fillerWords.slice(0, neededWords).join(' ');
            }
            return text.split(' ').slice(0, 150).join(' ');
        }

        function generateSimulatedDescription(productData) {
            const seoKeywords = getSEOKeywords(productData.productName, productData.gender);
            
            return `
                <div class="product-title" style="font-size: 14pt; font-weight: bold;">${productData.productName}</div>
                <div class="product-description">
                    <div style="background: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 12pt;">
                        <strong>Chế độ mô phỏng:</strong> Nhập API Key Google Gemini để sử dụng AI thực tế
                    </div>
                    <ul>
                        <li style="font-size: 12pt;"><strong>Kiểu dáng:</strong> ${generateFillerText(0, productData, 30)}</li>
                        <li style="font-size: 12pt;"><strong>Thiết kế:</strong> ${generateFillerText(1, productData, 30)}</li>
                        <li style="font-size: 12pt;"><strong>Màu sắc & Mix-Match:</strong> ${generateFillerText(2, productData, 30)}</li>
                    </ul>
                    
                    <div class="specs" style="font-size: 12pt;">
                        ${productData.material ? `<p><strong>Chất liệu:</strong> ${productData.material}</p>` : ''}
                        ${productData.composition ? `<p><strong>Thành phần:</strong> ${productData.composition}</p>` : ''}
                        ${productData.size ? `<p><strong>Kích thước:</strong> ${productData.size}</p>` : ''}
                        ${productData.color ? `<p><strong>Màu sắc:</strong> ${productData.color}</p>` : ''}
                    </div>
                </div>
            `;
        }

        function getGenderStyle(gender) {
            const styles = {
                'nữ': 'nữ tính, thanh lịch',
                'nam': 'nam tính, lịch lãm',
                'bé gái': 'dễ thương, xinh xắn',
                'bé trai': 'năng động, khỏe khoắn'
            };
            return styles[gender] || 'hiện đại, thời trang';
        }

        function getSEOKeywords(productName, gender) {
            const baseKeywords = ['thoải mái', 'chất lượng cao', 'thời trang'];
            const genderKeywords = {
                'nữ': ['nữ tính', 'quyến rũ', 'thanh lịch'],
                'nam': ['nam tính', 'lịch lãm', 'mạnh mẽ'],
                'bé gái': ['dễ thương', 'xinh xắn', 'an toàn'],
                'bé trai': ['năng động', 'khỏe khoắn', 'an toàn']
            };
            
            return [...baseKeywords, ...(genderKeywords[gender] || [])];
        }

        function copyToClipboard() {
            const outputContent = document.getElementById('outputContent');
            const textToCopy = outputContent.innerText;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    alert('Đã sao chép mô tả sản phẩm!');
                });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Đã sao chép mô tả sản phẩm!');
            }
        }

        function downloadDocx() {
            const outputContent = document.getElementById('outputContent');
            const productName = document.getElementById('productName').value || 'San_Pham';
            const doc = new docx.Document({
                sections: [{
                    properties: {},
                    children: [
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: productName,
                                    font: "Times New Roman",
                                    size: 28, // 14pt
                                    bold: true
                                })
                            ],
                            spacing: { after: 200 }
                        }),
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `Kiểu dáng: ${document.querySelector('.product-description ul li:nth-child(1)').textContent.replace('Kiểu dáng: ', '')}`,
                                    font: "Times New Roman",
                                    size: 24, // 12pt
                                    break: 1
                                })
                            ]
                        }),
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `Thiết kế: ${document.querySelector('.product-description ul li:nth-child(2)').textContent.replace('Thiết kế: ', '')}`,
                                    font: "Times New Roman",
                                    size: 24, // 12pt
                                    break: 1
                                })
                            ]
                        }),
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `Màu sắc & Mix-Match: ${document.querySelector('.product-description ul li:nth-child(3)').textContent.replace('Màu sắc & Mix-Match: ', '')}`,
                                    font: "Times New Roman",
                                    size: 24, // 12pt
                                    break: 1
                                })
                            ]
                        }),
                        ...(lastProductData.material ? [new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `Chất liệu: ${lastProductData.material}`,
                                    font: "Times New Roman",
                                    size: 24, // 12pt
                                    break: 1
                                })
                            ]
                        })] : []),
                        ...(lastProductData.composition ? [new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `Thành phần: ${lastProductData.composition}`,
                                    font: "Times New Roman",
                                    size: 24, // 12pt
                                    break: 1
                                })
                            ]
                        })] : []),
                        ...(lastProductData.size ? [new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `Kích thước: ${lastProductData.size}`,
                                    font: "Times New Roman",
                                    size: 24, // 12pt
                                    break: 1
                                })
                            ]
                        })] : []),
                        ...(lastProductData.color ? [new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `Màu sắc: ${lastProductData.color}`,
                                    font: "Times New Roman",
                                    size: 24, // 12pt
                                    break: 1
                                })
                            ]
                        })] : [])
                    ]
                }]
            });

            docx.Packer.toBlob(doc).then(blob => {
                saveAs(blob, `${productName}_description.docx`);
            }).catch(error => {
                console.error('Error generating DOCX:', error);
                alert('Lỗi khi tạo file DOCX!');
            });
        }
    </script></div>
<footer>
      Copyright © Tien Hoang 2025
    </footer>
</div>
<script>
    function showFrame(id) {
      document.querySelectorAll('.iframe-container').forEach(el => el.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }
  </script>
</body>
</html>
