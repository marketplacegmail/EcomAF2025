<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>All Combined HTMLs</title>
<style>
body {font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f3f4f6;}
.header {padding: 16px; text-align: center; background: linear-gradient(90deg, #7ef9ff, #ff6ec7, #a78bfa); color: #061124;}
.toolbar {display: flex; gap: 8px; flex-wrap: wrap; padding: 12px; background: #fff; align-items: center; justify-content: center;}
.tab-btn {padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd; background: #fff; cursor: pointer;}
.tab-btn.active {background: linear-gradient(90deg, #7ef9ff, #ff6ec7, #a78bfa); color: #061124; border-color: #111;}
.container {padding: 12px;}
.file-frame {width: 100%; height: 80vh; border: 1px solid #ccc; border-radius: 8px; display: none;}
.file-frame.active {display: block;}
</style>
</head>
<body>
<div class="header"><h1>Bá»™ tool Ecommerce iBasic</h1></div>
<div class="toolbar">
<button class="tab-btn" data-target="file1">Livestream Dashboard</button>
<button class="tab-btn" data-target="file2">Livestream Script Gen Fixed</button>
<button class="tab-btn" data-target="file3">Underwear Storytelling System</button>
<button class="tab-btn" data-target="file4">Lingerie Desriptions</button>
<button class="tab-btn" data-target="file5">Smooth Thumbnail Maker</button>
<button class="tab-btn" data-target="file6">Enhanced Dashboard Fixed</button>
</div>
<div class="container">
<iframe id="file1" class="file-frame" srcdoc="&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;vi&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Livestream Management Dashboard&lt;/title&gt;
    &lt;style&gt;
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.15);
        }
        h1 {
            color: #ff9ed8;
            text-align: center;
            font-size: 2.5em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }
        h2 {
            color: #b19cd9;
            font-size: 1.5em;
            text-align: center;
        }
        h3 {
            color: #7b68ee;
            font-size: 1.2em;
            margin: 15px 0 10px;
        }
        h4 {
            color: #7b68ee;
            font-size: 1em;
            margin: 10px 0;
        }
        .form-section, .summary-section {
            margin: 20px 0;
            padding: 20px;
            background: #e6e6fa;
            border-radius: 10px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #7b68ee;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ff9ed8;
            border-radius: 8px;
            background: #fff0f5;
            color: #333;
            box-sizing: border-box;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #b19cd9;
            color: white;
        }
        button {
            padding: 12px 25px;
            background: #ff9ed8;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            margin: 5px;
        }
        button:hover {
            background: #ff6bb8;
            transform: scale(1.05);
        }
        .error {
            color: #ff6bb8;
            font-size: 0.9em;
            margin-top: 10px;
            text-align: center;
        }
        .success {
            color: #28a745;
            font-size: 0.9em;
            margin-top: 10px;
            text-align: center;
        }
        .checklist {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .checklist-item input[type=&quot;checkbox&quot;] {
            width: 20px;
            height: 20px;
            accent-color: #ff9ed8;
        }
        .checklist-item input[type=&quot;text&quot;] {
            flex: 1;
            padding: 8px;
            font-size: 0.9em;
        }
        .checklist-item label {
            margin: 0;
            font-size: 0.9em;
            width: 130px;
        }
        .summary-section {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 2em;
            }
            .checklist {
                grid-template-columns: 1fr;
            }
            button {
                width: 100%;
                margin: 5px 0;
            }
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;h1&gt;ðŸŽ¥ Livestream Management Dashboard&lt;/h1&gt;
        &lt;div style=&quot;text-align: center; margin-bottom: 20px; color: #b19cd9; font-size: 0.9em;&quot;&gt;
            &lt;span style=&quot;font-size: 1.1em;&quot;&gt;ðŸ’– Made with love by &lt;/span&gt;
            &lt;strong style=&quot;color: #ff9ed8;&quot;&gt;Tien Hoang&lt;/strong&gt;
            &lt;span&gt; âœ¨ðŸŒŸðŸ’«&lt;/span&gt;
        &lt;/div&gt;

        &lt;div class=&quot;form-section&quot;&gt;
            &lt;div class=&quot;input-group&quot;&gt;
                &lt;label for=&quot;roomId&quot;&gt;ROOM ID:&lt;/label&gt;
                &lt;input type=&quot;text&quot; id=&quot;roomId&quot; placeholder=&quot;Nháº­p Room ID&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;input-group&quot;&gt;
                &lt;label for=&quot;liveDate&quot;&gt;NGÃ€Y LIVESTREAM:&lt;/label&gt;
                &lt;input type=&quot;date&quot; id=&quot;liveDate&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;input-group&quot;&gt;
                &lt;h3&gt;Check List PhiÃªn Live&lt;/h3&gt;
                &lt;h4&gt;TrÆ°á»›c PhiÃªn Live - LIVE DIRECTOR&lt;/h4&gt;
                &lt;div class=&quot;checklist&quot;&gt;
                    &lt;div&gt;
                        &lt;h4&gt;1. Ká»‹ch báº£n&lt;/h4&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;
                            &lt;input type=&quot;checkbox&quot; id=&quot;scriptTheme&quot;&gt;
                            &lt;label for=&quot;scriptTheme&quot;&gt;Chá»§ Ä‘á» live&lt;/label&gt;
                            &lt;input type=&quot;text&quot; id=&quot;scriptThemeText&quot; placeholder=&quot;Nháº­p chá»§ Ä‘á»&quot;&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;&lt;input type=&quot;checkbox&quot; id=&quot;aiScript&quot;&gt;&lt;label for=&quot;aiScript&quot;&gt;Táº¡o Ká»‹ch báº£n (AI)&lt;/label&gt;&lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div&gt;
                        &lt;h4&gt;2. Promotion&lt;/h4&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;
                            &lt;input type=&quot;checkbox&quot; id=&quot;exclusiveDeal&quot;&gt;
                            &lt;label for=&quot;exclusiveDeal&quot;&gt;Deal Ä‘á»™c quyá»n&lt;/label&gt;
                            &lt;input type=&quot;text&quot; id=&quot;exclusiveDealText&quot; placeholder=&quot;Nháº­p deal&quot;&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;
                            &lt;input type=&quot;checkbox&quot; id=&quot;voucher&quot;&gt;
                            &lt;label for=&quot;voucher&quot;&gt;Voucher&lt;/label&gt;
                            &lt;input type=&quot;text&quot; id=&quot;voucherText&quot; placeholder=&quot;Nháº­p voucher&quot;&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div&gt;
                        &lt;h4&gt;3. Host&lt;/h4&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;&lt;input type=&quot;checkbox&quot; id=&quot;discussScript&quot;&gt;&lt;label for=&quot;discussScript&quot;&gt;Tháº£o luáº­n Ká»‹ch báº£n&lt;/label&gt;&lt;/div&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;&lt;input type=&quot;checkbox&quot; id=&quot;knowPromotion&quot;&gt;&lt;label for=&quot;knowPromotion&quot;&gt;Náº¯m Promotion&lt;/label&gt;&lt;/div&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;&lt;input type=&quot;checkbox&quot; id=&quot;costume&quot;&gt;&lt;label for=&quot;costume&quot;&gt;Trang phá»¥c&lt;/label&gt;&lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div&gt;
                        &lt;h4&gt;4. HÃ¬nh áº£nh&lt;/h4&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;
                            &lt;input type=&quot;checkbox&quot; id=&quot;background&quot;&gt;
                            &lt;label for=&quot;background&quot;&gt;Background&lt;/label&gt;
                            &lt;input type=&quot;text&quot; id=&quot;backgroundText&quot; placeholder=&quot;Nháº­p mÃ´ táº£ background&quot;&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;&lt;input type=&quot;checkbox&quot; id=&quot;taglineScheme&quot;&gt;&lt;label for=&quot;taglineScheme&quot;&gt;Tagline &amp; Scheme&lt;/label&gt;&lt;/div&gt;
                        &lt;div class=&quot;checklist-item&quot;&gt;&lt;input type=&quot;checkbox&quot; id=&quot;lighting&quot;&gt;&lt;label for=&quot;lighting&quot;&gt;Ãnh sÃ¡ng&lt;/label&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;table&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th&gt;Host name&lt;/th&gt;
                        &lt;th&gt;LIVE DIRECTOR name&lt;/th&gt;
                        &lt;th&gt;Thá»i gian báº¯t Ä‘áº§u phiÃªn live&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody id=&quot;liveTable&quot;&gt;
                    &lt;tr&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 1&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 1&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 2&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 2&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 3&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 3&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 4&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 4&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 5&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 5&quot;&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;

            &lt;div class=&quot;input-group&quot;&gt;
                &lt;h3&gt;Æ¯u vÃ  NhÆ°á»£c PhiÃªn Livestream&lt;/h3&gt;
                &lt;div class=&quot;input-group&quot;&gt;
                    &lt;label for=&quot;script&quot;&gt;Ká»‹ch báº£n vÃ  hÃ¬nh thá»©c livestream:&lt;/label&gt;
                    &lt;textarea id=&quot;script&quot; rows=&quot;4&quot; placeholder=&quot;MÃ´ táº£ ká»‹ch báº£n vÃ  hÃ¬nh thá»©c livestream&quot;&gt;&lt;/textarea&gt;
                &lt;/div&gt;
                &lt;div class=&quot;input-group&quot;&gt;
                    &lt;label for=&quot;interaction&quot;&gt;Nhu cáº§u &amp; tÆ°Æ¡ng tÃ¡c cá»§a khÃ¡ch hÃ ng:&lt;/label&gt;
                    &lt;textarea id=&quot;interaction&quot; rows=&quot;4&quot; placeholder=&quot;MÃ´ táº£ nhu cáº§u vÃ  tÆ°Æ¡ng tÃ¡c&quot;&gt;&lt;/textarea&gt;
                &lt;/div&gt;
                &lt;div class=&quot;input-group&quot;&gt;
                    &lt;label for=&quot;quality&quot;&gt;Cháº¥t lÆ°á»£ng hÃ¬nh áº£nh vÃ  Ã¢m thanh:&lt;/label&gt;
                    &lt;textarea id=&quot;quality&quot; rows=&quot;4&quot; placeholder=&quot;ÄÃ¡nh giÃ¡ cháº¥t lÆ°á»£ng hÃ¬nh áº£nh vÃ  Ã¢m thanh&quot;&gt;&lt;/textarea&gt;
                &lt;/div&gt;
                &lt;div class=&quot;input-group&quot;&gt;
                    &lt;label for=&quot;improvement&quot;&gt;RÃºt kinh nghiá»‡m vÃ  cáº£i thiá»‡n:&lt;/label&gt;
                    &lt;textarea id=&quot;improvement&quot; rows=&quot;4&quot; placeholder=&quot;Nhá»¯ng Ä‘iá»ƒm cáº§n cáº£i thiá»‡n cho livestream tiáº¿p theo&quot;&gt;&lt;/textarea&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;summary-section&quot;&gt;
            &lt;button onclick=&quot;exportToExcel()&quot;&gt;ðŸ“Š Xuáº¥t Excel vá»›i dá»¯ liá»‡u&lt;/button&gt;
            &lt;button onclick=&quot;resetForm()&quot;&gt;ðŸ”„ Reset Form&lt;/button&gt;
            &lt;div id=&quot;messageArea&quot; class=&quot;error&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        function showMessage(message, isError = true) {
            const messageArea = document.getElementById(&#x27;messageArea&#x27;);
            messageArea.textContent = message;
            messageArea.className = isError ? &#x27;error&#x27; : &#x27;success&#x27;;
        }

        function sanitizeString(str) {
            return str ? str.replace(/[\x00-\x1F\x7F-\x9F]/g, &#x27;&#x27;).trim() : &#x27;&#x27;;
        }

        function exportToExcel() {
            // Kiá»ƒm tra thÆ° viá»‡n XLSX
            if (typeof XLSX === &#x27;undefined&#x27;) {
                showMessage(&#x27;Lá»—i: ThÆ° viá»‡n XLSX khÃ´ng Ä‘Æ°á»£c táº£i! Vui lÃ²ng kiá»ƒm tra káº¿t ná»‘i máº¡ng.&#x27;);
                return;
            }

            // Láº¥y dá»¯ liá»‡u cÆ¡ báº£n
            const roomId = sanitizeString(document.getElementById(&#x27;roomId&#x27;).value);
            const liveDate = sanitizeString(document.getElementById(&#x27;liveDate&#x27;).value);
            const scriptThemeText = sanitizeString(document.getElementById(&#x27;scriptThemeText&#x27;).value);
            
            // Kiá»ƒm tra dá»¯ liá»‡u báº¯t buá»™c
            if (!roomId) {
                showMessage(&#x27;Vui lÃ²ng nháº­p Room ID!&#x27;);
                return;
            }
            if (!liveDate) {
                showMessage(&#x27;Vui lÃ²ng chá»n ngÃ y livestream!&#x27;);
                return;
            }
            if (!scriptThemeText) {
                showMessage(&#x27;Vui lÃ²ng nháº­p chá»§ Ä‘á» live!&#x27;);
                return;
            }

            // Láº¥y dá»¯ liá»‡u Ä‘Ã¡nh giÃ¡
            const script = sanitizeString(document.getElementById(&#x27;script&#x27;).value);
            const interaction = sanitizeString(document.getElementById(&#x27;interaction&#x27;).value);
            const quality = sanitizeString(document.getElementById(&#x27;quality&#x27;).value);
            const improvement = sanitizeString(document.getElementById(&#x27;improvement&#x27;).value);

            // Láº¥y dá»¯ liá»‡u báº£ng host/director
            const tableRows = document.querySelectorAll(&#x27;#liveTable tr&#x27;);
            const liveData = [];
            
            tableRows.forEach((row, index) =&gt; {
                const inputs = row.querySelectorAll(&#x27;input&#x27;);
                const host = sanitizeString(inputs[0].value);
                const director = sanitizeString(inputs[1].value);
                const time = sanitizeString(inputs[2].value);

                if (host || director || time) {
                    liveData.push({
                        &#x27;STT&#x27;: index + 1,
                        &#x27;Host&#x27;: host || &#x27;&#x27;,
                        &#x27;Director&#x27;: director || &#x27;&#x27;,
                        &#x27;Thá»i gian&#x27;: time || &#x27;&#x27;
                    });
                }
            });

            // Láº¥y dá»¯ liá»‡u checklist
            const checklistItems = [
                { id: &#x27;scriptTheme&#x27;, text: &#x27;scriptThemeText&#x27;, name: &#x27;Chá»§ Ä‘á» live&#x27; },
                { id: &#x27;aiScript&#x27;, text: null, name: &#x27;Táº¡o Ká»‹ch báº£n (AI)&#x27; },
                { id: &#x27;exclusiveDeal&#x27;, text: &#x27;exclusiveDealText&#x27;, name: &#x27;Deal Ä‘á»™c quyá»n&#x27; },
                { id: &#x27;voucher&#x27;, text: &#x27;voucherText&#x27;, name: &#x27;Voucher&#x27; },
                { id: &#x27;discussScript&#x27;, text: null, name: &#x27;Tháº£o luáº­n Ká»‹ch báº£n&#x27; },
                { id: &#x27;knowPromotion&#x27;, text: null, name: &#x27;Náº¯m Promotion&#x27; },
                { id: &#x27;costume&#x27;, text: null, name: &#x27;Trang phá»¥c&#x27; },
                { id: &#x27;background&#x27;, text: &#x27;backgroundText&#x27;, name: &#x27;Background&#x27; },
                { id: &#x27;taglineScheme&#x27;, text: null, name: &#x27;Tagline &amp; Scheme&#x27; },
                { id: &#x27;lighting&#x27;, text: null, name: &#x27;Ãnh sÃ¡ng&#x27; }
            ];

            try {
                const wb = XLSX.utils.book_new();

                // Táº¡o sheet chÃ­nh vá»›i cáº¥u trÃºc tá»‘i Æ°u cho Pivot
                const mainData = [];

                // Náº¿u khÃ´ng cÃ³ dá»¯ liá»‡u host/director, táº¡o 1 dÃ²ng dá»¯ liá»‡u cÆ¡ báº£n
                if (liveData.length === 0) {
                    mainData.push({
                        &#x27;Room ID&#x27;: roomId,
                        &#x27;NgÃ y Livestream&#x27;: liveDate,
                        &#x27;Chá»§ Ä‘á» Live&#x27;: scriptThemeText,
                        &#x27;Host Name&#x27;: &#x27;&#x27;,
                        &#x27;Live Director Name&#x27;: &#x27;&#x27;,
                        &#x27;Thá»i gian báº¯t Ä‘áº§u&#x27;: &#x27;&#x27;,
                        &#x27;Ká»‹ch báº£n vÃ  hÃ¬nh thá»©c&#x27;: script,
                        &#x27;Nhu cáº§u &amp; tÆ°Æ¡ng tÃ¡c&#x27;: interaction,
                        &#x27;Cháº¥t lÆ°á»£ng hÃ¬nh áº£nh vÃ  Ã¢m thanh&#x27;: quality,
                        &#x27;RÃºt kinh nghiá»‡m vÃ  cáº£i thiá»‡n&#x27;: improvement,
                        // ThÃªm táº¥t cáº£ checklist items vÃ o cÃ¹ng dÃ²ng
                        &#x27;Chá»§ Ä‘á» live - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;scriptTheme&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                        &#x27;Chá»§ Ä‘á» live - Chi tiáº¿t&#x27;: sanitizeString(document.getElementById(&#x27;scriptThemeText&#x27;).value),
                        &#x27;Táº¡o Ká»‹ch báº£n AI - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;aiScript&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                        &#x27;Deal Ä‘á»™c quyá»n - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;exclusiveDeal&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                        &#x27;Deal Ä‘á»™c quyá»n - Chi tiáº¿t&#x27;: sanitizeString(document.getElementById(&#x27;exclusiveDealText&#x27;).value),
                        &#x27;Voucher - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;voucher&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                        &#x27;Voucher - Chi tiáº¿t&#x27;: sanitizeString(document.getElementById(&#x27;voucherText&#x27;).value),
                        &#x27;Tháº£o luáº­n Ká»‹ch báº£n - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;discussScript&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                        &#x27;Náº¯m Promotion - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;knowPromotion&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                        &#x27;Trang phá»¥c - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;costume&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                        &#x27;Background - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;background&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                        &#x27;Background - Chi tiáº¿t&#x27;: sanitizeString(document.getElementById(&#x27;backgroundText&#x27;).value),
                        &#x27;Tagline &amp; Scheme - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;taglineScheme&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                        &#x27;Ãnh sÃ¡ng - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;lighting&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;
                    });
                } else {
                    // Táº¡o má»™t dÃ²ng cho má»—i host/director vá»›i thÃ´ng tin Ä‘áº§y Ä‘á»§
                    liveData.forEach(live =&gt; {
                        if (live.Host || live.Director || live[&#x27;Thá»i gian&#x27;]) {
                            mainData.push({
                                &#x27;Room ID&#x27;: roomId,
                                &#x27;NgÃ y Livestream&#x27;: liveDate,
                                &#x27;Chá»§ Ä‘á» Live&#x27;: scriptThemeText,
                                &#x27;Host Name&#x27;: live.Host,
                                &#x27;Live Director Name&#x27;: live.Director,
                                &#x27;Thá»i gian báº¯t Ä‘áº§u&#x27;: live[&#x27;Thá»i gian&#x27;],
                                &#x27;Ká»‹ch báº£n vÃ  hÃ¬nh thá»©c&#x27;: script,
                                &#x27;Nhu cáº§u &amp; tÆ°Æ¡ng tÃ¡c&#x27;: interaction,
                                &#x27;Cháº¥t lÆ°á»£ng hÃ¬nh áº£nh vÃ  Ã¢m thanh&#x27;: quality,
                                &#x27;RÃºt kinh nghiá»‡m vÃ  cáº£i thiá»‡n&#x27;: improvement,
                                // ThÃªm táº¥t cáº£ checklist items vÃ o cÃ¹ng dÃ²ng
                                &#x27;Chá»§ Ä‘á» live - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;scriptTheme&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                                &#x27;Chá»§ Ä‘á» live - Chi tiáº¿t&#x27;: sanitizeString(document.getElementById(&#x27;scriptThemeText&#x27;).value),
                                &#x27;Táº¡o Ká»‹ch báº£n AI - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;aiScript&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                                &#x27;Deal Ä‘á»™c quyá»n - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;exclusiveDeal&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                                &#x27;Deal Ä‘á»™c quyá»n - Chi tiáº¿t&#x27;: sanitizeString(document.getElementById(&#x27;exclusiveDealText&#x27;).value),
                                &#x27;Voucher - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;voucher&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                                &#x27;Voucher - Chi tiáº¿t&#x27;: sanitizeString(document.getElementById(&#x27;voucherText&#x27;).value),
                                &#x27;Tháº£o luáº­n Ká»‹ch báº£n - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;discussScript&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                                &#x27;Náº¯m Promotion - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;knowPromotion&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                                &#x27;Trang phá»¥c - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;costume&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                                &#x27;Background - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;background&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                                &#x27;Background - Chi tiáº¿t&#x27;: sanitizeString(document.getElementById(&#x27;backgroundText&#x27;).value),
                                &#x27;Tagline &amp; Scheme - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;taglineScheme&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;,
                                &#x27;Ãnh sÃ¡ng - HoÃ n thÃ nh&#x27;: document.getElementById(&#x27;lighting&#x27;).checked ? &#x27;CÃ³&#x27; : &#x27;KhÃ´ng&#x27;
                            });
                        }
                    });
                }

                // Táº¡o worksheet chÃ­nh
                const ws1 = XLSX.utils.json_to_sheet(mainData);
                XLSX.utils.book_append_sheet(wb, ws1, &#x27;Dá»¯ liá»‡u tá»•ng há»£p&#x27;);

                // Táº¡o sheet tÃ³m táº¯t
                const summaryData = [
                    { &#x27;ThÃ´ng tin&#x27;: &#x27;Room ID&#x27;, &#x27;GiÃ¡ trá»‹&#x27;: roomId },
                    { &#x27;ThÃ´ng tin&#x27;: &#x27;NgÃ y Livestream&#x27;, &#x27;GiÃ¡ trá»‹&#x27;: liveDate },
                    { &#x27;ThÃ´ng tin&#x27;: &#x27;Chá»§ Ä‘á» Live&#x27;, &#x27;GiÃ¡ trá»‹&#x27;: scriptThemeText },
                    { &#x27;ThÃ´ng tin&#x27;: &#x27;Tá»•ng checklist hoÃ n thÃ nh&#x27;, &#x27;GiÃ¡ trá»‹&#x27;: checklistItems.filter(item =&gt; document.getElementById(item.id).checked).length + &#x27;/&#x27; + checklistItems.length },
                    { &#x27;ThÃ´ng tin&#x27;: &#x27;Sá»‘ lÆ°á»£ng host/director&#x27;, &#x27;GiÃ¡ trá»‹&#x27;: liveData.length },
                    { &#x27;ThÃ´ng tin&#x27;: &#x27;NgÃ y xuáº¥t bÃ¡o cÃ¡o&#x27;, &#x27;GiÃ¡ trá»‹&#x27;: new Date().toLocaleDateString(&#x27;vi-VN&#x27;) }
                ];

                const ws2 = XLSX.utils.json_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, ws2, &#x27;TÃ³m táº¯t&#x27;);

                // Xuáº¥t file
                const fileName = `Livestream_${roomId}_${scriptThemeText.replace(/[^a-zA-Z0-9]/g, &#x27;_&#x27;)}_${new Date().getTime()}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                showMessage(&#x27;Xuáº¥t Excel thÃ nh cÃ´ng!&#x27;, false);
                
            } catch (error) {
                console.error(&#x27;Export Error:&#x27;, error);
                showMessage(&#x27;Lá»—i khi xuáº¥t file Excel: &#x27; + error.message);
            }
        }

        function resetForm() {
            // Reset táº¥t cáº£ input text vÃ  textarea
            document.getElementById(&#x27;roomId&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;liveDate&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;script&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;interaction&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;quality&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;improvement&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;scriptThemeText&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;exclusiveDealText&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;voucherText&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;backgroundText&#x27;).value = &#x27;&#x27;;
            
            // Reset táº¥t cáº£ checkbox
            const checkboxes = document.querySelectorAll(&#x27;input[type=&quot;checkbox&quot;]&#x27;);
            checkboxes.forEach(checkbox =&gt; checkbox.checked = false);

            // Reset báº£ng
            const tableBody = document.getElementById(&#x27;liveTable&#x27;);
            tableBody.innerHTML = `
                &lt;tr&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 1&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 1&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 2&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 2&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 3&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 3&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 4&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 4&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn host 5&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; placeholder=&quot;Nháº­p tÃªn director 5&quot;&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;datetime-local&quot; placeholder=&quot;Chá»n thá»i gian&quot;&gt;&lt;/td&gt;
                &lt;/tr&gt;
            `;

            // Reset thÃ´ng bÃ¡o
            document.getElementById(&#x27;messageArea&#x27;).textContent = &#x27;&#x27;;
            
            showMessage(&#x27;Form Ä‘Ã£ Ä‘Æ°á»£c reset thÃ nh cÃ´ng!&#x27;, false);
        }

        // Kiá»ƒm tra thÆ° viá»‡n XLSX khi trang load
        window.addEventListener(&#x27;load&#x27;, function() {
            setTimeout(() =&gt; {
                if (typeof XLSX === &#x27;undefined&#x27;) {
                    showMessage(&#x27;Cáº£nh bÃ¡o: ThÆ° viá»‡n XLSX chÆ°a Ä‘Æ°á»£c táº£i. Vui lÃ²ng kiá»ƒm tra káº¿t ná»‘i máº¡ng.&#x27;);
                }
            }, 2000);
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;"></iframe>
<iframe id="file2" class="file-frame" srcdoc="&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;vi&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Táº¡o Ká»‹ch Báº£n Livestream AI (Updated)&lt;/title&gt;
    &lt;script src=&quot;https://unpkg.com/docx@7.8.2/build/index.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: &#x27;Segoe UI&#x27;, Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff00ff 0%, #00ffcc 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff33cc, #00ff99);
            color: white;
            text-align: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: &#x27;&#x27;;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 100 100&quot;&gt;&lt;circle cx=&quot;50&quot; cy=&quot;50&quot; r=&quot;2&quot; fill=&quot;rgba(255,255,255,0.1)&quot;/&gt;&lt;/svg&gt;&#x27;) repeat;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-100px); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .api-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            border-left: 4px solid #ff33cc;
        }

        .api-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .api-input:focus {
            outline: none;
            border-color: #ff33cc;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
            padding: 40px;
        }

        .input-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .input-section:hover {
            transform: translateY(-5px);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f9f9f9;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff33cc;
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 51, 204, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .product-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .product-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .product-item label {
            font-size: 0.9em;
            margin-bottom: 5px;
            color: #666;
        }

        .product-item textarea {
            min-height: 80px;
            font-size: 14px;
            padding: 10px;
        }

        .style-options {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .style-option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .style-option:hover {
            border-color: #ff33cc;
            background: #fff0f5;
        }

        .style-option.selected {
            border-color: #ff33cc;
            background: #ff33cc;
            color: white;
        }

        .style-option h4 {
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .style-option p {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .brand-policy-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .cta-promotion-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .generate-btn,
        .regenerate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #ff33cc, #00ff99);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .regenerate-btn {
            background: linear-gradient(135deg, #00ff99, #ff33cc);
        }

        .generate-btn:hover,
        .regenerate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 51, 204, 0.3);
        }

        .generate-btn:active,
        .regenerate-btn:active {
            transform: translateY(0);
        }

        .generate-btn:disabled,
        .regenerate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .output-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .output-section::before {
            content: &#x27;&#x27;;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff33cc, #00ff99, #ff00ff, #00ccff);
            animation: gradient-shift 3s linear infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .output-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .script-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .tab-btn.active {
            background: #ff33cc;
            color: white;
            border-color: #ff33cc;
        }

        .script-output {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            border-left: 4px solid #ff33cc;
            font-family: &#x27;Consolas&#x27;, &#x27;Monaco&#x27;, monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            color: #333;
            display: none;
        }

        .script-output.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 50px 0;
        }

        .loading {
            display: none;
            text-align: center;
            color: #ff33cc;
            font-style: italic;
            font-size: 1.1em;
            padding: 20px;
        }

        .loading::after {
            content: &#x27;...&#x27;;
            animation: loading-dots 1.5s infinite;
        }

        @keyframes loading-dots {
            0%, 20% { content: &#x27;.&#x27;; }
            40% { content: &#x27;..&#x27;; }
            60%, 100% { content: &#x27;...&#x27;; }
        }

        .copy-btn,
        .download-btn {
            padding: 10px 15px;
            background: #00ff99;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .copy-btn:hover,
        .download-btn:hover {
            background: #00cc88;
            transform: scale(1.05);
        }

        .copy-btn:disabled,
        .download-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .header p {
                font-size: 1em;
            }

            .product-grid,
            .brand-policy-grid,
            .cta-promotion-grid,
            .style-options {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;header&quot;&gt;
            &lt;h1&gt;ðŸŽ¬ Táº¡o Ká»‹ch Báº£n Livestream AI&lt;/h1&gt;
            &lt;p&gt;CÃ´ng cá»¥ thÃ´ng minh tÃ­ch há»£p Google Gemini 2.5 Flash (New) Ä‘á»ƒ táº¡o ká»‹ch báº£n livestream siÃªu tá»‘c&lt;/p&gt;
        &lt;/div&gt;

        &lt;div class=&quot;api-section&quot;&gt;
            &lt;h3&gt;ðŸ”‘ Cáº¥u hÃ¬nh API Google Gemini&lt;/h3&gt;
            &lt;input type=&quot;password&quot; id=&quot;apiKey&quot; class=&quot;api-input&quot; placeholder=&quot;Nháº­p API Key cá»§a báº¡n (AIza...)&quot;&gt;
            &lt;p style=&quot;font-size: 12px; color: #666; margin-top: 5px;&quot;&gt;
                API Key sáº½ chá»‰ lÆ°u trong session nÃ y vÃ  khÃ´ng Ä‘Æ°á»£c gá»­i Ä‘áº¿n mÃ¡y chá»§ nÃ o khÃ¡c.
                &lt;a href=&quot;https://aistudio.google.com/apikey&quot; target=&quot;_blank&quot;&gt;Láº¥y API Key táº¡i Ä‘Ã¢y&lt;/a&gt;
            &lt;/p&gt;
        &lt;/div&gt;

        &lt;div class=&quot;main-content&quot;&gt;
            &lt;div class=&quot;input-section&quot;&gt;
                &lt;h2&gt;ðŸ“ ThÃ´ng Tin Äáº§u VÃ o&lt;/h2&gt;
                &lt;form id=&quot;scriptForm&quot;&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;topic&quot;&gt;ðŸŽ¯ Chá»§ Ä‘á» live:&lt;/label&gt;
                        &lt;input type=&quot;text&quot; id=&quot;topic&quot; name=&quot;topic&quot; placeholder=&quot;VÃ­ dá»¥: Giáº£m giÃ¡ sá»‘c Black Friday, Ra máº¯t sáº£n pháº©m má»›i...&quot; required&gt;
                    &lt;/div&gt;

                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label&gt;ðŸŽ­ Phong cÃ¡ch ká»‹ch báº£n:&lt;/label&gt;
                        &lt;div class=&quot;style-options&quot;&gt;
                            &lt;div class=&quot;style-option selected&quot; data-style=&quot;friendly&quot;&gt;
                                &lt;h4&gt;ðŸŒŸ ThÃ¢n thiá»‡n&lt;/h4&gt;
                                &lt;p&gt;Dá»… thÆ°Æ¡ng, gáº§n gÅ©i&lt;/p&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;style-option&quot; data-style=&quot;professional&quot;&gt;
                                &lt;h4&gt;ðŸ’¼ ChuyÃªn nghiá»‡p&lt;/h4&gt;
                                &lt;p&gt;Lá»‹ch sá»±, tin cáº­y&lt;/p&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;style-option&quot; data-style=&quot;energetic&quot;&gt;
                                &lt;h4&gt;âš¡ NÄƒng Ä‘á»™ng&lt;/h4&gt;
                                &lt;p&gt;SÃ´i Ä‘á»™ng, kháº©n cáº¥p&lt;/p&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;

                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label&gt;ðŸ“¦ MÃ´ táº£ Hot Products:&lt;/label&gt;
                        &lt;div class=&quot;product-grid&quot;&gt;
                            &lt;div class=&quot;product-item&quot;&gt;
                                &lt;label&gt;Sáº£n pháº©m 1:&lt;/label&gt;
                                &lt;textarea id=&quot;product1&quot; placeholder=&quot;TÃªn, giÃ¡, tÃ­nh nÄƒng...&quot; required&gt;&lt;/textarea&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;product-item&quot;&gt;
                                &lt;label&gt;Sáº£n pháº©m 2:&lt;/label&gt;
                                &lt;textarea id=&quot;product2&quot; placeholder=&quot;TÃªn, giÃ¡, tÃ­nh nÄƒng...&quot;&gt;&lt;/textarea&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;product-item&quot;&gt;
                                &lt;label&gt;Sáº£n pháº©m 3:&lt;/label&gt;
                                &lt;textarea id=&quot;product3&quot; placeholder=&quot;TÃªn, giÃ¡, tÃ­nh nÄƒng...&quot;&gt;&lt;/textarea&gt;
                            &lt;/div&gt;
                            &lt;div class=&quot;product-item&quot;&gt;
                                &lt;label&gt;Sáº£n pháº©m 4:&lt;/label&gt;
                                &lt;textarea id=&quot;product4&quot; placeholder=&quot;TÃªn, giÃ¡, tÃ­nh nÄƒng...&quot;&gt;&lt;/textarea&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;product-item&quot;&gt;
                            &lt;label&gt;Sáº£n pháº©m 5:&lt;/label&gt;
                            &lt;textarea id=&quot;product5&quot; placeholder=&quot;TÃªn, giÃ¡, tÃ­nh nÄƒng...&quot;&gt;&lt;/textarea&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;

                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;seasonality&quot;&gt;ðŸŒ¸ Seasonality:&lt;/label&gt;
                        &lt;textarea id=&quot;seasonality&quot; name=&quot;seasonality&quot; placeholder=&quot;Sá»± kiá»‡n theo mÃ¹a hoáº·c dá»‹p Ä‘áº·c biá»‡t&quot;&gt;&lt;/textarea&gt;
                    &lt;/div&gt;

                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;gamification&quot;&gt;ðŸŽ® Gamification:&lt;/label&gt;
                        &lt;textarea id=&quot;gamification&quot; name=&quot;gamification&quot; placeholder=&quot;TrÃ² chÆ¡i hoáº·c hoáº¡t Ä‘á»™ng giáº£i trÃ­&quot;&gt;&lt;/textarea&gt;
                    &lt;/div&gt;

                    &lt;div class=&quot;form-group&quot;&gt;
                        &lt;label for=&quot;tipsHacks&quot;&gt;ðŸ’¡ TIP/HACK:&lt;/label&gt;
                        &lt;textarea id=&quot;tipsHacks&quot; name=&quot;tipsHacks&quot; placeholder=&quot;Máº¹o hoáº·c thá»§ thuáº­t há»¯u Ã­ch&quot;&gt;&lt;/textarea&gt;
                    &lt;/div&gt;

                    &lt;div class=&quot;brand-policy-grid&quot;&gt;
                        &lt;div class=&quot;form-group&quot;&gt;
                            &lt;label for=&quot;brandStory&quot;&gt;ðŸ¢ Brand Story:&lt;/label&gt;
                            &lt;textarea id=&quot;brandStory&quot; name=&quot;brandStory&quot; placeholder=&quot;CÃ¢u chuyá»‡n thÆ°Æ¡ng hiá»‡u&quot; required&gt;&lt;/textarea&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;form-group&quot;&gt;
                            &lt;label for=&quot;policy&quot;&gt;ðŸ“‹ Policy Product:&lt;/label&gt;
                            &lt;textarea id=&quot;policy&quot; name=&quot;policy&quot; placeholder=&quot;ChÃ­nh sÃ¡ch sáº£n pháº©m&quot; required&gt;&lt;/textarea&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;

                    &lt;div class=&quot;cta-promotion-grid&quot;&gt;
                        &lt;div class=&quot;form-group&quot;&gt;
                            &lt;label for=&quot;cta&quot;&gt;ðŸŽ¯ CTA (Call to Action):&lt;/label&gt;
                            &lt;textarea id=&quot;cta&quot; name=&quot;cta&quot; placeholder=&quot;KÃªu gá»i hÃ nh Ä‘á»™ng&quot; required&gt;&lt;/textarea&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;form-group&quot;&gt;
                            &lt;label for=&quot;promotion&quot;&gt;ðŸŽ Promotion:&lt;/label&gt;
                            &lt;textarea id=&quot;promotion&quot; name=&quot;promotion&quot; placeholder=&quot;Khuyáº¿n mÃ£i Ä‘áº·c biá»‡t&quot; required&gt;&lt;/textarea&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;

                    &lt;div class=&quot;button-group&quot;&gt;
                        &lt;button type=&quot;submit&quot; class=&quot;generate-btn&quot; id=&quot;generateBtn&quot;&gt;
                            ðŸš€ Táº¡o Ká»‹ch Báº£n AI
                        &lt;/button&gt;
                        &lt;button type=&quot;button&quot; class=&quot;regenerate-btn&quot; id=&quot;regenerateBtn&quot; disabled&gt;
                            ðŸ”„ Táº¡o Láº¡i Ká»‹ch Báº£n
                        &lt;/button&gt;
                    &lt;/div&gt;
                &lt;/form&gt;
            &lt;/div&gt;

            &lt;div class=&quot;output-section&quot;&gt;
                &lt;h2&gt;ðŸ“œ Ká»‹ch Báº£n Livestream&lt;/h2&gt;
                &lt;div class=&quot;button-group&quot;&gt;
                    &lt;button class=&quot;copy-btn&quot; onclick=&quot;copyScript()&quot; id=&quot;copyBtn&quot; disabled&gt;ðŸ“‹ Copy&lt;/button&gt;
                    &lt;button class=&quot;download-btn&quot; onclick=&quot;downloadScript()&quot; id=&quot;downloadBtn&quot; disabled&gt;ðŸ“¥ Táº£i DOCX&lt;/button&gt;
                &lt;/div&gt;

                &lt;div class=&quot;script-tabs&quot; id=&quot;scriptTabs&quot; style=&quot;display: none;&quot;&gt;
                    &lt;button class=&quot;tab-btn active&quot; onclick=&quot;showScript(1)&quot;&gt;Ká»‹ch báº£n 1&lt;/button&gt;
                    &lt;button class=&quot;tab-btn&quot; onclick=&quot;showScript(2)&quot;&gt;Ká»‹ch báº£n 2&lt;/button&gt;
                &lt;/div&gt;

                &lt;div class=&quot;script-output active&quot; id=&quot;script1&quot;&gt;
                    &lt;div class=&quot;empty-state&quot;&gt;
                        Ká»‹ch báº£n sáº½ xuáº¥t hiá»‡n á»Ÿ Ä‘Ã¢y sau khi báº¡n Ä‘iá»n thÃ´ng tin vÃ  nháº¥n &quot;Táº¡o Ká»‹ch Báº£n AI&quot;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;script-output&quot; id=&quot;script2&quot;&gt;&lt;/div&gt;
                &lt;div class=&quot;loading&quot; id=&quot;loading&quot;&gt;Gemini 2.5 Flash Ä‘ang suy nghÄ© vÃ¨o vÃ¨o...&lt;/div&gt;
                &lt;div class=&quot;error-message&quot; id=&quot;errorMessage&quot; style=&quot;display: none;&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
        let currentScript = 1;
        let selectedStyle = &#x27;friendly&#x27;;
        let scriptGenerationCount = 0;
        let scriptData = {
            script1: &#x27;&#x27;,
            script2: &#x27;&#x27;
        };

        // Style selection
        document.querySelectorAll(&#x27;.style-option&#x27;).forEach(option =&gt; {
            option.addEventListener(&#x27;click&#x27;, function() {
                document.querySelectorAll(&#x27;.style-option&#x27;).forEach(opt =&gt; opt.classList.remove(&#x27;selected&#x27;));
                this.classList.add(&#x27;selected&#x27;);
                selectedStyle = this.getAttribute(&#x27;data-style&#x27;);
            });
        });

        // Form submit
        document.getElementById(&#x27;scriptForm&#x27;).addEventListener(&#x27;submit&#x27;, function(e) {
            e.preventDefault();
            generateScript();
        });

        // Regenerate button
        document.getElementById(&#x27;regenerateBtn&#x27;).addEventListener(&#x27;click&#x27;, function() {
            generateScript(true);
        });

        function showScript(scriptNumber) {
            currentScript = scriptNumber;
            document.getElementById(&#x27;script1&#x27;).classList.remove(&#x27;active&#x27;);
            document.getElementById(&#x27;script2&#x27;).classList.remove(&#x27;active&#x27;);
            document.getElementById(&#x27;script&#x27; + scriptNumber).classList.add(&#x27;active&#x27;);
            document.querySelectorAll(&#x27;.tab-btn&#x27;).forEach(btn =&gt; btn.classList.remove(&#x27;active&#x27;));
            document.querySelectorAll(&#x27;.tab-btn&#x27;)[scriptNumber - 1].classList.add(&#x27;active&#x27;);
        }

        async function generateScript(isRegenerate = false) {
            const apiKey = document.getElementById(&#x27;apiKey&#x27;).value;
            const topic = document.getElementById(&#x27;topic&#x27;).value;
            const products = [
                document.getElementById(&#x27;product1&#x27;).value,
                document.getElementById(&#x27;product2&#x27;).value,
                document.getElementById(&#x27;product3&#x27;).value,
                document.getElementById(&#x27;product4&#x27;).value,
                document.getElementById(&#x27;product5&#x27;).value
            ].filter(p =&gt; p.trim());
            const seasonality = document.getElementById(&#x27;seasonality&#x27;).value;
            const gamification = document.getElementById(&#x27;gamification&#x27;).value;
            const tipsHacks = document.getElementById(&#x27;tipsHacks&#x27;).value;
            const brandStory = document.getElementById(&#x27;brandStory&#x27;).value;
            const policy = document.getElementById(&#x27;policy&#x27;).value;
            const cta = document.getElementById(&#x27;cta&#x27;).value;
            const promotion = document.getElementById(&#x27;promotion&#x27;).value;

            if (!apiKey) {
                showError(&#x27;Vui lÃ²ng nháº­p API Key cá»§a Google Gemini!&#x27;);
                return;
            }

            if (!topic || products.length === 0 || !brandStory || !policy || !cta || !promotion) {
                showError(&#x27;Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ cÃ¡c trÆ°á»ng báº¯t buá»™c: Chá»§ Ä‘á», Ã­t nháº¥t 1 sáº£n pháº©m, Brand Story, Policy, CTA vÃ  Promotion!&#x27;);
                return;
            }

            const loading = document.getElementById(&#x27;loading&#x27;);
            const scriptTabs = document.getElementById(&#x27;scriptTabs&#x27;);
            const generateBtn = document.getElementById(&#x27;generateBtn&#x27;);
            const regenerateBtn = document.getElementById(&#x27;regenerateBtn&#x27;);
            const copyBtn = document.getElementById(&#x27;copyBtn&#x27;);
            const downloadBtn = document.getElementById(&#x27;downloadBtn&#x27;);

            // Clear and show loading
            document.getElementById(&#x27;script1&#x27;).innerHTML = &#x27;&#x27;;
            document.getElementById(&#x27;script2&#x27;).innerHTML = &#x27;&#x27;;
            const emptyState = document.querySelector(&#x27;.empty-state&#x27;);
            if (emptyState) emptyState.style.display = &#x27;none&#x27;;
            document.getElementById(&#x27;errorMessage&#x27;).style.display = &#x27;none&#x27;;
            loading.style.display = &#x27;block&#x27;;
            scriptTabs.style.display = &#x27;none&#x27;;
            generateBtn.disabled = true;
            regenerateBtn.disabled = true;
            copyBtn.disabled = true;
            downloadBtn.disabled = true;
            generateBtn.textContent = isRegenerate ? &#x27;Äang táº¡o láº¡i...&#x27; : &#x27;Äang táº¡o...&#x27;;

            try {
                scriptGenerationCount++;

                const [script1, script2] = await Promise.all([
                    generateScriptWithGemini(apiKey, topic, products, seasonality, gamification, tipsHacks, brandStory, policy, cta, promotion, selectedStyle, 1),
                    generateScriptWithGemini(apiKey, topic, products, seasonality, gamification, tipsHacks, brandStory, policy, cta, promotion, selectedStyle, 2)
                ]);

                scriptData.script1 = script1;
                scriptData.script2 = script2;

                document.getElementById(&#x27;script1&#x27;).innerHTML = &#x27;&lt;pre&gt;&#x27; + escapeHtml(scriptData.script1) + &#x27;&lt;/pre&gt;&#x27;;
                document.getElementById(&#x27;script2&#x27;).innerHTML = &#x27;&lt;pre&gt;&#x27; + escapeHtml(scriptData.script2) + &#x27;&lt;/pre&gt;&#x27;;

                scriptTabs.style.display = &#x27;flex&#x27;;
                showScript(1);
                loading.style.display = &#x27;none&#x27;;

                regenerateBtn.disabled = false;
                copyBtn.disabled = false;
                downloadBtn.disabled = false;

            } catch (error) {
                console.error(&#x27;Error:&#x27;, error);
                showError(&#x27;Lá»—i khi táº¡o ká»‹ch báº£n: &#x27; + error.message);
                loading.style.display = &#x27;none&#x27;;
                const emptyState = document.querySelector(&#x27;.empty-state&#x27;);
                if (emptyState) emptyState.style.display = &#x27;block&#x27;;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = &#x27;ðŸš€ Táº¡o Ká»‹ch Báº£n AI&#x27;;
            }
        }

        async function generateScriptWithGemini(apiKey, topic, products, seasonality, gamification, tipsHacks, brandStory, policy, cta, promotion, style, version) {
            const styleDescriptions = {
                &#x27;friendly&#x27;: &#x27;thÃ¢n thiá»‡n, dá»… thÆ°Æ¡ng, gáº§n gÅ©i vá»›i khÃ¡n giáº£&#x27;,
                &#x27;professional&#x27;: &#x27;chuyÃªn nghiá»‡p, lá»‹ch sá»±, tin cáº­y vÃ  thuyáº¿t phá»¥c&#x27;,
                &#x27;energetic&#x27;: &#x27;nÄƒng Ä‘á»™ng, sÃ´i ná»•i, táº¡o cáº£m giÃ¡c kháº©n cáº¥p vÃ  thÃºc Ä‘áº©y hÃ nh Ä‘á»™ng&#x27;
            };
            const versionPrompts = {
                1: &#x27;PhiÃªn báº£n 1: Táº­p trung vÃ o xÃ¢y dá»±ng niá»m tin vÃ  tÆ°Æ¡ng tÃ¡c vá»›i khÃ¡n giáº£&#x27;,
                2: &#x27;PhiÃªn báº£n 2: Táº­p trung vÃ o táº¡o urgency vÃ  thÃºc Ä‘áº©y hÃ nh Ä‘á»™ng máº¡nh máº½&#x27;
            };
            const productList = products.map((p, i) =&gt; `SP${i + 1}: ${p}`).join(&#x27;\n&#x27;);

            const prompt = `Táº¡o ká»‹ch báº£n livestream 60 PHÃšT hoÃ n chá»‰nh vá»›i yÃªu cáº§u:

CHá»¦ Äá»€: ${topic}
PHONG CÃCH: ${styleDescriptions[style]}
${versionPrompts[version]}

SÃ€N PHáº¨M:
${productList}

SEASONALITY: ${seasonality || &#x27;KhÃ´ng&#x27;}
GAMIFICATION: ${gamification || &#x27;KhÃ´ng&#x27;}
TIP/HACK: ${tipsHacks || &#x27;KhÃ´ng&#x27;}
BRAND: ${brandStory}
POLICY: ${policy}
CTA: ${cta}
PROMOTION: ${promotion}

Cáº¤U TRÃšC Ká»ŠCH Báº¢N (60 phÃºt):
1. KHAI Máº C (0-5 phÃºt): ChÃ o má»«ng, giá»›i thiá»‡u chá»§ Ä‘á»
2. BRAND STORY (5-10 phÃºt): CÃ¢u chuyá»‡n thÆ°Æ¡ng hiá»‡u
3. SÃ€N PHáº¨M (10-35 phÃºt): TrÃ¬nh bÃ y chi tiáº¿t tá»«ng sáº£n pháº©m
4. SEASONALITY (35-40 phÃºt): Ná»™i dung theo mÃ¹a (náº¿u cÃ³)
5. GAMIFICATION (40-45 phÃºt): TrÃ² chÆ¡i tÆ°Æ¡ng tÃ¡c (náº¿u cÃ³)
6. TIP/HACK (45-50 phÃºt): Chia sáº» máº¹o há»¯u Ã­ch (náº¿u cÃ³)
7. POLICY (50-53 phÃºt): ChÃ­nh sÃ¡ch báº£o hÃ nh, Ä‘á»•i tráº£
8. PROMOTION &amp; CTA (53-58 phÃºt): Khuyáº¿n mÃ£i vÃ  kÃªu gá»i Ä‘áº·t hÃ ng
9. Káº¾T THÃšC (58-60 phÃºt): Tá»•ng káº¿t, cáº£m Æ¡n

YÃŠU Cáº¦U:
- Viáº¿t Gá»ŒN, SÃšNG TÃCH nhÆ°ng Äáº¦Y Äá»¦ táº¥t cáº£ pháº§n
- Má»—i pháº§n cÃ³ timing rÃµ rÃ ng
- Dialogue tá»± nhiÃªn, phÃ¹ há»£p phong cÃ¡ch
- TÃ­ch há»£p call-to-action xuyÃªn suá»‘t
- PHáº¢I cÃ³ Ä‘áº§y Ä‘á»§ 9 pháº§n tá»« KHAI Máº C Ä‘áº¿n Káº¾T THÃšC
- Tá»•ng thá»i lÆ°á»£ng: 60 phÃºt

Báº¯t Ä‘áº§u táº¡o ká»‹ch báº£n:`;

            // Updated API URL to use gemini-2.5-flash-preview-09-2025
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: &#x27;POST&#x27;,
                headers: { &#x27;Content-Type&#x27;: &#x27;application/json&#x27; },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.85,
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 8192
                    },
                    safetySettings: [
                        { category: &quot;HARM_CATEGORY_HARASSMENT&quot;, threshold: &quot;BLOCK_MEDIUM_AND_ABOVE&quot; },
                        { category: &quot;HARM_CATEGORY_HATE_SPEECH&quot;, threshold: &quot;BLOCK_MEDIUM_AND_ABOVE&quot; },
                        { category: &quot;HARM_CATEGORY_SEXUALLY_EXPLICIT&quot;, threshold: &quot;BLOCK_MEDIUM_AND_ABOVE&quot; },
                        { category: &quot;HARM_CATEGORY_DANGEROUS_CONTENT&quot;, threshold: &quot;BLOCK_MEDIUM_AND_ABOVE&quot; }
                    ]
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || &#x27;Lá»—i khi gá»i API Gemini&#x27;);
            }

            const data = await response.json();

            if (data.candidates &amp;&amp; data.candidates[0]) {
                const candidate = data.candidates[0];
                const finishReason = candidate.finishReason;

                if (finishReason === &#x27;MAX_TOKENS&#x27;) {
                    console.warn(&#x27;âš ï¸ Cáº£nh bÃ¡o: Response bá»‹ cáº¯t do Ä‘áº¡t giá»›i háº¡n token&#x27;);
                }

                if (candidate.content &amp;&amp; candidate.content.parts &amp;&amp; candidate.content.parts[0]) {
                    return candidate.content.parts[0].text;
                } else {
                    throw new Error(&#x27;KhÃ´ng nháº­n Ä‘Æ°á»£c ná»™i dung tá»« Gemini AI&#x27;);
                }
            } else {
                throw new Error(&#x27;KhÃ´ng nháº­n Ä‘Æ°á»£c pháº£n há»“i tá»« Gemini AI&#x27;);
            }
        }

        function showError(message) {
            const errorMessage = document.getElementById(&#x27;errorMessage&#x27;);
            errorMessage.textContent = &#x27;âŒ &#x27; + message;
            errorMessage.style.display = &#x27;block&#x27;;

            setTimeout(() =&gt; {
                errorMessage.style.display = &#x27;none&#x27;;
            }, 6000);
        }

        function escapeHtml(text) {
            const div = document.createElement(&#x27;div&#x27;);
            div.textContent = text;
            return div.innerHTML;
        }

        function copyScript() {
            const scriptToCopy = scriptData[&#x27;script&#x27; + currentScript];
            if (!scriptToCopy) {
                showError(&#x27;KhÃ´ng cÃ³ ká»‹ch báº£n Ä‘á»ƒ sao chÃ©p.&#x27;);
                return;
            }

            navigator.clipboard.writeText(scriptToCopy).then(() =&gt; {
                const copyBtn = document.getElementById(&#x27;copyBtn&#x27;);
                const originalText = copyBtn.textContent;
                copyBtn.textContent = &#x27;âœ… ÄÃ£ copy&#x27;;
                copyBtn.style.background = &#x27;#00cc88&#x27;;

                setTimeout(() =&gt; {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = &#x27;#00ff99&#x27;;
                }, 2000);
            }).catch(err =&gt; {
                showError(&#x27;KhÃ´ng thá»ƒ copy: &#x27; + err.message);
            });
        }

        function downloadScript() {
            const scriptText = scriptData[&#x27;script&#x27; + currentScript];
            if (!scriptText) {
                showError(&#x27;KhÃ´ng cÃ³ ká»‹ch báº£n Ä‘á»ƒ táº£i xuá»‘ng.&#x27;);
                return;
            }

            const doc = new docx.Document({
                sections: [{
                    properties: {},
                    children: [
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: &quot;Ká»ŠCH Báº¢N LIVESTREAM 60 PHÃšT&quot;,
                                    bold: true,
                                    size: 32,
                                    font: &quot;Arial&quot;
                                })
                            ],
                            spacing: { after: 400 },
                            alignment: docx.AlignmentType.CENTER
                        }),
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `NgÃ y táº¡o: ${new Date().toLocaleDateString(&#x27;vi-VN&#x27;)}`,
                                    size: 20,
                                    font: &quot;Arial&quot;,
                                    italics: true
                                })
                            ],
                            spacing: { after: 400 },
                            alignment: docx.AlignmentType.CENTER
                        }),
                        ...scriptText.split(&#x27;\n&#x27;).map(line =&gt; 
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: line,
                                        size: 24,
                                        font: &quot;Arial&quot;
                                    })
                                ],
                                spacing: { after: 120 }
                            })
                        )
                    ]
                }]
            });

            docx.Packer.toBlob(doc).then(blob =&gt; {
                const timestamp = new Date().getTime();
                saveAs(blob, `KichBan_Livestream_${currentScript}_${timestamp}.docx`);
            }).catch(error =&gt; {
                console.error(&#x27;Error generating DOCX:&#x27;, error);
                showError(&#x27;Lá»—i khi táº¡o file DOCX: &#x27; + error.message);
            });
        }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;"></iframe>
<iframe id="file3" class="file-frame" srcdoc="&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;vi&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;
    &lt;title&gt;Há»‡ Thá»‘ng Táº¡o Storytelling Ná»™i Y - Gemini AI Content Generator&lt;/title&gt;
    &lt;link href=&quot;https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css&quot; rel=&quot;stylesheet&quot; /&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css&quot; /&gt;
    &lt;style&gt;
        @import url(&#x27;https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap&#x27;);
        body { font-family: &#x27;Inter&#x27;, sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .story-card { transition: all 0.3s ease; }
        .story-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .typing-animation { 
            border-right: 2px solid #667eea; 
            white-space: nowrap; 
            overflow: hidden;
            animation: typing 3s steps(40) infinite alternate;
        }
        @keyframes typing {
            0% { width: 0; }
            100% { width: 100%; }
        }
        .prose p { margin-bottom: 1rem; line-height: 1.6; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body class=&quot;bg-gray-50&quot;&gt;
    &lt;!-- Header Section --&gt;
    &lt;header class=&quot;gradient-bg text-white py-8 px-6&quot;&gt;
        &lt;div class=&quot;max-w-7xl mx-auto&quot;&gt;
            &lt;div class=&quot;text-center&quot;&gt;
                &lt;h1 class=&quot;text-4xl font-bold mb-4&quot;&gt;
                    &lt;i class=&quot;fas fa-magic mr-3&quot;&gt;&lt;/i&gt;
                    Há»‡ Thá»‘ng Táº¡o Storytelling Ná»™i Y
                &lt;/h1&gt;
                &lt;p class=&quot;text-xl opacity-90 mb-6&quot;&gt;Powered by Gemini AI - Tá»± Ä‘á»™ng táº¡o cÃ¢u chuyá»‡n háº¥p dáº«n cho sáº£n pháº©m ná»™i y&lt;/p&gt;
                &lt;div class=&quot;flex flex-wrap justify-center gap-4&quot;&gt;
                    &lt;span class=&quot;bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm&quot;&gt;
                        &lt;i class=&quot;fas fa-user mr-2&quot;&gt;&lt;/i&gt;Nam/Ná»¯/Tráº» em
                    &lt;/span&gt;
                    &lt;span class=&quot;bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm&quot;&gt;
                        &lt;i class=&quot;fas fa-graduation-cap mr-2&quot;&gt;&lt;/i&gt;Há»c sinh
                    &lt;/span&gt;
                    &lt;span class=&quot;bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm&quot;&gt;
                        &lt;i class=&quot;fas fa-home mr-2&quot;&gt;&lt;/i&gt;Homewear &amp; Underwear
                    &lt;/span&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/header&gt;

    &lt;!-- Main Content --&gt;
    &lt;main class=&quot;max-w-7xl mx-auto px-6 py-8&quot;&gt;
        &lt;!-- System Overview --&gt;
        &lt;section class=&quot;mb-12&quot;&gt;
            &lt;div class=&quot;bg-white rounded-xl shadow-lg p-8&quot;&gt;
                &lt;h2 class=&quot;text-2xl font-bold text-gray-800 mb-6&quot;&gt;
                    &lt;i class=&quot;fas fa-cogs text-blue-600 mr-3&quot;&gt;&lt;/i&gt;
                    Quy TrÃ¬nh Hoáº¡t Äá»™ng
                &lt;/h2&gt;
                &lt;div class=&quot;grid md:grid-cols-3 gap-6&quot;&gt;
                    &lt;div class=&quot;text-center&quot;&gt;
                        &lt;div class=&quot;bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4&quot;&gt;
                            &lt;i class=&quot;fas fa-keyboard text-blue-600 text-2xl&quot;&gt;&lt;/i&gt;
                        &lt;/div&gt;
                        &lt;h3 class=&quot;font-semibold mb-2&quot;&gt;1. Input Tá»« KhÃ³a&lt;/h3&gt;
                        &lt;p class=&quot;text-gray-600 text-sm&quot;&gt;Nháº­p tá»« khÃ³a liÃªn quan Ä‘áº¿n ná»™i y: Ã¡o ngá»±c, giáº·t á»§i, cháº¥t liá»‡u...&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;text-center&quot;&gt;
                        &lt;div class=&quot;bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4&quot;&gt;
                            &lt;i class=&quot;fas fa-brain text-purple-600 text-2xl&quot;&gt;&lt;/i&gt;
                        &lt;/div&gt;
                        &lt;h3 class=&quot;font-semibold mb-2&quot;&gt;2. AI Research&lt;/h3&gt;
                        &lt;p class=&quot;text-gray-600 text-sm&quot;&gt;Gemini API phÃ¢n tÃ­ch vÃ  nghiÃªn cá»©u ná»™i dung liÃªn quan&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;text-center&quot;&gt;
                        &lt;div class=&quot;bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4&quot;&gt;
                            &lt;i class=&quot;fas fa-pen-fancy text-green-600 text-2xl&quot;&gt;&lt;/i&gt;
                        &lt;/div&gt;
                        &lt;h3 class=&quot;font-semibold mb-2&quot;&gt;3. Generate Story&lt;/h3&gt;
                        &lt;p class=&quot;text-gray-600 text-sm&quot;&gt;Táº¡o ra cÃ¢u chuyá»‡n háº¥p dáº«n theo framework chuyÃªn nghiá»‡p&lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;

        &lt;!-- 7 Categories Framework --&gt;
        &lt;section class=&quot;mb-12&quot;&gt;
            &lt;div class=&quot;bg-white rounded-xl shadow-lg p-8&quot;&gt;
                &lt;h2 class=&quot;text-2xl font-bold text-gray-800 mb-6&quot;&gt;
                    &lt;i class=&quot;fas fa-tags text-indigo-600 mr-3&quot;&gt;&lt;/i&gt;
                    7 Danh Má»¥c Storytelling ChÃ­nh
                &lt;/h2&gt;
                &lt;div class=&quot;grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6&quot;&gt;
                    &lt;div class=&quot;story-card bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-lg border-l-4 border-red-500&quot;&gt;
                        &lt;i class=&quot;fas fa-lightbulb text-red-600 text-2xl mb-3&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-gray-800 mb-2&quot;&gt;Tips&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-gray-600&quot;&gt;Máº¹o sá»­ dá»¥ng, chá»n size, phá»‘i Ä‘á»“ thÃ´ng minh&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;story-card bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg border-l-4 border-blue-500&quot;&gt;
                        &lt;i class=&quot;fas fa-tools text-blue-600 text-2xl mb-3&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-gray-800 mb-2&quot;&gt;Hack&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-gray-600&quot;&gt;Thá»§ thuáº­t báº£o quáº£n, giáº·t á»§i, kÃ©o dÃ i tuá»•i thá»&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;story-card bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg border-l-4 border-green-500&quot;&gt;
                        &lt;i class=&quot;fas fa-leaf text-green-600 text-2xl mb-3&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-gray-800 mb-2&quot;&gt;Cháº¥t Liá»‡u&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-gray-600&quot;&gt;Cotton, Modal, Bamboo, Lá»¥a vÃ  Ä‘áº·c tÃ­nh&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;story-card bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg border-l-4 border-purple-500&quot;&gt;
                        &lt;i class=&quot;fas fa-drafting-compass text-purple-600 text-2xl mb-3&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-gray-800 mb-2&quot;&gt;Thiáº¿t Káº¿&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-gray-600&quot;&gt;Kiá»ƒu dÃ¡ng, form, cÃ´ng nÄƒng Ä‘áº·c biá»‡t&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;story-card bg-gradient-to-br from-yellow-50 to-yellow-100 p-6 rounded-lg border-l-4 border-yellow-500&quot;&gt;
                        &lt;i class=&quot;fas fa-gift text-yellow-600 text-2xl mb-3&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-gray-800 mb-2&quot;&gt;MÃ¹a Lá»… Há»™i&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-gray-600&quot;&gt;Collection theo Valentine, Noel, Táº¿t&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;story-card bg-gradient-to-br from-pink-50 to-pink-100 p-6 rounded-lg border-l-4 border-pink-500&quot;&gt;
                        &lt;i class=&quot;fas fa-palette text-pink-600 text-2xl mb-3&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-gray-800 mb-2&quot;&gt;Mix &amp; Match&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-gray-600&quot;&gt;Phá»‘i há»£p bá»™, táº¡o style cÃ¡ nhÃ¢n&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;story-card bg-gradient-to-br from-indigo-50 to-indigo-100 p-6 rounded-lg border-l-4 border-indigo-500&quot;&gt;
                        &lt;i class=&quot;fas fa-eye-dropper text-indigo-600 text-2xl mb-3&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-gray-800 mb-2&quot;&gt;MÃ u Sáº¯c&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-gray-600&quot;&gt;TÃ¢m lÃ½ há»c mÃ u sáº¯c, trend 2024&lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;

        &lt;!-- Keyword Input System --&gt;
        &lt;section class=&quot;mb-12&quot;&gt;
            &lt;div class=&quot;bg-white rounded-xl shadow-lg p-8&quot;&gt;
                &lt;h2 class=&quot;text-2xl font-bold text-gray-800 mb-6&quot;&gt;
                    &lt;i class=&quot;fas fa-search text-blue-600 mr-3&quot;&gt;&lt;/i&gt;
                    Táº¡o Storytelling Tá»« Tá»« KhÃ³a
                &lt;/h2&gt;

                &lt;!-- Input Form --&gt;
                &lt;div class=&quot;grid md:grid-cols-2 gap-8&quot;&gt;
                    &lt;div&gt;
                        &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-2&quot;&gt;
                            &lt;i class=&quot;fas fa-edit mr-2&quot;&gt;&lt;/i&gt;Nháº­p tá»« khÃ³a
                        &lt;/label&gt;
                        &lt;input type=&quot;text&quot; id=&quot;keywordInput&quot; placeholder=&quot;VD: Ã¡o ngá»±c, giáº·t á»§i&quot; 
                               class=&quot;w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent&quot;&gt;

                        &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-2 mt-4&quot;&gt;
                            &lt;i class=&quot;fas fa-users mr-2&quot;&gt;&lt;/i&gt;Äá»‘i tÆ°á»£ng khÃ¡ch hÃ ng
                        &lt;/label&gt;
                        &lt;select id=&quot;audienceSelect&quot; class=&quot;w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500&quot;&gt;
                            &lt;option value=&quot;women&quot;&gt;Ná»¯&lt;/option&gt;
                            &lt;option value=&quot;men&quot;&gt;Nam&lt;/option&gt;
                            &lt;option value=&quot;children&quot;&gt;Tráº» em&lt;/option&gt;
                            &lt;option value=&quot;students&quot;&gt;Há»c sinh&lt;/option&gt;
                            &lt;option value=&quot;homewear&quot;&gt;Homewear&lt;/option&gt;
                        &lt;/select&gt;

                        &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-2 mt-4&quot;&gt;
                            &lt;i class=&quot;fas fa-layer-group mr-2&quot;&gt;&lt;/i&gt;Danh má»¥c ná»™i dung
                        &lt;/label&gt;
                        &lt;select id=&quot;categorySelect&quot; class=&quot;w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500&quot;&gt;
                            &lt;option value=&quot;tips&quot;&gt;Tips - Máº¹o sá»­ dá»¥ng&lt;/option&gt;
                            &lt;option value=&quot;hack&quot;&gt;Hack - Thá»§ thuáº­t&lt;/option&gt;
                            &lt;option value=&quot;material&quot;&gt;Cháº¥t liá»‡u&lt;/option&gt;
                            &lt;option value=&quot;design&quot;&gt;Thiáº¿t káº¿&lt;/option&gt;
                            &lt;option value=&quot;seasonal&quot;&gt;MÃ¹a lá»… há»™i&lt;/option&gt;
                            &lt;option value=&quot;mixmatch&quot;&gt;Mix &amp; Match&lt;/option&gt;
                            &lt;option value=&quot;color&quot;&gt;MÃ u sáº¯c&lt;/option&gt;
                        &lt;/select&gt;

                        &lt;button onclick=&quot;generateTopics()&quot; class=&quot;w-full mt-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition duration-300&quot;&gt;
                            &lt;i class=&quot;fas fa-search mr-2&quot;&gt;&lt;/i&gt;TÃ¬m Chá»§ Äá»
                        &lt;/button&gt;
                    &lt;/div&gt;

                    &lt;div&gt;
                        &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-2&quot;&gt;
                            &lt;i class=&quot;fas fa-file-alt mr-2&quot;&gt;&lt;/i&gt;Chá»n chá»§ Ä‘á»
                        &lt;/label&gt;
                        &lt;select id=&quot;topicSelect&quot; class=&quot;w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500&quot;&gt;
                            &lt;option value=&quot;&quot;&gt;Vui lÃ²ng tÃ¬m chá»§ Ä‘á» trÆ°á»›c...&lt;/option&gt;
                        &lt;/select&gt;

                        &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-2 mt-4&quot;&gt;
                            &lt;i class=&quot;fas fa-cog mr-2&quot;&gt;&lt;/i&gt;CÃ i Ä‘áº·t Gemini API
                        &lt;/label&gt;
                        &lt;input type=&quot;password&quot; id=&quot;apiKey&quot; placeholder=&quot;Nháº­p Gemini API Key&quot; 
                               class=&quot;w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500&quot;&gt;

                        &lt;div class=&quot;mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg&quot;&gt;
                            &lt;h4 class=&quot;font-medium text-blue-800 mb-2&quot;&gt;
                                &lt;i class=&quot;fas fa-info-circle mr-2&quot;&gt;&lt;/i&gt;HÆ°á»›ng dáº«n sá»­ dá»¥ng API
                            &lt;/h4&gt;
                            &lt;p class=&quot;text-sm text-blue-700&quot;&gt;
                                1. Láº¥y API key tá»« &lt;a href=&quot;https://ai.google.dev/&quot; class=&quot;underline&quot; target=&quot;_blank&quot;&gt;Google AI Studio&lt;/a&gt;&lt;br /&gt;
                                2. Nháº­p key vÃ o Ã´ trÃªn&lt;br /&gt;
                                3. Chá»n tá»« khÃ³a, danh má»¥c vÃ  chá»§ Ä‘á»&lt;br /&gt;
                                4. Nháº¥n &quot;Táº¡o Storytelling&quot;
                            &lt;/p&gt;
                        &lt;/div&gt;

                        &lt;button onclick=&quot;generateStory()&quot; class=&quot;w-full mt-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition duration-300&quot;&gt;
                            &lt;i class=&quot;fas fa-magic mr-2&quot;&gt;&lt;/i&gt;Táº¡o Storytelling vá»›i Gemini AI
                        &lt;/button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;

        &lt;!-- Generated Story Output --&gt;
        &lt;section class=&quot;mb-12&quot;&gt;
            &lt;div class=&quot;bg-white rounded-xl shadow-lg p-8&quot;&gt;
                &lt;h2 class=&quot;text-2xl font-bold text-gray-800 mb-6&quot;&gt;
                    &lt;i class=&quot;fas fa-scroll text-green-600 mr-3&quot;&gt;&lt;/i&gt;
                    Storytelling ÄÆ°á»£c Táº¡o
                &lt;/h2&gt;
                &lt;div id=&quot;storyOutput&quot; class=&quot;min-h-64 p-6 bg-gray-50 border border-gray-200 rounded-lg&quot;&gt;
                    &lt;div class=&quot;text-center py-16 text-gray-500&quot;&gt;
                        &lt;i class=&quot;fas fa-edit text-4xl mb-4&quot;&gt;&lt;/i&gt;
                        &lt;p class=&quot;text-lg&quot;&gt;CÃ¢u chuyá»‡n sáº½ xuáº¥t hiá»‡n á»Ÿ Ä‘Ã¢y sau khi báº¡n táº¡o...&lt;/p&gt;
                        &lt;p class=&quot;text-sm mt-2&quot;&gt;Sá»­ dá»¥ng form bÃªn trÃªn Ä‘á»ƒ báº¯t Ä‘áº§u táº¡o ná»™i dung&lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;mt-4 flex justify-end&quot;&gt;
                    &lt;button onclick=&quot;copyToClipboard()&quot; id=&quot;copyButton&quot; class=&quot;hidden bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition duration-300&quot;&gt;
                        &lt;i class=&quot;fas fa-copy mr-2&quot;&gt;&lt;/i&gt;Copy Storytelling
                    &lt;/button&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;

        &lt;!-- Content Framework --&gt;
        &lt;section class=&quot;mb-12&quot;&gt;
            &lt;div class=&quot;bg-white rounded-xl shadow-lg p-8&quot;&gt;
                &lt;h2 class=&quot;text-2xl font-bold text-gray-800 mb-6&quot;&gt;
                    &lt;i class=&quot;fas fa-sitemap text-indigo-600 mr-3&quot;&gt;&lt;/i&gt;
                    Framework Táº¡o Content ChuyÃªn Nghiá»‡p
                &lt;/h2&gt;

                &lt;div class=&quot;grid md:grid-cols-3 gap-6&quot;&gt;
                    &lt;!-- Framework Steps --&gt;
                    &lt;div class=&quot;col-span-2&quot;&gt;
                        &lt;div class=&quot;space-y-6&quot;&gt;
                            &lt;div class=&quot;flex&quot;&gt;
                                &lt;div class=&quot;flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-4&quot;&gt;
                                    &lt;span class=&quot;text-blue-600 font-semibold text-sm&quot;&gt;1&lt;/span&gt;
                                &lt;/div&gt;
                                &lt;div&gt;
                                    &lt;h3 class=&quot;font-semibold text-gray-800&quot;&gt;Keyword Analysis&lt;/h3&gt;
                                    &lt;p class=&quot;text-sm text-gray-600 mt-1&quot;&gt;PhÃ¢n tÃ­ch tá»« khÃ³a â†’ XÃ¡c Ä‘á»‹nh intent â†’ Map vá»›i 7 categories&lt;/p&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;

                            &lt;div class=&quot;flex&quot;&gt;
                                &lt;div class=&quot;flex-shrink-0 w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-4&quot;&gt;
                                    &lt;span class=&quot;text-purple-600 font-semibold text-sm&quot;&gt;2&lt;/span&gt;
                                &lt;/div&gt;
                                &lt;div&gt;
                                    &lt;h3 class=&quot;font-semibold text-gray-800&quot;&gt;Topic Generation&lt;/h3&gt;
                                    &lt;p class=&quot;text-sm text-gray-600 mt-1&quot;&gt;Gemini AI research â†’ Táº¡o title háº¥p dáº«n â†’ XÃ¡c Ä‘á»‹nh angle&lt;/p&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;

                            &lt;div class=&quot;flex&quot;&gt;
                                &lt;div class=&quot;flex-shrink-0 w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-4&quot;&gt;
                                    &lt;span class=&quot;text-green-600 font-semibold text-sm&quot;&gt;3&lt;/span&gt;
                                &lt;/div&gt;
                                &lt;div&gt;
                                    &lt;h3 class=&quot;font-semibold text-gray-800&quot;&gt;Story Structure&lt;/h3&gt;
                                    &lt;p class=&quot;text-sm text-gray-600 mt-1&quot;&gt;Hook â†’ Problem â†’ Solution â†’ Benefit â†’ Call-to-action&lt;/p&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;

                            &lt;div class=&quot;flex&quot;&gt;
                                &lt;div class=&quot;flex-shrink-0 w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center mr-4&quot;&gt;
                                    &lt;span class=&quot;text-yellow-600 font-semibold text-sm&quot;&gt;4&lt;/span&gt;
                                &lt;/div&gt;
                                &lt;div&gt;
                                    &lt;h3 class=&quot;font-semibold text-gray-800&quot;&gt;Content Enhancement&lt;/h3&gt;
                                    &lt;p class=&quot;text-sm text-gray-600 mt-1&quot;&gt;Visual storytelling â†’ Emotional connection â†’ User engagement&lt;/p&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;

                    &lt;!-- Template Structure --&gt;
                    &lt;div class=&quot;bg-gray-50 p-6 rounded-lg&quot;&gt;
                        &lt;h3 class=&quot;font-semibold text-gray-800 mb-4&quot;&gt;Template Structure&lt;/h3&gt;
                        &lt;div class=&quot;space-y-3 text-sm&quot;&gt;
                            &lt;div class=&quot;p-2 bg-white rounded border-l-2 border-blue-500&quot;&gt;
                                &lt;strong&gt;Hook:&lt;/strong&gt; CÃ¢u má»Ÿ Ä‘áº§u háº¥p dáº«n
                            &lt;/div&gt;
                            &lt;div class=&quot;p-2 bg-white rounded border-l-2 border-red-500&quot;&gt;
                                &lt;strong&gt;Story:&lt;/strong&gt; Ká»ƒ chuyá»‡n cáº£m xÃºc
                            &lt;/div&gt;
                            &lt;div class=&quot;p-2 bg-white rounded border-l-2 border-green-500&quot;&gt;
                                &lt;strong&gt;Solution:&lt;/strong&gt; Giáº£i phÃ¡p cá»¥ thá»ƒ
                            &lt;/div&gt;
                            &lt;div class=&quot;p-2 bg-white rounded border-l-2 border-purple-500&quot;&gt;
                                &lt;strong&gt;Benefit:&lt;/strong&gt; Lá»£i Ã­ch rÃµ rÃ ng
                            &lt;/div&gt;
                            &lt;div class=&quot;p-2 bg-white rounded border-l-2 border-yellow-500&quot;&gt;
                                &lt;strong&gt;CTA:&lt;/strong&gt; KÃªu gá»i hÃ nh Ä‘á»™ng
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;

        &lt;!-- Material Comparison --&gt;
        &lt;section class=&quot;mb-12&quot;&gt;
            &lt;div class=&quot;bg-white rounded-xl shadow-lg p-8&quot;&gt;
                &lt;h2 class=&quot;text-2xl font-bold text-gray-800 mb-6&quot;&gt;
                    &lt;i class=&quot;fas fa-microscope text-green-600 mr-3&quot;&gt;&lt;/i&gt;
                    So SÃ¡nh Cháº¥t Liá»‡u Ná»™i Y
                &lt;/h2&gt;

                &lt;div class=&quot;overflow-x-auto&quot;&gt;
                    &lt;table class=&quot;w-full text-sm&quot;&gt;
                        &lt;thead class=&quot;bg-gray-50&quot;&gt;
                            &lt;tr&gt;
                                &lt;th class=&quot;px-4 py-3 text-left font-semibold text-gray-800&quot;&gt;Cháº¥t Liá»‡u&lt;/th&gt;
                                &lt;th class=&quot;px-4 py-3 text-left font-semibold text-gray-800&quot;&gt;Nguá»“n Gá»‘c&lt;/th&gt;
                                &lt;th class=&quot;px-4 py-3 text-left font-semibold text-gray-800&quot;&gt;Æ¯u Äiá»ƒm&lt;/th&gt;
                                &lt;th class=&quot;px-4 py-3 text-left font-semibold text-gray-800&quot;&gt;NhÆ°á»£c Äiá»ƒm&lt;/th&gt;
                                &lt;th class=&quot;px-4 py-3 text-left font-semibold text-gray-800&quot;&gt;Storytelling Angle&lt;/th&gt;
                            &lt;/tr&gt;
                        &lt;/thead&gt;
                        &lt;tbody class=&quot;divide-y divide-gray-200&quot;&gt;
                            &lt;tr class=&quot;hover:bg-green-50&quot;&gt;
                                &lt;td class=&quot;px-4 py-3 font-medium text-green-800&quot;&gt;Bamboo&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;Bá»™t tre/trÃºc&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;KhÃ¡ng khuáº©n tá»± nhiÃªn, tháº¥m hÃºt má»“ hÃ´i, thÃ¢n thiá»‡n mÃ´i trÆ°á»ng&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;Dá»… nhÄƒn, cÃ³ thá»ƒ phai mÃ u&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;&quot;Sá»©c máº¡nh tá»« thiÃªn nhiÃªn&quot;&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr class=&quot;hover:bg-blue-50&quot;&gt;
                                &lt;td class=&quot;px-4 py-3 font-medium text-blue-800&quot;&gt;Modal&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;Bá»™t gá»— sá»“i&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;Má»m máº¡i, bá»n mÃ u, Ã­t nhÄƒn, giá»¯ form tá»‘t&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;GiÃ¡ cao hÆ¡n cotton&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;&quot;Luxury cáº£m á»©ng má»‹n mÃ ng&quot;&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr class=&quot;hover:bg-yellow-50&quot;&gt;
                                &lt;td class=&quot;px-4 py-3 font-medium text-yellow-800&quot;&gt;Cotton&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;Sá»£i bÃ´ng tá»± nhiÃªn&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;ThoÃ¡ng khÃ­, tháº¥m hÃºt, giÃ¡ cáº£ pháº£i chÄƒng&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;Dá»… co rÃºt, nhÄƒn nhiá»u&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;&quot;ÄÃ¡ng tin cáº­y hÃ ng ngÃ y&quot;&lt;/td&gt;
                            &lt;/tr&gt;
                            &lt;tr class=&quot;hover:bg-purple-50&quot;&gt;
                                &lt;td class=&quot;px-4 py-3 font-medium text-purple-800&quot;&gt;Lace&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;Ren polyester/nylon&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;Quyáº¿n rÅ©, thanh lá»‹ch, co giÃ£n tá»‘t&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;Dá»… rÃ¡ch, cáº§n chÄƒm sÃ³c Ä‘áº·c biá»‡t&lt;/td&gt;
                                &lt;td class=&quot;px-4 py-3 text-gray-600&quot;&gt;&quot;Ná»¯ tÃ­nh vÃ  quyáº¿n rÅ©&quot;&lt;/td&gt;
                            &lt;/tr&gt;
                        &lt;/tbody&gt;
                    &lt;/table&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;
    &lt;/main&gt;

    &lt;!-- Footer --&gt;
    &lt;footer class=&quot;gradient-bg text-white py-6 px-6&quot;&gt;
        &lt;div class=&quot;max-w-7xl mx-auto text-center&quot;&gt;
            &lt;p class=&quot;text-sm opacity-80&quot;&gt;Â© 2025 Copyright by Tien Hoang.&lt;/p&gt;
            &lt;div class=&quot;mt-4 flex justify-center space-x-4&quot;&gt;
                &lt;a href=&quot;#&quot; class=&quot;text-white hover:text-yellow-300 transition duration-300&quot;&gt;
                    &lt;i class=&quot;fab fa-facebook-f&quot;&gt;&lt;/i&gt;
                &lt;/a&gt;
                &lt;a href=&quot;#&quot; class=&quot;text-white hover:text-yellow-300 transition duration-300&quot;&gt;
                    &lt;i class=&quot;fab fa-instagram&quot;&gt;&lt;/i&gt;
                &lt;/a&gt;
                &lt;a href=&quot;#&quot; class=&quot;text-white hover:text-yellow-300 transition duration-300&quot;&gt;
                    &lt;i class=&quot;fab fa-tiktok&quot;&gt;&lt;/i&gt;
                &lt;/a&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/footer&gt;

    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        // --- Cáº¥u hÃ¬nh API vÃ  logic Thá»­ láº¡i (Fix lá»—i API) ---
        const GEMINI_MODEL = &quot;gemini-2.5-flash-preview-09-2025&quot;; // Cáº­p nháº­t model á»•n Ä‘á»‹nh hÆ¡n
        const API_BASE_URL = &quot;https://generativelanguage.googleapis.com/v1beta/models/&quot;;

        // HÃ m fetch cÃ³ Tá»± Ä‘á»™ng Thá»­ láº¡i (Exponential Backoff) Ä‘á»ƒ tÄƒng Ä‘á»™ á»•n Ä‘á»‹nh
        async function fetchWithRetry(url, options, maxRetries = 3) {
            let lastError = null;
            for (let i = 0; i &lt; maxRetries; i++) {
                // Äá»£i 1s, 2s, 4s...
                const delay = Math.pow(2, i) * 1000; 
                if (i &gt; 0) {
                    // console.log(`Retrying API call in ${delay / 1000}s... (Attempt ${i + 1}/${maxRetries})`);
                    await new Promise(resolve =&gt; setTimeout(resolve, delay));
                }

                try {
                    const response = await fetch(url, options);
                    if (response.ok) {
                        return response;
                    } else {
                        // Náº¿u lÃ  lá»—i 4xx (vÃ­ dá»¥ 400 Bad Request, 401 Unauthorized), kháº£ nÄƒng lÃ  API Key sai
                        if (response.status &gt;= 400 &amp;&amp; response.status &lt; 500) {
                            const errorBody = await response.json();
                            throw new Error(`Client Error (${response.status}): ${errorBody.error.message || &#x27;Lá»—i: Vui lÃ²ng kiá»ƒm tra láº¡i API Key.&#x27;}`);
                        }
                        // Náº¿u lÃ  lá»—i 5xx, tiáº¿p tá»¥c thá»­ láº¡i
                        lastError = new Error(`HTTP Error! status: ${response.status}`);
                    }
                } catch (error) {
                    // Lá»—i máº¡ng hoáº·c lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh
                    lastError = error;
                }
            }
            throw lastError; // NÃ©m lá»—i cuá»‘i cÃ¹ng náº¿u Ä‘Ã£ thá»­ háº¿t sá»‘ láº§n
        }
        // ---------------------------------------------------


        // Variables to store data
        let encryptedApiKey = null;
        let generatedStoryContent = &#x27;&#x27;;

        // API Key Encryption
        function encryptApiKey(apiKey) {
            const secretKey = &#x27;gemini-storytelling-secret&#x27;;
            encryptedApiKey = CryptoJS.AES.encrypt(apiKey, secretKey).toString();
        }

        function decryptApiKey() {
            if (!encryptedApiKey) return &#x27;&#x27;;
            const secretKey = &#x27;gemini-storytelling-secret&#x27;;
            try {
                const bytes = CryptoJS.AES.decrypt(encryptedApiKey, secretKey);
                return bytes.toString(CryptoJS.enc.Utf8);
            } catch (error) {
                console.error(&#x27;Decryption error:&#x27;, error);
                return &#x27;&#x27;;
            }
        }

        // Event listeners
        document.getElementById(&#x27;apiKey&#x27;).addEventListener(&#x27;input&#x27;, function(e) {
            if (e.target.value.trim()) {
                encryptApiKey(e.target.value);
            } else {
                encryptedApiKey = null;
            }
        });

        // Show loading state
        function showLoading(elementId, message) {
            document.getElementById(elementId).innerHTML = `
                &lt;div class=&quot;text-center py-8&quot;&gt;
                    &lt;div class=&quot;pulse-animation&quot;&gt;
                        &lt;i class=&quot;fas fa-spinner fa-spin text-4xl text-blue-600 mb-4&quot;&gt;&lt;/i&gt;
                        &lt;p class=&quot;text-lg font-semibold text-gray-700&quot;&gt;${message}&lt;/p&gt;
                        &lt;p class=&quot;text-sm text-gray-500 mt-2&quot;&gt;Vui lÃ²ng Ä‘á»£i trong giÃ¢y lÃ¡t&lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            `;
        }

        // Show error state
        function showError(elementId, message) {
            document.getElementById(elementId).innerHTML = `
                &lt;div class=&quot;text-center py-8 text-red-500&quot;&gt;
                    &lt;i class=&quot;fas fa-exclamation-triangle text-4xl mb-4&quot;&gt;&lt;/i&gt;
                    &lt;p class=&quot;text-lg&quot;&gt;${message}&lt;/p&gt;
                    &lt;p class=&quot;text-sm mt-2&quot;&gt;Vui lÃ²ng kiá»ƒm tra láº¡i thÃ´ng tin vÃ  thá»­ láº¡i.&lt;/p&gt;
                &lt;/div&gt;
            `;
            // áº¨n nÃºt copy náº¿u cÃ³ lá»—i
            document.getElementById(&#x27;copyButton&#x27;).classList.add(&#x27;hidden&#x27;);
        }

        // Validate inputs
        function validateInputs(keyword, apiKey, requireTopic = false, topic = &#x27;&#x27;) {
            if (!keyword) {
                showError(&#x27;storyOutput&#x27;, &#x27;Vui lÃ²ng nháº­p Tá»« KhÃ³a Ä‘á»ƒ báº¯t Ä‘áº§u!&#x27;);
                return false;
            }
            if (!apiKey) {
                showError(&#x27;storyOutput&#x27;, &#x27;Vui lÃ²ng nháº­p Gemini API Key Ä‘á»ƒ thá»±c hiá»‡n.&#x27;);
                return false;
            }
            if (requireTopic &amp;&amp; !topic) {
                showError(&#x27;storyOutput&#x27;, &#x27;Vui lÃ²ng chá»n má»™t Chá»§ Äá» trÆ°á»›c khi táº¡o Storytelling.&#x27;);
                return false;
            }
            return true;
        }

        // Topic Generation
        async function generateTopics() {
            const keyword = document.getElementById(&#x27;keywordInput&#x27;).value.trim();
            const category = document.getElementById(&#x27;categorySelect&#x27;).value;
            const audience = document.getElementById(&#x27;audienceSelect&#x27;).value;
            const apiKey = decryptApiKey();

            if (!validateInputs(keyword, apiKey)) return;

            const topicSelect = document.getElementById(&#x27;topicSelect&#x27;);
            topicSelect.innerHTML = &#x27;&lt;option value=&quot;&quot;&gt;Äang táº¡o chá»§ Ä‘á»...&lt;/option&gt;&#x27;;

            const categoryNames = {
                &#x27;tips&#x27;: &#x27;Tips - Máº¹o sá»­ dá»¥ng&#x27;,
                &#x27;hack&#x27;: &#x27;Hack - Thá»§ thuáº­t&#x27;,
                &#x27;material&#x27;: &#x27;Cháº¥t liá»‡u&#x27;,
                &#x27;design&#x27;: &#x27;Thiáº¿t káº¿&#x27;,
                &#x27;seasonal&#x27;: &#x27;MÃ¹a lá»… há»™i&#x27;,
                &#x27;mixmatch&#x27;: &#x27;Mix &amp; Match&#x27;,
                &#x27;color&#x27;: &#x27;MÃ u sáº¯c&#x27;
            };

            const audienceNames = {
                &#x27;women&#x27;: &#x27;Phá»¥ ná»¯&#x27;,
                &#x27;men&#x27;: &#x27;Nam giá»›i&#x27;,
                &#x27;children&#x27;: &#x27;Tráº» em&#x27;,
                &#x27;students&#x27;: &#x27;Há»c sinh&#x27;,
                &#x27;homewear&#x27;: &#x27;Homewear&#x27;
            };

            try {
                const prompt = `Táº¡o danh sÃ¡ch 10 chá»§ Ä‘á» storytelling háº¥p dáº«n vá» ná»™i y:
                - Tá»« khÃ³a: &quot;${keyword}&quot;
                - Danh má»¥c: &quot;${categoryNames[category]}&quot;
                - Äá»‘i tÆ°á»£ng: &quot;${audienceNames[audience]}&quot;

                YÃªu cáº§u:
                1. Má»—i chá»§ Ä‘á» ngáº¯n gá»n (1-2 cÃ¢u)
                2. Háº¥p dáº«n, gÃ¢y tÃ² mÃ²
                3. PhÃ¹ há»£p vá»›i framework Hook-Problem-Solution-Benefit-CTA
                4. Tráº£ vá» dáº¡ng danh sÃ¡ch Ä‘Ã¡nh sá»‘ tá»« 1-10
                5. Má»—i chá»§ Ä‘á» trÃªn má»™t dÃ²ng riÃªng`;

                const apiUrl = `${API_BASE_URL}${GEMINI_MODEL}:generateContent?key=${apiKey}`;

                const response = await fetchWithRetry(apiUrl, {
                    method: &#x27;POST&#x27;,
                    headers: {
                        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.8,
                            maxOutputTokens: 1500,
                            topP: 0.9
                        }
                    })
                });

                const data = await response.json();

                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error(&#x27;Äá»‹nh dáº¡ng pháº£n há»“i tá»« Gemini API khÃ´ng há»£p lá»‡.&#x27;);
                }

                const topicsText = data.candidates[0].content.parts[0].text;
                const topics = topicsText.split(&#x27;\n&#x27;)
                    .filter(t =&gt; t.trim())
                    .map(t =&gt; t.replace(/^\d+\.\s*/, &#x27;&#x27;).trim())
                    .filter(t =&gt; t.length &gt; 10)
                    .slice(0, 10);

                topicSelect.innerHTML = &#x27;&lt;option value=&quot;&quot;&gt;Chá»n má»™t chá»§ Ä‘á»...&lt;/option&gt;&#x27;;

                if (topics.length &gt; 0) {
                    topics.forEach((topic, index) =&gt; {
                        const option = document.createElement(&#x27;option&#x27;);
                        option.value = topic;
                        option.textContent = `${index + 1}. ${topic}`;
                        topicSelect.appendChild(option);
                    });
                } else {
                    topicSelect.innerHTML = &#x27;&lt;option value=&quot;&quot;&gt;KhÃ´ng tÃ¬m Ä‘Æ°á»£c chá»§ Ä‘á» phÃ¹ há»£p. Vui lÃ²ng thá»­ láº¡i.&lt;/option&gt;&#x27;;
                    showError(&#x27;storyOutput&#x27;, &#x27;KhÃ´ng tÃ¬m Ä‘Æ°á»£c chá»§ Ä‘á». HÃ£y thá»­ Ä‘á»•i tá»« khÃ³a hoáº·c danh má»¥c.&#x27;);
                }

            } catch (error) {
                console.error(&#x27;Error generating topics:&#x27;, error);
                // Cáº­p nháº­t thÃ´ng bÃ¡o lá»—i rÃµ rÃ ng hÆ¡n
                showError(&#x27;storyOutput&#x27;, `Lá»—i khi táº¡o chá»§ Ä‘á»: ${error.message}. Vui lÃ²ng kiá»ƒm tra API key vÃ  thá»­ láº¡i.`); 
                topicSelect.innerHTML = &#x27;&lt;option value=&quot;&quot;&gt;Lá»—i khi táº¡o chá»§ Ä‘á». Vui lÃ²ng kiá»ƒm tra API key vÃ  thá»­ láº¡i.&lt;/option&gt;&#x27;;
            }
        }

        // Story Generation
        async function generateStory() {
            const keyword = document.getElementById(&#x27;keywordInput&#x27;).value.trim();
            const audience = document.getElementById(&#x27;audienceSelect&#x27;).value;
            const category = document.getElementById(&#x27;categorySelect&#x27;).value;
            const topic = document.getElementById(&#x27;topicSelect&#x27;).value;
            const apiKey = decryptApiKey();

            if (!validateInputs(keyword, apiKey, true, topic)) return;

            showLoading(&#x27;storyOutput&#x27;, &#x27;Gemini AI Ä‘ang táº¡o storytelling...&#x27;);

            const categoryNames = {
                &#x27;tips&#x27;: &#x27;Tips - Máº¹o sá»­ dá»¥ng&#x27;,
                &#x27;hack&#x27;: &#x27;Hack - Thá»§ thuáº­t&#x27;,
                &#x27;material&#x27;: &#x27;Cháº¥t liá»‡u&#x27;,
                &#x27;design&#x27;: &#x27;Thiáº¿t káº¿&#x27;,
                &#x27;seasonal&#x27;: &#x27;MÃ¹a lá»… há»™i&#x27;,
                &#x27;mixmatch&#x27;: &#x27;Mix &amp; Match&#x27;,
                &#x27;color&#x27;: &#x27;MÃ u sáº¯c&#x27;
            };

            const audienceNames = {
                &#x27;women&#x27;: &#x27;Phá»¥ ná»¯&#x27;,
                &#x27;men&#x27;: &#x27;Nam giá»›i&#x27;,
                &#x27;children&#x27;: &#x27;Tráº» em&#x27;,
                &#x27;students&#x27;: &#x27;Há»c sinh&#x27;,
                &#x27;homewear&#x27;: &#x27;Homewear&#x27;
            };

            try {
                const prompt = `Táº¡o storytelling chuyÃªn nghiá»‡p cho sáº£n pháº©m ná»™i y:

                THÃ”NG TIN:
                - Tá»« khÃ³a: &quot;${keyword}&quot;
                - Chá»§ Ä‘á»: &quot;${topic}&quot;
                - Danh má»¥c: &quot;${categoryNames[category]}&quot;
                - Äá»‘i tÆ°á»£ng: &quot;${audienceNames[audience]}&quot;

                FRAMEWORK YÃŠU Cáº¦U:
                1. HOOK (CÃ¢u má»Ÿ Ä‘áº§u): Táº¡o sá»± chÃº Ã½, gÃ¢y tÃ² mÃ²
                2. PROBLEM (Váº¥n Ä‘á»): XÃ¡c Ä‘á»‹nh pain point cá»§a khÃ¡ch hÃ ng
                3. STORY (CÃ¢u chuyá»‡n): Ká»ƒ chuyá»‡n cáº£m xÃºc, dá»… Ä‘á»“ng cáº£m
                4. SOLUTION (Giáº£i phÃ¡p): Giá»›i thiá»‡u sáº£n pháº©m/lá»i khuyÃªn
                5. BENEFIT (Lá»£i Ã­ch): MÃ´ táº£ cá»¥ thá»ƒ giÃ¡ trá»‹ mang láº¡i
                6. CTA (KÃªu gá»i hÃ nh Ä‘á»™ng): Äá»™ng viÃªn hÃ nh Ä‘á»™ng cá»¥ thá»ƒ

                YÃŠU Cáº¦U CONTENT:
                - Äá»™ dÃ i: 300-500 tá»«
                - NgÃ´n ngá»¯: Tiáº¿ng Viá»‡t thÃ¢n thiá»‡n, dá»… hiá»ƒu
                - TÃ´ng Ä‘iá»‡u: Tá»± tin, chuyÃªn nghiá»‡p nhÆ°ng gáº§n gÅ©i
                - CÃ³ emoji phÃ¹ há»£p Ä‘á»ƒ tÄƒng engagement
                - Bao gá»“m hashtag liÃªn quan

                HÃ£y táº¡o ná»™i dung storytelling hoÃ n chá»‰nh theo framework trÃªn.`;

                const apiUrl = `${API_BASE_URL}${GEMINI_MODEL}:generateContent?key=${apiKey}`;

                const response = await fetchWithRetry(apiUrl, {
                    method: &#x27;POST&#x27;,
                    headers: {
                        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 2048,
                            topP: 0.8
                        }
                    })
                });

                const data = await response.json();

                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error(&#x27;Äá»‹nh dáº¡ng pháº£n há»“i tá»« Gemini API khÃ´ng há»£p lá»‡. CÃ³ thá»ƒ API Key khÃ´ng chÃ­nh xÃ¡c.&#x27;);
                }

                const story = data.candidates[0].content.parts[0].text;
                generatedStoryContent = story;
                displayGeneratedStory(story, keyword, category, topic);

            } catch (error) {
                console.error(&#x27;API Error:&#x27;, error);
                // Cáº­p nháº­t thÃ´ng bÃ¡o lá»—i rÃµ rÃ ng hÆ¡n
                showError(&#x27;storyOutput&#x27;, `Lá»—i khi táº¡o storytelling: ${error.message}. Vui lÃ²ng kiá»ƒm tra API key vÃ  thá»­ láº¡i.`);
            }
        }

        // Display generated story
        function displayGeneratedStory(story, keyword, category, topic) {
            const categoryNames = {
                &#x27;tips&#x27;: &#x27;TIPS&#x27;,
                &#x27;hack&#x27;: &#x27;HACK&#x27;,
                &#x27;material&#x27;: &#x27;CHáº¤T LIá»†U&#x27;,
                &#x27;design&#x27;: &#x27;THIáº¾T Káº¾&#x27;,
                &#x27;seasonal&#x27;: &#x27;MÃ™A Lá»„ Há»˜I&#x27;,
                &#x27;mixmatch&#x27;: &#x27;MIX &amp; MATCH&#x27;,
                &#x27;color&#x27;: &#x27;MÃ€U Sáº®C&#x27;
            };

            // Format story content with proper paragraphs
            const formattedStory = story
                .split(&#x27;\n&#x27;)
                .filter(line =&gt; line.trim())
                .map(line =&gt; `&lt;p class=&quot;mb-4&quot;&gt;${line.trim()}&lt;/p&gt;`)
                .join(&#x27;&#x27;);

            document.getElementById(&#x27;storyOutput&#x27;).innerHTML = `
                &lt;div class=&quot;border-b border-gray-200 pb-4 mb-6&quot;&gt;
                    &lt;div class=&quot;flex items-center justify-between mb-3&quot;&gt;
                        &lt;div class=&quot;flex items-center space-x-3&quot;&gt;
                            &lt;span class=&quot;bg-gradient-to-r from-blue-600 to-purple-600 text-white text-xs font-semibold px-3 py-1 rounded-full&quot;&gt;
                                ${categoryNames[category]}
                            &lt;/span&gt;
                            &lt;span class=&quot;text-sm text-gray-500&quot;&gt;
                                &lt;i class=&quot;fas fa-key mr-1&quot;&gt;&lt;/i&gt;
                                ${keyword}
                            &lt;/span&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;flex items-center space-x-2 text-xs text-gray-500&quot;&gt;
                            &lt;i class=&quot;fas fa-robot&quot;&gt;&lt;/i&gt;
                            &lt;span&gt;Generated by Gemini AI&lt;/span&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;h3 class=&quot;text-xl font-bold text-gray-800&quot;&gt;${topic}&lt;/h3&gt;
                &lt;/div&gt;

                &lt;div class=&quot;prose max-w-none text-gray-700 leading-relaxed&quot;&gt;
                    ${formattedStory}
                &lt;/div&gt;

                &lt;div class=&quot;mt-8 p-4 bg-green-50 border border-green-200 rounded-lg&quot;&gt;
                    &lt;div class=&quot;flex items-start space-x-3&quot;&gt;
                        &lt;i class=&quot;fas fa-check-circle text-green-600 text-xl&quot;&gt;&lt;/i&gt;
                        &lt;div&gt;
                            &lt;h4 class=&quot;font-semibold text-green-800 mb-1&quot;&gt;Storytelling hoÃ n thÃ nh!&lt;/h4&gt;
                            &lt;p class=&quot;text-sm text-green-700&quot;&gt;
                                Ná»™i dung Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u cho engagement vÃ  conversion theo framework chuyÃªn nghiá»‡p. 
                                Báº¡n cÃ³ thá»ƒ copy vÃ  sá»­ dá»¥ng ngay cho chiáº¿n dá»‹ch marketing.
                            &lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            `;

            // Show copy button
            document.getElementById(&#x27;copyButton&#x27;).classList.remove(&#x27;hidden&#x27;);
        }

        // Copy to clipboard function
        async function copyToClipboard() {
            if (!generatedStoryContent) {
                // Sá»­ dá»¥ng showError thay vÃ¬ alert
                showError(&#x27;storyOutput&#x27;, &#x27;KhÃ´ng cÃ³ ná»™i dung Ä‘á»ƒ copy. Vui lÃ²ng táº¡o storytelling trÆ°á»›c.&#x27;);
                return;
            }

            try {
                // Thay tháº¿ navigator.clipboard.writeText báº±ng document.execCommand(&#x27;copy&#x27;) cho mÃ´i trÆ°á»ng iframe
                const textarea = document.createElement(&#x27;textarea&#x27;);
                textarea.value = generatedStoryContent;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand(&#x27;copy&#x27;);
                document.body.removeChild(textarea);

                const button = document.getElementById(&#x27;copyButton&#x27;);
                const originalContent = button.innerHTML;

                button.innerHTML = &#x27;&lt;i class=&quot;fas fa-check mr-2&quot;&gt;&lt;/i&gt;ÄÃ£ Copy!&#x27;;
                button.classList.remove(&#x27;bg-gray-600&#x27;, &#x27;hover:bg-gray-700&#x27;);
                button.classList.add(&#x27;bg-green-600&#x27;, &#x27;hover:bg-green-700&#x27;);

                setTimeout(() =&gt; {
                    button.innerHTML = originalContent;
                    button.classList.remove(&#x27;bg-green-600&#x27;, &#x27;hover:bg-green-700&#x27;);
                    button.classList.add(&#x27;bg-gray-600&#x27;, &#x27;hover:bg-gray-700&#x27;);
                }, 2000);

            } catch (error) {
                console.error(&#x27;Copy failed:&#x27;, error);
                // Sá»­ dá»¥ng showError thay vÃ¬ alert
                showError(&#x27;storyOutput&#x27;, &#x27;KhÃ´ng thá»ƒ copy tá»± Ä‘á»™ng. Vui lÃ²ng bÃ´i Ä‘en vÃ  copy thá»§ cÃ´ng.&#x27;);
            }
        }

        // Initialize page
        document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() {
            // Add intersection observer for animations
            const cards = document.querySelectorAll(&#x27;.story-card&#x27;);
            const observer = new IntersectionObserver((entries) =&gt; {
                entries.forEach(entry =&gt; {
                    if (entry.isIntersecting) {
                        entry.target.style.transform = &#x27;translateY(0)&#x27;;
                        entry.target.style.opacity = &#x27;1&#x27;;
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: &#x27;0px 0px -50px 0px&#x27;
            });

            cards.forEach((card, index) =&gt; {
                card.style.transform = &#x27;translateY(20px)&#x27;;
                card.style.opacity = &#x27;0&#x27;;
                card.style.transition = `all 0.6s ease ${index * 0.1}s`;
                observer.observe(card);
            });

            // Add smooth scrolling for better UX
            document.documentElement.style.scrollBehavior = &#x27;smooth&#x27;;

            // Add keyboard shortcuts
            document.addEventListener(&#x27;keydown&#x27;, function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case &#x27;Enter&#x27;:
                            e.preventDefault();
                            if (document.getElementById(&#x27;topicSelect&#x27;).value) {
                                generateStory();
                            } else {
                                generateTopics();
                            }
                            break;
                        case &#x27;c&#x27;:
                            if (generatedStoryContent) {
                                e.preventDefault();
                                copyToClipboard();
                            }
                            break;
                    }
                }
            });
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
"></iframe>
<iframe id="file4" class="file-frame" srcdoc="&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;vi&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Táº¡o MÃ´ Táº£ Sáº£n Pháº©m Ná»™i Y &amp; Äá»“ Máº·c NhÃ  - SEO AI Generator&lt;/title&gt;
    &lt;meta name=&quot;description&quot; content=&quot;á»¨ng dá»¥ng táº¡o mÃ´ táº£ sáº£n pháº©m ná»™i y, Ä‘á»“ máº·c nhÃ  chuáº©n SEO sá»­ dá»¥ng AI. Tá»‘i Æ°u hÃ³a ná»™i dung cho website bÃ¡n hÃ ng thá»i trang ná»¯, nam, tráº» em.&quot;&gt;
    &lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;
    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css&quot; rel=&quot;stylesheet&quot;&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        :root {
            --primary: #ec4899;
            --secondary: #be185d;
        }
        .bg-primary { background-color: var(--primary); }
        .text-primary { color: var(--primary); }
        .border-primary { border-color: var(--primary); }
        .hover\:bg-secondary:hover { background-color: var(--secondary); }
        .focus\:ring-primary:focus { --tw-ring-color: var(--primary); }
        .border-b-2.border-primary { border-bottom: 2px solid var(--primary); }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body class=&quot;bg-gradient-to-br from-pink-50 to-purple-100 min-h-screen&quot;&gt;
    &lt;!-- Header --&gt;
    &lt;header class=&quot;bg-white shadow-lg&quot;&gt;
        &lt;div class=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4&quot;&gt;
            &lt;div class=&quot;flex items-center justify-between&quot;&gt;
                &lt;div class=&quot;flex items-center space-x-3&quot;&gt;
                    &lt;i class=&quot;fas fa-heart text-3xl text-primary&quot;&gt;&lt;/i&gt;
                    &lt;div&gt;
                        &lt;h1 class=&quot;text-2xl font-bold text-gray-900&quot;&gt;AI Product Description Generator&lt;/h1&gt;
                        &lt;p class=&quot;text-sm text-gray-600&quot;&gt;Ná»™i Y &amp; Äá»“ Máº·c NhÃ  - Gemini 2.0 Flash&lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;text-sm text-gray-600&quot;&gt;
                    &lt;i class=&quot;fas fa-search mr-1&quot;&gt;&lt;/i&gt;
                    SEO Optimized
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/header&gt;

    &lt;main class=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8&quot;&gt;
        &lt;!-- API Key Section --&gt;
        &lt;div class=&quot;bg-white rounded-xl shadow-lg p-6 mb-8&quot;&gt;
            &lt;div class=&quot;flex items-center space-x-3 mb-4&quot;&gt;
                &lt;i class=&quot;fas fa-key text-2xl text-yellow-500&quot;&gt;&lt;/i&gt;
                &lt;h2 class=&quot;text-xl font-semibold text-gray-900&quot;&gt;Cáº¥u HÃ¬nh API Key&lt;/h2&gt;
            &lt;/div&gt;
            &lt;div class=&quot;bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4&quot;&gt;
                &lt;div class=&quot;flex&quot;&gt;
                    &lt;i class=&quot;fas fa-exclamation-triangle text-yellow-400 mr-2 mt-1&quot;&gt;&lt;/i&gt;
                    &lt;div&gt;
                        &lt;p class=&quot;text-sm text-yellow-700&quot;&gt;
                            &lt;strong&gt;LÆ°u Ã½:&lt;/strong&gt; API Key chá»‰ Ä‘Æ°á»£c lÆ°u trong phiÃªn lÃ m viá»‡c hiá»‡n táº¡i vÃ  khÃ´ng Ä‘Æ°á»£c gá»­i Ä‘áº¿n server khÃ¡c.
                        &lt;/p&gt;
                        &lt;p class=&quot;text-sm text-yellow-700 mt-1&quot;&gt;
                            Äá»ƒ láº¥y API Key, truy cáº­p: 
                            &lt;a href=&quot;https://aistudio.google.com/apikey&quot; target=&quot;_blank&quot; class=&quot;underline font-medium&quot;&gt;
                                Google AI Studio API Key
                            &lt;/a&gt;
                        &lt;/p&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex space-x-4&quot;&gt;
                &lt;input 
                    type=&quot;password&quot; 
                    id=&quot;apiKey&quot; 
                    placeholder=&quot;Nháº­p Google Gemini API Key...&quot; 
                    class=&quot;flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot;
                /&gt;
                &lt;button 
                    onclick=&quot;saveApiKey()&quot; 
                    class=&quot;px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors duration-200&quot;&gt;
                    &lt;i class=&quot;fas fa-save mr-2&quot;&gt;&lt;/i&gt;
                    LÆ°u Key
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div id=&quot;apiKeyStatus&quot; class=&quot;mt-2 text-sm&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;grid lg:grid-cols-2 gap-8&quot;&gt;
            &lt;!-- Input Form --&gt;
            &lt;div class=&quot;space-y-8&quot;&gt;
                &lt;!-- Product Info Form --&gt;
                &lt;div class=&quot;bg-white rounded-xl shadow-lg p-6&quot;&gt;
                    &lt;div class=&quot;flex items-center space-x-3 mb-6&quot;&gt;
                        &lt;i class=&quot;fas fa-tshirt text-2xl text-primary&quot;&gt;&lt;/i&gt;
                        &lt;h2 class=&quot;text-xl font-semibold text-gray-900&quot;&gt;INPUT A - ThÃ´ng Tin Sáº£n Pháº©m&lt;/h2&gt;
                    &lt;/div&gt;
                    
                    &lt;form id=&quot;productForm&quot; class=&quot;space-y-4&quot;&gt;
                        &lt;div class=&quot;grid md:grid-cols-2 gap-4&quot;&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;TÃªn sáº£n pháº©m *&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;name&quot; required class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: Ão ngá»§ lá»¥a cao cáº¥p&quot;&gt;
                            &lt;/div&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Loáº¡i sáº£n pháº©m&lt;/label&gt;
                                &lt;select name=&quot;type&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot;&gt;
                                    &lt;option value=&quot;&quot;&gt;Chá»n loáº¡i sáº£n pháº©m&lt;/option&gt;
                                    &lt;option value=&quot;Ão bra&quot;&gt;Ão bra&lt;/option&gt;
                                    &lt;option value=&quot;Quáº§n lÃ³t&quot;&gt;Quáº§n lÃ³t&lt;/option&gt;
                                    &lt;option value=&quot;Bá»™ Ä‘á»“ lÃ³t&quot;&gt;Bá»™ Ä‘á»“ lÃ³t&lt;/option&gt;
                                    &lt;option value=&quot;Ão ngá»§&quot;&gt;Ão ngá»§&lt;/option&gt;
                                    &lt;option value=&quot;VÃ¡y ngá»§&quot;&gt;VÃ¡y ngá»§&lt;/option&gt;
                                    &lt;option value=&quot;Pyjama&quot;&gt;Pyjama&lt;/option&gt;
                                    &lt;option value=&quot;Bá»™ máº·c nhÃ &quot;&gt;Bá»™ máº·c nhÃ &lt;/option&gt;
                                    &lt;option value=&quot;Ão lÃ³t&quot;&gt;Ão lÃ³t&lt;/option&gt;
                                    &lt;option value=&quot;Quáº§n boxer&quot;&gt;Quáº§n boxer&lt;/option&gt;
                                    &lt;option value=&quot;Äá»“ lÃ³t tráº» em&quot;&gt;Äá»“ lÃ³t tráº» em&lt;/option&gt;
                                    &lt;option value=&quot;Bodysuit&quot;&gt;Bodysuit&lt;/option&gt;
                                    &lt;option value=&quot;Shapewear&quot;&gt;Shapewear&lt;/option&gt;
                                &lt;/select&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;

                        &lt;div class=&quot;grid md:grid-cols-2 gap-4&quot;&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Cháº¥t liá»‡u&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;material&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: Cotton 95%, Spandex 5%&quot;&gt;
                            &lt;/div&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Kiá»ƒu dÃ¡ng&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;style&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: Ã”m body, thoáº£i mÃ¡i&quot;&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;

                        &lt;div&gt;
                            &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Thiáº¿t káº¿&lt;/label&gt;
                            &lt;input type=&quot;text&quot; name=&quot;design&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: Há»a tiáº¿t hoa, viá»n ren, mÃ u trÆ¡n&quot;&gt;
                        &lt;/div&gt;

                        &lt;div class=&quot;grid md:grid-cols-2 gap-4&quot;&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Phom Ã¡o&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;top_fit&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: Ã”m vá»«a, tÃ´n dÃ¡ng&quot;&gt;
                            &lt;/div&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Phom quáº§n&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;bottom_fit&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: Low-rise, high-waist&quot;&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;

                        &lt;div class=&quot;grid md:grid-cols-3 gap-4&quot;&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;MÃºt Ã¡o bra&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;padding&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: CÃ³ mÃºt dÃ y, push-up, mÃºt gel...&quot;&gt;
                            &lt;/div&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;DÃ¢y vai&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;strap&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: DÃ¢y to, dÃ¢y chÃ©o, khÃ´ng dÃ¢y...&quot;&gt;
                            &lt;/div&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;BÄƒng lÆ°ng&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;back_band&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: BÄƒng cao, cÃ³ wire, bÄƒng ren...&quot;&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;

                        &lt;div class=&quot;grid md:grid-cols-2 gap-4&quot;&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Máº¯c cÃ i&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;clasp&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: Máº¯c cÃ i sau, khÃ³a kÃ©o, nÃºt báº¥m...&quot;&gt;
                            &lt;/div&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;MÃ u sáº¯c&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;color&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: Äen, tráº¯ng, há»“ng nude&quot;&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;

                        &lt;div class=&quot;grid md:grid-cols-3 gap-4&quot;&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;KÃ­ch thÆ°á»›c&lt;/label&gt;
                                &lt;input type=&quot;text&quot; name=&quot;size&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: 32A, 34B, S, M, L&quot;&gt;
                            &lt;/div&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Giá»›i tÃ­nh&lt;/label&gt;
                                &lt;select name=&quot;gender&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot;&gt;
                                    &lt;option value=&quot;&quot;&gt;Chá»n giá»›i tÃ­nh&lt;/option&gt;
                                    &lt;option value=&quot;Ná»¯&quot;&gt;Ná»¯&lt;/option&gt;
                                    &lt;option value=&quot;Nam&quot;&gt;Nam&lt;/option&gt;
                                    &lt;option value=&quot;Tráº» em ná»¯&quot;&gt;Tráº» em ná»¯&lt;/option&gt;
                                    &lt;option value=&quot;Tráº» em nam&quot;&gt;Tráº» em nam&lt;/option&gt;
                                    &lt;option value=&quot;Unisex&quot;&gt;Unisex&lt;/option&gt;
                                &lt;/select&gt;
                            &lt;/div&gt;
                            &lt;div&gt;
                                &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Äá»™ tuá»•i&lt;/label&gt;
                                &lt;select name=&quot;age_group&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot;&gt;
                                    &lt;option value=&quot;&quot;&gt;Chá»n Ä‘á»™ tuá»•i&lt;/option&gt;
                                    &lt;option value=&quot;Tráº» em (3-12 tuá»•i)&quot;&gt;Tráº» em (3-12 tuá»•i)&lt;/option&gt;
                                    &lt;option value=&quot;Teen (13-17 tuá»•i)&quot;&gt;Teen (13-17 tuá»•i)&lt;/option&gt;
                                    &lt;option value=&quot;NgÆ°á»i lá»›n (18-40 tuá»•i)&quot;&gt;NgÆ°á»i lá»›n (18-40 tuá»•i)&lt;/option&gt;
                                    &lt;option value=&quot;Trung niÃªn (40+ tuá»•i)&quot;&gt;Trung niÃªn (40+ tuá»•i)&lt;/option&gt;
                                &lt;/select&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;

                        &lt;div&gt;
                            &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Phong cÃ¡ch mÃ´ táº£&lt;/label&gt;
                            &lt;select name=&quot;description_style&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot;&gt;
                                &lt;option value=&quot;&quot;&gt;Chá»n phong cÃ¡ch&lt;/option&gt;
                                &lt;option value=&quot;Thoáº£i mÃ¡i tiá»‡n lá»£i&quot;&gt;Thoáº£i mÃ¡i &amp; Tiá»‡n lá»£i (HÃ ng ngÃ y)&lt;/option&gt;
                                &lt;option value=&quot;Cao cáº¥p sang trá»ng&quot;&gt;Cao cáº¥p &amp; Sang trá»ng (Premium)&lt;/option&gt;
                                &lt;option value=&quot;Quyáº¿n rÅ© gá»£i cáº£m&quot;&gt;Quyáº¿n rÅ© &amp; Gá»£i cáº£m (Romantic)&lt;/option&gt;
                                &lt;option value=&quot;Tráº» trung nÄƒng Ä‘á»™ng&quot;&gt;Tráº» trung &amp; NÄƒng Ä‘á»™ng (Teen/Young)&lt;/option&gt;
                            &lt;/select&gt;
                            &lt;p class=&quot;text-xs text-gray-500 mt-1&quot;&gt;Phong cÃ¡ch áº£nh hÆ°á»Ÿng Ä‘áº¿n tone viáº¿t vÃ  tá»« khÃ³a SEO&lt;/p&gt;
                        &lt;/div&gt;

                        &lt;div&gt;
                            &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;TÃ­nh nÄƒng Ä‘áº·c biá»‡t&lt;/label&gt;
                            &lt;textarea name=&quot;other_content&quot; rows=&quot;3&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: KhÃ¡ng khuáº©n, tháº¥m hÃºt má»“ hÃ´i, Ä‘á»‹nh hÃ¬nh, nÃ¢ng ngá»±c...&quot;&gt;&lt;/textarea&gt;
                        &lt;/div&gt;

                        &lt;div&gt;
                            &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Phá»‘i Ä‘á»“ &amp; Sá»­ dá»¥ng&lt;/label&gt;
                            &lt;textarea name=&quot;mix_match&quot; rows=&quot;2&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: PhÃ¹ há»£p máº·c nhÃ , ngá»§, káº¿t há»£p vá»›i Ã¡o khoÃ¡c...&quot;&gt;&lt;/textarea&gt;
                        &lt;/div&gt;

                        &lt;div&gt;
                            &lt;label class=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;ThÃ nh pháº§n cháº¥t liá»‡u&lt;/label&gt;
                            &lt;textarea name=&quot;composition&quot; rows=&quot;2&quot; class=&quot;w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent&quot; placeholder=&quot;VD: 95% Cotton, 5% Spandex - má»m máº¡i, co giÃ£n tá»‘t&quot;&gt;&lt;/textarea&gt;
                        &lt;/div&gt;
                    &lt;/form&gt;
                &lt;/div&gt;

                &lt;!-- Image Upload Form --&gt;
                &lt;div class=&quot;bg-white rounded-xl shadow-lg p-6&quot;&gt;
                    &lt;div class=&quot;flex items-center space-x-3 mb-6&quot;&gt;
                        &lt;i class=&quot;fas fa-images text-2xl text-purple-500&quot;&gt;&lt;/i&gt;
                        &lt;h2 class=&quot;text-xl font-semibold text-gray-900&quot;&gt;INPUT B - HÃ¬nh áº¢nh Sáº£n Pháº©m (TÃ¹y chá»n)&lt;/h2&gt;
                    &lt;/div&gt;
                    
                    &lt;div class=&quot;space-y-4&quot;&gt;
                        &lt;!-- Upload Area --&gt;
                        &lt;div class=&quot;border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-colors duration-200&quot; 
                             ondrop=&quot;dropHandler(event)&quot; 
                             ondragover=&quot;dragOverHandler(event)&quot; 
                             ondragleave=&quot;dragLeaveHandler(event)&quot;&gt;
                            &lt;div id=&quot;uploadArea&quot; class=&quot;space-y-4&quot;&gt;
                                &lt;div class=&quot;mx-auto w-16 h-16 bg-gradient-to-r from-pink-100 to-purple-100 rounded-full flex items-center justify-center&quot;&gt;
                                    &lt;i class=&quot;fas fa-cloud-upload-alt text-2xl text-primary&quot;&gt;&lt;/i&gt;
                                &lt;/div&gt;
                                &lt;div&gt;
                                    &lt;p class=&quot;text-lg font-medium text-gray-700 mb-2&quot;&gt;KÃ©o tháº£ hÃ¬nh áº£nh vÃ o Ä‘Ã¢y&lt;/p&gt;
                                    &lt;p class=&quot;text-sm text-gray-500 mb-4&quot;&gt;hoáº·c&lt;/p&gt;
                                    &lt;label for=&quot;imageInput&quot; class=&quot;inline-flex items-center px-6 py-3 bg-primary text-white rounded-lg hover:bg-secondary transition-colors duration-200 cursor-pointer&quot;&gt;
                                        &lt;i class=&quot;fas fa-folder-open mr-2&quot;&gt;&lt;/i&gt;
                                        Chá»n HÃ¬nh áº¢nh
                                    &lt;/label&gt;
                                    &lt;input type=&quot;file&quot; id=&quot;imageInput&quot; accept=&quot;image/*&quot; multiple class=&quot;hidden&quot; onchange=&quot;handleFileSelect(event)&quot;&gt;
                                &lt;/div&gt;
                                &lt;p class=&quot;text-xs text-gray-400&quot;&gt;Há»— trá»£: JPG, PNG, WebP (Tá»‘i Ä‘a 5MB má»—i file)&lt;/p&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;

                        &lt;!-- Image Preview Grid --&gt;
                        &lt;div id=&quot;imagePreview&quot; class=&quot;grid grid-cols-2 md:grid-cols-3 gap-4 hidden&quot;&gt;
                            &lt;!-- Images will be displayed here --&gt;
                        &lt;/div&gt;

                        &lt;!-- Clear Images Button --&gt;
                        &lt;div id=&quot;clearImagesBtn&quot; class=&quot;text-center hidden&quot;&gt;
                            &lt;button onclick=&quot;clearImages()&quot; class=&quot;px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-200&quot;&gt;
                                &lt;i class=&quot;fas fa-trash-alt mr-2&quot;&gt;&lt;/i&gt;
                                XÃ³a Táº¥t Cáº£ HÃ¬nh
                            &lt;/button&gt;
                        &lt;/div&gt;

                        &lt;!-- Image Analysis Toggle --&gt;
                        &lt;div class=&quot;bg-blue-50 border border-blue-200 rounded-lg p-4&quot;&gt;
                            &lt;div class=&quot;flex items-center space-x-3&quot;&gt;
                                &lt;input type=&quot;checkbox&quot; id=&quot;useImageAnalysis&quot; class=&quot;w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded&quot;&gt;
                                &lt;label for=&quot;useImageAnalysis&quot; class=&quot;text-sm font-medium text-gray-700&quot;&gt;
                                    Sá»­ dá»¥ng AI phÃ¢n tÃ­ch hÃ¬nh áº£nh Ä‘á»ƒ cáº£i thiá»‡n mÃ´ táº£
                                &lt;/label&gt;
                            &lt;/div&gt;
                            &lt;p class=&quot;text-xs text-gray-500 mt-2 ml-7&quot;&gt;
                                AI sáº½ phÃ¢n tÃ­ch hÃ¬nh áº£nh Ä‘á»ƒ bá»• sung thÃ´ng tin vá» mÃ u sáº¯c, thiáº¿t káº¿, cháº¥t liá»‡u vÃ  kiá»ƒu dÃ¡ng
                            &lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;

                &lt;!-- Action Buttons --&gt;
                &lt;div class=&quot;bg-white rounded-xl shadow-lg p-6&quot;&gt;
                    &lt;div class=&quot;flex space-x-4&quot;&gt;
                        &lt;button onclick=&quot;generateDescription()&quot; class=&quot;flex-1 px-6 py-3 bg-gradient-to-r from-pink-600 to-purple-600 text-white rounded-lg hover:from-pink-700 hover:to-purple-700 transition-all duration-200 font-medium&quot;&gt;
                            &lt;i class=&quot;fas fa-magic mr-2&quot;&gt;&lt;/i&gt;
                            Táº¡o MÃ´ Táº£ AI
                        &lt;/button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;!-- Results Panel --&gt;
            &lt;div class=&quot;space-y-8&quot;&gt;
                &lt;!-- Loading State --&gt;
                &lt;div id=&quot;loadingState&quot; class=&quot;bg-white rounded-xl shadow-lg p-8 text-center hidden&quot;&gt;
                    &lt;div class=&quot;animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4&quot;&gt;&lt;/div&gt;
                    &lt;p class=&quot;text-gray-600&quot;&gt;Äang táº¡o mÃ´ táº£ sáº£n pháº©m chuyÃªn nghiá»‡p...&lt;/p&gt;
                &lt;/div&gt;

                &lt;!-- Generated Description --&gt;
                &lt;div id=&quot;resultPanel&quot; class=&quot;bg-white rounded-xl shadow-lg p-6 hidden&quot;&gt;
                    &lt;div class=&quot;flex items-center justify-between mb-6&quot;&gt;
                        &lt;div class=&quot;flex items-center space-x-3&quot;&gt;
                            &lt;i class=&quot;fas fa-file-text text-2xl text-purple-500&quot;&gt;&lt;/i&gt;
                            &lt;h2 class=&quot;text-xl font-semibold text-gray-900&quot;&gt;MÃ´ Táº£ Sáº£n Pháº©m AI&lt;/h2&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;flex space-x-2&quot;&gt;
                            &lt;button onclick=&quot;copyDescription()&quot; class=&quot;px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200 text-sm&quot;&gt;
                                &lt;i class=&quot;fas fa-copy mr-1&quot;&gt;&lt;/i&gt;
                                Copy
                            &lt;/button&gt;
                            &lt;button onclick=&quot;exportToDocx()&quot; class=&quot;px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm&quot;&gt;
                                &lt;i class=&quot;fas fa-file-word mr-1&quot;&gt;&lt;/i&gt;
                                Táº£i DOCX
                            &lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;div id=&quot;descriptionContent&quot; class=&quot;space-y-6&quot;&gt;
                        &lt;!-- Content will be populated by JavaScript --&gt;
                    &lt;/div&gt;
                &lt;/div&gt;

                &lt;!-- Instructions --&gt;
                &lt;div class=&quot;bg-gradient-to-r from-pink-100 to-purple-100 rounded-xl shadow-lg p-6&quot;&gt;
                    &lt;div class=&quot;flex items-center space-x-3 mb-4&quot;&gt;
                        &lt;i class=&quot;fas fa-info-circle text-2xl text-pink-600&quot;&gt;&lt;/i&gt;
                        &lt;h2 class=&quot;text-xl font-semibold text-gray-900&quot;&gt;HÆ°á»›ng Dáº«n Sá»­ Dá»¥ng&lt;/h2&gt;
                    &lt;/div&gt;
                    
                    &lt;div class=&quot;space-y-3 text-sm text-gray-700&quot;&gt;
                        &lt;div class=&quot;flex items-start space-x-2&quot;&gt;
                            &lt;span class=&quot;bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold&quot;&gt;1&lt;/span&gt;
                            &lt;p&gt;Nháº­p API Key Google Gemini (miá»…n phÃ­ táº¡i aistudio.google.com)&lt;/p&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;flex items-start space-x-2&quot;&gt;
                            &lt;span class=&quot;bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold&quot;&gt;2&lt;/span&gt;
                            &lt;p&gt;Äiá»n thÃ´ng tin sáº£n pháº©m ná»™i y/Ä‘á»“ máº·c nhÃ  chi tiáº¿t&lt;/p&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;flex items-start space-x-2&quot;&gt;
                            &lt;span class=&quot;bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold&quot;&gt;3&lt;/span&gt;
                            &lt;p&gt;Upload hÃ¬nh áº£nh sáº£n pháº©m (tÃ¹y chá»n) vÃ  báº­t phÃ¢n tÃ­ch AI&lt;/p&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;flex items-start space-x-2&quot;&gt;
                            &lt;span class=&quot;bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold&quot;&gt;4&lt;/span&gt;
                            &lt;p&gt;Nháº¥n &quot;Táº¡o MÃ´ Táº£ AI&quot; Ä‘á»ƒ táº¡o ná»™i dung chuáº©n SEO&lt;/p&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;flex items-start space-x-2&quot;&gt;
                            &lt;span class=&quot;bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold&quot;&gt;5&lt;/span&gt;
                            &lt;p&gt;Copy ná»™i dung hoáº·c táº£i xuá»‘ng file DOCX&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/main&gt;

    &lt;!-- Footer --&gt;
    &lt;footer class=&quot;bg-white shadow-lg mt-16&quot;&gt;
        &lt;div class=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6&quot;&gt;
            &lt;div class=&quot;text-center text-gray-600&quot;&gt;
                &lt;p class=&quot;text-sm&quot;&gt;
                    Â© 2025 &lt;strong&gt;Hoang Tien&lt;/strong&gt;. All rights reserved. | 
                    AI Product Description Generator for Lingerie &amp; Sleepwear
                &lt;/p&gt;
                &lt;p class=&quot;text-xs mt-2 text-gray-500&quot;&gt;
                    Táº¡o mÃ´ táº£ sáº£n pháº©m ná»™i y, Ä‘á»“ máº·c nhÃ  chuyÃªn nghiá»‡p vá»›i cÃ´ng nghá»‡ AI
                &lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/footer&gt;

    &lt;script&gt;
        let currentDescription = null;
        let uploadedImages = [];

        // Initialize
        document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() {
            const savedKey = sessionStorage.getItem(&#x27;gemini_api_key&#x27;);
            if (savedKey) {
                showStatus(&#x27;apiKeyStatus&#x27;, &#x27;API Key Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trÆ°á»›c Ä‘Ã³!&#x27;, &#x27;success&#x27;);
            }
        });

        // Image Upload Functions
        function dragOverHandler(e) {
            e.preventDefault();
            e.currentTarget.classList.add(&#x27;border-primary&#x27;, &#x27;bg-pink-50&#x27;);
        }

        function dragLeaveHandler(e) {
            e.preventDefault();
            e.currentTarget.classList.remove(&#x27;border-primary&#x27;, &#x27;bg-pink-50&#x27;);
        }

        function dropHandler(e) {
            e.preventDefault();
            e.currentTarget.classList.remove(&#x27;border-primary&#x27;, &#x27;bg-pink-50&#x27;);
            
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }

        function handleFiles(files) {
            const imageFiles = files.filter(file =&gt; file.type.startsWith(&#x27;image/&#x27;));
            
            if (imageFiles.length === 0) {
                alert(&#x27;Vui lÃ²ng chá»n file hÃ¬nh áº£nh há»£p lá»‡!&#x27;);
                return;
            }

            imageFiles.forEach(file =&gt; {
                if (file.size &gt; 5 * 1024 * 1024) { // 5MB
                    alert(`File ${file.name} quÃ¡ lá»›n. Vui lÃ²ng chá»n file nhá» hÆ¡n 5MB.`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImages.push({
                        file: file,
                        dataUrl: e.target.result,
                        name: file.name
                    });
                    displayImages();
                };
                reader.readAsDataURL(file);
            });
        }

        function displayImages() {
            const previewContainer = document.getElementById(&#x27;imagePreview&#x27;);
            const clearBtn = document.getElementById(&#x27;clearImagesBtn&#x27;);

            if (uploadedImages.length === 0) {
                previewContainer.classList.add(&#x27;hidden&#x27;);
                clearBtn.classList.add(&#x27;hidden&#x27;);
                return;
            }

            previewContainer.classList.remove(&#x27;hidden&#x27;);
            clearBtn.classList.remove(&#x27;hidden&#x27;);

            previewContainer.innerHTML = uploadedImages.map((img, index) =&gt; `
                &lt;div class=&quot;relative group&quot;&gt;
                    &lt;img src=&quot;${img.dataUrl}&quot; alt=&quot;${sanitizeHtml(img.name)}&quot; 
                         class=&quot;w-full h-32 object-cover rounded-lg border border-gray-200&quot;&gt;
                    &lt;div class=&quot;absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 rounded-lg flex items-center justify-center&quot;&gt;
                        &lt;button onclick=&quot;removeImage(${index})&quot; 
                                class=&quot;opacity-0 group-hover:opacity-100 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-all duration-200&quot;&gt;
                            &lt;i class=&quot;fas fa-times text-sm&quot;&gt;&lt;/i&gt;
                        &lt;/button&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;absolute bottom-2 left-2 right-2&quot;&gt;
                        &lt;div class=&quot;bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded truncate&quot;&gt;
                            ${sanitizeHtml(img.name)}
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            `).join(&#x27;&#x27;);
        }

        function removeImage(index) {
            uploadedImages.splice(index, 1);
            displayImages();
        }

        function clearImages() {
            uploadedImages = [];
            displayImages();
            document.getElementById(&#x27;imageInput&#x27;).value = &#x27;&#x27;;
        }

        // Sanitize HTML to prevent XSS
        function sanitizeHtml(str) {
            if (!str) return &#x27;&#x27;;
            const div = document.createElement(&#x27;div&#x27;);
            div.textContent = str;
            return div.innerHTML;
        }

        // Convert image to base64 for Gemini API
        function imageToBase64(file) {
            return new Promise((resolve, reject) =&gt; {
                const reader = new FileReader();
                reader.onload = () =&gt; {
                    const base64 = reader.result.split(&#x27;,&#x27;)[1]; // Remove data:image/...;base64, prefix
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // API Key Management - Changed to sessionStorage for better security
        function saveApiKey() {
            const apiKey = document.getElementById(&#x27;apiKey&#x27;).value.trim();
            if (apiKey) {
                sessionStorage.setItem(&#x27;gemini_api_key&#x27;, apiKey);
                showStatus(&#x27;apiKeyStatus&#x27;, &#x27;API Key Ä‘Ã£ Ä‘Æ°á»£c lÆ°u thÃ nh cÃ´ng!&#x27;, &#x27;success&#x27;);
                document.getElementById(&#x27;apiKey&#x27;).value = &#x27;&#x27;;
            } else {
                showStatus(&#x27;apiKeyStatus&#x27;, &#x27;Vui lÃ²ng nháº­p API Key!&#x27;, &#x27;error&#x27;);
            }
        }

        function getApiKey() {
            return sessionStorage.getItem(&#x27;gemini_api_key&#x27;);
        }

        // Status Message Helper
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = &#x27;mt-2 text-sm &#x27; + (type === &#x27;success&#x27; ? &#x27;text-green-600&#x27; : &#x27;text-red-600&#x27;);
        }

        // Form Data Collection
        function collectFormData() {
            const form = document.getElementById(&#x27;productForm&#x27;);
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (value.trim()) {
                    data[key] = value.trim();
                }
            }
            
            return data;
        }

        // Generate Description with AI
        async function generateDescription() {
            const apiKey = getApiKey();
            if (!apiKey) {
                alert(&#x27;Vui lÃ²ng nháº­p API Key trÆ°á»›c!&#x27;);
                return;
            }

            const formData = collectFormData();
            if (!formData.name) {
                alert(&#x27;Vui lÃ²ng nháº­p tÃªn sáº£n pháº©m!&#x27;);
                return;
            }

            // Show loading
            document.getElementById(&#x27;loadingState&#x27;).classList.remove(&#x27;hidden&#x27;);
            document.getElementById(&#x27;resultPanel&#x27;).classList.add(&#x27;hidden&#x27;);

            try {
                const useImageAnalysis = document.getElementById(&#x27;useImageAnalysis&#x27;).checked;
                let imageAnalysis = &#x27;&#x27;;

                // Analyze images if enabled and images available
                if (useImageAnalysis &amp;&amp; uploadedImages.length &gt; 0) {
                    try {
                        imageAnalysis = await analyzeImages(apiKey);
                    } catch (error) {
                        console.warn(&#x27;Image analysis failed:&#x27;, error);
                        // Continue without image analysis
                    }
                }

                const prompt = buildPrompt(formData, imageAnalysis);
                const description = await callGeminiAPI(apiKey, prompt);
                
                currentDescription = description;
                displayDescription(description);
                
            } catch (error) {
                console.error(&#x27;Error:&#x27;, error);
                alert(&#x27;CÃ³ lá»—i xáº£y ra khi táº¡o mÃ´ táº£: &#x27; + error.message);
            } finally {
                document.getElementById(&#x27;loadingState&#x27;).classList.add(&#x27;hidden&#x27;);
            }
        }

        // Analyze Images with Gemini Vision API - Updated to Gemini 2.0 Flash
        async function analyzeImages(apiKey) {
            if (uploadedImages.length === 0) return &#x27;&#x27;;

            try {
                const firstImage = uploadedImages[0];
                const base64Image = await imageToBase64(firstImage.file);

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
                    method: &#x27;POST&#x27;,
                    headers: {
                        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {
                                    text: &quot;PhÃ¢n tÃ­ch hÃ¬nh áº£nh sáº£n pháº©m ná»™i y/Ä‘á»“ máº·c nhÃ  nÃ y vÃ  mÃ´ táº£ chi tiáº¿t vá»: 1) MÃ u sáº¯c chÃ­nh vÃ  phá»¥, 2) Cháº¥t liá»‡u (dá»±a trÃªn váº» ngoÃ i), 3) Kiá»ƒu dÃ¡ng vÃ  thiáº¿t káº¿, 4) Há»a tiáº¿t hoáº·c chi tiáº¿t Ä‘áº·c biá»‡t, 5) Phong cÃ¡ch tá»•ng thá»ƒ. Tráº£ lá»i báº±ng tiáº¿ng Viá»‡t, ngáº¯n gá»n vÃ  chÃ­nh xÃ¡c.&quot;
                                },
                                {
                                    inline_data: {
                                        mime_type: firstImage.file.type,
                                        data: base64Image
                                    }
                                }
                            ]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`Image analysis failed: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.candidates &amp;&amp; data.candidates[0] &amp;&amp; data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                }
                
                return &#x27;&#x27;;
            } catch (error) {
                console.error(&#x27;Image analysis error:&#x27;, error);
                return &#x27;&#x27;;
            }
        }

        // Build AI Prompt with fixed format
        function buildPrompt(data, imageAnalysis = &#x27;&#x27;) {
            let prompt = `Táº¡o mÃ´ táº£ sáº£n pháº©m ná»™i y/Ä‘á»“ máº·c nhÃ  theo format chuáº©n vá»›i thÃ´ng tin:

THÃ”NG TIN Sáº¢N PHáº¨M:
- TÃªn: ${data.name}
${data.type ? `- Loáº¡i: ${data.type}` : &#x27;&#x27;}
${data.material ? `- Cháº¥t liá»‡u: ${data.material}` : &#x27;&#x27;}
${data.style ? `- Kiá»ƒu dÃ¡ng: ${data.style}` : &#x27;&#x27;}
${data.design ? `- Thiáº¿t káº¿: ${data.design}` : &#x27;&#x27;}
${data.top_fit ? `- Phom Ã¡o: ${data.top_fit}` : &#x27;&#x27;}
${data.bottom_fit ? `- Phom quáº§n: ${data.bottom_fit}` : &#x27;&#x27;}
${data.padding ? `- MÃºt: ${data.padding}` : &#x27;&#x27;}
${data.strap ? `- DÃ¢y vai: ${data.strap}` : &#x27;&#x27;}
${data.back_band ? `- BÄƒng lÆ°ng: ${data.back_band}` : &#x27;&#x27;}
${data.clasp ? `- Máº¯c cÃ i: ${data.clasp}` : &#x27;&#x27;}
${data.color ? `- MÃ u sáº¯c: ${data.color}` : &#x27;&#x27;}
${data.size ? `- Size: ${data.size}` : &#x27;&#x27;}
${data.gender ? `- Giá»›i tÃ­nh: ${data.gender}` : &#x27;&#x27;}
${data.age_group ? `- Äá»™ tuá»•i: ${data.age_group}` : &#x27;&#x27;}
${data.description_style ? `- Phong cÃ¡ch: ${data.description_style}` : &#x27;&#x27;}
${data.other_content ? `- TÃ­nh nÄƒng Ä‘áº·c biá»‡t: ${data.other_content}` : &#x27;&#x27;}
${data.mix_match ? `- Phá»‘i Ä‘á»“: ${data.mix_match}` : &#x27;&#x27;}
${data.composition ? `- ThÃ nh pháº§n: ${data.composition}` : &#x27;&#x27;}`;

            if (imageAnalysis) {
                prompt += `

PHÃ‚N TÃCH HÃŒNH áº¢NH:
${imageAnalysis}
(Sá»­ dá»¥ng thÃ´ng tin nÃ y Ä‘á»ƒ bá»• sung vÃ  cáº£i thiá»‡n mÃ´ táº£ sáº£n pháº©m)`;
            }

            prompt += `

FORMAT YÃŠU Cáº¦U:
Tráº£ vá» format JSON vá»›i 4 pháº§n CHÃNH XÃC:
{
  &quot;title&quot;: &quot;TÃªn sáº£n pháº©m lÃ m tiÃªu Ä‘á» chÃ­nh (60-80 tá»«)&quot;,
  &quot;short_description&quot;: &quot;Táº¡o CHÃNH XÃC 4 cÃ¢u mÃ´ táº£ ngáº¯n, má»—i cÃ¢u 15-20 tá»«, cÃ¡ch nhau bá»Ÿi \\n&quot;,
  &quot;detailed_description&quot;: &quot;1 Ä‘oáº¡n vÄƒn dÃ i CHÃNH XÃC 150-200 tá»« miÃªu táº£ chi tiáº¿t sáº£n pháº©m&quot;,
  &quot;specifications&quot;: {
    &quot;Cháº¥t liá»‡u&quot;: &quot;...&quot;,
    &quot;Size&quot;: &quot;...&quot;, 
    &quot;MÃ u sáº¯c&quot;: &quot;...&quot;,
    &quot;Xuáº¥t xá»©&quot;: &quot;Viá»‡t Nam&quot;
  }
}

QUAN TRá»ŒNG:
- MÃ´ táº£ ngáº¯n: CHÃNH XÃC 4 cÃ¢u, má»—i cÃ¢u 15-20 tá»«
- MÃ´ táº£ chi tiáº¿t: CHÃNH XÃC 150-200 tá»«
- Sá»­ dá»¥ng tá»« khÃ³a SEO phÃ¹ há»£p vá»›i phong cÃ¡ch Ä‘Ã£ chá»n
- Äáº£m báº£o ná»™i dung phÃ¹ há»£p vá»›i sáº£n pháº©m ná»™i y/Ä‘á»“ máº·c nhÃ 
- Title pháº£i láº¥y chÃ­nh xÃ¡c tÃªn sáº£n pháº©m tá»« input: &quot;${data.name}&quot;`;

            return prompt;
        }

        // Call Gemini API - Updated to Gemini 2.0 Flash with improved error handling
        async function callGeminiAPI(apiKey, prompt, retryCount = 0) {
            const maxRetries = 3;
            const baseDelay = 2000;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
                    method: &#x27;POST&#x27;,
                    headers: {
                        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 2048,
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() =&gt; ({}));
                    
                    if ((response.status === 503 || response.status === 429 || response.status === 500) &amp;&amp; retryCount &lt; maxRetries) {
                        const delay = baseDelay * Math.pow(2, retryCount);
                        console.log(`API error ${response.status}, retrying in ${delay}ms... (attempt ${retryCount + 1}/${maxRetries})`);
                        
                        await new Promise(resolve =&gt; setTimeout(resolve, delay));
                        return callGeminiAPI(apiKey, prompt, retryCount + 1);
                    }
                    
                    let errorMessage = `API lá»—i (${response.status})`;
                    if (response.status === 503) {
                        errorMessage = &#x27;API hiá»‡n Ä‘ang quÃ¡ táº£i. Vui lÃ²ng thá»­ láº¡i sau vÃ i phÃºt.&#x27;;
                    } else if (response.status === 429) {
                        errorMessage = &#x27;ÄÃ£ vÆ°á»£t quÃ¡ giá»›i háº¡n request. Vui lÃ²ng chá» má»™t chÃºt rá»“i thá»­ láº¡i.&#x27;;
                    } else if (response.status === 500) {
                        errorMessage = &#x27;Lá»—i server API. Vui lÃ²ng thá»­ láº¡i sau.&#x27;;
                    } else if (response.status === 401 || response.status === 403) {
                        errorMessage = &#x27;API Key khÃ´ng há»£p lá»‡ hoáº·c háº¿t háº¡n. Vui lÃ²ng kiá»ƒm tra láº¡i API Key.&#x27;;
                    } else if (response.status === 400) {
                        errorMessage = &#x27;YÃªu cáº§u khÃ´ng há»£p lá»‡. Vui lÃ²ng kiá»ƒm tra thÃ´ng tin nháº­p vÃ o.&#x27;;
                    }
                    
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                console.log(&#x27;API Response:&#x27;, data);
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error(&#x27;KhÃ´ng nháº­n Ä‘Æ°á»£c pháº£n há»“i há»£p lá»‡ tá»« API. Vui lÃ²ng thá»­ láº¡i.&#x27;);
                }

                const text = data.candidates[0].content.parts[0].text;
                
                // Try to parse JSON response with improved validation
                try {
                    const jsonStart = text.indexOf(&#x27;{&#x27;);
                    const jsonEnd = text.lastIndexOf(&#x27;}&#x27;) + 1;
                    if (jsonStart &gt;= 0 &amp;&amp; jsonEnd &gt; jsonStart) {
                        const jsonText = text.substring(jsonStart, jsonEnd);
                        const parsedResult = JSON.parse(jsonText);
                        
                        // Validate and sanitize required fields
                        const result = {
                            title: sanitizeText(parsedResult.title) || sanitizeText(collectFormData().name) || &quot;MÃ´ táº£ sáº£n pháº©m cháº¥t lÆ°á»£ng cao&quot;,
                            short_description: sanitizeText(parsedResult.short_description) || &quot;Thiáº¿t káº¿ thá»i trang, hiá»‡n Ä‘áº¡i\nCháº¥t liá»‡u cao cáº¥p, bá»n Ä‘áº¹p\nThoáº£i mÃ¡i khi sá»­ dá»¥ng\nPhÃ¹ há»£p nhiá»u dÃ¡ng ngÆ°á»i&quot;,
                            detailed_description: sanitizeText(parsedResult.detailed_description) || &quot;Sáº£n pháº©m Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i cháº¥t liá»‡u cao cáº¥p, mang Ä‘áº¿n sá»± thoáº£i mÃ¡i vÃ  phong cÃ¡ch cho ngÆ°á»i sá»­ dá»¥ng.&quot;,
                            specifications: sanitizeSpecifications(parsedResult.specifications) || {
                                &quot;Cháº¥t liá»‡u&quot;: &quot;Cotton cao cáº¥p&quot;,
                                &quot;Size&quot;: &quot;S, M, L, XL&quot;, 
                                &quot;MÃ u sáº¯c&quot;: &quot;Äen, tráº¯ng, há»“ng nude&quot;,
                                &quot;Xuáº¥t xá»©&quot;: &quot;Viá»‡t Nam&quot;
                            }
                        };
                        
                        return result;
                    }
                } catch (e) {
                    console.warn(&#x27;Could not parse JSON, using fallback format&#x27;, e);
                }
                
                // Fallback: Create structured data from plain text
                return createFallbackDescription(text);
                
            } catch (error) {
                if (error.name === &#x27;TypeError&#x27; &amp;&amp; error.message.includes(&#x27;fetch&#x27;)) {
                    throw new Error(&#x27;KhÃ´ng thá»ƒ káº¿t ná»‘i Ä‘áº¿n API. Vui lÃ²ng kiá»ƒm tra káº¿t ná»‘i internet.&#x27;);
                }
                console.error(&#x27;API call error:&#x27;, error);
                throw error;
            }
        }

        // Sanitize text to prevent XSS attacks
        function sanitizeText(text) {
            if (!text || typeof text !== &#x27;string&#x27;) return &#x27;&#x27;;
            
            // Remove potential HTML/script tags
            const div = document.createElement(&#x27;div&#x27;);
            div.textContent = text;
            return div.innerHTML
                .replace(/&lt;script\b[^&lt;]*(?:(?!&lt;\/script&gt;)&lt;[^&lt;]*)*&lt;\/script&gt;/gi, &#x27;&#x27;)
                .replace(/&lt;[^&gt;]*&gt;/g, &#x27;&#x27;)
                .trim();
        }

        // Sanitize specifications object
        function sanitizeSpecifications(specs) {
            if (!specs || typeof specs !== &#x27;object&#x27;) return null;
            
            const sanitized = {};
            Object.keys(specs).forEach(key =&gt; {
                const sanitizedKey = sanitizeText(key);
                const sanitizedValue = sanitizeText(specs[key]);
                if (sanitizedKey &amp;&amp; sanitizedValue) {
                    sanitized[sanitizedKey] = sanitizedValue;
                }
            });
            
            return Object.keys(sanitized).length &gt; 0 ? sanitized : null;
        }

        // Create fallback description structure
        function createFallbackDescription(text) {
            const formData = collectFormData();
            
            return {
                title: formData.name || &quot;MÃ´ táº£ sáº£n pháº©m cháº¥t lÆ°á»£ng cao&quot;,
                short_description: &quot;Thiáº¿t káº¿ thá»i trang, hiá»‡n Ä‘áº¡i vÃ  tinh táº¿\nCháº¥t liá»‡u cao cáº¥p, má»m máº¡i vÃ  bá»n Ä‘áº¹p\nMang láº¡i cáº£m giÃ¡c thoáº£i mÃ¡i khi máº·c\nPhÃ¹ há»£p vá»›i nhiá»u dÃ¡ng ngÆ°á»i khÃ¡c nhau&quot;,
                detailed_description: sanitizeText(text) || &quot;Sáº£n pháº©m Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i cháº¥t liá»‡u cao cáº¥p, mang Ä‘áº¿n sá»± thoáº£i mÃ¡i vÃ  phong cÃ¡ch cho ngÆ°á»i sá»­ dá»¥ng. Vá»›i kiá»ƒu dÃ¡ng hiá»‡n Ä‘áº¡i vÃ  tÃ­nh nÄƒng Æ°u viá»‡t, Ä‘Ã¢y lÃ  lá»±a chá»n hoÃ n háº£o cho nhu cáº§u hÃ ng ngÃ y.&quot;,
                specifications: {
                    &quot;Cháº¥t liá»‡u&quot;: formData.material || formData.composition || &quot;Cotton cao cáº¥p&quot;,
                    &quot;Size&quot;: formData.size || &quot;S, M, L, XL&quot;, 
                    &quot;MÃ u sáº¯c&quot;: formData.color || &quot;Äen, tráº¯ng, há»“ng nude&quot;,
                    &quot;Xuáº¥t xá»©&quot;: &quot;Viá»‡t Nam&quot;
                }
            };
        }

        // Display Generated Description with XSS protection
        function displayDescription(description) {
            const content = document.getElementById(&#x27;descriptionContent&#x27;);
            
            if (!description || typeof description !== &#x27;object&#x27;) {
                description = createFallbackDescription();
            }
            
            // Process short description safely
            let shortDescItems = [];
            if (description.short_description &amp;&amp; typeof description.short_description === &#x27;string&#x27;) {
                shortDescItems = description.short_description
                    .split(&#x27;\n&#x27;)
                    .filter(item =&gt; item.trim() !== &#x27;&#x27;)
                    .map(item =&gt; sanitizeText(item.replace(/^[â€¢\-\*]\s*/, &#x27;&#x27;).trim()))
                    .filter(item =&gt; item.length &gt; 0);
            }
            
            // Ensure we have at least 4 bullet points
            if (shortDescItems.length &lt; 4) {
                const defaultItems = [
                    &quot;Thiáº¿t káº¿ thá»i trang, hiá»‡n Ä‘áº¡i vÃ  tinh táº¿&quot;,
                    &quot;Cháº¥t liá»‡u cao cáº¥p, má»m máº¡i vÃ  bá»n Ä‘áº¹p&quot;, 
                    &quot;Mang láº¡i cáº£m giÃ¡c thoáº£i mÃ¡i khi máº·c&quot;,
                    &quot;PhÃ¹ há»£p vá»›i nhiá»u dÃ¡ng ngÆ°á»i khÃ¡c nhau&quot;
                ];
                shortDescItems = [...shortDescItems, ...defaultItems].slice(0, 4);
            }
            
            // Sanitize all content before displaying
            const safeTitle = sanitizeText(description.title);
            const safeDetailedDescription = sanitizeText(description.detailed_description);
            
            content.innerHTML = `
                &lt;div class=&quot;space-y-8&quot;&gt;
                    &lt;!-- Title (H2) --&gt;
                    &lt;div class=&quot;border-b-2 border-primary pb-4&quot;&gt;
                        &lt;h2 class=&quot;text-3xl font-bold text-gray-900 leading-tight&quot;&gt;${safeTitle}&lt;/h2&gt;
                    &lt;/div&gt;

                    &lt;!-- Short Description (4 bullet points) --&gt;
                    &lt;div class=&quot;bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl p-6&quot;&gt;
                        &lt;h3 class=&quot;text-xl font-semibold text-gray-900 mb-4&quot;&gt;MÃ´ Táº£ Ngáº¯n&lt;/h3&gt;
                        &lt;ul class=&quot;space-y-3&quot;&gt;
                            ${shortDescItems.map(item =&gt; `
                                &lt;li class=&quot;flex items-start space-x-3&quot;&gt;
                                    &lt;div class=&quot;w-2 h-2 bg-primary rounded-full mt-2 flex-shrink-0&quot;&gt;&lt;/div&gt;
                                    &lt;span class=&quot;text-gray-700 leading-relaxed&quot;&gt;${item}&lt;/span&gt;
                                &lt;/li&gt;
                            `).join(&#x27;&#x27;)}
                        &lt;/ul&gt;
                    &lt;/div&gt;

                    &lt;!-- Detailed Description (Long paragraph) --&gt;
                    &lt;div&gt;
                        &lt;h3 class=&quot;text-xl font-semibold text-gray-900 mb-4&quot;&gt;MÃ´ Táº£ Chi Tiáº¿t&lt;/h3&gt;
                        &lt;div class=&quot;bg-white border border-gray-200 rounded-lg p-6&quot;&gt;
                            &lt;div class=&quot;prose prose-gray max-w-none&quot;&gt;
                                &lt;p class=&quot;text-gray-700 leading-loose text-justify indent-8&quot;&gt;${safeDetailedDescription}&lt;/p&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;

                    &lt;!-- Technical Specifications --&gt;
                    ${description.specifications &amp;&amp; Object.keys(description.specifications).length ? `
                    &lt;div&gt;
                        &lt;h3 class=&quot;text-xl font-semibold text-gray-900 mb-4&quot;&gt;ThÃ´ng Sá»‘ Ká»¹ Thuáº­t&lt;/h3&gt;
                        &lt;div class=&quot;bg-gray-50 border border-gray-200 rounded-lg overflow-hidden&quot;&gt;
                            &lt;table class=&quot;w-full&quot;&gt;
                                &lt;tbody class=&quot;divide-y divide-gray-200&quot;&gt;
                                    ${Object.entries(description.specifications).map(([key, value]) =&gt; `
                                        &lt;tr class=&quot;hover:bg-gray-100 transition-colors&quot;&gt;
                                            &lt;td class=&quot;px-6 py-4 font-medium text-gray-900 bg-gray-100 w-1/3&quot;&gt;${sanitizeText(key)}&lt;/td&gt;
                                            &lt;td class=&quot;px-6 py-4 text-gray-700&quot;&gt;${sanitizeText(value)}&lt;/td&gt;
                                        &lt;/tr&gt;
                                    `).join(&#x27;&#x27;)}
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    ` : &#x27;&#x27;}
                &lt;/div&gt;
            `;

            document.getElementById(&#x27;resultPanel&#x27;).classList.remove(&#x27;hidden&#x27;);
        }

        // Copy to Clipboard with improved handling
        function copyDescription() {
            if (!currentDescription) {
                alert(&#x27;ChÆ°a cÃ³ mÃ´ táº£ Ä‘á»ƒ copy!&#x27;);
                return;
            }

            let textToCopy = `${currentDescription.title}\n\n`;
            
            // Short description (4 bullet points)
            textToCopy += `MÃ” Táº¢ NGáº®N:\n`;
            if (currentDescription.short_description &amp;&amp; typeof currentDescription.short_description === &#x27;string&#x27;) {
                const shortDescItems = currentDescription.short_description
                    .split(&#x27;\n&#x27;)
                    .filter(item =&gt; item.trim() !== &#x27;&#x27;)
                    .map(item =&gt; item.replace(/^[â€¢\-\*]\s*/, &#x27;&#x27;).trim())
                    .filter(item =&gt; item.length &gt; 0);
                    
                shortDescItems.forEach(item =&gt; {
                    textToCopy += `â€¢ ${item}\n`;
                });
            }
            textToCopy += &#x27;\n&#x27;;
            
            // Detailed description
            textToCopy += `MÃ” Táº¢ CHI TIáº¾T:\n${currentDescription.detailed_description}\n\n`;
            
            // Technical specifications
            if (currentDescription.specifications &amp;&amp; Object.keys(currentDescription.specifications).length) {
                textToCopy += `THÃ”NG Sá» Ká»¸ THUáº¬T:\n`;
                Object.entries(currentDescription.specifications).forEach(([key, value]) =&gt; {
                    textToCopy += `${key}: ${value}\n`;
                });
                textToCopy += &#x27;\n&#x27;;
            }

            navigator.clipboard.writeText(textToCopy).then(() =&gt; {
                alert(&#x27;ÄÃ£ copy mÃ´ táº£ sáº£n pháº©m!&#x27;);
            }).catch(err =&gt; {
                console.error(&#x27;Copy failed:&#x27;, err);
                
                // Fallback: create a temporary textarea
                const textarea = document.createElement(&#x27;textarea&#x27;);
                textarea.value = textToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand(&#x27;copy&#x27;);
                    alert(&#x27;ÄÃ£ copy mÃ´ táº£ sáº£n pháº©m!&#x27;);
                } catch (e) {
                    alert(&#x27;KhÃ´ng thá»ƒ copy tá»± Ä‘á»™ng. Vui lÃ²ng copy thá»§ cÃ´ng tá»« káº¿t quáº£ hiá»ƒn thá»‹!&#x27;);
                }
                
                document.body.removeChild(textarea);
            });
        }

        // Export to DOCX with improved error handling
        async function exportToDocx() {
            if (!currentDescription) {
                alert(&#x27;ChÆ°a cÃ³ mÃ´ táº£ Ä‘á»ƒ xuáº¥t file!&#x27;);
                return;
            }

            try {
                // Check if docx library is loaded
                if (typeof docx === &#x27;undefined&#x27;) {
                    await loadDocxLibrary();
                    if (typeof docx === &#x27;undefined&#x27;) {
                        throw new Error(&#x27;KhÃ´ng thá»ƒ táº£i thÆ° viá»‡n DOCX&#x27;);
                    }
                }

                const children = [];
                
                // Main title
                children.push(
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: currentDescription.title || &#x27;MÃ´ táº£ sáº£n pháº©m&#x27;,
                                bold: true,
                                size: 32,
                                font: &quot;Times New Roman&quot;
                            })
                        ],
                        alignment: docx.AlignmentType.CENTER,
                        spacing: { after: 400 }
                    })
                );

                // Short description
                children.push(
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: &quot;MÃ” Táº¢ NGáº®N:&quot;,
                                bold: true,
                                size: 24,
                                font: &quot;Times New Roman&quot;
                            })
                        ],
                        spacing: { after: 200, before: 300 }
                    })
                );

                if (currentDescription.short_description) {
                    const shortDescItems = currentDescription.short_description
                        .split(&#x27;\n&#x27;)
                        .filter(item =&gt; item.trim() !== &#x27;&#x27;)
                        .map(item =&gt; item.replace(/^[â€¢\-\*]\s*/, &#x27;&#x27;).trim())
                        .filter(item =&gt; item.length &gt; 0);
                        
                    shortDescItems.forEach(item =&gt; {
                        children.push(
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: `â€¢ ${item}`,
                                        font: &quot;Times New Roman&quot;,
                                        size: 22
                                    })
                                ],
                                spacing: { after: 100 }
                            })
                        );
                    });
                }

                // Detailed description
                children.push(
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: &quot;MÃ” Táº¢ CHI TIáº¾T:&quot;,
                                bold: true,
                                size: 24,
                                font: &quot;Times New Roman&quot;
                            })
                        ],
                        spacing: { after: 200, before: 400 }
                    }),
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: currentDescription.detailed_description || &#x27;&#x27;,
                                font: &quot;Times New Roman&quot;,
                                size: 22
                            })
                        ],
                        spacing: { after: 400 },
                        alignment: docx.AlignmentType.JUSTIFIED
                    })
                );

                // Technical specifications
                if (currentDescription.specifications &amp;&amp; Object.keys(currentDescription.specifications).length) {
                    children.push(
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: &quot;THÃ”NG Sá» Ká»¸ THUáº¬T:&quot;,
                                    bold: true,
                                    size: 24,
                                    font: &quot;Times New Roman&quot;
                                })
                            ],
                            spacing: { after: 200, before: 300 }
                        })
                    );

                    Object.entries(currentDescription.specifications).forEach(([key, value]) =&gt; {
                        children.push(
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: `${key}: `,
                                        bold: true,
                                        font: &quot;Times New Roman&quot;,
                                        size: 22
                                    }),
                                    new docx.TextRun({
                                        text: String(value),
                                        font: &quot;Times New Roman&quot;,
                                        size: 22
                                    })
                                ],
                                spacing: { after: 100 }
                            })
                        );
                    });
                }

                // Create document
                const doc = new docx.Document({
                    sections: [{
                        properties: {
                            page: {
                                margin: {
                                    top: 720,
                                    right: 720,
                                    bottom: 720,
                                    left: 720
                                }
                            }
                        },
                        children: children
                    }],
                    styles: {
                        default: {
                            document: {
                                run: {
                                    font: &quot;Times New Roman&quot;,
                                    size: 22
                                }
                            }
                        }
                    }
                });

                // Generate and download file
                const blob = await docx.Packer.toBlob(doc);
                const fileName = `mo-ta-san-pham-${new Date().getTime()}.docx`;
                
                downloadBlob(blob, fileName);
                alert(&#x27;ÄÃ£ táº£i xuá»‘ng file Word thÃ nh cÃ´ng!&#x27;);
                    
            } catch (error) {
                console.error(&#x27;Export error:&#x27;, error);
                
                // Fallback: create text file
                exportToText();
            }
        }

        // Load DOCX library dynamically
        function loadDocxLibrary() {
            return new Promise((resolve, reject) =&gt; {
                if (typeof docx !== &#x27;undefined&#x27;) {
                    resolve();
                    return;
                }

                const script = document.createElement(&#x27;script&#x27;);
                script.src = &#x27;https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js&#x27;;
                script.onload = () =&gt; resolve();
                script.onerror = () =&gt; reject(new Error(&#x27;Failed to load DOCX library&#x27;));
                document.head.appendChild(script);
            });
        }

        // Download blob as file
        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement(&#x27;a&#x27;);
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Export to text file as fallback
        function exportToText() {
            try {
                let textContent = `${currentDescription.title}\n\n`;
                
                textContent += `MÃ” Táº¢ NGáº®N:\n`;
                if (currentDescription.short_description) {
                    const shortDescItems = currentDescription.short_description
                        .split(&#x27;\n&#x27;)
                        .filter(item =&gt; item.trim() !== &#x27;&#x27;);
                    shortDescItems.forEach(item =&gt; {
                        textContent += `â€¢ ${item.replace(/^[â€¢\-\*]\s*/, &#x27;&#x27;)}\n`;
                    });
                }
                textContent += &#x27;\n&#x27;;
                
                textContent += `MÃ” Táº¢ CHI TIáº¾T:\n${currentDescription.detailed_description}\n\n`;
                
                if (currentDescription.specifications) {
                    textContent += `THÃ”NG Sá» Ká»¸ THUáº¬T:\n`;
                    Object.entries(currentDescription.specifications).forEach(([key, value]) =&gt; {
                        textContent += `${key}: ${value}\n`;
                    });
                }
                
                const blob = new Blob([textContent], { type: &#x27;text/plain;charset=utf-8&#x27; });
                const fileName = `mo-ta-san-pham-${new Date().getTime()}.txt`;
                
                downloadBlob(blob, fileName);
                alert(&#x27;ÄÃ£ táº£i xuá»‘ng file TXT (do lá»—i táº¡o DOCX). Báº¡n cÃ³ thá»ƒ copy vÃ o Word Ä‘á»ƒ Ä‘á»‹nh dáº¡ng láº¡i!&#x27;);
            } catch (fallbackError) {
                alert(&#x27;KhÃ´ng thá»ƒ xuáº¥t file. Vui lÃ²ng copy ná»™i dung thá»§ cÃ´ng!&#x27;);
            }
        }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
                        "></iframe>
<iframe id="file5" class="file-frame" srcdoc="&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;vi&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Thumbnail Maker Tool - Professional Enhanced&lt;/title&gt;
    &lt;style&gt;
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: &#x27;Segoe UI&#x27;, Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        h1::before {
            content: &#x27;ðŸŽ¨&#x27;;
            position: absolute;
            left: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            animation: rotate 4s linear infinite;
        }

        h1::after {
            content: &#x27;âœ¨&#x27;;
            position: absolute;
            right: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes rotate {
            from { transform: translateY(-50%) rotate(0deg); }
            to { transform: translateY(-50%) rotate(360deg); }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: translateY(-50%) scale(1); }
            50% { opacity: 0.5; transform: translateY(-50%) scale(1.2); }
        }

        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .upload-box {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            transition: all 0.3s ease;
        }

        .upload-box:hover {
            border-color: #764ba2;
            background: rgba(118, 75, 162, 0.1);
            transform: translateY(-2px);
        }

        .upload-box h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .status.error {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .controls-section {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .controls-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-item label {
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        .control-item input[type=&quot;range&quot;] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .control-item input[type=&quot;range&quot;]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .control-item input[type=&quot;number&quot;] {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .control-item input[type=&quot;number&quot;]:focus {
            border-color: #667eea;
            outline: none;
        }

        .control-item select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
            cursor: pointer;
        }

        .control-item select:focus {
            border-color: #667eea;
            outline: none;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .removal-settings {
            background: rgba(255, 193, 7, 0.05);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .removal-settings h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .download-section {
            background: rgba(118, 75, 162, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .download-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .download-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .download-btn {
            background: linear-gradient(45deg, #764ba2, #667eea);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.4);
        }

        .download-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: &#x27;&#x27;;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(45deg, transparent 33%, rgba(255,255,255,0.3) 33%, rgba(255,255,255,0.3) 66%, transparent 66%);
            animation: progress-animation 1s linear infinite;
        }

        @keyframes progress-animation {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .thumbnails-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .thumbnail-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            border: 3px solid transparent;
        }

        .thumbnail-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .thumbnail-item.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        }

        .thumbnail-canvas {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            object-fit: cover;
            margin: 0 auto;
        }

        .thumbnail-info {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .thumbnail-name {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #d32f2f;
            transform: scale(1.05);
        }

        .workspace-info {
            text-align: center;
            color: #666;
            margin-top: 20px;
            font-size: 14px;
        }

        .copyright-section {
            margin-top: 40px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 20px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.2);
            position: relative;
            overflow: hidden;
        }

        .copyright-section::before {
            content: &#x27;&#x27;;
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .copyright-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .copyright-text {
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
        }

        .copyright-icon {
            font-size: 20px;
            animation: bounce 2s infinite;
        }

        .copyright-icon:nth-child(1) {
            animation-delay: 0s;
        }

        .copyright-icon:nth-child(3) {
            animation-delay: 0.3s;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }

        .cute-icons {
            display: flex;
            justify-content: center;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .cute-icon {
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

        .cute-icon:nth-child(1) { animation-delay: 0s; }
        .cute-icon:nth-child(2) { animation-delay: 0.6s; }
        .cute-icon:nth-child(3) { animation-delay: 1.2s; }
        .cute-icon:nth-child(4) { animation-delay: 1.8s; }
        .cute-icon:nth-child(5) { animation-delay: 2.4s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(5deg); }
            50% { transform: translateY(-5px) rotate(-5deg); }
            75% { transform: translateY(-15px) rotate(3deg); }
        }

        .cute-icon:hover {
            transform: scale(1.5) rotate(360deg);
            filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5));
        }

        .selected-info {
            background: rgba(102, 126, 234, 0.2);
            border: 3px solid rgba(102, 126, 234, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            animation: pulse-selection 2s infinite;
        }

        @keyframes pulse-selection {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
            }
        }

        .current-editing {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #333;
        }

        @media (max-width: 768px) {
            .upload-section {
                grid-template-columns: 1fr;
            }

            .control-group {
                grid-template-columns: 1fr;
            }

            .thumbnails-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;h1&gt;ðŸŽ¨ Thumbnail Maker Tool - Professional Enhanced&lt;/h1&gt;

        &lt;!-- Upload Section --&gt;
        &lt;div class=&quot;upload-section&quot;&gt;
            &lt;div class=&quot;upload-box&quot;&gt;
                &lt;h3&gt;ðŸ“· Upload PhÃ´ng Ná»n&lt;/h3&gt;
                &lt;p&gt;KÃ­ch thÆ°á»›c khuyáº¿n nghá»‹: 1200x1200px&lt;/p&gt;
                &lt;input type=&quot;file&quot; id=&quot;backgroundInput&quot; class=&quot;file-input&quot; accept=&quot;image/*&quot;&gt;
                &lt;button class=&quot;upload-btn&quot; onclick=&quot;document.getElementById(&#x27;backgroundInput&#x27;).click()&quot;&gt;
                    Chá»n PhÃ´ng Ná»n
                &lt;/button&gt;
                &lt;div id=&quot;backgroundStatus&quot; class=&quot;status&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;

            &lt;div class=&quot;upload-box&quot;&gt;
                &lt;h3&gt;ðŸ›ï¸ Upload Sáº£n Pháº©m&lt;/h3&gt;
                &lt;p&gt;Chá»n nhiá»u file, tá»± Ä‘á»™ng xÃ³a phÃ´ng ná»n thÃ´ng minh&lt;/p&gt;
                &lt;input type=&quot;file&quot; id=&quot;productInput&quot; class=&quot;file-input&quot; accept=&quot;image/*&quot; multiple&gt;
                &lt;button class=&quot;upload-btn&quot; onclick=&quot;document.getElementById(&#x27;productInput&#x27;).click()&quot;&gt;
                    Chá»n Sáº£n Pháº©m
                &lt;/button&gt;
                &lt;div id=&quot;productStatus&quot; class=&quot;status&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;!-- Background Removal Settings --&gt;
        &lt;div class=&quot;removal-settings&quot;&gt;
            &lt;h4&gt;ðŸŽ¯ CÃ i Äáº·t XÃ³a Ná»n ThÃ´ng Minh&lt;/h4&gt;
            &lt;div class=&quot;control-group&quot;&gt;
                &lt;div class=&quot;control-item&quot;&gt;
                    &lt;label&gt;Äá»™ Nháº¡y (10-100)&lt;/label&gt;
                    &lt;input type=&quot;range&quot; id=&quot;sensitivity&quot; min=&quot;10&quot; max=&quot;100&quot; step=&quot;5&quot; value=&quot;40&quot;&gt;
                    &lt;span id=&quot;sensitivityValue&quot;&gt;40&lt;/span&gt;
                &lt;/div&gt;

                &lt;div class=&quot;control-item&quot;&gt;
                    &lt;label&gt;Blur Edge MÆ°á»£t (0-10px)&lt;/label&gt;
                    &lt;input type=&quot;range&quot; id=&quot;edgeBlur&quot; min=&quot;0&quot; max=&quot;10&quot; step=&quot;1&quot; value=&quot;3&quot;&gt;
                    &lt;span id=&quot;edgeBlurValue&quot;&gt;3px&lt;/span&gt;
                &lt;/div&gt;

                &lt;div class=&quot;control-item&quot;&gt;
                    &lt;label&gt;Preserve White Details&lt;/label&gt;
                    &lt;input type=&quot;checkbox&quot; id=&quot;preserveWhite&quot; checked&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;!-- Controls Section --&gt;
        &lt;div class=&quot;controls-section&quot;&gt;
            &lt;h3&gt;âš™ï¸ Chá»‰nh Sá»­a&lt;/h3&gt;

            &lt;div class=&quot;current-editing&quot; id=&quot;currentEditing&quot; style=&quot;display: none;&quot;&gt;
                &lt;strong&gt;Äang chá»‰nh sá»­a:&lt;/strong&gt; &lt;span id=&quot;currentProductName&quot;&gt;KhÃ´ng cÃ³&lt;/span&gt;
            &lt;/div&gt;

            &lt;div class=&quot;selected-info&quot; id=&quot;selectedInfo&quot; style=&quot;display: none;&quot;&gt;
                &lt;strong&gt;ðŸŽ¯ ÄÃƒ CHá»ŒN HÃ€NG LOáº T:&lt;/strong&gt; &lt;span id=&quot;selectedCount&quot;&gt;0&lt;/span&gt; thumbnail(s) - Sáºµn sÃ ng chá»‰nh sá»­a!
            &lt;/div&gt;

            &lt;div class=&quot;control-group&quot;&gt;
                &lt;div class=&quot;control-item&quot;&gt;
                    &lt;label&gt;Scale (0.1x - 3x)&lt;/label&gt;
                    &lt;input type=&quot;range&quot; id=&quot;globalScale&quot; min=&quot;0.1&quot; max=&quot;3&quot; step=&quot;0.1&quot; value=&quot;0.6&quot;&gt;
                    &lt;span id=&quot;globalScaleValue&quot;&gt;0.6x&lt;/span&gt;
                &lt;/div&gt;

                &lt;div class=&quot;control-item&quot;&gt;
                    &lt;label&gt;Vá»‹ TrÃ­ X&lt;/label&gt;
                    &lt;input type=&quot;number&quot; id=&quot;globalX&quot; min=&quot;-600&quot; max=&quot;600&quot; value=&quot;0&quot; placeholder=&quot;Vá»‹ trÃ­ X&quot;&gt;
                &lt;/div&gt;

                &lt;div class=&quot;control-item&quot;&gt;
                    &lt;label&gt;Vá»‹ TrÃ­ Y&lt;/label&gt;
                    &lt;input type=&quot;number&quot; id=&quot;globalY&quot; min=&quot;-600&quot; max=&quot;600&quot; value=&quot;0&quot; placeholder=&quot;Vá»‹ trÃ­ Y&quot;&gt;
                &lt;/div&gt;

                &lt;div class=&quot;control-item&quot;&gt;
                    &lt;label&gt;GÃ³c Xoay (0-360Â°)&lt;/label&gt;
                    &lt;input type=&quot;range&quot; id=&quot;rotation&quot; min=&quot;0&quot; max=&quot;360&quot; step=&quot;1&quot; value=&quot;0&quot;&gt;
                    &lt;span id=&quot;rotationValue&quot;&gt;0Â°&lt;/span&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div class=&quot;control-buttons&quot;&gt;
                &lt;button class=&quot;control-btn&quot; onclick=&quot;applyChanges()&quot;&gt;Ãp Dá»¥ng&lt;/button&gt;
                &lt;button class=&quot;control-btn&quot; onclick=&quot;centerProducts()&quot;&gt;CÄƒn Giá»¯a&lt;/button&gt;
                &lt;button class=&quot;control-btn&quot; onclick=&quot;resetPositions()&quot;&gt;Reset Vá»‹ TrÃ­&lt;/button&gt;
                &lt;button class=&quot;control-btn&quot; onclick=&quot;selectAllThumbnails()&quot;&gt;Chá»n Táº¥t Cáº£&lt;/button&gt;
                &lt;button class=&quot;control-btn&quot; onclick=&quot;deselectAllThumbnails()&quot;&gt;Bá» Chá»n Táº¥t Cáº£&lt;/button&gt;
                &lt;button class=&quot;control-btn&quot; onclick=&quot;reprocessBackgrounds()&quot;&gt;Xá»­ LÃ½ Láº¡i Ná»n&lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;!-- Download Section --&gt;
        &lt;div class=&quot;download-section&quot;&gt;
            &lt;h3&gt;ðŸ’¾ Táº£i Xuá»‘ng&lt;/h3&gt;

            &lt;!-- Size Selection --&gt;
            &lt;div class=&quot;control-group&quot; style=&quot;margin-bottom: 20px;&quot;&gt;
                &lt;div class=&quot;control-item&quot;&gt;
                    &lt;label&gt;ðŸ“ Chá»n KÃ­ch ThÆ°á»›c Thumbnail&lt;/label&gt;
                    &lt;select id=&quot;thumbnailSize&quot;&gt;
                        &lt;option value=&quot;1200x1200&quot;&gt;1200x1200 (VuÃ´ng - Máº·c Ä‘á»‹nh)&lt;/option&gt;
                        &lt;option value=&quot;788x1024&quot;&gt;788x1024 (Dá»c 3:4)&lt;/option&gt;
                        &lt;option value=&quot;1024x788&quot;&gt;1024x788 (Ngang 4:3)&lt;/option&gt;
                        &lt;option value=&quot;1080x1080&quot;&gt;1080x1080 (Instagram vuÃ´ng)&lt;/option&gt;
                        &lt;option value=&quot;1080x1350&quot;&gt;1080x1350 (Instagram dá»c 4:5)&lt;/option&gt;
                        &lt;option value=&quot;1350x1080&quot;&gt;1350x1080 (Instagram ngang 5:4)&lt;/option&gt;
                    &lt;/select&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div class=&quot;download-buttons&quot;&gt;
                &lt;button class=&quot;download-btn&quot; id=&quot;downloadSelected&quot; onclick=&quot;downloadSelected()&quot; disabled&gt;
                    Táº£i Thumbnail ÄÃ£ Chá»n
                &lt;/button&gt;
                &lt;button class=&quot;download-btn&quot; id=&quot;downloadAll&quot; onclick=&quot;downloadAll()&quot; disabled&gt;
                    Táº£i Táº¥t Cáº£ Thumbnail
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot;&gt;
                &lt;div class=&quot;progress-fill&quot; id=&quot;progressFill&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;!-- Thumbnails Grid --&gt;
        &lt;div class=&quot;thumbnails-grid&quot; id=&quot;thumbnailsGrid&quot;&gt;&lt;/div&gt;

        &lt;div class=&quot;workspace-info&quot; id=&quot;workspaceInfo&quot;&gt;
            Táº£i lÃªn phÃ´ng ná»n vÃ  sáº£n pháº©m Ä‘á»ƒ báº¯t Ä‘áº§u táº¡o thumbnail
        &lt;/div&gt;

        &lt;!-- Copyright Section --&gt;
        &lt;div class=&quot;copyright-section&quot;&gt;
            &lt;div class=&quot;copyright-content&quot;&gt;
                &lt;span class=&quot;copyright-icon&quot;&gt;ðŸŽ¨&lt;/span&gt;
                &lt;span class=&quot;copyright-text&quot;&gt;Copyright Â© 2025 Tien Hoang&lt;/span&gt;
                &lt;span class=&quot;copyright-icon&quot;&gt;âœ¨&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class=&quot;cute-icons&quot;&gt;
                &lt;span class=&quot;cute-icon&quot;&gt;ðŸ±&lt;/span&gt;
                &lt;span class=&quot;cute-icon&quot;&gt;ðŸŒ¸&lt;/span&gt;
                &lt;span class=&quot;cute-icon&quot;&gt;ðŸ’«&lt;/span&gt;
                &lt;span class=&quot;cute-icon&quot;&gt;ðŸ¦„&lt;/span&gt;
                &lt;span class=&quot;cute-icon&quot;&gt;ðŸŒˆ&lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
        let backgroundImage = null;
        let products = [];
        let selectedThumbnails = new Set();
        let currentEditingProduct = null;

        // Advanced background removal with smooth edge detection
        function advancedBackgroundRemoval(imageData, canvas, sensitivity = 40, preserveWhite = true, edgeBlur = 2) {
            const ctx = canvas.getContext(&#x27;2d&#x27;);
            const data = imageData.data;
            const width = canvas.width;
            const height = canvas.height;

            // Sample multiple edge points for better background detection
            const samplePoints = [];
            const edge = 5; // Avoid exact corners

            // Top edge
            for (let x = edge; x &lt; width - edge; x += Math.floor(width / 20)) {
                samplePoints.push([x, edge]);
            }
            // Bottom edge
            for (let x = edge; x &lt; width - edge; x += Math.floor(width / 20)) {
                samplePoints.push([x, height - edge]);
            }
            // Left edge
            for (let y = edge; y &lt; height - edge; y += Math.floor(height / 20)) {
                samplePoints.push([edge, y]);
            }
            // Right edge
            for (let y = edge; y &lt; height - edge; y += Math.floor(height / 20)) {
                samplePoints.push([width - edge, y]);
            }

            // Collect background colors
            let bgColors = [];
            samplePoints.forEach(([x, y]) =&gt; {
                const idx = (y * width + x) * 4;
                bgColors.push({
                    r: data[idx],
                    g: data[idx + 1],
                    b: data[idx + 2],
                    brightness: (data[idx] + data[idx + 1] + data[idx + 2]) / 3
                });
            });

            // Find dominant background color
            let dominantBg = bgColors.reduce((prev, curr) =&gt; {
                let prevCount = bgColors.filter(c =&gt; 
                    Math.abs(c.r - prev.r) &lt; 30 &amp;&amp; 
                    Math.abs(c.g - prev.g) &lt; 30 &amp;&amp; 
                    Math.abs(c.b - prev.b) &lt; 30
                ).length;
                let currCount = bgColors.filter(c =&gt; 
                    Math.abs(c.r - curr.r) &lt; 30 &amp;&amp; 
                    Math.abs(c.g - curr.g) &lt; 30 &amp;&amp; 
                    Math.abs(c.b - curr.b) &lt; 30
                ).length;
                return currCount &gt; prevCount ? curr : prev;
            });

            // Create alpha map for smooth transitions
            let alphaMap = new Array(width * height).fill(255);

            // First pass: Detect background pixels
            for (let y = 0; y &lt; height; y++) {
                for (let x = 0; x &lt; width; x++) {
                    const idx = (y * width + x) * 4;
                    const r = data[idx];
                    const g = data[idx + 1];
                    const b = data[idx + 2];

                    // Calculate similarity to dominant background
                    const colorDiff = Math.abs(r - dominantBg.r) + 
                                    Math.abs(g - dominantBg.g) + 
                                    Math.abs(b - dominantBg.b);

                    const brightness = (r + g + b) / 3;

                    // Decide whether to make transparent
                    let makeTransparent = false;
                    let alpha = 255;

                    // If very similar to background color
                    if (colorDiff &lt; sensitivity) {
                        makeTransparent = true;
                        alpha = Math.max(0, 255 - ((sensitivity - colorDiff) / sensitivity) * 255);
                    }

                    // Special handling for white/light colors
                    if (brightness &gt; 240 &amp;&amp; !preserveWhite) {
                        makeTransparent = true;
                        alpha = Math.max(0, 255 - ((brightness - 240) / 15) * 255);
                    } else if (brightness &gt; 250 &amp;&amp; preserveWhite) {
                        if (colorDiff &lt; sensitivity * 0.7) {
                            makeTransparent = true;
                            alpha = Math.max(0, 255 - ((sensitivity * 0.7 - colorDiff) / (sensitivity * 0.7)) * 255);
                        }
                    }

                    if (makeTransparent) {
                        alphaMap[y * width + x] = alpha;
                    }
                }
            }

            // Second pass: Apply smooth edge blur
            if (edgeBlur &gt; 0) {
                let smoothedAlphaMap = [...alphaMap];

                for (let y = edgeBlur; y &lt; height - edgeBlur; y++) {
                    for (let x = edgeBlur; x &lt; width - edgeBlur; x++) {
                        const centerIdx = y * width + x;
                        const centerAlpha = alphaMap[centerIdx];

                        // Skip if already fully opaque
                        if (centerAlpha === 255) continue;

                        // Check if this pixel is near an edge (transition zone)
                        let isNearEdge = false;
                        let minAlpha = centerAlpha;
                        let maxAlpha = centerAlpha;

                        // Check surrounding pixels within blur radius
                        for (let dy = -edgeBlur; dy &lt;= edgeBlur &amp;&amp; !isNearEdge; dy++) {
                            for (let dx = -edgeBlur; dx &lt;= edgeBlur &amp;&amp; !isNearEdge; dx++) {
                                if (dx === 0 &amp;&amp; dy === 0) continue;

                                const neighborIdx = (y + dy) * width + (x + dx);
                                const neighborAlpha = alphaMap[neighborIdx];

                                minAlpha = Math.min(minAlpha, neighborAlpha);
                                maxAlpha = Math.max(maxAlpha, neighborAlpha);

                                // If there&#x27;s a significant alpha difference nearby, this is an edge
                                if (Math.abs(centerAlpha - neighborAlpha) &gt; 100) {
                                    isNearEdge = true;
                                }
                            }
                        }

                        // Apply gaussian-like blur for smooth edges
                        if (isNearEdge &amp;&amp; centerAlpha &lt; 255) {
                            let totalAlpha = 0;
                            let totalWeight = 0;

                            for (let dy = -edgeBlur; dy &lt;= edgeBlur; dy++) {
                                for (let dx = -edgeBlur; dx &lt;= edgeBlur; dx++) {
                                    const distance = Math.sqrt(dx * dx + dy * dy);
                                    if (distance &lt;= edgeBlur) {
                                        // Gaussian weight
                                        const weight = Math.exp(-(distance * distance) / (2 * (edgeBlur / 3) * (edgeBlur / 3)));
                                        const neighborIdx = (y + dy) * width + (x + dx);

                                        if (neighborIdx &gt;= 0 &amp;&amp; neighborIdx &lt; alphaMap.length) {
                                            totalAlpha += alphaMap[neighborIdx] * weight;
                                            totalWeight += weight;
                                        }
                                    }
                                }
                            }

                            if (totalWeight &gt; 0) {
                                smoothedAlphaMap[centerIdx] = Math.round(totalAlpha / totalWeight);
                            }
                        }
                    }
                }

                alphaMap = smoothedAlphaMap;
            }

            // Apply the final alpha values
            for (let y = 0; y &lt; height; y++) {
                for (let x = 0; x &lt; width; x++) {
                    const idx = (y * width + x) * 4;
                    const mapIdx = y * width + x;
                    data[idx + 3] = alphaMap[mapIdx];
                }
            }

            ctx.putImageData(imageData, 0, 0);
            return canvas;
        }

        // Handle background upload
        document.getElementById(&#x27;backgroundInput&#x27;).addEventListener(&#x27;change&#x27;, function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        backgroundImage = img;
                        showStatus(&#x27;backgroundStatus&#x27;, &#x27;PhÃ´ng ná»n Ä‘Ã£ táº£i lÃªn thÃ nh cÃ´ng!&#x27;, &#x27;success&#x27;);
                        updateDownloadButtons();
                        updateWorkspaceInfo();
                        generateThumbnails();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Handle product upload with improved processing
        document.getElementById(&#x27;productInput&#x27;).addEventListener(&#x27;change&#x27;, function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            showStatus(&#x27;productStatus&#x27;, `Äang xá»­ lÃ½ ${files.length} sáº£n pháº©m vá»›i thuáº­t toÃ¡n xÃ³a ná»n thÃ´ng minh...`, &#x27;success&#x27;);

            let processed = 0;
            files.forEach((file, index) =&gt; {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        // Create canvas for advanced background removal
                        const canvas = document.createElement(&#x27;canvas&#x27;);
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext(&#x27;2d&#x27;);

                        ctx.drawImage(img, 0, 0);
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

                        // Apply advanced background removal
                        const sensitivity = parseInt(document.getElementById(&#x27;sensitivity&#x27;).value);
                        const preserveWhite = document.getElementById(&#x27;preserveWhite&#x27;).checked;
                        const edgeBlur = parseInt(document.getElementById(&#x27;edgeBlur&#x27;).value);

                        advancedBackgroundRemoval(imageData, canvas, sensitivity, preserveWhite, edgeBlur);

                        // Create product object
                        const product = {
                            id: Date.now() + index,
                            name: file.name.replace(/\.[^/.]+$/, &quot;&quot;),
                            originalImage: img,
                            image: img,
                            canvas: canvas,
                            scale: 0.6,
                            x: 0,
                            y: 0,
                            rotation: 0
                        };

                        products.push(product);
                        processed++;

                        if (processed === files.length) {
                            showStatus(&#x27;productStatus&#x27;, `ÄÃ£ xá»­ lÃ½ ${files.length} sáº£n pháº©m vá»›i cÃ´ng nghá»‡ xÃ³a ná»n thÃ´ng minh!`, &#x27;success&#x27;);
                            generateThumbnails();
                            updateDownloadButtons();
                            updateWorkspaceInfo();
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        });

        // Reprocess backgrounds with new settings
        function reprocessBackgrounds() {
            if (products.length === 0) return;

            showStatus(&#x27;productStatus&#x27;, &#x27;Äang xá»­ lÃ½ láº¡i ná»n vá»›i cÃ i Ä‘áº·t má»›i...&#x27;, &#x27;success&#x27;);

            const sensitivity = parseInt(document.getElementById(&#x27;sensitivity&#x27;).value);
            const preserveWhite = document.getElementById(&#x27;preserveWhite&#x27;).checked;
            const edgeBlur = parseInt(document.getElementById(&#x27;edgeBlur&#x27;).value);

            products.forEach(product =&gt; {
                const canvas = document.createElement(&#x27;canvas&#x27;);
                canvas.width = product.originalImage.width;
                canvas.height = product.originalImage.height;
                const ctx = canvas.getContext(&#x27;2d&#x27;);

                ctx.drawImage(product.originalImage, 0, 0);
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

                advancedBackgroundRemoval(imageData, canvas, sensitivity, preserveWhite, edgeBlur);
                product.canvas = canvas;
            });

            generateThumbnails();
            showStatus(&#x27;productStatus&#x27;, &#x27;ÄÃ£ xá»­ lÃ½ láº¡i ná»n thÃ nh cÃ´ng!&#x27;, &#x27;success&#x27;);
        }

        // Generate thumbnails with rotation support
        function generateThumbnails() {
            const grid = document.getElementById(&#x27;thumbnailsGrid&#x27;);
            grid.innerHTML = &#x27;&#x27;;

            products.forEach(product =&gt; {
                const thumbnailDiv = document.createElement(&#x27;div&#x27;);
                thumbnailDiv.className = &#x27;thumbnail-item&#x27;;
                thumbnailDiv.setAttribute(&#x27;data-id&#x27;, product.id);

                // Update selection state
                if (selectedThumbnails.has(product.id)) {
                    thumbnailDiv.classList.add(&#x27;selected&#x27;);
                }

                const canvas = document.createElement(&#x27;canvas&#x27;);
                canvas.width = 200;
                canvas.height = 200;
                canvas.className = &#x27;thumbnail-canvas&#x27;;

                const ctx = canvas.getContext(&#x27;2d&#x27;);

                // Clear canvas with white background
                ctx.fillStyle = &#x27;white&#x27;;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw background if available (fit to square)
                if (backgroundImage) {
                    // Calculate scale to fit square while maintaining aspect ratio
                    const bgScale = Math.min(canvas.width / backgroundImage.width, canvas.height / backgroundImage.height);
                    const bgWidth = backgroundImage.width * bgScale;
                    const bgHeight = backgroundImage.height * bgScale;
                    const bgX = (canvas.width - bgWidth) / 2;
                    const bgY = (canvas.height - bgHeight) / 2;

                    ctx.drawImage(backgroundImage, bgX, bgY, bgWidth, bgHeight);
                }

                // Draw product with rotation
                const productCanvas = product.canvas;
                const scale = product.scale;

                // For Preview (always square 200x200), the ratio is uniform
                const ratio = canvas.width / 1200; 

                const x = product.x * ratio + canvas.width / 2;
                const y = product.y * ratio + canvas.height / 2;
                const rotation = (product.rotation || 0) * Math.PI / 180;

                const scaledWidth = productCanvas.width * scale * ratio;
                const scaledHeight = productCanvas.height * scale * ratio;

                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(rotation);
                ctx.drawImage(
                    productCanvas,
                    -scaledWidth / 2,
                    -scaledHeight / 2,
                    scaledWidth,
                    scaledHeight
                );
                ctx.restore();

                // Create thumbnail info
                const info = document.createElement(&#x27;div&#x27;);
                info.className = &#x27;thumbnail-info&#x27;;
                info.innerHTML = `
                    &lt;span class=&quot;thumbnail-name&quot;&gt;${product.name}&lt;/span&gt;
                    &lt;button class=&quot;delete-btn&quot; onclick=&quot;deleteProduct(${product.id})&quot;&gt;XÃ³a&lt;/button&gt;
                `;

                thumbnailDiv.appendChild(canvas);
                thumbnailDiv.appendChild(info);

                // Add click event for selection/editing
                thumbnailDiv.addEventListener(&#x27;click&#x27;, function(e) {
                    if (e.target.classList.contains(&#x27;delete-btn&#x27;)) return;

                    // If holding Ctrl/Cmd, toggle selection for batch editing
                    if (e.ctrlKey || e.metaKey) {
                        toggleThumbnailSelection(product.id);
                    } else {
                        // Single click - select for individual editing
                        setCurrentEditingProduct(product.id);
                    }
                });

                grid.appendChild(thumbnailDiv);
            });
        }

        // Set current editing product
        function setCurrentEditingProduct(productId) {
            currentEditingProduct = productId;
            const product = products.find(p =&gt; p.id === productId);

            if (product) {
                // Update control values to match current product
                document.getElementById(&#x27;globalScale&#x27;).value = product.scale;
                document.getElementById(&#x27;globalX&#x27;).value = product.x;
                document.getElementById(&#x27;globalY&#x27;).value = product.y;
                document.getElementById(&#x27;rotation&#x27;).value = product.rotation || 0;
                document.getElementById(&#x27;globalScaleValue&#x27;).textContent = product.scale + &#x27;x&#x27;;
                document.getElementById(&#x27;rotationValue&#x27;).textContent = (product.rotation || 0) + &#x27;Â°&#x27;;

                // Update current editing display
                document.getElementById(&#x27;currentEditing&#x27;).style.display = &#x27;block&#x27;;
                document.getElementById(&#x27;currentProductName&#x27;).textContent = product.name;

                // Clear batch selection when editing individual product
                selectedThumbnails.clear();
                updateSelectedInfo();
                updateDownloadButtons();

                // Remove all selection highlights and add editing highlight
                document.querySelectorAll(&#x27;.thumbnail-item&#x27;).forEach(item =&gt; {
                    item.classList.remove(&#x27;selected&#x27;);
                    if (item.getAttribute(&#x27;data-id&#x27;) == productId) {
                        item.style.border = &#x27;3px solid #ffc107&#x27;;
                    } else {
                        item.style.border = &#x27;3px solid transparent&#x27;;
                    }
                });
            }
        }

        // Toggle thumbnail selection for batch editing
        function toggleThumbnailSelection(productId) {
            // Clear individual editing mode
            currentEditingProduct = null;
            document.getElementById(&#x27;currentEditing&#x27;).style.display = &#x27;none&#x27;;
            document.querySelectorAll(&#x27;.thumbnail-item&#x27;).forEach(item =&gt; {
                item.style.border = &#x27;3px solid transparent&#x27;;
            });

            const thumbnailDiv = document.querySelector(`[data-id=&quot;${productId}&quot;]`);

            if (selectedThumbnails.has(productId)) {
                selectedThumbnails.delete(productId);
                thumbnailDiv.classList.remove(&#x27;selected&#x27;);
            } else {
                selectedThumbnails.add(productId);
                thumbnailDiv.classList.add(&#x27;selected&#x27;);
            }

            updateSelectedInfo();
            updateDownloadButtons();
        }

        // Select all thumbnails
        function selectAllThumbnails() {
            currentEditingProduct = null;
            document.getElementById(&#x27;currentEditing&#x27;).style.display = &#x27;none&#x27;;
            document.querySelectorAll(&#x27;.thumbnail-item&#x27;).forEach(item =&gt; {
                item.style.border = &#x27;3px solid transparent&#x27;;
            });

            products.forEach(product =&gt; {
                selectedThumbnails.add(product.id);
                const thumbnailDiv = document.querySelector(`[data-id=&quot;${product.id}&quot;]`);
                thumbnailDiv.classList.add(&#x27;selected&#x27;);
            });
            updateSelectedInfo();
            updateDownloadButtons();
        }

        // Deselect all thumbnails
        function deselectAllThumbnails() {
            currentEditingProduct = null;
            document.getElementById(&#x27;currentEditing&#x27;).style.display = &#x27;none&#x27;;

            selectedThumbnails.clear();
            document.querySelectorAll(&#x27;.thumbnail-item&#x27;).forEach(item =&gt; {
                item.classList.remove(&#x27;selected&#x27;);
                item.style.border = &#x27;3px solid transparent&#x27;;
            });
            updateSelectedInfo();
            updateDownloadButtons();
        }

        // Update selected info
        function updateSelectedInfo() {
            const selectedInfo = document.getElementById(&#x27;selectedInfo&#x27;);
            const selectedCount = document.getElementById(&#x27;selectedCount&#x27;);

            if (selectedThumbnails.size &gt; 0) {
                selectedInfo.style.display = &#x27;block&#x27;;
                selectedCount.textContent = selectedThumbnails.size;
            } else {
                selectedInfo.style.display = &#x27;none&#x27;;
            }
        }

        // Delete product
        function deleteProduct(productId) {
            products = products.filter(p =&gt; p.id !== productId);
            selectedThumbnails.delete(productId);
            if (currentEditingProduct === productId) {
                currentEditingProduct = null;
                document.getElementById(&#x27;currentEditing&#x27;).style.display = &#x27;none&#x27;;
            }
            generateThumbnails();
            updateSelectedInfo();
            updateDownloadButtons();
            updateWorkspaceInfo();
        }

        // Apply changes with rotation support
        function applyChanges() {
            const scale = parseFloat(document.getElementById(&#x27;globalScale&#x27;).value);
            const x = parseInt(document.getElementById(&#x27;globalX&#x27;).value) || 0;
            const y = parseInt(document.getElementById(&#x27;globalY&#x27;).value) || 0;
            const rotation = parseInt(document.getElementById(&#x27;rotation&#x27;).value) || 0;

            let targetProducts = [];

            // If editing individual product
            if (currentEditingProduct) {
                targetProducts = products.filter(p =&gt; p.id === currentEditingProduct);
            }
            // If batch editing selected products
            else if (selectedThumbnails.size &gt; 0) {
                targetProducts = products.filter(p =&gt; selectedThumbnails.has(p.id));
            }
            // If nothing selected, apply to all
            else {
                targetProducts = products;
            }

            targetProducts.forEach(product =&gt; {
                product.scale = scale;
                product.x = x;
                product.y = y;
                product.rotation = rotation;
            });

            generateThumbnails();
        }

        // Center products
        function centerProducts() {
            let targetProducts = [];

            // If editing individual product
            if (currentEditingProduct) {
                targetProducts = products.filter(p =&gt; p.id === currentEditingProduct);
            }
            // If batch editing selected products
            else if (selectedThumbnails.size &gt; 0) {
                targetProducts = products.filter(p =&gt; selectedThumbnails.has(p.id));
            }
            // If nothing selected, apply to all
            else {
                targetProducts = products;
            }

            targetProducts.forEach(product =&gt; {
                product.x = 0;
                product.y = 0;
            });

            document.getElementById(&#x27;globalX&#x27;).value = 0;
            document.getElementById(&#x27;globalY&#x27;).value = 0;

            generateThumbnails();
        }

        // Reset positions
        function resetPositions() {
            let targetProducts = [];

            // If editing individual product
            if (currentEditingProduct) {
                targetProducts = products.filter(p =&gt; p.id === currentEditingProduct);
            }
            // If batch editing selected products
            else if (selectedThumbnails.size &gt; 0) {
                targetProducts = products.filter(p =&gt; selectedThumbnails.has(p.id));
            }
            // If nothing selected, apply to all
            else {
                targetProducts = products;
            }

            targetProducts.forEach(product =&gt; {
                product.scale = 0.6;
                product.x = 0;
                product.y = 0;
                product.rotation = 0;
            });

            document.getElementById(&#x27;globalScale&#x27;).value = 0.6;
            document.getElementById(&#x27;globalX&#x27;).value = 0;
            document.getElementById(&#x27;globalY&#x27;).value = 0;
            document.getElementById(&#x27;rotation&#x27;).value = 0;
            document.getElementById(&#x27;globalScaleValue&#x27;).textContent = &#x27;0.6x&#x27;;
            document.getElementById(&#x27;rotationValue&#x27;).textContent = &#x27;0Â°&#x27;;

            generateThumbnails();
        }

        // Update value displays
        document.getElementById(&#x27;globalScale&#x27;).addEventListener(&#x27;input&#x27;, function() {
            document.getElementById(&#x27;globalScaleValue&#x27;).textContent = this.value + &#x27;x&#x27;;
        });

        document.getElementById(&#x27;rotation&#x27;).addEventListener(&#x27;input&#x27;, function() {
            document.getElementById(&#x27;rotationValue&#x27;).textContent = this.value + &#x27;Â°&#x27;;
        });

        document.getElementById(&#x27;sensitivity&#x27;).addEventListener(&#x27;input&#x27;, function() {
            document.getElementById(&#x27;sensitivityValue&#x27;).textContent = this.value;
        });

        document.getElementById(&#x27;edgeBlur&#x27;).addEventListener(&#x27;input&#x27;, function() {
            document.getElementById(&#x27;edgeBlurValue&#x27;).textContent = this.value + &#x27;px&#x27;;
        });

        // Download selected thumbnails
        function downloadSelected() {
            if (selectedThumbnails.size === 0) return;

            const selectedProducts = products.filter(p =&gt; selectedThumbnails.has(p.id));

            if (selectedProducts.length === 1) {
                // Download single file
                downloadSingleThumbnail(selectedProducts[0]);
            } else {
                // Download multiple files
                downloadMultipleThumbnails(selectedProducts);
            }
        }

        // Download all thumbnails
        function downloadAll() {
            if (products.length === 0) return;

            if (products.length === 1) {
                downloadSingleThumbnail(products[0]);
            } else {
                downloadMultipleThumbnails(products);
            }
        }

        // Get selected thumbnail size
        function getSelectedThumbnailSize() {
            const sizeSelect = document.getElementById(&#x27;thumbnailSize&#x27;);
            const [width, height] = sizeSelect.value.split(&#x27;x&#x27;).map(Number);
            return { width, height };
        }

        // Download single thumbnail with rotation support
        function downloadSingleThumbnail(product) {
            const canvas = document.createElement(&#x27;canvas&#x27;);
            const size = getSelectedThumbnailSize();
            canvas.width = size.width;
            canvas.height = size.height;
            const ctx = canvas.getContext(&#x27;2d&#x27;);

            // Draw background
            if (backgroundImage) {
                // Scale background to fit canvas while maintaining aspect ratio
                const bgScale = Math.min(canvas.width / backgroundImage.width, canvas.height / backgroundImage.height);
                const bgWidth = backgroundImage.width * bgScale;
                const bgHeight = backgroundImage.height * bgScale;
                const bgX = (canvas.width - bgWidth) / 2;
                const bgY = (canvas.height - bgHeight) / 2;

                // Fill canvas with white first
                ctx.fillStyle = &#x27;white&#x27;;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.drawImage(backgroundImage, bgX, bgY, bgWidth, bgHeight);
            }

            // Draw product with rotation
            const productCanvas = product.canvas;
            const scale = product.scale;

            // Use uniform ratio based on the smallest dimension to preserve aspect ratio
            // This fixes the stretching issue on non-square canvases
            const ratio = Math.min(canvas.width / 1200, canvas.height / 1200);

            // Position still uses relative coordinates to place item correctly
            const x = (product.x * (canvas.width / 1200)) + canvas.width / 2;
            const y = (product.y * (canvas.height / 1200)) + canvas.height / 2;
            const rotation = (product.rotation || 0) * Math.PI / 180;

            // Size uses uniform ratio
            const scaledWidth = productCanvas.width * scale * ratio;
            const scaledHeight = productCanvas.height * scale * ratio;

            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.drawImage(
                productCanvas,
                -scaledWidth / 2,
                -scaledHeight / 2,
                scaledWidth,
                scaledHeight
            );
            ctx.restore();

            // Download
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement(&#x27;a&#x27;);
                a.href = url;
                a.download = `${product.name}_thumbnail.png`;
                a.click();
                URL.revokeObjectURL(url);
            }, &#x27;image/png&#x27;);
        }

        // Download multiple thumbnails
        function downloadMultipleThumbnails(targetProducts) {
            const progressBar = document.getElementById(&#x27;progressBar&#x27;);
            const progressFill = document.getElementById(&#x27;progressFill&#x27;);

            progressBar.style.display = &#x27;block&#x27;;
            progressFill.style.width = &#x27;0%&#x27;;

            let processed = 0;
            const size = getSelectedThumbnailSize();

            targetProducts.forEach((product, index) =&gt; {
                setTimeout(() =&gt; {
                    const canvas = document.createElement(&#x27;canvas&#x27;);
                    canvas.width = size.width;
                    canvas.height = size.height;
                    const ctx = canvas.getContext(&#x27;2d&#x27;);

                    // Draw background
                    if (backgroundImage) {
                        // Scale background to fit canvas while maintaining aspect ratio
                        const bgScale = Math.min(canvas.width / backgroundImage.width, canvas.height / backgroundImage.height);
                        const bgWidth = backgroundImage.width * bgScale;
                        const bgHeight = backgroundImage.height * bgScale;
                        const bgX = (canvas.width - bgWidth) / 2;
                        const bgY = (canvas.height - bgHeight) / 2;

                        // Fill canvas with white first
                        ctx.fillStyle = &#x27;white&#x27;;
                        ctx.fillRect(0, 0, canvas.width, canvas.height);

                        ctx.drawImage(backgroundImage, bgX, bgY, bgWidth, bgHeight);
                    }

                    // Draw product with rotation
                    const productCanvas = product.canvas;
                    const scale = product.scale;

                    // Use uniform ratio for size to fix stretching
                    const ratio = Math.min(canvas.width / 1200, canvas.height / 1200);

                    const x = (product.x * (canvas.width / 1200)) + canvas.width / 2;
                    const y = (product.y * (canvas.height / 1200)) + canvas.height / 2;
                    const rotation = (product.rotation || 0) * Math.PI / 180;

                    // Size uses uniform ratio
                    const scaledWidth = productCanvas.width * scale * ratio;
                    const scaledHeight = productCanvas.height * scale * ratio;

                    ctx.save();
                    ctx.translate(x, y);
                    ctx.rotate(rotation);
                    ctx.drawImage(
                        productCanvas,
                        -scaledWidth / 2,
                        -scaledHeight / 2,
                        scaledWidth,
                        scaledHeight
                    );
                    ctx.restore();

                    // Download
                    canvas.toBlob(function(blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement(&#x27;a&#x27;);
                        a.href = url;
                        a.download = `${product.name}_thumbnail.png`;
                        a.click();
                        URL.revokeObjectURL(url);

                        processed++;
                        const progress = (processed / targetProducts.length) * 100;
                        progressFill.style.width = progress + &#x27;%&#x27;;

                        if (processed === targetProducts.length) {
                            setTimeout(() =&gt; {
                                progressBar.style.display = &#x27;none&#x27;;
                            }, 1000);
                        }
                    }, &#x27;image/png&#x27;);
                }, index * 100); // Delay each download by 100ms
            });
        }

        // Show status message
        function showStatus(elementId, message, type) {
            const statusEl = document.getElementById(elementId);
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = &#x27;block&#x27;;

            if (type === &#x27;success&#x27;) {
                setTimeout(() =&gt; {
                    statusEl.style.display = &#x27;none&#x27;;
                }, 3000);
            }
        }

        // Update download buttons
        function updateDownloadButtons() {
            const downloadSelected = document.getElementById(&#x27;downloadSelected&#x27;);
            const downloadAll = document.getElementById(&#x27;downloadAll&#x27;);

            downloadSelected.disabled = selectedThumbnails.size === 0 || !backgroundImage;
            downloadAll.disabled = products.length === 0 || !backgroundImage;
        }

        // Update workspace info
        function updateWorkspaceInfo() {
            const info = document.getElementById(&#x27;workspaceInfo&#x27;);
            if (products.length === 0) {
                info.textContent = &#x27;Táº£i lÃªn phÃ´ng ná»n vÃ  sáº£n pháº©m Ä‘á»ƒ báº¯t Ä‘áº§u táº¡o thumbnail&#x27;;
            } else {
                info.textContent = `Workspace: ${products.length} sáº£n pháº©m Ä‘Ã£ táº£i lÃªn${backgroundImage ? &#x27; | PhÃ´ng ná»n: ÄÃ£ sáºµn sÃ ng&#x27; : &#x27; | Cáº§n táº£i phÃ´ng ná»n&#x27;}`;
            }
        }

        // Initialize
        updateDownloadButtons();
        updateWorkspaceInfo();
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
"></iframe>
<iframe id="file6" class="file-frame" srcdoc="&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;vi&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Dashboard PhÃ¢n TÃ­ch Metrics ThÆ°Æ¡ng Máº¡i Äiá»‡n Tá»­ - Enhanced&lt;/title&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;&gt;
    &lt;link href=&quot;https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;
    &lt;style&gt;
        :root {
            /* Y2K Gradient Schemes */
            --gradient-primary: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            --gradient-secondary: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            --gradient-tertiary: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            --gradient-success: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            --gradient-warning: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            --gradient-info: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            --gradient-danger: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            
            /* Y2K Pastel Colors */
            --pastel-lavender: #e8e4ff;
            --pastel-mint: #e0fff4;
            --pastel-peach: #ffe8f0;
            --pastel-sky: #e6f3ff;
            --pastel-cream: #fff8e7;
            --pastel-rose: #ffebf0;
            --pastel-purple: #f0ebff;
            --pastel-cyan: #e0ffff;
            
            /* Text Colors */
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --text-light: #74b9ff;
        }

        * {
            font-family: &#x27;Inter&#x27;, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #6c5ce7 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 12px 40px rgba(116, 185, 255, 0.2);
        }

        .glass-card-secondary {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 30px rgba(116, 185, 255, 0.15);
        }

        .gradient-text {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-gradient {
            background: var(--gradient-primary);
            transition: all 0.4s ease;
            transform: translateY(0);
            border: none;
        }

        .btn-gradient:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 107, 157, 0.4);
        }

        .btn-secondary {
            background: var(--gradient-secondary);
        }

        .btn-secondary:hover {
            box-shadow: 0 15px 35px rgba(116, 185, 255, 0.4);
        }

        .btn-tertiary {
            background: var(--gradient-tertiary);
        }

        .btn-tertiary:hover {
            box-shadow: 0 15px 35px rgba(253, 121, 168, 0.4);
        }

        .btn-success {
            background: var(--gradient-success);
        }

        .btn-success:hover {
            box-shadow: 0 15px 35px rgba(0, 184, 148, 0.4);
        }

        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .upload-area {
            background: var(--pastel-lavender);
            border: 3px dashed rgba(116, 185, 255, 0.4);
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: var(--pastel-mint);
            border-color: rgba(0, 184, 148, 0.6);
            transform: translateY(-2px);
        }

        .metric-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
        }

        .metric-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(116, 185, 255, 0.2);
        }

        .status-badge {
            background: var(--gradient-success);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(0, 184, 148, 0.3);
        }

        .data-type-badge {
            background: var(--gradient-info);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(162, 155, 254, 0.3);
            transition: all 0.3s ease;
        }

        .data-type-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(162, 155, 254, 0.4);
        }

        .modal-overlay {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.3);
        }

        .input-field {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid transparent;
            border-radius: 20px;
            padding: 16px 24px;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 25px rgba(116, 185, 255, 0.1);
            color: var(--text-primary);
        }

        .input-field:focus {
            border-color: rgba(116, 185, 255, 0.5);
            box-shadow: 0 10px 35px rgba(116, 185, 255, 0.2);
            outline: none;
        }

        .section-header {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .icon-wrapper {
            background: var(--gradient-primary);
            width: 56px;
            height: 56px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 16px;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
        }

        .text-readable {
            color: var(--text-primary) !important;
            font-weight: 500;
        }

        .text-secondary-readable {
            color: var(--text-secondary) !important;
        }

        /* Enhanced Comparison Badges */
        .comparison-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            animation: pulse 2s infinite;
        }

        .comparison-positive {
            background: linear-gradient(135deg, #10b981, #059669);
            border: 1px solid #065f46;
        }

        .comparison-negative {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: 1px solid #991b1b;
        }

        .comparison-neutral {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: 1px solid #92400e;
        }

        .comparison-badge i {
            font-size: 10px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Performance Highlight Styles */
        .performance-bad {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border-left: 5px solid #dc3545;
        }

        .highlight-section {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(116, 185, 255, 0.1));
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 107, 157, 0.2);
        }

        .floating-animation {
            animation: floating 6s ease-in-out infinite;
        }

        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .slide-in {
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .insights-table {
            border-collapse: collapse;
            width: 100%;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .insights-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .insights-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            vertical-align: top;
        }

        .insights-table tr:hover {
            background: rgba(116, 185, 255, 0.05);
        }

        .metric-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .pivot-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            font-weight: 600;
            text-align: left;
            font-size: 14px;
        }
        
        /* GMV Run Rate Card Styling */
        .runrate-card {
            background: linear-gradient(135deg, #f0e6ff 0%, #e8e0ff 100%);
            border: 2px solid #b8a9ff;
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 8px 30px rgba(108, 92, 231, 0.2);
            text-align: center;
        }
        
        .runrate-formula {
            font-family: &#x27;Inter&#x27;, sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: #6c5ce7;
            margin-bottom: 16px;
        }
        
        .runrate-metric {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            border: 1px solid #dcdbff;
            transition: all 0.3s ease;
            cursor: default;
        }
        
        .runrate-metric:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.1);
        }
        
        .metric-value-lg {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .metric-label-sm {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6c5ce7;
            text-transform: uppercase;
        }

        /* Styling for the Pre element to ensure long content is fully visible */
        #insightsContent {
            overflow-x: auto; /* Allow horizontal scrolling if text is too wide */
            max-height: 500px; /* Set a max height */
            overflow-y: auto; /* Allow vertical scrolling if text is too long */
            padding: 15px;
            border: 1px solid #e5e7eb;
            background-color: #f9fafb;
            border-radius: 10px;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class=&quot;min-h-screen p-4 md:p-8&quot;&gt;
        &lt;div class=&quot;max-w-7xl mx-auto&quot;&gt;
            &lt;div class=&quot;text-center mb-12 floating-animation&quot;&gt;
                &lt;h1 class=&quot;text-4xl md:text-6xl font-bold gradient-text mb-4&quot;&gt;
                    Dashboard Analytics Enhanced
                &lt;/h1&gt;
                &lt;p class=&quot;text-white/90 text-lg md:text-xl font-medium&quot;&gt;
                    PhÃ¢n tÃ­ch thÃ´ng minh vá»›i MOM Comparison &amp; Performance Tracking
                &lt;/p&gt;
            &lt;/div&gt;

            &lt;!-- GMV RUN RATE OVERVIEW SECTION --&gt;
            &lt;div id=&quot;runRateOverview&quot; class=&quot;runrate-card slide-in&quot; style=&quot;display: none;&quot;&gt;
                &lt;div class=&quot;flex items-center justify-center mb-4&quot;&gt;
                    &lt;i class=&quot;fas fa-rocket text-3xl mr-3 text-pink-600&quot;&gt;&lt;/i&gt;
                    &lt;h2 class=&quot;text-2xl font-bold text-pink-600&quot;&gt;GMV Run Rate Overview (Dá»¯ liá»‡u Today)&lt;/h2&gt;
                &lt;/div&gt;
                
                &lt;div class=&quot;runrate-formula&quot;&gt;
                    GMV Run Rate = CR% x TRAFFIC x AOV
                &lt;/div&gt;

                &lt;div class=&quot;grid grid-cols-2 md:grid-cols-4 gap-4&quot; id=&quot;runRateMetricsContainer&quot;&gt;
                    &lt;!-- Metrics will be injected here by JS --&gt;
                &lt;/div&gt;
                &lt;p class=&quot;mt-4 text-sm font-medium text-gray-600&quot;&gt;
                    *CÃ¡c chá»‰ sá»‘ Ä‘Æ°á»£c tÃ­nh toÃ¡n tá»« dá»¯ liá»‡u &#x27;Today&#x27; Ä‘á»ƒ Æ°á»›c tÃ­nh Run Rate Performance.
                &lt;/p&gt;
            &lt;/div&gt;
            &lt;!-- END GMV RUN RATE OVERVIEW SECTION --&gt;

            &lt;div class=&quot;glass-card p-8 mb-8 slide-in&quot;&gt;
                &lt;div class=&quot;icon-wrapper&quot;&gt;
                    &lt;i class=&quot;fas fa-brain text-xl&quot;&gt;&lt;/i&gt;
                &lt;/div&gt;
                &lt;h2 class=&quot;section-header&quot;&gt;Cáº¥u hÃ¬nh Gemini AI&lt;/h2&gt;
                &lt;input
                    type=&quot;password&quot;
                    id=&quot;geminiApiKey&quot;
                    placeholder=&quot;Nháº­p Gemini API Key Ä‘á»ƒ kÃ­ch hoáº¡t AI insights...&quot;
                    class=&quot;w-full input-field&quot;
                /&gt;
                &lt;div id=&quot;apiKeyStatus&quot; class=&quot;mt-4&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;

            &lt;div class=&quot;glass-card p-8 mb-8 slide-in&quot;&gt;
                &lt;div class=&quot;icon-wrapper&quot;&gt;
                    &lt;i class=&quot;fas fa-cloud-upload-alt text-xl&quot;&gt;&lt;/i&gt;
                &lt;/div&gt;
                &lt;h2 class=&quot;section-header&quot;&gt;Upload Dá»¯ Liá»‡u Excel&lt;/h2&gt;
                
                &lt;div class=&quot;mb-8 p-6 glass-card-secondary&quot;&gt;
                    &lt;h3 class=&quot;text-lg font-semibold text-readable mb-4&quot;&gt;
                        &lt;i class=&quot;fas fa-download mr-2&quot;&gt;&lt;/i&gt;
                        Táº£i File Excel Máº«u
                    &lt;/h3&gt;
                    &lt;p class=&quot;text-secondary-readable text-sm mb-4&quot;&gt;
                        File máº«u bao gá»“m dÃ²ng Target vÃ  dá»¯ liá»‡u so sÃ¡nh MOM
                    &lt;/p&gt;
                    &lt;div class=&quot;flex flex-wrap gap-3&quot;&gt;
                        &lt;button onclick=&quot;generateSampleFile(&#x27;BAU&#x27;)&quot; class=&quot;btn-gradient text-white px-6 py-3 rounded-full font-semibold shadow-lg&quot;&gt;
                            &lt;i class=&quot;fas fa-download mr-2&quot;&gt;&lt;/i&gt;
                            Máº«u BAU
                        &lt;/button&gt;
                        &lt;button onclick=&quot;generateSampleFile(&#x27;Double day&#x27;)&quot; class=&quot;btn-secondary text-white px-6 py-3 rounded-full font-semibold shadow-lg&quot;&gt;
                            &lt;i class=&quot;fas fa-download mr-2&quot;&gt;&lt;/i&gt;
                            Máº«u Double day
                        &lt;/button&gt;
                        &lt;button onclick=&quot;generateSampleFile(&#x27;15th, 25th&#x27;)&quot; class=&quot;btn-tertiary text-white px-6 py-3 rounded-full font-semibold shadow-lg&quot;&gt;
                            &lt;i class=&quot;fas fa-download mr-2&quot;&gt;&lt;/i&gt;
                            Máº«u 15th, 25th
                        &lt;/button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;

                &lt;div class=&quot;grid grid-cols-1 md:grid-cols-3 gap-6&quot;&gt;
                    &lt;div class=&quot;upload-area rounded-2xl p-8 text-center&quot;&gt;
                        &lt;i class=&quot;fas fa-calendar-day text-4xl text-purple-600 mb-4&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-readable mb-2&quot;&gt;BAU Days&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-secondary-readable mb-4&quot;&gt;Business as usual&lt;/p&gt;
                        &lt;label class=&quot;cursor-pointer&quot;&gt;
                            &lt;input type=&quot;file&quot; accept=&quot;.xlsx,.xls&quot; onchange=&quot;handleFileUpload(event, &#x27;BAU&#x27;)&quot; class=&quot;hidden&quot;&gt;
                            &lt;span class=&quot;btn-gradient text-white px-4 py-2 rounded-full text-sm font-semibold&quot;&gt;
                                Chá»n file
                            &lt;/span&gt;
                        &lt;/label&gt;
                        &lt;div id=&quot;status-BAU&quot; class=&quot;mt-4&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;div class=&quot;upload-area rounded-2xl p-8 text-center&quot;&gt;
                        &lt;i class=&quot;fas fa-fire text-4xl text-red-500 mb-4&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-readable mb-2&quot;&gt;Double Days&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-secondary-readable mb-4&quot;&gt;Peak performance days&lt;/p&gt;
                        &lt;label class=&quot;cursor-pointer&quot;&gt;
                            &lt;input type=&quot;file&quot; accept=&quot;.xlsx,.xls&quot; onchange=&quot;handleFileUpload(event, &#x27;Double day&#x27;)&quot; class=&quot;hidden&quot;&gt;
                            &lt;span class=&quot;btn-secondary text-white px-4 py-2 rounded-full text-sm font-semibold&quot;&gt;
                                Chá»n file
                            &lt;/span&gt;
                        &lt;/label&gt;
                        &lt;div id=&quot;status-Double day&quot; class=&quot;mt-4&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;div class=&quot;upload-area rounded-2xl p-8 text-center&quot;&gt;
                        &lt;i class=&quot;fas fa-star text-4xl text-yellow-500 mb-4&quot;&gt;&lt;/i&gt;
                        &lt;h3 class=&quot;font-semibold text-readable mb-2&quot;&gt;Special Days&lt;/h3&gt;
                        &lt;p class=&quot;text-sm text-secondary-readable mb-4&quot;&gt;15th &amp; 25th monthly&lt;/p&gt;
                        &lt;label class=&quot;cursor-pointer&quot;&gt;
                            &lt;input type=&quot;file&quot; accept=&quot;.xlsx,.xls&quot; onchange=&quot;handleFileUpload(event, &#x27;15th, 25th&#x27;)&quot; class=&quot;hidden&quot;&gt;
                            &lt;span class=&quot;btn-tertiary text-white px-4 py-2 rounded-full text-sm font-semibold&quot;&gt;
                                Chá»n file
                            &lt;/span&gt;
                        &lt;/label&gt;
                        &lt;div id=&quot;status-15th, 25th&quot; class=&quot;mt-4&quot;&gt;&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div id=&quot;dataTypeSelection&quot; class=&quot;glass-card p-8 mb-8 slide-in&quot; style=&quot;display: none;&quot;&gt;
                &lt;div class=&quot;icon-wrapper&quot;&gt;
                    &lt;i class=&quot;fas fa-filter text-xl&quot;&gt;&lt;/i&gt;
                &lt;/div&gt;
                &lt;h2 class=&quot;section-header&quot;&gt;Chá»n Loáº¡i Dá»¯ Liá»‡u Hiá»ƒn Thá»‹&lt;/h2&gt;
                &lt;div class=&quot;flex flex-wrap gap-4&quot; id=&quot;dataTypeCheckboxes&quot;&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;!-- Performance Highlights Section --&gt;
            &lt;div id=&quot;performanceHighlights&quot; class=&quot;glass-card p-8 mb-8 slide-in&quot; style=&quot;display: none;&quot;&gt;
                &lt;div class=&quot;icon-wrapper&quot;&gt;
                    &lt;i class=&quot;fas fa-exclamation-triangle text-xl&quot;&gt;&lt;/i&gt;
                &lt;/div&gt;
                &lt;h2 class=&quot;section-header&quot;&gt;Performance Highlights&lt;/h2&gt;
                &lt;div class=&quot;highlight-section&quot;&gt;
                    &lt;h3 class=&quot;text-lg font-semibold text-readable mb-4&quot;&gt;
                        &lt;i class=&quot;fas fa-trending-down mr-2 text-red-500&quot;&gt;&lt;/i&gt;
                        Metrics Cáº§n Cáº£i Thiá»‡n (So vá»›i MOM)
                    &lt;/h3&gt;
                    &lt;div id=&quot;badPerformanceMetrics&quot; class=&quot;grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4&quot;&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div id=&quot;actionButtons&quot; class=&quot;glass-card p-8 mb-8 slide-in&quot; style=&quot;display: none;&quot;&gt;
                &lt;div class=&quot;icon-wrapper&quot;&gt;
                    &lt;i class=&quot;fas fa-magic text-xl&quot;&gt;&lt;/i&gt;
                &lt;/div&gt;
                &lt;h2 class=&quot;section-header&quot;&gt;PhÃ¢n TÃ­ch Dá»¯ Liá»‡u&lt;/h2&gt;
                &lt;div class=&quot;flex flex-wrap gap-4&quot;&gt;
                    &lt;button onclick=&quot;generateInsights()&quot; class=&quot;btn-gradient text-white px-8 py-4 rounded-2xl font-semibold shadow-2xl&quot;&gt;
                        &lt;i class=&quot;fas fa-brain mr-3&quot;&gt;&lt;/i&gt;
                        &lt;span id=&quot;insightButtonText&quot;&gt;Táº¡o AI Insights&lt;/span&gt;
                    &lt;/button&gt;
                    &lt;button onclick=&quot;exportToExcel()&quot; class=&quot;btn-tertiary text-white px-8 py-4 rounded-2xl font-semibold shadow-2xl&quot;&gt;
                        &lt;i class=&quot;fas fa-download mr-3&quot;&gt;&lt;/i&gt;
                        Xuáº¥t Excel Report
                    &lt;/button&gt;
                &lt;/div&gt;
                &lt;div id=&quot;insightStatus&quot; class=&quot;mt-4&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;

            &lt;div id=&quot;pivotTableSection&quot; class=&quot;glass-card p-8 mb-8 slide-in&quot; style=&quot;display: none;&quot;&gt;
                &lt;div class=&quot;icon-wrapper&quot;&gt;
                    &lt;i class=&quot;fas fa-table text-xl&quot;&gt;&lt;/i&gt;
                &lt;/div&gt;
                &lt;h2 class=&quot;section-header&quot;&gt;Báº£ng Pivot Metrics vá»›i MOM Comparison&lt;/h2&gt;
                &lt;div class=&quot;overflow-x-auto rounded-2xl&quot;&gt;
                    &lt;table id=&quot;pivotTable&quot; class=&quot;min-w-full pivot-table&quot;&gt;
                    &lt;/table&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div id=&quot;insightsSection&quot; class=&quot;glass-card p-8 mb-8 slide-in&quot; style=&quot;display: none;&quot;&gt;
                &lt;div class=&quot;icon-wrapper&quot;&gt;
                    &lt;i class=&quot;fas fa-lightbulb text-xl&quot;&gt;&lt;/i&gt;
                &lt;/div&gt;
                &lt;h2 class=&quot;section-header&quot;&gt;AI Insights &amp; PhÃ¢n TÃ­ch Structured&lt;/h2&gt;
                &lt;div id=&quot;insightsTableContainer&quot; class=&quot;mb-6&quot;&gt;
                    &lt;table id=&quot;insightsTable&quot; class=&quot;insights-table&quot;&gt;
                        &lt;thead&gt;
                            &lt;tr&gt;
                                &lt;th width=&quot;20%&quot;&gt;Metrics&lt;/th&gt;
                                &lt;th width=&quot;40%&quot;&gt;Highlight&lt;/th&gt;
                                &lt;th width=&quot;40%&quot;&gt;Action Äá» Xuáº¥t&lt;/th&gt;
                            &lt;/tr&gt;
                        &lt;/thead&gt;
                        &lt;tbody id=&quot;insightsTableBody&quot;&gt;
                        &lt;/tbody&gt;
                    &lt;/table&gt;
                &lt;/div&gt;
                &lt;div class=&quot;glass-card-secondary rounded-2xl p-6&quot;&gt;
                    &lt;h3 class=&quot;font-semibold text-readable mb-3&quot;&gt;
                        &lt;i class=&quot;fas fa-robot mr-2&quot;&gt;&lt;/i&gt;
                        AI Analysis Details
                    &lt;/h3&gt;
                    &lt;!-- Added max-height and overflow properties to ensure long content is scrollable --&gt;
                    &lt;pre id=&quot;insightsContent&quot; class=&quot;whitespace-pre-wrap text-readable font-medium leading-relaxed text-sm&quot;&gt;&lt;/pre&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div class=&quot;copyright&quot;&gt;
                &lt;p class=&quot;copyright-text&quot;&gt;
                    Â© 2025 Created with â¤ï¸ by 
                    &lt;a href=&quot;#&quot; class=&quot;copyright-link&quot;&gt;Tien Hoang&lt;/a&gt;
                    | Enhanced Dashboard Analytics System with MOM Comparison
                &lt;/p&gt;
            &lt;/div&gt;

            &lt;!-- Enhanced Chart Modal --&gt;
            &lt;div id=&quot;chartModal&quot; class=&quot;fixed inset-0 modal-overlay flex items-center justify-center z-50&quot; style=&quot;display: none;&quot;&gt;
                &lt;div class=&quot;glass-card p-8 max-w-6xl max-h-[90vh] overflow-y-auto m-4 w-full&quot;&gt;
                    &lt;div class=&quot;flex justify-between items-center mb-6&quot;&gt;
                        &lt;h3 class=&quot;section-header text-2xl&quot;&gt;
                            &lt;i class=&quot;fas fa-chart-bar mr-3&quot;&gt;&lt;/i&gt;
                            &lt;span id=&quot;chartTitle&quot;&gt;Biá»ƒu Ä‘á»“ PhÃ¢n tÃ­ch Metrics&lt;/span&gt;
                        &lt;/h3&gt;
                        &lt;button onclick=&quot;closeChartModal()&quot; class=&quot;text-gray-600 hover:text-gray-800 text-2xl&quot;&gt;
                            &lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;
                        &lt;/button&gt;
                    &lt;/div&gt;
                    &lt;div id=&quot;chartContainer&quot; class=&quot;chart-container&quot;&gt;
                        &lt;canvas id=&quot;mainChart&quot;&gt;&lt;/canvas&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
        // Global variables
        let uploadedData = {};
        let selectedDataTypes = [];
        let pivotData = null;
        let targetData = {};
        let compareData = {};
        let chartInstance = null;

        // Enhanced metrics configuration vá»›i phÃ¢n loáº¡i theo nhÃ³m
        const metricsConfig = {
            // Performance metrics
            &#x27;Ad cost&#x27;: { type: &#x27;input&#x27;, unit: &#x27;VND&#x27;, category: &#x27;Performance&#x27;, goodDirection: &#x27;lower&#x27; },
            &#x27;Ad CIR&#x27;: { 
                type: &#x27;calculated&#x27;, 
                formula: (data) =&gt; (data[&#x27;Ad cost&#x27;] || 0) / (data[&#x27;Ad GMV&#x27;] || 1) * 100,
                unit: &#x27;%&#x27;,
                category: &#x27;Performance&#x27;,
                goodDirection: &#x27;lower&#x27;
            },
            &#x27;CPC Paid Ad&#x27;: { type: &#x27;input&#x27;, unit: &#x27;VND&#x27;, category: &#x27;Performance&#x27;, goodDirection: &#x27;lower&#x27; },
            
            // Doanh thu metrics
            &#x27;Total GMV&#x27;: { type: &#x27;input&#x27;, unit: &#x27;VND&#x27;, category: &#x27;Doanh thu&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;Ad GMV&#x27;: { type: &#x27;input&#x27;, unit: &#x27;VND&#x27;, category: &#x27;Doanh thu&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;Live GMV&#x27;: { type: &#x27;input&#x27;, unit: &#x27;VND&#x27;, category: &#x27;Doanh thu&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;Order&#x27;: { type: &#x27;input&#x27;, unit: &#x27;count&#x27;, category: &#x27;Doanh thu&#x27;, goodDirection: &#x27;higher&#x27; },
            
            // Traffic metrics
            &#x27;Product click&#x27;: { type: &#x27;input&#x27;, unit: &#x27;count&#x27;, category: &#x27;Traffic&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;Ad Click&#x27;: { type: &#x27;input&#x27;, unit: &#x27;count&#x27;, category: &#x27;Traffic&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;Unique User&#x27;: { type: &#x27;input&#x27;, unit: &#x27;count&#x27;, category: &#x27;Traffic&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;ATC&#x27;: { type: &#x27;input&#x27;, unit: &#x27;count&#x27;, category: &#x27;Traffic&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;Buyer&#x27;: { type: &#x27;input&#x27;, unit: &#x27;count&#x27;, category: &#x27;Traffic&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;View Live&#x27;: { type: &#x27;input&#x27;, unit: &#x27;count&#x27;, category: &#x27;Traffic&#x27;, goodDirection: &#x27;higher&#x27; },
            
            // Chuyá»ƒn Ä‘á»•i metrics
            &#x27;CR of product click&#x27;: { 
                type: &#x27;calculated&#x27;, 
                formula: (data) =&gt; (data[&#x27;Order&#x27;] || 0) / (data[&#x27;Product click&#x27;] || 1) * 100,
                unit: &#x27;%&#x27;,
                category: &#x27;Chuyá»ƒn Ä‘á»•i&#x27;,
                goodDirection: &#x27;higher&#x27;
            },
            &#x27;CR of buyer&#x27;: { 
                type: &#x27;calculated&#x27;, 
                formula: (data) =&gt; (data[&#x27;Buyer&#x27;] || 0) / (data[&#x27;Unique User&#x27;] || 1) * 100,
                unit: &#x27;%&#x27;,
                category: &#x27;Chuyá»ƒn Ä‘á»•i&#x27;,
                goodDirection: &#x27;higher&#x27;
            },
            &#x27;Ad CR&#x27;: { 
                type: &#x27;calculated&#x27;, 
                formula: (data) =&gt; (data[&#x27;ATC&#x27;] || 0) / (data[&#x27;Unique User&#x27;] || 1) * 100,
                unit: &#x27;%&#x27;,
                category: &#x27;Chuyá»ƒn Ä‘á»•i&#x27;,
                goodDirection: &#x27;higher&#x27;
            },
            &#x27;CR Live&#x27;: { type: &#x27;input&#x27;, unit: &#x27;%&#x27;, category: &#x27;Chuyá»ƒn Ä‘á»•i&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;%ATC&#x27;: { 
                type: &#x27;calculated&#x27;, 
                formula: (data) =&gt; (data[&#x27;ATC&#x27;] || 0) / (data[&#x27;Unique User&#x27;] || 1) * 100,
                unit: &#x27;%&#x27;,
                category: &#x27;Chuyá»ƒn Ä‘á»•i&#x27;,
                goodDirection: &#x27;higher&#x27;
            },
            
            // GiÃ¡ trá»‹ Ä‘Æ¡n hÃ ng metrics
            &#x27;AOV&#x27;: { type: &#x27;input&#x27;, unit: &#x27;VND&#x27;, category: &#x27;GiÃ¡ trá»‹ Ä‘Æ¡n&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;ASP&#x27;: { type: &#x27;input&#x27;, unit: &#x27;VND&#x27;, category: &#x27;GiÃ¡ trá»‹ Ä‘Æ¡n&#x27;, goodDirection: &#x27;higher&#x27; },
            &#x27;ABS&#x27;: { 
                type: &#x27;calculated&#x27;, 
                formula: (data) =&gt; (data[&#x27;AOV&#x27;] || 0) / (data[&#x27;ASP&#x27;] || 1),
                unit: &#x27;count&#x27;,
                category: &#x27;GiÃ¡ trá»‹ Ä‘Æ¡n&#x27;,
                goodDirection: &#x27;higher&#x27;
            }
        };

        // Format currency in Vietnamese Dong
        function formatVND(value) {
            if (value &gt;= 1000000000) {
                return `${(value / 1000000000).toFixed(1)}B VND`;
            }
            if (value &gt;= 1000000) {
                return `${(value / 1000000).toFixed(1)}M VND`;
            }
            if (value &gt;= 1000) {
                return `${(value / 1000).toFixed(1)}K VND`;
            }
            return `${value.toFixed(0)} VND`;
        }

        // Format value based on unit
        function formatValue(value, unit) {
            if (unit === &#x27;VND&#x27;) return formatVND(value);
            if (unit === &#x27;%&#x27;) return `${value.toFixed(2)}%`;
            // Handle large count values
            if (unit === &#x27;count&#x27; &amp;&amp; value &gt;= 1000000) {
                return `${(value / 1000000).toFixed(1)}M`;
            }
            if (unit === &#x27;count&#x27; &amp;&amp; value &gt;= 1000) {
                return `${(value / 1000).toFixed(1)}K`;
            }
            return value.toFixed(0);
        }

        // Calculate metrics based on input data
        function calculateMetrics(inputData) {
            const calculatedData = { ...inputData };
            
            Object.entries(metricsConfig).forEach(([metric, config]) =&gt; {
                if (config.type === &#x27;calculated&#x27; &amp;&amp; config.formula) {
                    calculatedData[metric] = config.formula(inputData);
                }
            });
            
            return calculatedData;
        }

        // Calculate percentage change for MOM comparison
        function calculatePercentageChange(current, previous) {
            if (!previous || previous === 0) return 0;
            return ((current - previous) / previous) * 100;
        }

        // Enhanced comparison badge with good/bad performance logic
        function createComparisonBadge(change, metricName) {
            let icon, className;
            const metricConfig = metricsConfig[metricName];
            const goodDirection = metricConfig ? metricConfig.goodDirection : &#x27;higher&#x27;;
            
            // Determine if change is good or bad based on metric type
            let isGood = false;
            if (goodDirection === &#x27;higher&#x27;) {
                isGood = change &gt; 0;
            } else if (goodDirection === &#x27;lower&#x27;) {
                isGood = change &lt; 0;
            }
            
            if (Math.abs(change) &gt; 5) {
                if (isGood) {
                    icon = &#x27;fas fa-arrow-up&#x27;;
                    className = &#x27;comparison-positive&#x27;;
                } else {
                    icon = &#x27;fas fa-arrow-down&#x27;;
                    className = &#x27;comparison-negative&#x27;;
                }
            } else {
                icon = &#x27;fas fa-minus&#x27;;
                className = &#x27;comparison-neutral&#x27;;
            }

            return `
                &lt;span class=&quot;${className} comparison-badge&quot;&gt;
                    &lt;i class=&quot;${icon}&quot;&gt;&lt;/i&gt;
                    ${change &gt; 0 ? &#x27;+&#x27; : &#x27;&#x27;}${change.toFixed(1)}%
                &lt;/span&gt;
            `;
        }

        // Show notification helper
        function showNotification(message, type = &#x27;success&#x27;) {
            const notification = document.createElement(&#x27;div&#x27;);
            const bgColor = type === &#x27;success&#x27; ? &#x27;bg-green-500&#x27; : &#x27;bg-red-500&#x27;;
            const icon = type === &#x27;success&#x27; ? &#x27;fas fa-check&#x27; : &#x27;fas fa-exclamation-triangle&#x27;;
            
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
            notification.innerHTML = `&lt;i class=&quot;${icon} mr-2&quot;&gt;&lt;/i&gt;${message}`;
            document.body.appendChild(notification);
            setTimeout(() =&gt; {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }

        // Show status message in specific container
        function showStatusMessage(containerId, message, type = &#x27;success&#x27;) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const messageClass = type === &#x27;success&#x27; ? &#x27;success-message&#x27; : &#x27;error-message&#x27;;
            const icon = type === &#x27;success&#x27; ? &#x27;fas fa-check-circle&#x27; : &#x27;fas fa-exclamation-circle&#x27;;
            
            container.innerHTML = `
                &lt;div class=&quot;${messageClass}&quot;&gt;
                    &lt;i class=&quot;${icon} mr-2&quot;&gt;&lt;/i&gt;${message}
                &lt;/div&gt;
            `;
        }

        // Generate enhanced sample Excel file with Target, Compare, and Today data
        function generateSampleFile(dataType) {
            try {
                const baseSampleData = [
                    // Target row
                    {
                        date: &#x27;Target&#x27;,
                        type: &#x27;Target&#x27;,
                        AOV: 300000,
                        &#x27;Product click&#x27;: 2000,
                        &#x27;Ad GMV&#x27;: 6000000,
                        &#x27;Ad cost&#x27;: 1000000,
                        &#x27;Live GMV&#x27;: 2500000,
                        &#x27;Total GMV&#x27;: 8500000,
                        Order: 150,
                        &#x27;Ad Click&#x27;: 3500,
                        &#x27;CPC Paid Ad&#x27;: 16000,
                        &#x27;Unique User&#x27;: 3000,
                        ATC: 500,
                        Buyer: 120,
                        &#x27;View Live&#x27;: 8200,
                        &#x27;CR Live&#x27;: 5.5,
                        ASP: 185000
                    },
                    // Compare MOM row
                    {
                        date: &#x27;Compare MOM&#x27;,
                        type: &#x27;Compare&#x27;,
                        AOV: 250000,
                        &#x27;Product click&#x27;: 1800,
                        &#x27;Ad GMV&#x27;: 5500000,
                        &#x27;Ad cost&#x27;: 950000,
                        &#x27;Live GMV&#x27;: 2200000,
                        &#x27;Total GMV&#x27;: 7700000,
                        Order: 140,
                        &#x27;Ad Click&#x27;: 3200,
                        &#x27;CPC Paid Ad&#x27;: 15500,
                        &#x27;Unique User&#x27;: 2700,
                        ATC: 450,
                        Buyer: 110,
                        &#x27;View Live&#x27;: 8000,
                        &#x27;CR Live&#x27;: 5.2,
                        ASP: 175000
                    },
                    // Today/Current data
                    {
                        date: &#x27;Today&#x27;,
                        type: &#x27;Current&#x27;,
                        AOV: 275000,
                        &#x27;Product click&#x27;: 1900,
                        &#x27;Ad GMV&#x27;: 5800000,
                        &#x27;Ad cost&#x27;: 920000,
                        &#x27;Live GMV&#x27;: 2300000,
                        &#x27;Total GMV&#x27;: 8100000,
                        Order: 145,
                        &#x27;Ad Click&#x27;: 3300,
                        &#x27;CPC Paid Ad&#x27;: 15800,
                        &#x27;Unique User&#x27;: 2800,
                        ATC: 480,
                        Buyer: 115,
                        &#x27;View Live&#x27;: 8500,
                        &#x27;CR Live&#x27;: 5.8,
                        ASP: 190000
                    },
                    // Additional sample data rows
                    {
                        date: &#x27;01/01/2024&#x27;,
                        type: &#x27;Historical&#x27;,
                        AOV: 260000,
                        &#x27;Product click&#x27;: 1700,
                        &#x27;Ad GMV&#x27;: 5200000,
                        &#x27;Ad cost&#x27;: 880000,
                        &#x27;Live GMV&#x27;: 2100000,
                        &#x27;Total GMV&#x27;: 7300000,
                        Order: 130,
                        &#x27;Ad Click&#x27;: 3000,
                        &#x27;CPC Paid Ad&#x27;: 15200,
                        &#x27;Unique User&#x27;: 2600,
                        ATC: 420,
                        Buyer: 105,
                        &#x27;View Live&#x27;: 7800,
                        &#x27;CR Live&#x27;: 5.2,
                        ASP: 175000
                    }
                ];

                // Adjust sample data based on data type
                const sampleData = baseSampleData.map(row =&gt; {
                    if (row.type === &#x27;Target&#x27;) return row; // Don&#x27;t adjust target
                    
                    const multiplier = dataType === &#x27;Double day&#x27; ? 1.5 : 
                                    dataType === &#x27;15th, 25th&#x27; ? 1.2 : 1.0;
                    
                    const adjustedRow = { ...row };
                    Object.keys(adjustedRow).forEach(key =&gt; {
                        if (key !== &#x27;date&#x27; &amp;&amp; key !== &#x27;type&#x27; &amp;&amp; typeof adjustedRow[key] === &#x27;number&#x27;) {
                            adjustedRow[key] = Math.round(adjustedRow[key] * multiplier);
                        }
                    });
                    return adjustedRow;
                });

                // Create Excel file and download
                const worksheet = XLSX.utils.json_to_sheet(sampleData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, dataType);

                XLSX.writeFile(workbook, `Enhanced_Sample_${dataType.replace(/[^a-zA-Z0-9]/g, &#x27;_&#x27;)}.xlsx`);
                
                // Show success message
                showNotification(`ÄÃ£ táº£i file máº«u ${dataType} vá»›i Target &amp; MOM data`, &#x27;success&#x27;);
                
            } catch (error) {
                console.error(&#x27;Error generating sample file:&#x27;, error);
                showNotification(`Lá»—i khi táº¡o file máº«u: ${error.message}`, &#x27;error&#x27;);
            }
        }

        // Enhanced file upload handler
        function handleFileUpload(event, dataType) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const workbook = XLSX.read(e.target.result, { type: &#x27;binary&#x27; });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: &quot;&quot; });

                    const processedData = jsonData.map(row =&gt; calculateMetrics(row));
                    
                    // Separate Target, Compare, and other data
                    processedData.forEach(row =&gt; {
                        const dateStr = (row.date || row.Date || &#x27;&#x27;).toString().toLowerCase();
                        const typeStr = (row.type || &#x27;&#x27;).toString().toLowerCase();
                        
                        if (dateStr.includes(&#x27;target&#x27;) || typeStr.includes(&#x27;target&#x27;)) {
                            if (!targetData[dataType]) targetData[dataType] = {};
                            targetData[dataType] = row;
                        } else if (dateStr.includes(&#x27;compare&#x27;) || typeStr.includes(&#x27;compare&#x27;) || 
                                 dateStr.includes(&#x27;mom&#x27;) || typeStr.includes(&#x27;mom&#x27;)) {
                            if (!compareData[dataType]) compareData[dataType] = {};
                            compareData[dataType] = row;
                        }
                    });
                    
                    uploadedData[dataType] = processedData;
                    
                    document.getElementById(`status-${dataType}`).innerHTML = 
                        `&lt;span class=&quot;status-badge&quot;&gt;âœ“ ${processedData.length} rows uploaded&lt;/span&gt;`;
                    
                    if (!selectedDataTypes.includes(dataType)) {
                        selectedDataTypes.push(dataType);
                    }
                    
                    updateDataTypeSelection();
                    updatePivotData();
                    updateRunRateOverview(); // NEW: Update Run Rate Overview on data load
                } catch (error) {
                    showNotification(`Lá»—i khi Ä‘á»c file Excel: ${error.message}`, &#x27;error&#x27;);
                }
            };
            reader.readAsBinaryString(file);
        }

        // Update data type selection
        function updateDataTypeSelection() {
            const container = document.getElementById(&#x27;dataTypeCheckboxes&#x27;);
            container.innerHTML = &#x27;&#x27;;
            
            const dataTypes = [&#x27;BAU&#x27;, &#x27;Double day&#x27;, &#x27;15th, 25th&#x27;];
            dataTypes.forEach(dataType =&gt; {
                if (uploadedData[dataType]) {
                    const label = document.createElement(&#x27;label&#x27;);
                    label.className = &#x27;flex items-center cursor-pointer&#x27;;
                    label.innerHTML = `
                        &lt;input type=&quot;checkbox&quot; ${selectedDataTypes.includes(dataType) ? &#x27;checked&#x27; : &#x27;&#x27;} 
                               onchange=&quot;toggleDataType(&#x27;${dataType}&#x27;)&quot; class=&quot;mr-3 scale-125&quot;&gt;
                        &lt;span class=&quot;data-type-badge&quot;&gt;${dataType}&lt;/span&gt;
                    `;
                    container.appendChild(label);
                }
            });
            
            if (Object.keys(uploadedData).length &gt; 0) {
                document.getElementById(&#x27;dataTypeSelection&#x27;).style.display = &#x27;block&#x27;;
            }
        }

        // Toggle data type selection
        function toggleDataType(dataType) {
            if (selectedDataTypes.includes(dataType)) {
                selectedDataTypes = selectedDataTypes.filter(t =&gt; t !== dataType);
            } else {
                selectedDataTypes.push(dataType);
            }
            updatePivotData();
            updateRunRateOverview(); // NEW: Update Run Rate Overview on selection change
        }

        // Update pivot data with enhanced MOM comparison
        function updatePivotData() {
            if (selectedDataTypes.length === 0) {
                pivotData = null;
                document.getElementById(&#x27;pivotTableSection&#x27;).style.display = &#x27;none&#x27;;
                document.getElementById(&#x27;actionButtons&#x27;).style.display = &#x27;none&#x27;;
                document.getElementById(&#x27;performanceHighlights&#x27;).style.display = &#x27;none&#x27;;
                document.getElementById(&#x27;runRateOverview&#x27;).style.display = &#x27;none&#x27;; // NEW: Hide Run Rate
                return;
            }

            const pivot = {};
            selectedDataTypes.forEach(dataType =&gt; {
                if (uploadedData[dataType]) {
                    uploadedData[dataType].forEach(row =&gt; {
                        const date = row.date || row.Date || &#x27;Unknown&#x27;;
                        if (!pivot[date]) pivot[date] = {};
                        pivot[date][dataType] = row;
                    });
                }
            });

            pivotData = pivot;
            renderPivotTable();
            updatePerformanceHighlights();
            document.getElementById(&#x27;pivotTableSection&#x27;).style.display = &#x27;block&#x27;;
            document.getElementById(&#x27;actionButtons&#x27;).style.display = &#x27;block&#x27;;
        }

        // --- NEW FUNCTION: Calculate and Render Run Rate Overview ---
        function updateRunRateOverview() {
            const container = document.getElementById(&#x27;runRateMetricsContainer&#x27;);
            const overviewSection = document.getElementById(&#x27;runRateOverview&#x27;);
            container.innerHTML = &#x27;&#x27;;

            if (selectedDataTypes.length === 0 || !pivotData || !pivotData[&#x27;Today&#x27;]) {
                overviewSection.style.display = &#x27;none&#x27;;
                return;
            }

            // Aggregate &#x27;Today&#x27; data across all selected types (using sum for GMV, Order, Traffic and average for CR, AOV)
            const aggregatedTodayData = {
                &#x27;Total GMV&#x27;: 0,
                &#x27;Order&#x27;: 0,
                &#x27;Unique User&#x27;: 0, // DÃ¹ng lÃ m proxy cho TRAFFIC
                &#x27;AOV&#x27;: [], // Sáº½ tÃ­nh trung bÃ¬nh
                &#x27;CR of buyer&#x27;: [], // Sáº½ tÃ­nh trung bÃ¬nh
            };

            selectedDataTypes.forEach(dataType =&gt; {
                const data = pivotData[&#x27;Today&#x27;][dataType];
                if (data) {
                    aggregatedTodayData[&#x27;Total GMV&#x27;] += (data[&#x27;Total GMV&#x27;] || 0);
                    aggregatedTodayData[&#x27;Order&#x27;] += (data[&#x27;Order&#x27;] || 0);
                    aggregatedTodayData[&#x27;Unique User&#x27;] += (data[&#x27;Unique User&#x27;] || 0);
                    if (data[&#x27;AOV&#x27;]) aggregatedTodayData[&#x27;AOV&#x27;].push(data[&#x27;AOV&#x27;]);
                    if (data[&#x27;CR of buyer&#x27;]) aggregatedTodayData[&#x27;CR of buyer&#x27;].push(data[&#x27;CR of buyer&#x27;]);
                }
            });

            const totalGMV = aggregatedTodayData[&#x27;Total GMV&#x27;];
            const totalTraffic = aggregatedTodayData[&#x27;Unique User&#x27;]; // TRAFFIC proxy
            const avgAOV = aggregatedTodayData[&#x27;AOV&#x27;].length &gt; 0 ? aggregatedTodayData[&#x27;AOV&#x27;].reduce((a, b) =&gt; a + b, 0) / aggregatedTodayData[&#x27;AOV&#x27;].length : 0;
            const avgCR = aggregatedTodayData[&#x27;CR of buyer&#x27;].length &gt; 0 ? aggregatedTodayData[&#x27;CR of buyer&#x27;].reduce((a, b) =&gt; a + b, 0) / aggregatedTodayData[&#x27;CR of buyer&#x27;].length : 0; // CR% proxy

            const metricsToDisplay = [
                {
                    label: &#x27;GMV Run Rate&#x27;,
                    value: totalGMV,
                    unit: &#x27;VND&#x27;,
                    icon: &#x27;fas fa-money-bill-wave&#x27;,
                    color: &#x27;text-pink-600&#x27;
                },
                {
                    label: &#x27;CR% (CR of buyer)&#x27;,
                    value: avgCR,
                    unit: &#x27;%&#x27;,
                    icon: &#x27;fas fa-percent&#x27;,
                    color: &#x27;text-green-600&#x27;
                },
                {
                    label: &#x27;TRAFFIC (Unique User)&#x27;,
                    value: totalTraffic,
                    unit: &#x27;count&#x27;,
                    icon: &#x27;fas fa-users&#x27;,
                    color: &#x27;text-blue-600&#x27;
                },
                {
                    label: &#x27;AOV (Average Order Value)&#x27;,
                    value: avgAOV,
                    unit: &#x27;VND&#x27;,
                    icon: &#x27;fas fa-shopping-bag&#x27;,
                    color: &#x27;text-purple-600&#x27;
                }
            ];
            
            // Render the metrics
            metricsToDisplay.forEach(m =&gt; {
                const metricDiv = document.createElement(&#x27;div&#x27;);
                metricDiv.className = &#x27;runrate-metric&#x27;;
                metricDiv.innerHTML = `
                    &lt;i class=&quot;${m.icon} ${m.color} text-2xl mb-2&quot;&gt;&lt;/i&gt;
                    &lt;span class=&quot;metric-value-lg&quot;&gt;${formatValue(m.value, m.unit)}&lt;/span&gt;
                    &lt;span class=&quot;metric-label-sm&quot;&gt;${m.label}&lt;/span&gt;
                `;
                container.appendChild(metricDiv);
            });

            overviewSection.style.display = &#x27;block&#x27;;

            // Optional: Calculate GMV Check
            // Äá»ƒ kiá»ƒm tra cÃ´ng thá»©c GMV = CR * Traffic * AOV
            // CR% (tÃ­nh theo tháº­p phÃ¢n) * Traffic * AOV
            // const calculatedGMVCheck = (avgCR / 100) * totalTraffic * avgAOV;
            // console.log(`GMV Check: ${formatVND(calculatedGMVCheck)} | Actual GMV: ${formatVND(totalGMV)}`);
        }
        // --- END NEW FUNCTION ---

        // Update performance highlights vá»›i thÃ´ng tin chi tiáº¿t hÆ¡n
        function updatePerformanceHighlights() {
            const badMetrics = identifyBadPerformanceMetrics();
            const container = document.getElementById(&#x27;badPerformanceMetrics&#x27;);
            
            if (badMetrics.length === 0) {
                document.getElementById(&#x27;performanceHighlights&#x27;).style.display = &#x27;none&#x27;;
                return;
            }

            container.innerHTML = &#x27;&#x27;;
            badMetrics.forEach(metric =&gt; {
                const metricCard = document.createElement(&#x27;div&#x27;);
                metricCard.className = &#x27;performance-bad rounded-lg p-4&#x27;;
                
                // Icon based on category
                let categoryIcon = &#x27;fas fa-exclamation-triangle&#x27;;
                switch(metric.category) {
                    case &#x27;Performance&#x27;: categoryIcon = &#x27;fas fa-chart-line&#x27;; break;
                    case &#x27;Doanh thu&#x27;: categoryIcon = &#x27;fas fa-dollar-sign&#x27;; break;
                    case &#x27;Traffic&#x27;: categoryIcon = &#x27;fas fa-users&#x27;; break;
                    case &#x27;Chuyá»ƒn Ä‘á»•i&#x27;: categoryIcon = &#x27;fas fa-exchange-alt&#x27;; break;
                    case &#x27;GiÃ¡ trá»‹ Ä‘Æ¡n&#x27;: categoryIcon = &#x27;fas fa-shopping-cart&#x27;; break;
                }

                metricCard.innerHTML = `
                    &lt;div class=&quot;flex items-center justify-between mb-2&quot;&gt;
                        &lt;div class=&quot;flex items-center&quot;&gt;
                            &lt;i class=&quot;${categoryIcon} text-red-600 mr-2&quot;&gt;&lt;/i&gt;
                            &lt;h4 class=&quot;font-semibold text-readable&quot;&gt;${metric.name}&lt;/h4&gt;
                        &lt;/div&gt;
                        ${createComparisonBadge(metric.change, metric.name.split(&#x27; (&#x27;)[0])}
                    &lt;/div&gt;
                    &lt;div class=&quot;text-sm text-secondary-readable mb-2&quot;&gt;
                        &lt;div class=&quot;flex justify-between&quot;&gt;
                            &lt;span&gt;Current:&lt;/span&gt;
                            &lt;span class=&quot;font-semibold&quot;&gt;${formatValue(metric.current, metric.unit)}&lt;/span&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;flex justify-between&quot;&gt;
                            &lt;span&gt;MOM:&lt;/span&gt;
                            &lt;span&gt;${formatValue(metric.previous, metric.unit)}&lt;/span&gt;
                        &lt;/div&gt;
                        ${metric.target ? `
                        &lt;div class=&quot;flex justify-between&quot;&gt;
                            &lt;span&gt;Target:&lt;/span&gt;
                            &lt;span class=&quot;text-blue-600 font-semibold&quot;&gt;${formatValue(metric.target, metric.unit)}&lt;/span&gt;
                        &lt;/div&gt;` : &#x27;&#x27;}
                    &lt;/div&gt;
                    &lt;div class=&quot;text-xs bg-red-100 text-red-800 px-2 py-1 rounded&quot;&gt;
                        &lt;i class=&quot;fas fa-info-circle mr-1&quot;&gt;&lt;/i&gt;
                        ${metric.reason} â€¢ ${metric.category}
                    &lt;/div&gt;
                `;
                container.appendChild(metricCard);
            });

            document.getElementById(&#x27;performanceHighlights&#x27;).style.display = &#x27;block&#x27;;
        }

        // Identify bad performance metrics vá»›i logic tá»‘t/xáº¥u chi tiáº¿t
        function identifyBadPerformanceMetrics() {
            if (!pivotData) return [];

            const badMetrics = [];
            const todayData = pivotData[&#x27;Today&#x27;];
            const compareData = pivotData[&#x27;Compare MOM&#x27;];
            
            if (!todayData || !compareData) return [];

            Object.keys(metricsConfig).forEach(metric =&gt; {
                selectedDataTypes.forEach(dataType =&gt; {
                    const currentValue = todayData[dataType]?.[metric];
                    const previousValue = compareData[dataType]?.[metric];
                    const targetValue = pivotData[&#x27;Target&#x27;]?.[dataType]?.[metric];
                    const metricConfig = metricsConfig[metric];

                    if (currentValue !== undefined &amp;&amp; previousValue !== undefined &amp;&amp; metricConfig) {
                        const change = calculatePercentageChange(currentValue, previousValue);
                        const goodDirection = metricConfig.goodDirection;
                        
                        // XÃ¡c Ä‘á»‹nh metric cÃ³ performance xáº¥u hay khÃ´ng
                        let isBadPerformance = false;
                        
                        if (goodDirection === &#x27;higher&#x27;) {
                            // Vá»›i metrics cÃ ng cao cÃ ng tá»‘t (GMV, Order, CR, etc.)
                            isBadPerformance = change &lt; -5; // Giáº£m &gt; 5% lÃ  xáº¥u
                        } else if (goodDirection === &#x27;lower&#x27;) {
                            // Vá»›i metrics cÃ ng tháº¥p cÃ ng tá»‘t (Cost, CIR, CPC, etc.)
                            isBadPerformance = change &gt; 5; // TÄƒng &gt; 5% lÃ  xáº¥u
                        }
                        
                        // Kiá»ƒm tra so vá»›i target (náº¿u cÃ³)
                        const isBelowTarget = targetValue ? 
                            (goodDirection === &#x27;higher&#x27; ? (currentValue / targetValue) &lt; 0.9 : 
                             goodDirection === &#x27;lower&#x27; ? (currentValue / targetValue) &gt; 1.1 : false) : 
                            false;
                        
                        if (isBadPerformance || isBelowTarget) {
                            badMetrics.push({
                                name: `${metric} (${dataType})`,
                                current: currentValue,
                                previous: previousValue,
                                target: targetValue,
                                change: change,
                                unit: metricConfig.unit,
                                category: metricConfig.category,
                                goodDirection: goodDirection,
                                reason: isBadPerformance ? &#x27;MOM Performance&#x27; : &#x27;Below Target&#x27;
                            });
                        }
                    }
                });
            });

            return badMetrics.sort((a, b) =&gt; {
                // Sáº¯p xáº¿p theo má»©c Ä‘á»™ nghiÃªm trá»ng
                if (a.goodDirection === &#x27;higher&#x27;) {
                    return a.change - b.change; // Metric giáº£m nhiá»u nháº¥t lÃªn Ä‘áº§u
                } else {
                    return b.change - a.change; // Metric tÄƒng nhiá»u nháº¥t lÃªn Ä‘áº§u
                }
            });
        }

        // Enhanced pivot table vá»›i group theo category
        function renderPivotTable() {
            if (!pivotData) return;

            const dates = Object.keys(pivotData).sort((a, b) =&gt; {
                // Sort order: Target, Compare MOM, Today, then others
                if (a.includes(&#x27;Target&#x27;)) return -1;
                if (b.includes(&#x27;Target&#x27;)) return 1;
                if (a.includes(&#x27;Compare&#x27;)) return -1;
                if (b.includes(&#x27;Compare&#x27;)) return 1;
                if (a.includes(&#x27;Today&#x27;)) return -1;
                if (b.includes(&#x27;Today&#x27;)) return 1;
                return a.localeCompare(b);
            });
            
            // Group metrics by category
            const metricsGrouped = {};
            Object.entries(metricsConfig).forEach(([metric, config]) =&gt; {
                const category = config.category || &#x27;Other&#x27;;
                if (!metricsGrouped[category]) metricsGrouped[category] = [];
                metricsGrouped[category].push(metric);
            });
            
            let tableHTML = `
                &lt;thead class=&quot;bg-gradient-to-r from-purple-500 to-blue-500 text-white&quot;&gt;
                    &lt;tr&gt;
                        &lt;th class=&quot;px-6 py-4 text-left text-sm font-semibold rounded-tl-2xl&quot;&gt;Category / Metric&lt;/th&gt;
                        ${dates.map((date, index) =&gt; `
                            &lt;th class=&quot;px-6 py-4 text-left text-sm font-semibold ${index === dates.length - 1 ? &#x27;rounded-tr-2xl&#x27; : &#x27;&#x27;}&quot;&gt;
                                ${date}
                                ${date.includes(&#x27;Today&#x27;) ? &#x27;&lt;br&gt;&lt;small&gt;vs MOM&lt;/small&gt;&#x27; : &#x27;&#x27;}
                            &lt;/th&gt;
                        `).join(&#x27;&#x27;)}
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
            `;

            let rowIndex = 0;
            Object.entries(metricsGrouped).forEach(([category, metrics]) =&gt; {
                // Category header row
                const bgClass = rowIndex % 2 === 0 ? &#x27;bg-blue-50&#x27; : &#x27;bg-purple-50&#x27;;
                tableHTML += `
                    &lt;tr class=&quot;${bgClass}&quot;&gt;
                        &lt;td colspan=&quot;${dates.length + 1}&quot; class=&quot;px-6 py-3 font-bold text-lg text-blue-800 border-b-2 border-blue-200&quot;&gt;
                            &lt;i class=&quot;fas fa-folder-open mr-2&quot;&gt;&lt;/i&gt;${category}
                        &lt;/td&gt;
                    &lt;/tr&gt;
                `;
                rowIndex++;

                // Metrics rows for this category
                metrics.forEach((metric) =&gt; {
                    const bgClass = rowIndex % 2 === 0 ? &#x27;bg-gray-50&#x27; : &#x27;bg-white&#x27;;
                    tableHTML += `&lt;tr class=&quot;hover:bg-blue-50 transition-colors ${bgClass}&quot;&gt;
                        &lt;td class=&quot;px-6 py-4 text-sm font-semibold text-readable pl-12&quot;&gt;
                            &lt;span class=&quot;text-gray-600 mr-2&quot;&gt;â””â”€&lt;/span&gt;${metric}
                        &lt;/td&gt;`;
                    
                    dates.forEach(date =&gt; {
                        tableHTML += &#x27;&lt;td class=&quot;px-6 py-4 text-sm&quot;&gt;&#x27;;
                        
                        selectedDataTypes.forEach((dataType, index) =&gt; {
                            const value = pivotData[date]?.[dataType]?.[metric];
                            
                            if (value !== undefined) {
                                // Calculate MOM comparison for Today data
                                let comparisonHTML = &#x27;&#x27;;
                                if (date.includes(&#x27;Today&#x27;)) {
                                    const compareValue = pivotData[&#x27;Compare MOM&#x27;]?.[dataType]?.[metric];
                                    if (compareValue !== undefined) {
                                        const change = calculatePercentageChange(value, compareValue);
                                        comparisonHTML = `&lt;div class=&quot;mt-2&quot;&gt;${createComparisonBadge(change, metric)}&lt;/div&gt;`;
                                    }
                                }

                                const cardBgClass = date.includes(&#x27;Target&#x27;) ? &#x27;bg-blue-100 border-blue-300&#x27; :
                                                  date.includes(&#x27;Compare&#x27;) ? &#x27;bg-yellow-100 border-yellow-300&#x27; :
                                                  date.includes(&#x27;Today&#x27;) ? &#x27;bg-green-100 border-green-300&#x27; :
                                                  &#x27;bg-gray-100 border-gray-300&#x27;;

                                tableHTML += `
                                    &lt;div class=&quot;metric-cell ${cardBgClass} border&quot; onclick=&quot;showMetricChart(&#x27;${metric}&#x27;, &#x27;${dataType}&#x27;)&quot;&gt;
                                        &lt;div class=&quot;metric-label&quot;&gt;${dataType}&lt;/div&gt;
                                        &lt;div class=&quot;metric-value&quot;&gt;${formatValue(value, metricsConfig[metric]?.unit || &#x27;count&#x27;)}&lt;/div&gt;
                                        ${comparisonHTML}
                                    &lt;/div&gt;
                                `;
                            }
                        });
                        tableHTML += &#x27;&lt;/td&gt;&#x27;;
                    });
                    
                    tableHTML += &#x27;&lt;/tr&gt;&#x27;;
                    rowIndex++;
                });
            });

            tableHTML += &#x27;&lt;/tbody&gt;&#x27;;
            document.getElementById(&#x27;pivotTable&#x27;).innerHTML = tableHTML;
        }

        // Show chart for specific metric
        function showMetricChart(metric, dataType) {
            if (!pivotData) return;

            const chartData = [];
            const labels = [];
            const values = [];
            const backgroundColors = [];
            const borderColors = [];

            // Collect data for the specific metric and data type
            Object.entries(pivotData).forEach(([date, typeData]) =&gt; {
                const value = typeData[dataType]?.[metric];
                if (value !== undefined &amp;&amp; !date.includes(&#x27;Target&#x27;)) {
                    labels.push(date);
                    values.push(value);
                    
                    // Color coding based on date type
                    if (date.includes(&#x27;Today&#x27;)) {
                        backgroundColors.push(&#x27;rgba(34, 197, 94, 0.8)&#x27;);
                        borderColors.push(&#x27;rgb(34, 197, 94)&#x27;);
                    } else if (date.includes(&#x27;Compare&#x27;)) {
                        backgroundColors.push(&#x27;rgba(251, 146, 60, 0.8)&#x27;);
                        borderColors.push(&#x27;rgb(251, 146, 60)&#x27;);
                    } else {
                        backgroundColors.push(&#x27;rgba(99, 102, 241, 0.8)&#x27;);
                        borderColors.push(&#x27;rgb(99, 102, 241)&#x27;);
                    }
                }
            });

            // Add target line if available
            const targetValue = pivotData[&#x27;Target&#x27;]?.[dataType]?.[metric];

            if (labels.length === 0) {
                showNotification(&#x27;KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ hiá»ƒn thá»‹ biá»ƒu Ä‘á»“&#x27;, &#x27;error&#x27;);
                return;
            }

            // Update chart title
            document.getElementById(&#x27;chartTitle&#x27;).textContent = `${metric} - ${dataType}`;

            // Destroy existing chart
            if (chartInstance) {
                chartInstance.destroy();
            }

            // Create new chart
            const ctx = document.getElementById(&#x27;mainChart&#x27;).getContext(&#x27;2d&#x27;);
            chartInstance = new Chart(ctx, {
                type: &#x27;bar&#x27;,
                data: {
                    labels: labels,
                    datasets: [{
                        label: metric,
                        data: values,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }].concat(targetValue ? [{
                        label: &#x27;Target&#x27;,
                        data: Array(labels.length).fill(targetValue),
                        type: &#x27;line&#x27;,
                        borderColor: &#x27;rgb(239, 68, 68)&#x27;,
                        borderWidth: 3,
                        borderDash: [10, 5],
                        fill: false,
                        pointBackgroundColor: &#x27;rgb(239, 68, 68)&#x27;,
                        pointBorderColor: &#x27;rgb(239, 68, 68)&#x27;,
                        pointRadius: 6,
                    }] : [])
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${metric} - ${dataType}`,
                            font: {
                                size: 18,
                                weight: &#x27;bold&#x27;
                            },
                            color: &#x27;#374151&#x27;
                        },
                        legend: {
                            display: true,
                            position: &#x27;top&#x27;
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const unit = metricsConfig[metric]?.unit || &#x27;count&#x27;;
                                    return `${context.dataset.label}: ${formatValue(context.parsed.y, unit)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: &#x27;rgba(0,0,0,0.1)&#x27;
                            },
                            ticks: {
                                callback: function(value) {
                                    const unit = metricsConfig[metric]?.unit || &#x27;count&#x27;;
                                    return formatValue(value, unit);
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: &#x27;easeInOutQuart&#x27;
                    }
                }
            });

            // Show modal
            document.getElementById(&#x27;chartModal&#x27;).style.display = &#x27;flex&#x27;;
        }

        // Close chart modal
        function closeChartModal() {
            document.getElementById(&#x27;chartModal&#x27;).style.display = &#x27;none&#x27;;
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
        }

        // Enhanced AI insights generation with UPDATED Gemini API
        async function generateInsights() {
            const geminiApiKey = document.getElementById(&#x27;geminiApiKey&#x27;).value.trim();
            
            // Clear previous status
            document.getElementById(&#x27;insightStatus&#x27;).innerHTML = &#x27;&#x27;;
            
            if (!geminiApiKey) {
                showStatusMessage(&#x27;insightStatus&#x27;, &#x27;Vui lÃ²ng nháº­p Gemini API Key&#x27;, &#x27;error&#x27;);
                return;
            }
            
            if (!pivotData) {
                showStatusMessage(&#x27;insightStatus&#x27;, &#x27;Vui lÃ²ng táº£i dá»¯ liá»‡u trÆ°á»›c khi táº¡o insights&#x27;, &#x27;error&#x27;);
                return;
            }

            const button = document.getElementById(&#x27;insightButtonText&#x27;);
            const originalText = button.innerHTML;
            button.innerHTML = &#x27;&lt;i class=&quot;fas fa-spinner loading mr-2&quot;&gt;&lt;/i&gt;Äang táº¡o Insights...&#x27;;
            
            try {
                // Show API key validation
                showStatusMessage(&#x27;apiKeyStatus&#x27;, &#x27;Äang xÃ¡c thá»±c API Key...&#x27;, &#x27;success&#x27;);
                
                const analysisData = prepareAnalysisData();
                
                if (!analysisData || Object.keys(analysisData).length === 0) {
                    throw new Error(&#x27;KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ phÃ¢n tÃ­ch&#x27;);
                }
                
                const dataForAnalysis = JSON.stringify(analysisData, null, 2);
                
                const prompt = `
                    Báº¡n lÃ  má»™t chuyÃªn gia phÃ¢n tÃ­ch thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­. HÃ£y phÃ¢n tÃ­ch dá»¯ liá»‡u sau vÃ  Ä‘Æ°a ra insights chi tiáº¿t báº±ng tiáº¿ng Viá»‡t.

                    Dá»¯ liá»‡u bao gá»“m:
                    - Target: Má»¥c tiÃªu Ä‘áº·t ra
                    - Compare MOM: Dá»¯ liá»‡u thÃ¡ng trÆ°á»›c (Month over Month)
                    - Today: Dá»¯ liá»‡u hiá»‡n táº¡i
                    - Historical: Dá»¯ liá»‡u lá»‹ch sá»­

                    HÃ£y phÃ¢n tÃ­ch vÃ  Ä‘Æ°a ra:
                    1. Nhá»¯ng metric performance tá»‘t nháº¥t
                    2. Nhá»¯ng metric cáº§n cáº£i thiá»‡n
                    3. So sÃ¡nh vá»›i target vÃ  MOM
                    4. Äá» xuáº¥t action cá»¥ thá»ƒ cho tá»«ng váº¥n Ä‘á»
                    5. Dá»± Ä‘oÃ¡n xu hÆ°á»›ng

                    Dá»¯ liá»‡u: ${dataForAnalysis}
                `;

                showStatusMessage(&#x27;insightStatus&#x27;, &#x27;Äang gá»­i yÃªu cáº§u Ä‘áº¿n Gemini AI...&#x27;, &#x27;success&#x27;);

                // --- UPDATED API ENDPOINT AND MODEL ---
                const apiKey = geminiApiKey; // Use the provided API key
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.7,
                        topK: 40,
                        topP: 0.95,
                        // TÄƒng Max output tokens Ä‘á»ƒ Ä‘áº£m báº£o ná»™i dung dÃ i Ä‘Æ°á»£c truyá»n táº£i háº¿t
                        maxOutputTokens: 8192 // TÄƒng lÃªn má»©c tá»‘i Ä‘a cÃ³ thá»ƒ Ä‘á»ƒ chá»©a ná»™i dung dÃ i
                    }
                };
                
                // Exponential Backoff implementation
                const maxRetries = 3;
                let attempt = 0;
                let data = null;
                
                while (attempt &lt; maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: &#x27;POST&#x27;,
                            headers: {
                                &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
                            },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            const errorText = await response.text();
                            let errorMessage = `HTTP error! status: ${response.status}`;
                            
                            try {
                                const errorData = JSON.parse(errorText);
                                if (errorData.error &amp;&amp; errorData.error.message) {
                                    errorMessage = errorData.error.message;
                                }
                            } catch (e) {
                                // Keep original error message if JSON parsing fails
                            }
                            
                            // Check for retryable errors (429, 500, 503)
                            if (response.status === 429 || response.status &gt;= 500) {
                                if (attempt &lt; maxRetries - 1) {
                                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                                    await new Promise(resolve =&gt; setTimeout(resolve, delay));
                                    attempt++;
                                    continue; // Retry
                                }
                            }
                            
                            throw new Error(errorMessage);
                        }

                        data = await response.json();
                        break; // Success, exit loop

                    } catch (error) {
                        if (attempt &lt; maxRetries - 1) {
                            const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                            await new Promise(resolve =&gt; setTimeout(resolve, delay));
                            attempt++;
                            continue; // Retry
                        }
                        throw error; // Throw error after final attempt
                    }
                }
                
                // Process successful response
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error(&#x27;KhÃ´ng nháº­n Ä‘Æ°á»£c pháº£n há»“i há»£p lá»‡ tá»« Gemini AI&#x27;);
                }

                const insights = data.candidates[0].content.parts[0].text;

                // Display insights
                document.getElementById(&#x27;insightsContent&#x27;).textContent = insights;
                document.getElementById(&#x27;insightsSection&#x27;).style.display = &#x27;block&#x27;;

                // Generate structured insights table
                generateStructuredInsights();
                
                showStatusMessage(&#x27;insightStatus&#x27;, &#x27;AI Insights Ä‘Ã£ Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng!&#x27;, &#x27;success&#x27;);
                showStatusMessage(&#x27;apiKeyStatus&#x27;, &#x27;API Key há»£p lá»‡ vÃ  hoáº¡t Ä‘á»™ng tá»‘t&#x27;, &#x27;success&#x27;);
                
            } catch (error) {
                console.error(&#x27;Error generating insights:&#x27;, error);
                let errorMessage = &#x27;Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh&#x27;;
                
                if (error.message.includes(&#x27;API_KEY_INVALID&#x27;) || error.message.includes(&#x27;403&#x27;)) {
                    errorMessage = &#x27;API Key khÃ´ng há»£p lá»‡. Vui lÃ²ng kiá»ƒm tra láº¡i.&#x27;;
                    showStatusMessage(&#x27;apiKeyStatus&#x27;, errorMessage, &#x27;error&#x27;);
                } else if (error.message.includes(&#x27;QUOTA_EXCEEDED&#x27;) || error.message.includes(&#x27;429&#x27;)) {
                    errorMessage = &#x27;ÄÃ£ vÆ°á»£t quÃ¡ giá»›i háº¡n sá»­ dá»¥ng API. Vui lÃ²ng thá»­ láº¡i sau.&#x27;;
                } else if (error.message.includes(&#x27;Failed to fetch&#x27;)) {
                    errorMessage = &#x27;KhÃ´ng thá»ƒ káº¿t ná»‘i Ä‘áº¿n API. Kiá»ƒm tra káº¿t ná»‘i internet.&#x27;;
                } else if (error.message.includes(&#x27;NOT_FOUND&#x27;)) {
                    errorMessage = &#x27;Model khÃ´ng tÃ¬m tháº¥y. ÄÃ£ sá»­ dá»¥ng gemini-2.5-flash-preview-09-2025.&#x27;;
                } else {
                    errorMessage = error.message;
                }
                
                showStatusMessage(&#x27;insightStatus&#x27;, `Lá»—i khi táº¡o insights: ${errorMessage}`, &#x27;error&#x27;);
            } finally {
                button.innerHTML = originalText;
            }
        }

        // Prepare analysis data for AI with better structure
        function prepareAnalysisData() {
            if (!pivotData) return {};

            const analysis = {
                summary: {},
                comparison: {},
                performance: {},
                dataTypes: selectedDataTypes
            };

            // Calculate summary statistics
            selectedDataTypes.forEach(dataType =&gt; {
                analysis.summary[dataType] = {};
                
                Object.keys(metricsConfig).forEach(metric =&gt; {
                    const currentValue = pivotData[&#x27;Today&#x27;]?.[dataType]?.[metric];
                    const compareValue = pivotData[&#x27;Compare MOM&#x27;]?.[dataType]?.[metric];
                    const targetValue = pivotData[&#x27;Target&#x27;]?.[dataType]?.[metric];
                    
                    if (currentValue !== undefined) {
                        analysis.summary[dataType][metric] = {
                            current: currentValue,
                            target: targetValue,
                            compare: compareValue,
                            unit: metricsConfig[metric]?.unit || &#x27;count&#x27;,
                            category: metricsConfig[metric]?.category || &#x27;Other&#x27;
                        };

                        if (compareValue !== undefined) {
                            const change = calculatePercentageChange(currentValue, compareValue);
                            analysis.comparison[`${metric}_${dataType}`] = {
                                metric: metric,
                                dataType: dataType,
                                change: change,
                                direction: metricsConfig[metric]?.goodDirection || &#x27;higher&#x27;,
                                isGood: metricsConfig[metric]?.goodDirection === &#x27;higher&#x27; ? change &gt; 0 : change &lt; 0
                            };
                        }
                    }
                });
            });

            // Add performance summary
            const badMetrics = identifyBadPerformanceMetrics();
            const goodMetrics = identifyGoodPerformanceMetrics();
            
            analysis.performance = {
                badMetricsCount: badMetrics.length,
                goodMetricsCount: goodMetrics.length,
                badMetrics: badMetrics.slice(0, 5).map(m =&gt; ({
                    name: m.name,
                    change: m.change,
                    category: m.category
                })),
                goodMetrics: goodMetrics.slice(0, 5).map(m =&gt; ({
                    name: m.name,
                    change: m.change,
                    category: m.category
                }))
            };

            return analysis;
        }

        // Generate structured insights table
        function generateStructuredInsights() {
            const tableBody = document.getElementById(&#x27;insightsTableBody&#x27;);
            tableBody.innerHTML = &#x27;&#x27;;

            const badMetrics = identifyBadPerformanceMetrics();
            const goodMetrics = identifyGoodPerformanceMetrics();

            // Add bad performance metrics first
            badMetrics.slice(0, 5).forEach(metric =&gt; {
                const row = document.createElement(&#x27;tr&#x27;);
                row.innerHTML = `
                    &lt;td class=&quot;metric-name&quot;&gt;${metric.name}&lt;/td&gt;
                    &lt;td class=&quot;highlight-text&quot;&gt;
                        &lt;div class=&quot;mb-2&quot;&gt;
                            &lt;span class=&quot;text-red-600 font-semibold&quot;&gt;Underperforming:&lt;/span&gt; 
                            ${createComparisonBadge(metric.change, metric.name.split(&#x27; (&#x27;)[0])}
                        &lt;/div&gt;
                        &lt;div class=&quot;text-sm&quot;&gt;
                            Current: &lt;strong&gt;${formatValue(metric.current, metric.unit)}&lt;/strong&gt;&lt;br&gt;
                            MOM: ${formatValue(metric.previous, metric.unit)}&lt;br&gt;
                            ${metric.target ? `Target: ${formatValue(metric.target, metric.unit)}` : &#x27;&#x27;}
                        &lt;/div&gt;
                    &lt;/td&gt;
                    &lt;td class=&quot;action-text&quot;&gt;
                        ${getActionRecommendation(metric)}
                    &lt;/td&gt;
                `;
                tableBody.appendChild(row);
            });

            // Add good performance metrics
            goodMetrics.slice(0, 3).forEach(metric =&gt; {
                const row = document.createElement(&#x27;tr&#x27;);
                row.innerHTML = `
                    &lt;td class=&quot;metric-name&quot;&gt;${metric.name}&lt;/td&gt;
                    &lt;td class=&quot;highlight-text&quot;&gt;
                        &lt;div class=&quot;mb-2&quot;&gt;
                            &lt;span class=&quot;text-green-600 font-semibold&quot;&gt;Strong Performance:&lt;/span&gt; 
                            ${createComparisonBadge(metric.change, metric.name.split(&#x27; (&#x27;)[0])}
                        &lt;/div&gt;
                        &lt;div class=&quot;text-sm&quot;&gt;
                            Current: &lt;strong&gt;${formatValue(metric.current, metric.unit)}&lt;/strong&gt;&lt;br&gt;
                            MOM: ${formatValue(metric.previous, metric.unit)}
                        &lt;/div&gt;
                    &lt;/td&gt;
                    &lt;td class=&quot;action-text&quot;&gt;
                        &lt;i class=&quot;fas fa-trophy text-yellow-500 mr-2&quot;&gt;&lt;/i&gt;
                        Maintain current strategy. Consider scaling successful tactics to underperforming areas.
                    &lt;/td&gt;
                `;
                tableBody.appendChild(row);
            });
        }

        // Identify good performance metrics
        function identifyGoodPerformanceMetrics() {
            if (!pivotData) return [];

            const goodMetrics = [];
            const todayData = pivotData[&#x27;Today&#x27;];
            const compareData = pivotData[&#x27;Compare MOM&#x27;];
            
            if (!todayData || !compareData) return [];

            Object.keys(metricsConfig).forEach(metric =&gt; {
                selectedDataTypes.forEach(dataType =&gt; {
                    const currentValue = todayData[dataType]?.[metric];
                    const previousValue = compareData[dataType]?.[metric];
                    const metricConfig = metricsConfig[metric];

                    if (currentValue !== undefined &amp;&amp; previousValue !== undefined &amp;&amp; metricConfig) {
                        const change = calculatePercentageChange(currentValue, previousValue);
                        const goodDirection = metricConfig.goodDirection;
                        
                        let isGoodPerformance = false;
                        
                        if (goodDirection === &#x27;higher&#x27;) {
                            isGoodPerformance = change &gt; 10; // TÄƒng &gt; 10% lÃ  tá»‘t
                        } else if (goodDirection === &#x27;lower&#x27;) {
                            isGoodPerformance = change &lt; -10; // Giáº£m &gt; 10% lÃ  tá»‘t
                        }
                        
                        if (isGoodPerformance) {
                            goodMetrics.push({
                                name: `${metric} (${dataType})`,
                                current: currentValue,
                                previous: previousValue,
                                change: change,
                                unit: metricConfig.unit,
                                category: metricConfig.category,
                                goodDirection: goodDirection
                            });
                        }
                    }
                });
            });

            return goodMetrics.sort((a, b) =&gt; {
                // Sáº¯p xáº¿p theo performance tá»‘t nháº¥t
                if (a.goodDirection === &#x27;higher&#x27;) {
                    return b.change - a.change; // Metric tÄƒng nhiá»u nháº¥t lÃªn Ä‘áº§u
                } else {
                    return a.change - b.change; // Metric giáº£m nhiá»u nháº¥t lÃªn Ä‘áº§u
                }
            });
        }

        // Get action recommendation for metrics
        function getActionRecommendation(metric) {
            const category = metric.category;
            const metricName = metric.name.split(&#x27; (&#x27;)[0];
            
            const recommendations = {
                &#x27;Performance&#x27;: {
                    &#x27;Ad cost&#x27;: &#x27;ðŸ” Review ad targeting vÃ  bid strategy. Optimize cho high-converting keywords.&#x27;,
                    &#x27;Ad CIR&#x27;: &#x27;âš¡ Improve ad creative quality vÃ  landing page conversion rate.&#x27;,
                    &#x27;CPC Paid Ad&#x27;: &#x27;ðŸŽ¯ Refine audience targeting, test ad scheduling vÃ  device targeting.&#x27;
                },
                &#x27;Doanh thu&#x27;: {
                    &#x27;Total GMV&#x27;: &#x27;ðŸ“ˆ Launch promotional campaigns, expand product range, improve cross-selling.&#x27;,
                    &#x27;Ad GMV&#x27;: &#x27;ðŸš€ Increase ad budget cho high-performing campaigns, A/B test ad creatives.&#x27;,
                    &#x27;Live GMV&#x27;: &#x27;ðŸ“º Enhance live streaming quality, train hosts, promote live events.&#x27;,
                    &#x27;Order&#x27;: &#x27;ðŸ›’ Optimize checkout process, reduce cart abandonment, offer incentives.&#x27;
                },
                &#x27;Traffic&#x27;: {
                    &#x27;Product click&#x27;: &#x27;ðŸ”— Improve product titles, images, vÃ  SEO optimization.&#x27;,
                    &#x27;Ad Click&#x27;: &#x27;âœ¨ Create more compelling ad copy vÃ  visual creatives.&#x27;,
                    &#x27;Unique User&#x27;: &#x27;ðŸ“± Expand marketing channels, improve brand awareness campaigns.&#x27;,
                    &#x27;ATC&#x27;: &#x27;ðŸ›ï¸ Optimize product pages, add social proof, improve product descriptions.&#x27;,
                    &#x27;View Live&#x27;: &#x27;ðŸ“¢ Increase live streaming promotion across all channels.&#x27;
                },
                &#x27;Chuyá»ƒn Ä‘á»•i&#x27;: {
                    &#x27;CR of product click&#x27;: &#x27;ðŸŽ¯ A/B test product pages, improve trust signals, optimize pricing.&#x27;,
                    &#x27;CR of buyer&#x27;: &#x27;ðŸ’° Enhance user experience, simplify purchase flow, add payment options.&#x27;,
                    &#x27;Ad CR&#x27;: &#x27;ðŸ”„ Retarget website visitors, improve ad relevance score.&#x27;,
                    &#x27;CR Live&#x27;: &#x27;ðŸŽª Train live hosts on sales techniques, create urgency in live sessions.&#x27;
                },
                &#x27;GiÃ¡ trá»‹ Ä‘Æ¡n&#x27;: {
                    &#x27;AOV&#x27;: &#x27;ðŸ“¦ Implement bundle deals, cross-sell related products, minimum order incentives.&#x27;,
                    &#x27;ASP&#x27;: &#x27;ðŸ’Ž Focus on higher-margin products, improve product mix strategy.&#x27;,
                    &#x27;ABS&#x27;: &#x27;ðŸ›’ Encourage bulk purchases, offer volume discounts.&#x27;
                }
            };
            
            const categoryRecs = recommendations[category] || {};
            const specificRec = categoryRecs[metricName];
            
            if (specificRec) {
                return specificRec;
            }
            
            // Default recommendations by category
            const defaultRecs = {
                &#x27;Performance&#x27;: &#x27;ðŸ”§ Review campaign settings vÃ  optimize budget allocation.&#x27;,
                &#x27;Doanh thu&#x27;: &#x27;ðŸ“Š Analyze sales funnel vÃ  identify revenue growth opportunities.&#x27;,
                &#x27;Traffic&#x27;: &#x27;ðŸš¦ Enhance marketing reach vÃ  improve user acquisition strategies.&#x27;,
                &#x27;Chuyá»ƒn Ä‘á»•i&#x27;: &#x27;âš¡ Optimize user journey vÃ  reduce conversion barriers.&#x27;,
                &#x27;GiÃ¡ trá»‹ Ä‘Æ¡n&#x27;: &#x27;ðŸ’° Focus on increasing transaction value through strategic promotions.&#x27;
            };
            
            return defaultRecs[category] || &#x27;ðŸŽ¯ Monitor closely vÃ  develop improvement strategy.&#x27;;
        }

        // Export to Excel functionality
        function exportToExcel() {
            if (!pivotData) {
                showNotification(&#x27;KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ xuáº¥t&#x27;, &#x27;error&#x27;);
                return;
            }

            try {
                const exportData = [];
                
                // Prepare data for export
                Object.entries(pivotData).forEach(([date, typeData]) =&gt; {
                    selectedDataTypes.forEach(dataType =&gt; {
                        const rowData = typeData[dataType];
                        if (rowData) {
                            const exportRow = {
                                Date: date,
                                Type: dataType,
                                ...rowData
                            };
                            
                            // Add MOM comparison if it&#x27;s Today data
                            if (date.includes(&#x27;Today&#x27;)) {
                                Object.keys(metricsConfig).forEach(metric =&gt; {
                                    const currentValue = rowData[metric];
                                    const compareValue = pivotData[&#x27;Compare MOM&#x27;]?.[dataType]?.[metric];
                                    
                                    if (currentValue !== undefined &amp;&amp; compareValue !== undefined) {
                                        const change = calculatePercentageChange(currentValue, compareValue);
                                        exportRow[`${metric}_MOM_Change_%`] = change.toFixed(2);
                                    }
                                });
                            }
                            
                            exportData.push(exportRow);
                        }
                    });
                });

                // Create insights summary sheet
                const insightsData = [];
                const badMetrics = identifyBadPerformanceMetrics();
                const goodMetrics = identifyGoodPerformanceMetrics();

                // Add performance summary
                insightsData.push({
                    Category: &#x27;SUMMARY&#x27;,
                    Metric: &#x27;Bad Performance Count&#x27;,
                    Value: badMetrics.length,
                    Note: &#x27;Metrics underperforming vs MOM&#x27;
                });

                insightsData.push({
                    Category: &#x27;SUMMARY&#x27;, 
                    Metric: &#x27;Good Performance Count&#x27;,
                    Value: goodMetrics.length,
                    Note: &#x27;Metrics outperforming vs MOM&#x27;
                });

                // Add detailed bad performance metrics
                badMetrics.forEach(metric =&gt; {
                    insightsData.push({
                        Category: &#x27;BAD_PERFORMANCE&#x27;,
                        Metric: metric.name,
                        Value: `${metric.change.toFixed(1)}%`,
                        Current: formatValue(metric.current, metric.unit),
                        Previous: formatValue(metric.previous, metric.unit),
                        Target: metric.target ? formatValue(metric.target, metric.unit) : &#x27;&#x27;,
                        Action: getActionRecommendation(metric),
                        Note: `${metric.category} - ${metric.reason}`
                    });
                });

                // Add good performance metrics
                goodMetrics.forEach(metric =&gt; {
                    insightsData.push({
                        Category: &#x27;GOOD_PERFORMANCE&#x27;,
                        Metric: metric.name,
                        Value: `${metric.change.toFixed(1)}%`,
                        Current: formatValue(metric.current, metric.unit),
                        Previous: formatValue(metric.previous, metric.unit),
                        Action: &#x27;Maintain strategy and scale&#x27;,
                        Note: `${metric.category} - Strong performance`
                    });
                });

                // Create workbook with multiple sheets
                const workbook = XLSX.utils.book_new();
                
                // Main data sheet
                const dataSheet = XLSX.utils.json_to_sheet(exportData);
                XLSX.utils.book_append_sheet(workbook, dataSheet, &#x27;Raw Data&#x27;);
                
                // Insights sheet
                const insightsSheet = XLSX.utils.json_to_sheet(insightsData);
                XLSX.utils.book_append_sheet(workbook, insightsSheet, &#x27;Insights &amp; Actions&#x27;);

                // Export file
                const fileName = `Dashboard_Analytics_Report_${new Date().toISOString().split(&#x27;T&#x27;)[0]}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                
                showNotification(&#x27;Report Ä‘Ã£ Ä‘Æ°á»£c xuáº¥t thÃ nh cÃ´ng!&#x27;, &#x27;success&#x27;);
                
            } catch (error) {
                console.error(&#x27;Error exporting to Excel:&#x27;, error);
                showNotification(`Lá»—i khi xuáº¥t Excel: ${error.message}`, &#x27;error&#x27;);
            }
        }

        // Initialize page
        document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() {
            // Add any initialization code here
            console.log(&#x27;Dashboard Analytics Enhanced loaded successfully!&#x27;);
            
            // Test API key input validation
            const apiKeyInput = document.getElementById(&#x27;geminiApiKey&#x27;);
            apiKeyInput.addEventListener(&#x27;input&#x27;, function() {
                const apiKey = this.value.trim();
                if (apiKey.length &gt; 0) {
                    if (apiKey.startsWith(&#x27;AIza&#x27;)) {
                        showStatusMessage(&#x27;apiKeyStatus&#x27;, &#x27;API Key format looks correct&#x27;, &#x27;success&#x27;);
                    } else {
                        showStatusMessage(&#x27;apiKeyStatus&#x27;, &#x27;API Key should start with &quot;AIza&quot;&#x27;, &#x27;error&#x27;);
                    }
                } else {
                    document.getElementById(&#x27;apiKeyStatus&#x27;).innerHTML = &#x27;&#x27;;
                }
            });
        });

        // Close modal when clicking outside
        document.addEventListener(&#x27;click&#x27;, function(event) {
            const modal = document.getElementById(&#x27;chartModal&#x27;);
            if (event.target === modal) {
                closeChartModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener(&#x27;keydown&#x27;, function(event) {
            // Close modal with Escape key
            if (event.key === &#x27;Escape&#x27;) {
                closeChartModal();
            }
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;"></iframe>
</div>
<script>
const buttons=document.querySelectorAll('.tab-btn');
const frames=document.querySelectorAll('.file-frame');
buttons.forEach((btn)=>{
  btn.addEventListener('click',()=>{
    buttons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    frames.forEach(f=>f.classList.remove('active'));
    document.getElementById(btn.dataset.target).classList.add('active');
  });
});
buttons[0].classList.add('active');
frames[0].classList.add('active');
</script>
</body>
</html>
