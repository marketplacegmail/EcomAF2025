
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>G·ªôp HTML Tools</title>
    <style>
        body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }

/* Tabs container style */
.tabs { border-radius:14px; padding:10px; }

        .tabs { display:flex; gap:8px; align-items:center; background:transparent; color:#222; padding:12px 20px; }
        .tabs button { padding:10px 14px; border:none; background:#fff; color:#333; cursor:pointer; border-radius:12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin:0; transition: transform .12s ease, box-shadow .12s ease; }
        .tabs button.active { background: linear-gradient(90deg, #ff9ed8, #b19cd9); color: white; transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.12); }
        .tab-content { display:none; width:100%; height:calc(100vh - 50px); overflow:auto; }
        .tab-content.active { display:block; }
    </style>
    <script>
        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tabs button').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`[data-tab='${tabId}']`).classList.add('active');
        }
    </script>
</head>
<body>
    <header style="padding:18px 20px; background: transparent; text-align: left;"><h1 style="margin:0; font-family: Arial, sans-serif; font-size:32px; font-weight:700; color:#e0e0e0; letter-spacing:0.5px;">iBasic Ecommerce Tool</h1></header>
<div class="tabs">
        <button data-tab='livestream_dashboard.html' onclick="openTab('livestream_dashboard.html')">Livestream Dashboard</button><button data-tab='livestream_script_generator.html' onclick="openTab('livestream_script_generator.html')">Livestream Script Generator</button><button data-tab='underwear_storytelling_system.html' onclick="openTab('underwear_storytelling_system.html')">Underwear Storytelling System</button><button data-tab='lingerie_desriptions.html' onclick="openTab('lingerie_desriptions.html')">Lingerie Desriptions</button><button data-tab='smooth_thumbnail_maker.html' onclick="openTab('smooth_thumbnail_maker.html')">Smooth Thumbnail Maker</button><button data-tab='enhanced_dashboard_fixed.html' onclick="openTab('enhanced_dashboard_fixed.html')">Enhanced Dashboard Fixed</button>
    </div>
    
        <div class="tab-content" id="livestream_dashboard.html">
            <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livestream Management Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.15);
        }
        h1 {
            color: #ff9ed8;
            text-align: center;
            font-size: 2.5em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }
        h2 {
            color: #b19cd9;
            font-size: 1.5em;
            text-align: center;
        }
        h3 {
            color: #7b68ee;
            font-size: 1.2em;
            margin: 15px 0 10px;
        }
        h4 {
            color: #7b68ee;
            font-size: 1em;
            margin: 10px 0;
        }
        .form-section, .summary-section {
            margin: 20px 0;
            padding: 20px;
            background: #e6e6fa;
            border-radius: 10px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #7b68ee;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ff9ed8;
            border-radius: 8px;
            background: #fff0f5;
            color: #333;
            box-sizing: border-box;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #b19cd9;
            color: white;
        }
        button {
            padding: 12px 25px;
            background: #ff9ed8;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            margin: 5px;
        }
        button:hover {
            background: #ff6bb8;
            transform: scale(1.05);
        }
        .error {
            color: #ff6bb8;
            font-size: 0.9em;
            margin-top: 10px;
            text-align: center;
        }
        .success {
            color: #28a745;
            font-size: 0.9em;
            margin-top: 10px;
            text-align: center;
        }
        .checklist {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #ff9ed8;
        }
        .checklist-item input[type="text"] {
            flex: 1;
            padding: 8px;
            font-size: 0.9em;
        }
        .checklist-item label {
            margin: 0;
            font-size: 0.9em;
            width: 130px;
        }
        .summary-section {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 2em;
            }
            .checklist {
                grid-template-columns: 1fr;
            }
            button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé• Livestream Management Dashboard</h1>
        <div style="text-align: center; margin-bottom: 20px; color: #b19cd9; font-size: 0.9em;">
            <span style="font-size: 1.1em;">üíñ Made with love by </span>
            <strong style="color: #ff9ed8;">Tien Hoang</strong>
            <span> ‚ú®üåüüí´</span>
        </div>

        <div class="form-section">
            <div class="input-group">
                <label for="roomId">ROOM ID:</label>
                <input type="text" id="roomId" placeholder="Nh·∫≠p Room ID">
            </div>
            <div class="input-group">
                <label for="liveDate">NG√ÄY LIVESTREAM:</label>
                <input type="date" id="liveDate">
            </div>
            <div class="input-group">
                <h3>Check List Phi√™n Live</h3>
                <h4>Tr∆∞·ªõc Phi√™n Live - LIVE DIRECTOR</h4>
                <div class="checklist">
                    <div>
                        <h4>1. K·ªãch b·∫£n</h4>
                        <div class="checklist-item">
                            <input type="checkbox" id="scriptTheme">
                            <label for="scriptTheme">Ch·ªß ƒë·ªÅ live</label>
                            <input type="text" id="scriptThemeText" placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ">
                        </div>
                        <div class="checklist-item"><input type="checkbox" id="aiScript"><label for="aiScript">T·∫°o K·ªãch b·∫£n (AI)</label></div>
                    </div>
                    <div>
                        <h4>2. Promotion</h4>
                        <div class="checklist-item">
                            <input type="checkbox" id="exclusiveDeal">
                            <label for="exclusiveDeal">Deal ƒë·ªôc quy·ªÅn</label>
                            <input type="text" id="exclusiveDealText" placeholder="Nh·∫≠p deal">
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="voucher">
                            <label for="voucher">Voucher</label>
                            <input type="text" id="voucherText" placeholder="Nh·∫≠p voucher">
                        </div>
                    </div>
                    <div>
                        <h4>3. Host</h4>
                        <div class="checklist-item"><input type="checkbox" id="discussScript"><label for="discussScript">Th·∫£o lu·∫≠n K·ªãch b·∫£n</label></div>
                        <div class="checklist-item"><input type="checkbox" id="knowPromotion"><label for="knowPromotion">N·∫Øm Promotion</label></div>
                        <div class="checklist-item"><input type="checkbox" id="costume"><label for="costume">Trang ph·ª•c</label></div>
                    </div>
                    <div>
                        <h4>4. H√¨nh ·∫£nh</h4>
                        <div class="checklist-item">
                            <input type="checkbox" id="background">
                            <label for="background">Background</label>
                            <input type="text" id="backgroundText" placeholder="Nh·∫≠p m√¥ t·∫£ background">
                        </div>
                        <div class="checklist-item"><input type="checkbox" id="taglineScheme"><label for="taglineScheme">Tagline & Scheme</label></div>
                        <div class="checklist-item"><input type="checkbox" id="lighting"><label for="lighting">√Ånh s√°ng</label></div>
                    </div>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Host name</th>
                        <th>LIVE DIRECTOR name</th>
                        <th>Th·ªùi gian b·∫Øt ƒë·∫ßu phi√™n live</th>
                    </tr>
                </thead>
                <tbody id="liveTable">
                    <tr>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n host 1"></td>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n director 1"></td>
                        <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n host 2"></td>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n director 2"></td>
                        <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n host 3"></td>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n director 3"></td>
                        <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n host 4"></td>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n director 4"></td>
                        <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n host 5"></td>
                        <td><input type="text" placeholder="Nh·∫≠p t√™n director 5"></td>
                        <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                    </tr>
                </tbody>
            </table>

            <div class="input-group">
                <h3>∆Øu v√† Nh∆∞·ª£c Phi√™n Livestream</h3>
                <div class="input-group">
                    <label for="script">K·ªãch b·∫£n v√† h√¨nh th·ª©c livestream:</label>
                    <textarea id="script" rows="4" placeholder="M√¥ t·∫£ k·ªãch b·∫£n v√† h√¨nh th·ª©c livestream"></textarea>
                </div>
                <div class="input-group">
                    <label for="interaction">Nhu c·∫ßu & t∆∞∆°ng t√°c c·ªßa kh√°ch h√†ng:</label>
                    <textarea id="interaction" rows="4" placeholder="M√¥ t·∫£ nhu c·∫ßu v√† t∆∞∆°ng t√°c"></textarea>
                </div>
                <div class="input-group">
                    <label for="quality">Ch·∫•t l∆∞·ª£ng h√¨nh ·∫£nh v√† √¢m thanh:</label>
                    <textarea id="quality" rows="4" placeholder="ƒê√°nh gi√° ch·∫•t l∆∞·ª£ng h√¨nh ·∫£nh v√† √¢m thanh"></textarea>
                </div>
                <div class="input-group">
                    <label for="improvement">R√∫t kinh nghi·ªám v√† c·∫£i thi·ªán:</label>
                    <textarea id="improvement" rows="4" placeholder="Nh·ªØng ƒëi·ªÉm c·∫ßn c·∫£i thi·ªán cho livestream ti·∫øp theo"></textarea>
                </div>
            </div>
        </div>

        <div class="summary-section">
            <button onclick="exportToExcel()">üìä Xu·∫•t Excel v·ªõi d·ªØ li·ªáu</button>
            <button onclick="resetForm()">üîÑ Reset Form</button>
            <div id="messageArea" class="error"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        function showMessage(message, isError = true) {
            const messageArea = document.getElementById('messageArea');
            messageArea.textContent = message;
            messageArea.className = isError ? 'error' : 'success';
        }

        function sanitizeString(str) {
            return str ? str.replace(/[\x00-\x1F\x7F-\x9F]/g, '').trim() : '';
        }

        function exportToExcel() {
            // Ki·ªÉm tra th∆∞ vi·ªán XLSX
            if (typeof XLSX === 'undefined') {
                showMessage('L·ªói: Th∆∞ vi·ªán XLSX kh√¥ng ƒë∆∞·ª£c t·∫£i! Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.');
                return;
            }

            // L·∫•y d·ªØ li·ªáu c∆° b·∫£n
            const roomId = sanitizeString(document.getElementById('roomId').value);
            const liveDate = sanitizeString(document.getElementById('liveDate').value);
            const scriptThemeText = sanitizeString(document.getElementById('scriptThemeText').value);
            
            // Ki·ªÉm tra d·ªØ li·ªáu b·∫Øt bu·ªôc
            if (!roomId) {
                showMessage('Vui l√≤ng nh·∫≠p Room ID!');
                return;
            }
            if (!liveDate) {
                showMessage('Vui l√≤ng ch·ªçn ng√†y livestream!');
                return;
            }
            if (!scriptThemeText) {
                showMessage('Vui l√≤ng nh·∫≠p ch·ªß ƒë·ªÅ live!');
                return;
            }

            // L·∫•y d·ªØ li·ªáu ƒë√°nh gi√°
            const script = sanitizeString(document.getElementById('script').value);
            const interaction = sanitizeString(document.getElementById('interaction').value);
            const quality = sanitizeString(document.getElementById('quality').value);
            const improvement = sanitizeString(document.getElementById('improvement').value);

            // L·∫•y d·ªØ li·ªáu b·∫£ng host/director
            const tableRows = document.querySelectorAll('#liveTable tr');
            const liveData = [];
            
            tableRows.forEach((row, index) => {
                const inputs = row.querySelectorAll('input');
                const host = sanitizeString(inputs[0].value);
                const director = sanitizeString(inputs[1].value);
                const time = sanitizeString(inputs[2].value);

                if (host || director || time) {
                    liveData.push({
                        'STT': index + 1,
                        'Host': host || '',
                        'Director': director || '',
                        'Th·ªùi gian': time || ''
                    });
                }
            });

            // L·∫•y d·ªØ li·ªáu checklist
            const checklistItems = [
                { id: 'scriptTheme', text: 'scriptThemeText', name: 'Ch·ªß ƒë·ªÅ live' },
                { id: 'aiScript', text: null, name: 'T·∫°o K·ªãch b·∫£n (AI)' },
                { id: 'exclusiveDeal', text: 'exclusiveDealText', name: 'Deal ƒë·ªôc quy·ªÅn' },
                { id: 'voucher', text: 'voucherText', name: 'Voucher' },
                { id: 'discussScript', text: null, name: 'Th·∫£o lu·∫≠n K·ªãch b·∫£n' },
                { id: 'knowPromotion', text: null, name: 'N·∫Øm Promotion' },
                { id: 'costume', text: null, name: 'Trang ph·ª•c' },
                { id: 'background', text: 'backgroundText', name: 'Background' },
                { id: 'taglineScheme', text: null, name: 'Tagline & Scheme' },
                { id: 'lighting', text: null, name: '√Ånh s√°ng' }
            ];

            try {
                const wb = XLSX.utils.book_new();

                // T·∫°o sheet ch√≠nh v·ªõi c·∫•u tr√∫c t·ªëi ∆∞u cho Pivot
                const mainData = [];

                // N·∫øu kh√¥ng c√≥ d·ªØ li·ªáu host/director, t·∫°o 1 d√≤ng d·ªØ li·ªáu c∆° b·∫£n
                if (liveData.length === 0) {
                    mainData.push({
                        'Room ID': roomId,
                        'Ng√†y Livestream': liveDate,
                        'Ch·ªß ƒë·ªÅ Live': scriptThemeText,
                        'Host Name': '',
                        'Live Director Name': '',
                        'Th·ªùi gian b·∫Øt ƒë·∫ßu': '',
                        'K·ªãch b·∫£n v√† h√¨nh th·ª©c': script,
                        'Nhu c·∫ßu & t∆∞∆°ng t√°c': interaction,
                        'Ch·∫•t l∆∞·ª£ng h√¨nh ·∫£nh v√† √¢m thanh': quality,
                        'R√∫t kinh nghi·ªám v√† c·∫£i thi·ªán': improvement,
                        // Th√™m t·∫•t c·∫£ checklist items v√†o c√πng d√≤ng
                        'Ch·ªß ƒë·ªÅ live - Ho√†n th√†nh': document.getElementById('scriptTheme').checked ? 'C√≥' : 'Kh√¥ng',
                        'Ch·ªß ƒë·ªÅ live - Chi ti·∫øt': sanitizeString(document.getElementById('scriptThemeText').value),
                        'T·∫°o K·ªãch b·∫£n AI - Ho√†n th√†nh': document.getElementById('aiScript').checked ? 'C√≥' : 'Kh√¥ng',
                        'Deal ƒë·ªôc quy·ªÅn - Ho√†n th√†nh': document.getElementById('exclusiveDeal').checked ? 'C√≥' : 'Kh√¥ng',
                        'Deal ƒë·ªôc quy·ªÅn - Chi ti·∫øt': sanitizeString(document.getElementById('exclusiveDealText').value),
                        'Voucher - Ho√†n th√†nh': document.getElementById('voucher').checked ? 'C√≥' : 'Kh√¥ng',
                        'Voucher - Chi ti·∫øt': sanitizeString(document.getElementById('voucherText').value),
                        'Th·∫£o lu·∫≠n K·ªãch b·∫£n - Ho√†n th√†nh': document.getElementById('discussScript').checked ? 'C√≥' : 'Kh√¥ng',
                        'N·∫Øm Promotion - Ho√†n th√†nh': document.getElementById('knowPromotion').checked ? 'C√≥' : 'Kh√¥ng',
                        'Trang ph·ª•c - Ho√†n th√†nh': document.getElementById('costume').checked ? 'C√≥' : 'Kh√¥ng',
                        'Background - Ho√†n th√†nh': document.getElementById('background').checked ? 'C√≥' : 'Kh√¥ng',
                        'Background - Chi ti·∫øt': sanitizeString(document.getElementById('backgroundText').value),
                        'Tagline & Scheme - Ho√†n th√†nh': document.getElementById('taglineScheme').checked ? 'C√≥' : 'Kh√¥ng',
                        '√Ånh s√°ng - Ho√†n th√†nh': document.getElementById('lighting').checked ? 'C√≥' : 'Kh√¥ng'
                    });
                } else {
                    // T·∫°o m·ªôt d√≤ng cho m·ªói host/director v·ªõi th√¥ng tin ƒë·∫ßy ƒë·ªß
                    liveData.forEach(live => {
                        if (live.Host || live.Director || live['Th·ªùi gian']) {
                            mainData.push({
                                'Room ID': roomId,
                                'Ng√†y Livestream': liveDate,
                                'Ch·ªß ƒë·ªÅ Live': scriptThemeText,
                                'Host Name': live.Host,
                                'Live Director Name': live.Director,
                                'Th·ªùi gian b·∫Øt ƒë·∫ßu': live['Th·ªùi gian'],
                                'K·ªãch b·∫£n v√† h√¨nh th·ª©c': script,
                                'Nhu c·∫ßu & t∆∞∆°ng t√°c': interaction,
                                'Ch·∫•t l∆∞·ª£ng h√¨nh ·∫£nh v√† √¢m thanh': quality,
                                'R√∫t kinh nghi·ªám v√† c·∫£i thi·ªán': improvement,
                                // Th√™m t·∫•t c·∫£ checklist items v√†o c√πng d√≤ng
                                'Ch·ªß ƒë·ªÅ live - Ho√†n th√†nh': document.getElementById('scriptTheme').checked ? 'C√≥' : 'Kh√¥ng',
                                'Ch·ªß ƒë·ªÅ live - Chi ti·∫øt': sanitizeString(document.getElementById('scriptThemeText').value),
                                'T·∫°o K·ªãch b·∫£n AI - Ho√†n th√†nh': document.getElementById('aiScript').checked ? 'C√≥' : 'Kh√¥ng',
                                'Deal ƒë·ªôc quy·ªÅn - Ho√†n th√†nh': document.getElementById('exclusiveDeal').checked ? 'C√≥' : 'Kh√¥ng',
                                'Deal ƒë·ªôc quy·ªÅn - Chi ti·∫øt': sanitizeString(document.getElementById('exclusiveDealText').value),
                                'Voucher - Ho√†n th√†nh': document.getElementById('voucher').checked ? 'C√≥' : 'Kh√¥ng',
                                'Voucher - Chi ti·∫øt': sanitizeString(document.getElementById('voucherText').value),
                                'Th·∫£o lu·∫≠n K·ªãch b·∫£n - Ho√†n th√†nh': document.getElementById('discussScript').checked ? 'C√≥' : 'Kh√¥ng',
                                'N·∫Øm Promotion - Ho√†n th√†nh': document.getElementById('knowPromotion').checked ? 'C√≥' : 'Kh√¥ng',
                                'Trang ph·ª•c - Ho√†n th√†nh': document.getElementById('costume').checked ? 'C√≥' : 'Kh√¥ng',
                                'Background - Ho√†n th√†nh': document.getElementById('background').checked ? 'C√≥' : 'Kh√¥ng',
                                'Background - Chi ti·∫øt': sanitizeString(document.getElementById('backgroundText').value),
                                'Tagline & Scheme - Ho√†n th√†nh': document.getElementById('taglineScheme').checked ? 'C√≥' : 'Kh√¥ng',
                                '√Ånh s√°ng - Ho√†n th√†nh': document.getElementById('lighting').checked ? 'C√≥' : 'Kh√¥ng'
                            });
                        }
                    });
                }

                // T·∫°o worksheet ch√≠nh
                const ws1 = XLSX.utils.json_to_sheet(mainData);
                XLSX.utils.book_append_sheet(wb, ws1, 'D·ªØ li·ªáu t·ªïng h·ª£p');

                // T·∫°o sheet t√≥m t·∫Øt
                const summaryData = [
                    { 'Th√¥ng tin': 'Room ID', 'Gi√° tr·ªã': roomId },
                    { 'Th√¥ng tin': 'Ng√†y Livestream', 'Gi√° tr·ªã': liveDate },
                    { 'Th√¥ng tin': 'Ch·ªß ƒë·ªÅ Live', 'Gi√° tr·ªã': scriptThemeText },
                    { 'Th√¥ng tin': 'T·ªïng checklist ho√†n th√†nh', 'Gi√° tr·ªã': checklistItems.filter(item => document.getElementById(item.id).checked).length + '/' + checklistItems.length },
                    { 'Th√¥ng tin': 'S·ªë l∆∞·ª£ng host/director', 'Gi√° tr·ªã': liveData.length },
                    { 'Th√¥ng tin': 'Ng√†y xu·∫•t b√°o c√°o', 'Gi√° tr·ªã': new Date().toLocaleDateString('vi-VN') }
                ];

                const ws2 = XLSX.utils.json_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, ws2, 'T√≥m t·∫Øt');

                // Xu·∫•t file
                const fileName = `Livestream_${roomId}_${scriptThemeText.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().getTime()}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                showMessage('Xu·∫•t Excel th√†nh c√¥ng!', false);
                
            } catch (error) {
                console.error('Export Error:', error);
                showMessage('L·ªói khi xu·∫•t file Excel: ' + error.message);
            }
        }

        function resetForm() {
            // Reset t·∫•t c·∫£ input text v√† textarea
            document.getElementById('roomId').value = '';
            document.getElementById('liveDate').value = '';
            document.getElementById('script').value = '';
            document.getElementById('interaction').value = '';
            document.getElementById('quality').value = '';
            document.getElementById('improvement').value = '';
            document.getElementById('scriptThemeText').value = '';
            document.getElementById('exclusiveDealText').value = '';
            document.getElementById('voucherText').value = '';
            document.getElementById('backgroundText').value = '';
            
            // Reset t·∫•t c·∫£ checkbox
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => checkbox.checked = false);

            // Reset b·∫£ng
            const tableBody = document.getElementById('liveTable');
            tableBody.innerHTML = `
                <tr>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n host 1"></td>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n director 1"></td>
                    <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n host 2"></td>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n director 2"></td>
                    <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n host 3"></td>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n director 3"></td>
                    <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n host 4"></td>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n director 4"></td>
                    <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n host 5"></td>
                    <td><input type="text" placeholder="Nh·∫≠p t√™n director 5"></td>
                    <td><input type="datetime-local" placeholder="Ch·ªçn th·ªùi gian"></td>
                </tr>
            `;

            // Reset th√¥ng b√°o
            document.getElementById('messageArea').textContent = '';
            
            showMessage('Form ƒë√£ ƒë∆∞·ª£c reset th√†nh c√¥ng!', false);
        }

        // Ki·ªÉm tra th∆∞ vi·ªán XLSX khi trang load
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (typeof XLSX === 'undefined') {
                    showMessage('C·∫£nh b√°o: Th∆∞ vi·ªán XLSX ch∆∞a ƒë∆∞·ª£c t·∫£i. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.');
                }
            }, 2000);
        });
    </script>
</body>
</html>
        </div>
        
        <div class="tab-content" id="livestream_script_generator.html">
            <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫°o K·ªãch B·∫£n Livestream AI</title>
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff00ff 0%, #00ffcc 100%); /* Y2K gradient: neon pink to cyan */
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff33cc, #00ff99); /* Y2K neon gradient */
            color: white;
            text-align: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-100px); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .api-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            border-left: 4px solid #ff33cc; /* Y2K neon pink */
        }

        .api-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .api-input:focus {
            outline: none;
            border-color: #ff33cc; /* Y2K neon pink */
        }

        .api-status {
            font-size: 14px;
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }

        .api-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .api-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .main-content {
            display: flex;
            flex-direction: column; /* Stack sections vertically */
            gap: 30px;
            padding: 40px;
        }

        .input-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .input-section:hover {
            transform: translateY(-5px);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f9f9f9;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff33cc; /* Y2K neon pink */
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 51, 204, 0.1); /* Y2K neon pink shadow */
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .product-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .product-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .product-item label {
            font-size: 0.9em;
            margin-bottom: 5px;
            color: #666;
        }

        .product-item textarea {
            min-height: 80px;
            font-size: 14px;
            padding: 10px;
        }

        .style-options {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .style-option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .style-option:hover {
            border-color: #ff33cc; /* Y2K neon pink */
            background: #fff0f5; /* Light pink Y2K accent */
        }

        .style-option.selected {
            border-color: #ff33cc; /* Y2K neon pink */
            background: #ff33cc; /* Y2K neon pink */
            color: white;
        }

        .style-option h4 {
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .style-option p {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .brand-policy-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Side-by-side for Brand Story and Policy */
            gap: 15px;
            margin-bottom: 25px;
        }

        .cta-promotion-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Side-by-side for CTA and Promotion */
            gap: 15px;
            margin-bottom: 25px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .generate-btn,
        .regenerate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #ff33cc, #00ff99); /* Y2K neon gradient */
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .regenerate-btn {
            background: linear-gradient(135deg, #00ff99, #ff33cc); /* Reversed Y2K gradient */
        }

        .generate-btn:hover,
        .regenerate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 51, 204, 0.3); /* Y2K neon pink shadow */
        }

        .generate-btn:active,
        .regenerate-btn:active {
            transform: translateY(0);
        }

        .generate-btn:disabled,
        .regenerate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .output-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .output-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff33cc, #00ff99, #ff00ff, #00ccff); /* Y2K neon gradient */
            animation: gradient-shift 3s linear infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .output-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .script-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .tab-btn.active {
            background: #ff33cc; /* Y2K neon pink */
            color: white;
            border-color: #ff33cc; /* Y2K neon pink */
        }

        .script-output {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            border-left: 4px solid #ff33cc; /* Y2K neon pink */
            font-family: 'Consolas', 'Monaco', monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            color: #333;
            display: none;
        }

        .script-output.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 50px 0;
        }

        .loading {
            display: none;
            text-align: center;
            color: #ff33cc; /* Y2K neon pink */
            font-style: italic;
        }

        .loading::after {
            content: '...';
            animation: loading-dots 1.5s infinite;
        }

        @keyframes loading-dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .circle-nav {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
            display: none;
        }

        .circle-nav.active {
            display: block;
        }

        .circle-point {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff33cc; /* Y2K neon pink */
            border-radius: 50%;
            transform-origin: 50% 150px;
            transition: transform 0.3s ease, background 0.3s ease;
            cursor: pointer;
        }

        .circle-point:hover {
            background: #00ff99; /* Y2K neon green */
            transform: scale(1.2);
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            white-space: normal;
            max-width: 200px;
            display: none;
            z-index: 10;
        }

        .copy-btn,
        .download-btn {
            padding: 10px 15px;
            background: #00ff99; /* Y2K neon green */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .copy-btn:hover,
        .download-btn:hover {
            background: #00cc88; /* Darker Y2K neon green */
            transform: scale(1.05);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column; /* Ensure vertical stacking on mobile */
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .header p {
                font-size: 1em;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }

            .brand-policy-grid {
                grid-template-columns: 1fr; /* Stack Brand Story and Policy on mobile */
            }

            .cta-promotion-grid {
                grid-template-columns: 1fr; /* Stack CTA and Promotion on mobile */
            }

            .style-options {
                grid-template-columns: 1fr; /* Stack style options vertically on mobile */
            }

            .script-tabs {
                flex-direction: column;
            }

            .button-group {
                flex-direction: column;
                gap: 10px;
            }

            .circle-nav {
                width: 200px;
                height: 200px;
            }

            .circle-point {
                width: 15px;
                height: 15px;
                transform-origin: 50% 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ T·∫°o K·ªãch B·∫£n Livestream AI</h1>
            <p>C√¥ng c·ª• th√¥ng minh t√≠ch h·ª£p Google Gemini AI ƒë·ªÉ t·∫°o k·ªãch b·∫£n livestream chuy√™n nghi·ªáp</p>
        </div>

        <div class="api-section">
            <h3>üîë C·∫•u h√¨nh API Google Gemini</h3>
            <input type="password" id="apiKey" class="api-input" placeholder="Nh·∫≠p API Key c·ªßa b·∫°n (AIza...)">
            <div class="api-status" id="apiStatus" style="display: none;"></div>
            <p style="font-size: 12px; color: #666; margin-top: 5px;">
                API Key s·∫Ω ch·ªâ l∆∞u trong session n√†y v√† kh√¥ng ƒë∆∞·ª£c g·ª≠i ƒë·∫øn m√°y ch·ªß n√†o kh√°c.
                <a href="https://makersuite.google.com/app/apikey" target="_blank">L·∫•y API Key t·∫°i ƒë√¢y</a>
            </p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2>üìù Th√¥ng Tin ƒê·∫ßu V√†o</h2>
                <form id="scriptForm">
                    <div class="form-group">
                        <label for="topic">üéØ Ch·ªß ƒë·ªÅ live:</label>
                        <input type="text" id="topic" name="topic" placeholder="V√≠ d·ª•: Gi·∫£m gi√° s·ªëc Black Friday, Ra m·∫Øt s·∫£n ph·∫©m m·ªõi...">
                    </div>

                    <div class="form-group">
                        <label>üé≠ Phong c√°ch k·ªãch b·∫£n:</label>
                        <div class="style-options">
                            <div class="style-option" data-style="friendly">
                                <h4>üåü Th√¢n thi·ªán</h4>
                                <p>D·ªÖ th∆∞∆°ng, g·∫ßn g≈©i v·ªõi kh√°n gi·∫£</p>
                            </div>
                            <div class="style-option" data-style="professional">
                                <h4>üíº Chuy√™n nghi·ªáp</h4>
                                <p>L·ªãch s·ª±, tin c·∫≠y, thuy·∫øt ph·ª•c</p>
                            </div>
                            <div class="style-option" data-style="energetic">
                                <h4>‚ö° NƒÉng ƒë·ªông</h4>
                                <p>S√¥i ƒë·ªông, t·∫°o c·∫£m gi√°c kh·∫©n c·∫•p, th√∫c ƒë·∫©y h√†nh ƒë·ªông</p>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üì¶ M√¥ t·∫£ Hot Products:</label>
                        <div class="product-grid">
                            <div class="product-item">
                                <label>S·∫£n ph·∫©m 1:</label>
                                <textarea id="product1" placeholder="T√™n s·∫£n ph·∫©m, gi√°, t√≠nh nƒÉng n·ªïi b·∫≠t..."></textarea>
                            </div>
                            <div class="product-item">
                                <label>S·∫£n ph·∫©m 2:</label>
                                <textarea id="product2" placeholder="T√™n s·∫£n ph·∫©m, gi√°, t√≠nh nƒÉng n·ªïi b·∫≠t..."></textarea>
                            </div>
                            <div class="product-item">
                                <label>S·∫£n ph·∫©m 3:</label>
                                <textarea id="product3" placeholder="T√™n s·∫£n ph·∫©m, gi√°, t√≠nh nƒÉng n·ªïi b·∫≠t..."></textarea>
                            </div>
                            <div class="product-item">
                                <label>S·∫£n ph·∫©m 4:</label>
                                <textarea id="product4" placeholder="T√™n s·∫£n ph·∫©m, gi√°, t√≠nh nƒÉng n·ªïi b·∫≠t..."></textarea>
                            </div>
                        </div>
                        <div class="product-item">
                            <label>S·∫£n ph·∫©m 5:</label>
                            <textarea id="product5" placeholder="T√™n s·∫£n ph·∫©m, gi√°, t√≠nh nƒÉng n·ªïi b·∫≠t..."></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="seasonality">üå∏ Seasonality:</label>
                        <textarea id="seasonality" name="seasonality" placeholder="S·ª± ki·ªán theo m√πa ho·∫∑c d·ªãp ƒë·∫∑c bi·ªát:
- D·ªãp l·ªÖ (T·∫øt, Gi√°ng sinh, v.v.)
- Ch·ªß ƒë·ªÅ theo m√πa (H√®, ƒê√¥ng, v.v.)
- S·ª± ki·ªán ƒë·∫∑c bi·ªát (Back to School, Black Friday, v.v.)"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="gamification">üéÆ Gamification:</label>
                        <textarea id="gamification" name="gamification" placeholder="Tr√≤ ch∆°i ho·∫∑c ho·∫°t ƒë·ªông gi·∫£i tr√≠ trong livestream:
- Mini-game (b·ªëc thƒÉm may m·∫Øn, ƒëo√°n gi√°, v.v.)
- C√¢u ƒë·ªë t∆∞∆°ng t√°c
- Th·ª≠ th√°ch cho kh√°n gi·∫£
- Ph·∫ßn th∆∞·ªüng (qu√† t·∫∑ng, m√£ gi·∫£m gi√°, v.v.)"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="tipsHacks">üí° TIP/HACK:</label>
                        <textarea id="tipsHacks" name="tipsHacks" placeholder="M·∫πo ho·∫∑c th·ªß thu·∫≠t li√™n quan livestream:
- M·∫πo mua s·∫Øm
- C√°ch s·ª≠ d·ª•ng s·∫£n ph·∫©m
- L·ªùi khuy√™n cho kh√°n gi·∫£"></textarea>
                    </div>

                    <div class="brand-policy-grid">
                        <div class="form-group">
                            <label for="brandStory">üè¢ Brand Story:</label>
                            <textarea id="brandStory" name="brandStory" placeholder="C√¢u chuy·ªán th∆∞∆°ng hi·ªáu:
- L·ªãch s·ª≠ h√¨nh th√†nh
- S·ª© m·ªánh, t·∫ßm nh√¨n
- Gi√° tr·ªã c·ªët l√µi
- Th√†nh t·ª±u ƒë√°ng t·ª± h√†o
- Cam k·∫øt v·ªõi kh√°ch h√†ng"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="policy">üìã Policy Product:</label>
                            <textarea id="policy" name="policy" placeholder="Ch√≠nh s√°ch s·∫£n ph·∫©m:
- Ch√≠nh s√°ch b·∫£o h√†nh
- Ch√≠nh s√°ch ƒë·ªïi tr·∫£
- Ch√≠nh s√°ch giao h√†ng
- Ch√≠nh s√°ch thanh to√°n
- H·ªó tr·ª£ kh√°ch h√†ng"></textarea>
                        </div>
                    </div>

                    <div class="cta-promotion-grid">
                        <div class="form-group">
                            <label for="cta">üéØ CTA (Call to Action):</label>
                            <textarea id="cta" name="cta" placeholder="K√™u g·ªçi h√†nh ƒë·ªông:
- H∆∞·ªõng d·∫´n ƒë·∫∑t h√†ng
- K√™u g·ªçi t∆∞∆°ng t√°c (comment, share, v.v.)
- L·ªùi th√∫c ƒë·∫©y mua h√†ng"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="promotion">üéÅ Promotion:</label>
                            <textarea id="promotion" name="promotion" placeholder="Khuy·∫øn m√£i ƒë·∫∑c bi·ªát:
- M√£ gi·∫£m gi√°
- Qu√† t·∫∑ng k√®m
- ∆Øu ƒë√£i ƒë·∫∑c bi·ªát
- Th·ªùi gian c√≥ h·∫°n"></textarea>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="generate-btn" id="generateBtn">
                            üöÄ T·∫°o K·ªãch B·∫£n AI
                        </button>
                        <button type="button" class="regenerate-btn" id="regenerateBtn" disabled>
                            üîÑ T·∫°o L·∫°i K·ªãch B·∫£n
                        </button>
                    </div>
                </form>
            </div>

            <div class="output-section">
                <h2>üìú K·ªãch B·∫£n Livestream</h2>
                <div class="button-group">
                    <button class="copy-btn" onclick="copyScript()" id="copyBtn" disabled>üìã Copy</button>
                    <button class="download-btn" onclick="downloadScript()" id="downloadBtn" disabled>üì• T·∫£i DOCX</button>
                </div>
                
                <div class="script-tabs" id="scriptTabs" style="display: none;">
                    <button class="tab-btn active" onclick="showScript(1)">K·ªãch b·∫£n 1</button>
                    <button class="tab-btn" onclick="showScript(2)">K·ªãch b·∫£n 2</button>
                </div>

                <div class="script-output active" id="script1">
                    <div class="empty-state">
                        K·ªãch b·∫£n s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y sau khi b·∫°n ƒëi·ªÅn th√¥ng tin v√† nh·∫•n "T·∫°o K·ªãch B·∫£n AI"
                    </div>
                </div>
                <div class="script-output" id="script2"></div>
                <div class="circle-nav" id="circleNav1"></div>
                <div class="circle-nav" id="circleNav2"></div>
                <div class="loading" id="loading">Gemini AI ƒëang t·∫°o k·ªãch b·∫£n...</div>
                <div class="error-message" id="errorMessage" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        let currentScript = 1;
        let selectedStyle = 'friendly';
        let scriptGenerationCount = 0;
        let scriptContent = { 1: '', 2: '' }; // Store script content for circle navigation

        // X·ª≠ l√Ω ch·ªçn phong c√°ch
        document.querySelectorAll('.style-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.style-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedStyle = this.getAttribute('data-style');
            });
        });

        // M·∫∑c ƒë·ªãnh ch·ªçn phong c√°ch th√¢n thi·ªán
        document.querySelector('.style-option[data-style="friendly"]').classList.add('selected');

        document.getElementById('scriptForm').addEventListener('submit', function(e) {
            e.preventDefault();
            generateScript();
        });

        document.getElementById('regenerateBtn').addEventListener('click', function() {
            generateScript(true); // Pass true to indicate regeneration
        });

        async function generateScript(isRegenerate = false) {
            const apiKey = document.getElementById('apiKey').value;
            const topic = document.getElementById('topic').value;
            const product1 = document.getElementById('product1').value;
            const product2 = document.getElementById('product2').value;
            const product3 = document.getElementById('product3').value;
            const product4 = document.getElementById('product4').value;
            const product5 = document.getElementById('product5').value;
            const seasonality = document.getElementById('seasonality').value;
            const gamification = document.getElementById('gamification').value;
            const tipsHacks = document.getElementById('tipsHacks').value;
            const brandStory = document.getElementById('brandStory').value;
            const policy = document.getElementById('policy').value;
            const cta = document.getElementById('cta').value;
            const promotion = document.getElementById('promotion').value;

            // Ki·ªÉm tra API key
            if (!apiKey) {
                showError('Vui l√≤ng nh·∫≠p API Key c·ªßa Google Gemini!');
                return;
            }

            // Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
            if (!topic || !product1 || !brandStory || !policy || !cta || !promotion) {
                showError('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin: Ch·ªß ƒë·ªÅ live, √≠t nh·∫•t 1 s·∫£n ph·∫©m, Brand Story, Policy, CTA v√† Promotion!');
                return;
            }

            const products = [product1, product2, product3, product4, product5].filter(p => p.trim());
            
            const script1Element = document.getElementById('script1');
            const script2Element = document.getElementById('script2');
            const circleNav1 = document.getElementById('circleNav1');
            const circleNav2 = document.getElementById('circleNav2');
            const loading = document.getElementById('loading');
            const scriptTabs = document.getElementById('scriptTabs');
            const errorMessage = document.getElementById('errorMessage');
            const generateBtn = document.getElementById('generateBtn');
            const regenerateBtn = document.getElementById('regenerateBtn');
            const copyBtn = document.getElementById('copyBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // Hi·ªÉn th·ªã loading
            script1Element.style.display = 'none';
            script2Element.style.display = 'none';
            circleNav1.style.display = 'none';
            circleNav2.style.display = 'none';
            scriptTabs.style.display = 'none';
            errorMessage.style.display = 'none';
            loading.style.display = 'block';
            generateBtn.disabled = true;
            regenerateBtn.disabled = true;
            copyBtn.disabled = true;
            downloadBtn.disabled = true;
            generateBtn.textContent = isRegenerate ? 'ƒêang t·∫°o l·∫°i...' : 'ƒêang t·∫°o...';

            try {
                // TƒÉng s·ªë l·∫ßn t·∫°o ƒë·ªÉ thay ƒë·ªïi c√°ch di·ªÖn ƒë·∫°t
                scriptGenerationCount++;
                
                // T·∫°o 2 k·ªãch b·∫£n kh√°c nhau
                const script1 = await generateScriptWithGemini(apiKey, topic, products, seasonality, gamification, tipsHacks, brandStory, policy, cta, promotion, selectedStyle, 1, scriptGenerationCount);
                const script2 = await generateScriptWithGemini(apiKey, topic, products, seasonality, gamification, tipsHacks, brandStory, policy, cta, promotion, selectedStyle, 2, scriptGenerationCount);
                
                scriptContent[1] = script1;
                scriptContent[2] = script2;
                
                script1Element.innerHTML = script1;
                script2Element.innerHTML = script2;
                createCircleNavigation(1, script1);
                createCircleNavigation(2, script2);
                
                scriptTabs.style.display = 'flex';
                showScript(1);
                loading.style.display = 'none';
                
                // B·∫≠t n√∫t T·∫°o l·∫°i, Copy v√† T·∫£i xu·ªëng
                regenerateBtn.disabled = false;
                copyBtn.disabled = false;
                downloadBtn.disabled = false;
                
            } catch (error) {
                console.error('Error:', error);
                showError('L·ªói khi t·∫°o k·ªãch b·∫£n: ' + error.message);
                loading.style.display = 'none';
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'üöÄ T·∫°o K·ªãch B·∫£n AI';
            }
        }

        async function generateScriptWithGemini(apiKey, topic, products, seasonality, gamification, tipsHacks, brandStory, policy, cta, promotion, style, version, generationCount) {
            const styleDescriptions = {
                'friendly': 'th√¢n thi·ªán, d·ªÖ th∆∞∆°ng, g·∫ßn g≈©i v·ªõi kh√°n gi·∫£',
                'professional': 'chuy√™n nghi·ªáp, l·ªãch s·ª±, tin c·∫≠y v√† thuy·∫øt ph·ª•c',
                'energetic': 'nƒÉng ƒë·ªông, s√¥i n·ªïi, t·∫°o c·∫£m gi√°c kh·∫©n c·∫•p v√† th√∫c ƒë·∫©y h√†nh ƒë·ªông'
            };

            const versionPrompts = {
                1: 'T·∫°o k·ªãch b·∫£n v·ªõi c·∫•u tr√∫c r√µ r√†ng, t·∫≠p trung v√†o t∆∞∆°ng t√°c v√† x√¢y d·ª±ng ni·ªÅm tin',
                2: 'T·∫°o k·ªãch b·∫£n v·ªõi c√°ch ti·∫øp c·∫≠n kh√°c, t·∫≠p trung v√†o vi·ªác t·∫°o urgency v√† call-to-action m·∫°nh m·∫Ω'
            };

            const productList = products.map((product, index) => `S·∫£n ph·∫©m ${index + 1}: ${product}`).join('\n');

            const prompt = `
T√¥i c·∫ßn b·∫°n t·∫°o m·ªôt k·ªãch b·∫£n livestream ho√†n ch·ªânh v·ªõi c√°c y√™u c·∫ßu sau:

TH√îNG TIN C∆† B·∫¢N:
- Ch·ªß ƒë·ªÅ: ${topic}
- Phong c√°ch: ${styleDescriptions[style]}
- Y√™u c·∫ßu ƒë·∫∑c bi·ªát: ${versionPrompts[version]}
- L·∫ßn t·∫°o: ${generationCount} (ƒê·∫£m b·∫£o c√°ch di·ªÖn ƒë·∫°t v√† t·ª´ ng·ªØ kh√°c bi·ªát so v·ªõi c√°c l·∫ßn t·∫°o tr∆∞·ªõc, nh∆∞ng v·∫´n gi·ªØ c·∫•u tr√∫c v√† n·ªôi dung c·ªët l√µi)

S·∫¢N PH·∫®M:
${productList}

THEO M√ôA:
${seasonality}

TR√í CH∆†I & GI·∫¢I TR√ç:
${gamification}

TIP/HACK:
${tipsHacks}

TH√îNG TIN TH∆Ø∆†NG HI·ªÜU:
${brandStory}

CH√çNH S√ÅCH:
${policy}

K√äU G·ªåI H√ÄNH ƒê·ªòNG:
${cta}

KHUY·∫æN M√ÉI:
${promotion}

Y√äU C·∫¶U K·ªäCH B·∫¢N:
1. T·∫°o k·ªãch b·∫£n livestream ho√†n ch·ªânh kho·∫£ng 60 ph√∫t
2. Chia th√†nh c√°c ph·∫ßn r√µ r√†ng: Khai m·∫°c, Gi·ªõi thi·ªáu th∆∞∆°ng hi·ªáu, Tr√¨nh b√†y s·∫£n ph·∫©m, Theo m√πa, Tr√≤ ch∆°i & Gi·∫£i tr√≠, TIP/HACK, Ch√≠nh s√°ch, Khuy·∫øn m√£i v√† CTA, K·∫øt th√∫c
3. Bao g·ªìm timing c·ª• th·ªÉ cho t·ª´ng ph·∫ßn
4. C√≥ dialogue t·ª± nhi√™n, ph√π h·ª£p v·ªõi phong c√°ch ${styleDescriptions[style]}
5. T√≠ch h·ª£p c√°c c√¢u t∆∞∆°ng t√°c v·ªõi kh√°n gi·∫£, ƒë·∫∑c bi·ªát trong ph·∫ßn Tr√≤ ch∆°i & Gi·∫£i tr√≠
6. Bao g·ªìm call-to-action hi·ªáu qu·∫£
7. ƒê·ªãnh d·∫°ng r√µ r√†ng, d·ªÖ ƒë·ªçc
8. S·ª≠ d·ª•ng ti·∫øng Vi·ªát chu·∫©n Unicode ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªÉn th·ªã ƒë√∫ng tr√™n m·ªçi n·ªÅn t·∫£ng
9. Th√™m m·ªôt ph·∫ßn m·ªõi li√™n k·∫øt n·ªôi dung k·ªãch b·∫£n th√†nh m·ªôt v√≤ng tr√≤n, v·ªõi m·ªói ph·∫ßn (Khai m·∫°c, Gi·ªõi thi·ªáu th∆∞∆°ng hi·ªáu, v.v.) l√† m·ªôt ƒëi·ªÉm tr√™n v√≤ng tr√≤n, v√† khi hover v√†o ƒëi·ªÉm ƒë√≥, hi·ªÉn th·ªã n·ªôi dung chi ti·∫øt c·ªßa ph·∫ßn t∆∞∆°ng ·ª©ng

H√£y t·∫°o k·ªãch b·∫£n chi ti·∫øt v√† chuy√™n nghi·ªáp.
`;

            // C·∫≠p nh·∫≠t API URL s·ª≠ d·ª•ng Gemini 2.5 Flash
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.9, // TƒÉng temperature ƒë·ªÉ tƒÉng t√≠nh ƒëa d·∫°ng trong c√°ch di·ªÖn ƒë·∫°t
                        topK: 1,
                        topP: 1,
                        maxOutputTokens: 4096,
                    },
                    safetySettings: [
                        {
                            category: "HARM_CATEGORY_HARASSMENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_HATE_SPEECH",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        }
                    ]
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'L·ªói khi g·ªçi API Gemini');
            }

            const data = await response.json();
            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                return data.candidates[0].content.parts[0].text;
            } else {
                throw new Error('Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi t·ª´ Gemini AI');
            }
        }

        function showScript(scriptNumber) {
            currentScript = scriptNumber;
            
            // ·∫®n t·∫•t c·∫£ script v√† circle navigation
            document.getElementById('script1').style.display = 'none';
            document.getElementById('script2').style.display = 'none';
            document.getElementById('circleNav1').classList.remove('active');
            document.getElementById('circleNav2').classList.remove('active');
            
            // Hi·ªÉn th·ªã script v√† circle navigation ƒë∆∞·ª£c ch·ªçn
            document.getElementById('script' + scriptNumber).style.display = 'block';
            document.getElementById('circleNav' + scriptNumber).classList.add('active');
            
            // C·∫≠p nh·∫≠t tab active
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-btn')[scriptNumber - 1].classList.add('active');
        }

        function copyScript() {
            const currentScriptElement = document.getElementById('script' + currentScript);
            const text = currentScriptElement.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const copyBtn = document.getElementById('copyBtn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ ƒê√£ copy';
                copyBtn.style.background = '#00cc88'; /* Darker Y2K neon green */
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '#00ff99'; /* Y2K neon green */
                }, 2000);
            });
        }

        function downloadScript() {
            const currentScriptElement = document.getElementById('script' + currentScript);
            const scriptText = currentScriptElement.textContent;

            // T·∫°o t√†i li·ªáu DOCX v·ªõi font Arial v√† k√≠ch th∆∞·ªõc 12
            const doc = new docx.Document({
                sections: [{
                    properties: {},
                    children: [
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: "K·ªãch B·∫£n Livestream",
                                    bold: true,
                                    size: 24, // Title size 12pt in half-points (1pt = 2 half-points)
                                    font: "Arial"
                                })
                            ],
                            spacing: { after: 200 }
                        }),
                        ...scriptText.split('\n').map(line => 
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: line,
                                        size: 24, // Body text size 12pt in half-points
                                        font: "Arial"
                                    })
                                ],
                                spacing: { after: 100 }
                            })
                        )
                    ]
                }]
            });

            // T·∫°o v√† t·∫£i file DOCX
            docx.Packer.toBlob(doc).then(blob => {
                saveAs(blob, `KichBanLivestream_${currentScript}.docx`);
            }).catch(error => {
                console.error('Error generating DOCX:', error);
                showError('L·ªói khi t·∫°o file DOCX: ' + error.message);
            });
        }

        function createCircleNavigation(scriptNumber, scriptText) {
            const circleNav = document.getElementById(`circleNav${scriptNumber}`);
            circleNav.innerHTML = ''; // Clear existing content

            const sections = [
                "Khai m·∫°c", "Gi·ªõi thi·ªáu th∆∞∆°ng hi·ªáu", "Tr√¨nh b√†y s·∫£n ph·∫©m",
                "Theo m√πa", "Tr√≤ ch∆°i & Gi·∫£i tr√≠", "TIP/HACK", "Ch√≠nh s√°ch",
                "Khuy·∫øn m√£i v√† CTA", "K·∫øt th√∫c"
            ];

            const sectionContent = {};
            let currentSection = null;
            scriptText.split('\n').forEach(line => {
                const trimmedLine = line.trim();
                if (sections.includes(trimmedLine)) {
                    currentSection = trimmedLine;
                    sectionContent[currentSection] = [];
                } else if (currentSection && trimmedLine) {
                    sectionContent[currentSection].push(trimmedLine);
                }
            });

            const radius = 100; // Radius of the circle
            const centerX = 150;
            const centerY = 150;

            sections.forEach((section, index) => {
                const angle = (index / sections.length) * 2 * Math.PI - Math.PI / 2; // Start from top
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                const point = document.createElement('div');
                point.className = 'circle-point';
                point.style.left = `${x}px`;
                point.style.top = `${y}px`;
                point.dataset.section = section;

                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.textContent = sectionContent[section] ? sectionContent[section].join('\n') : 'N·ªôi dung kh√¥ng c√≥';
                tooltip.style.left = `${x + 20}px`;
                tooltip.style.top = `${y - 10}px`;

                point.addEventListener('mouseover', () => {
                    tooltip.style.display = 'block';
                });

                point.addEventListener('mouseout', () => {
                    tooltip.style.display = 'none';
                });

                circleNav.appendChild(point);
                circleNav.appendChild(tooltip);
            });
        }

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
        </div>
        
        <div class="tab-content" id="underwear_storytelling_system.html">
            <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>H·ªá Th·ªëng T·∫°o Storytelling N·ªôi Y - Gemini AI Content Generator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .story-card { transition: all 0.3s ease; }
        .story-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .typing-animation { 
            border-right: 2px solid #667eea; 
            white-space: nowrap; 
            overflow: hidden;
            animation: typing 3s steps(40) infinite alternate;
        }
        @keyframes typing {
            0% { width: 0; }
            100% { width: 100%; }
        }
        .prose p { margin-bottom: 1rem; line-height: 1.6; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header Section -->
    <header class="gradient-bg text-white py-8 px-6">
        <div class="max-w-7xl mx-auto">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-4">
                    <i class="fas fa-magic mr-3"></i>
                    H·ªá Th·ªëng T·∫°o Storytelling N·ªôi Y
                </h1>
                <p class="text-xl opacity-90 mb-6">Powered by Gemini AI - T·ª± ƒë·ªông t·∫°o c√¢u chuy·ªán h·∫•p d·∫´n cho s·∫£n ph·∫©m n·ªôi y</p>
                <div class="flex flex-wrap justify-center gap-4">
                    <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                        <i class="fas fa-user mr-2"></i>Nam/N·ªØ/Tr·∫ª em
                    </span>
                    <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                        <i class="fas fa-graduation-cap mr-2"></i>H·ªçc sinh
                    </span>
                    <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm">
                        <i class="fas fa-home mr-2"></i>Homewear & Underwear
                    </span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- System Overview -->
        <section class="mb-12">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-cogs text-blue-600 mr-3"></i>
                    Quy Tr√¨nh Ho·∫°t ƒê·ªông
                </h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-keyboard text-blue-600 text-2xl"></i>
                        </div>
                        <h3 class="font-semibold mb-2">1. Input T·ª´ Kh√≥a</h3>
                        <p class="text-gray-600 text-sm">Nh·∫≠p t·ª´ kh√≥a li√™n quan ƒë·∫øn n·ªôi y: √°o ng·ª±c, gi·∫∑t ·ªßi, ch·∫•t li·ªáu...</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-brain text-purple-600 text-2xl"></i>
                        </div>
                        <h3 class="font-semibold mb-2">2. AI Research</h3>
                        <p class="text-gray-600 text-sm">Gemini API ph√¢n t√≠ch v√† nghi√™n c·ª©u n·ªôi dung li√™n quan</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-pen-fancy text-green-600 text-2xl"></i>
                        </div>
                        <h3 class="font-semibold mb-2">3. Generate Story</h3>
                        <p class="text-gray-600 text-sm">T·∫°o ra c√¢u chuy·ªán h·∫•p d·∫´n theo framework chuy√™n nghi·ªáp</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 7 Categories Framework -->
        <section class="mb-12">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-tags text-indigo-600 mr-3"></i>
                    7 Danh M·ª•c Storytelling Ch√≠nh
                </h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <div class="story-card bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-lg border-l-4 border-red-500">
                        <i class="fas fa-lightbulb text-red-600 text-2xl mb-3"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">Tips</h3>
                        <p class="text-sm text-gray-600">M·∫πo s·ª≠ d·ª•ng, ch·ªçn size, ph·ªëi ƒë·ªì th√¥ng minh</p>
                    </div>
                    <div class="story-card bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg border-l-4 border-blue-500">
                        <i class="fas fa-tools text-blue-600 text-2xl mb-3"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">Hack</h3>
                        <p class="text-sm text-gray-600">Th·ªß thu·∫≠t b·∫£o qu·∫£n, gi·∫∑t ·ªßi, k√©o d√†i tu·ªïi th·ªç</p>
                    </div>
                    <div class="story-card bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg border-l-4 border-green-500">
                        <i class="fas fa-leaf text-green-600 text-2xl mb-3"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">Ch·∫•t Li·ªáu</h3>
                        <p class="text-sm text-gray-600">Cotton, Modal, Bamboo, L·ª•a v√† ƒë·∫∑c t√≠nh</p>
                    </div>
                    <div class="story-card bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg border-l-4 border-purple-500">
                        <i class="fas fa-drafting-compass text-purple-600 text-2xl mb-3"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">Thi·∫øt K·∫ø</h3>
                        <p class="text-sm text-gray-600">Ki·ªÉu d√°ng, form, c√¥ng nƒÉng ƒë·∫∑c bi·ªát</p>
                    </div>
                    <div class="story-card bg-gradient-to-br from-yellow-50 to-yellow-100 p-6 rounded-lg border-l-4 border-yellow-500">
                        <i class="fas fa-gift text-yellow-600 text-2xl mb-3"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">M√πa L·ªÖ H·ªôi</h3>
                        <p class="text-sm text-gray-600">Collection theo Valentine, Noel, T·∫øt</p>
                    </div>
                    <div class="story-card bg-gradient-to-br from-pink-50 to-pink-100 p-6 rounded-lg border-l-4 border-pink-500">
                        <i class="fas fa-palette text-pink-600 text-2xl mb-3"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">Mix & Match</h3>
                        <p class="text-sm text-gray-600">Ph·ªëi h·ª£p b·ªô, t·∫°o style c√° nh√¢n</p>
                    </div>
                    <div class="story-card bg-gradient-to-br from-indigo-50 to-indigo-100 p-6 rounded-lg border-l-4 border-indigo-500">
                        <i class="fas fa-eye-dropper text-indigo-600 text-2xl mb-3"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">M√†u S·∫Øc</h3>
                        <p class="text-sm text-gray-600">T√¢m l√Ω h·ªçc m√†u s·∫Øc, trend 2024</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Keyword Input System -->
        <section class="mb-12">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-search text-blue-600 mr-3"></i>
                    T·∫°o Storytelling T·ª´ T·ª´ Kh√≥a
                </h2>
                
                <!-- Input Form -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-edit mr-2"></i>Nh·∫≠p t·ª´ kh√≥a
                        </label>
                        <input type="text" id="keywordInput" placeholder="VD: √°o ng·ª±c, gi·∫∑t ·ªßi" 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        
                        <label class="block text-sm font-medium text-gray-700 mb-2 mt-4">
                            <i class="fas fa-users mr-2"></i>ƒê·ªëi t∆∞·ª£ng kh√°ch h√†ng
                        </label>
                        <select id="audienceSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="women">N·ªØ</option>
                            <option value="men">Nam</option>
                            <option value="children">Tr·∫ª em</option>
                            <option value="students">H·ªçc sinh</option>
                            <option value="homewear">Homewear</option>
                        </select>

                        <label class="block text-sm font-medium text-gray-700 mb-2 mt-4">
                            <i class="fas fa-layer-group mr-2"></i>Danh m·ª•c n·ªôi dung
                        </label>
                        <select id="categorySelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="tips">Tips - M·∫πo s·ª≠ d·ª•ng</option>
                            <option value="hack">Hack - Th·ªß thu·∫≠t</option>
                            <option value="material">Ch·∫•t li·ªáu</option>
                            <option value="design">Thi·∫øt k·∫ø</option>
                            <option value="seasonal">M√πa l·ªÖ h·ªôi</option>
                            <option value="mixmatch">Mix & Match</option>
                            <option value="color">M√†u s·∫Øc</option>
                        </select>

                        <button onclick="generateTopics()" class="w-full mt-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition duration-300">
                            <i class="fas fa-search mr-2"></i>T√¨m Ch·ªß ƒê·ªÅ
                        </button>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-file-alt mr-2"></i>Ch·ªçn ch·ªß ƒë·ªÅ
                        </label>
                        <select id="topicSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Vui l√≤ng t√¨m ch·ªß ƒë·ªÅ tr∆∞·ªõc...</option>
                        </select>

                        <label class="block text-sm font-medium text-gray-700 mb-2 mt-4">
                            <i class="fas fa-cog mr-2"></i>C√†i ƒë·∫∑t Gemini API
                        </label>
                        <input type="password" id="apiKey" placeholder="Nh·∫≠p Gemini API Key" 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        
                        <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <h4 class="font-medium text-blue-800 mb-2">
                                <i class="fas fa-info-circle mr-2"></i>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng API
                            </h4>
                            <p class="text-sm text-blue-700">
                                1. L·∫•y API key t·ª´ <a href="https://ai.google.dev/" class="underline" target="_blank">Google AI Studio</a><br />
                                2. Nh·∫≠p key v√†o √¥ tr√™n<br />
                                3. Ch·ªçn t·ª´ kh√≥a, danh m·ª•c v√† ch·ªß ƒë·ªÅ<br />
                                4. Nh·∫•n "T·∫°o Storytelling"
                            </p>
                        </div>

                        <button onclick="generateStory()" class="w-full mt-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 transition duration-300">
                            <i class="fas fa-magic mr-2"></i>T·∫°o Storytelling v·ªõi Gemini AI
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Generated Story Output -->
        <section class="mb-12">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-scroll text-green-600 mr-3"></i>
                    Storytelling ƒê∆∞·ª£c T·∫°o
                </h2>
                <div id="storyOutput" class="min-h-64 p-6 bg-gray-50 border border-gray-200 rounded-lg">
                    <div class="text-center py-16 text-gray-500">
                        <i class="fas fa-edit text-4xl mb-4"></i>
                        <p class="text-lg">C√¢u chuy·ªán s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y sau khi b·∫°n t·∫°o...</p>
                        <p class="text-sm mt-2">S·ª≠ d·ª•ng form b√™n tr√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu t·∫°o n·ªôi dung</p>
                    </div>
                </div>
                <div class="mt-4 flex justify-end">
                    <button onclick="copyToClipboard()" id="copyButton" class="hidden bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition duration-300">
                        <i class="fas fa-copy mr-2"></i>Copy Storytelling
                    </button>
                </div>
            </div>
        </section>

        <!-- Content Framework -->
        <section class="mb-12">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-sitemap text-indigo-600 mr-3"></i>
                    Framework T·∫°o Content Chuy√™n Nghi·ªáp
                </h2>
                
                <div class="grid md:grid-cols-3 gap-6">
                    <!-- Framework Steps -->
                    <div class="col-span-2">
                        <div class="space-y-6">
                            <div class="flex">
                                <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                    <span class="text-blue-600 font-semibold text-sm">1</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Keyword Analysis</h3>
                                    <p class="text-sm text-gray-600 mt-1">Ph√¢n t√≠ch t·ª´ kh√≥a ‚Üí X√°c ƒë·ªãnh intent ‚Üí Map v·ªõi 7 categories</p>
                                </div>
                            </div>
                            
                            <div class="flex">
                                <div class="flex-shrink-0 w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-4">
                                    <span class="text-purple-600 font-semibold text-sm">2</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Topic Generation</h3>
                                    <p class="text-sm text-gray-600 mt-1">Gemini AI research ‚Üí T·∫°o title h·∫•p d·∫´n ‚Üí X√°c ƒë·ªãnh angle</p>
                                </div>
                            </div>

                            <div class="flex">
                                <div class="flex-shrink-0 w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-4">
                                    <span class="text-green-600 font-semibold text-sm">3</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Story Structure</h3>
                                    <p class="text-sm text-gray-600 mt-1">Hook ‚Üí Problem ‚Üí Solution ‚Üí Benefit ‚Üí Call-to-action</p>
                                </div>
                            </div>

                            <div class="flex">
                                <div class="flex-shrink-0 w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center mr-4">
                                    <span class="text-yellow-600 font-semibold text-sm">4</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Content Enhancement</h3>
                                    <p class="text-sm text-gray-600 mt-1">Visual storytelling ‚Üí Emotional connection ‚Üí User engagement</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Template Structure -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="font-semibold text-gray-800 mb-4">Template Structure</h3>
                        <div class="space-y-3 text-sm">
                            <div class="p-2 bg-white rounded border-l-2 border-blue-500">
                                <strong>Hook:</strong> C√¢u m·ªü ƒë·∫ßu h·∫•p d·∫´n
                            </div>
                            <div class="p-2 bg-white rounded border-l-2 border-red-500">
                                <strong>Story:</strong> K·ªÉ chuy·ªán c·∫£m x√∫c
                            </div>
                            <div class="p-2 bg-white rounded border-l-2 border-green-500">
                                <strong>Solution:</strong> Gi·∫£i ph√°p c·ª• th·ªÉ
                            </div>
                            <div class="p-2 bg-white rounded border-l-2 border-purple-500">
                                <strong>Benefit:</strong> L·ª£i √≠ch r√µ r√†ng
                            </div>
                            <div class="p-2 bg-white rounded border-l-2 border-yellow-500">
                                <strong>CTA:</strong> K√™u g·ªçi h√†nh ƒë·ªông
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Material Comparison -->
        <section class="mb-12">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-microscope text-green-600 mr-3"></i>
                    So S√°nh Ch·∫•t Li·ªáu N·ªôi Y
                </h2>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left font-semibold text-gray-800">Ch·∫•t Li·ªáu</th>
                                <th class="px-4 py-3 text-left font-semibold text-gray-800">Ngu·ªìn G·ªëc</th>
                                <th class="px-4 py-3 text-left font-semibold text-gray-800">∆Øu ƒêi·ªÉm</th>
                                <th class="px-4 py-3 text-left font-semibold text-gray-800">Nh∆∞·ª£c ƒêi·ªÉm</th>
                                <th class="px-4 py-3 text-left font-semibold text-gray-800">Storytelling Angle</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr class="hover:bg-green-50">
                                <td class="px-4 py-3 font-medium text-green-800">Bamboo</td>
                                <td class="px-4 py-3 text-gray-600">B·ªôt tre/tr√∫c</td>
                                <td class="px-4 py-3 text-gray-600">Kh√°ng khu·∫©n t·ª± nhi√™n, th·∫•m h√∫t m·ªì h√¥i, th√¢n thi·ªán m√¥i tr∆∞·ªùng</td>
                                <td class="px-4 py-3 text-gray-600">D·ªÖ nhƒÉn, c√≥ th·ªÉ phai m√†u</td>
                                <td class="px-4 py-3 text-gray-600">"S·ª©c m·∫°nh t·ª´ thi√™n nhi√™n"</td>
                            </tr>
                            <tr class="hover:bg-blue-50">
                                <td class="px-4 py-3 font-medium text-blue-800">Modal</td>
                                <td class="px-4 py-3 text-gray-600">B·ªôt g·ªó s·ªìi</td>
                                <td class="px-4 py-3 text-gray-600">M·ªÅm m·∫°i, b·ªÅn m√†u, √≠t nhƒÉn, gi·ªØ form t·ªët</td>
                                <td class="px-4 py-3 text-gray-600">Gi√° cao h∆°n cotton</td>
                                <td class="px-4 py-3 text-gray-600">"Luxury c·∫£m ·ª©ng m·ªãn m√†ng"</td>
                            </tr>
                            <tr class="hover:bg-yellow-50">
                                <td class="px-4 py-3 font-medium text-yellow-800">Cotton</td>
                                <td class="px-4 py-3 text-gray-600">S·ª£i b√¥ng t·ª± nhi√™n</td>
                                <td class="px-4 py-3 text-gray-600">Tho√°ng kh√≠, th·∫•m h√∫t, gi√° c·∫£ ph·∫£i chƒÉng</td>
                                <td class="px-4 py-3 text-gray-600">D·ªÖ co r√∫t, nhƒÉn nhi·ªÅu</td>
                                <td class="px-4 py-3 text-gray-600">"ƒê√°ng tin c·∫≠y h√†ng ng√†y"</td>
                            </tr>
                            <tr class="hover:bg-purple-50">
                                <td class="px-4 py-3 font-medium text-purple-800">Lace</td>
                                <td class="px-4 py-3 text-gray-600">Ren polyester/nylon</td>
                                <td class="px-4 py-3 text-gray-600">Quy·∫øn r≈©, thanh l·ªãch, co gi√£n t·ªët</td>
                                <td class="px-4 py-3 text-gray-600">D·ªÖ r√°ch, c·∫ßn chƒÉm s√≥c ƒë·∫∑c bi·ªát</td>
                                <td class="px-4 py-3 text-gray-600">"N·ªØ t√≠nh v√† quy·∫øn r≈©"</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-6 px-6">
        <div class="max-w-7xl mx-auto text-center">
            <p class="text-sm opacity-80">¬© 2025 Copyright by Tien Hoang.</p>
            <div class="mt-4 flex justify-center space-x-4">
                <a href="#" class="text-white hover:text-yellow-300 transition duration-300">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="text-white hover:text-yellow-300 transition duration-300">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="#" class="text-white hover:text-yellow-300 transition duration-300">
                    <i class="fab fa-tiktok"></i>
                </a>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        // Variables to store data
        let encryptedApiKey = null;
        let generatedStoryContent = '';

        // API Key Encryption
        function encryptApiKey(apiKey) {
            const secretKey = 'gemini-storytelling-secret';
            encryptedApiKey = CryptoJS.AES.encrypt(apiKey, secretKey).toString();
        }

        function decryptApiKey() {
            if (!encryptedApiKey) return '';
            const secretKey = 'gemini-storytelling-secret';
            try {
                const bytes = CryptoJS.AES.decrypt(encryptedApiKey, secretKey);
                return bytes.toString(CryptoJS.enc.Utf8);
            } catch (error) {
                console.error('Decryption error:', error);
                return '';
            }
        }

        // Event listeners
        document.getElementById('apiKey').addEventListener('input', function(e) {
            if (e.target.value.trim()) {
                encryptApiKey(e.target.value);
            } else {
                encryptedApiKey = null;
            }
        });

        // Show loading state
        function showLoading(elementId, message) {
            document.getElementById(elementId).innerHTML = `
                <div class="text-center py-8">
                    <div class="pulse-animation">
                        <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                        <p class="text-lg font-semibold text-gray-700">${message}</p>
                        <p class="text-sm text-gray-500 mt-2">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</p>
                    </div>
                </div>
            `;
        }

        // Show error state
        function showError(elementId, message) {
            document.getElementById(elementId).innerHTML = `
                <div class="text-center py-8 text-red-500">
                    <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                    <p class="text-lg">${message}</p>
                    <p class="text-sm mt-2">Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin v√† th·ª≠ l·∫°i.</p>
                </div>
            `;
        }

        // Validate inputs
        function validateInputs(keyword, apiKey, requireTopic = false, topic = '') {
            if (!keyword) {
                alert('Vui l√≤ng nh·∫≠p t·ª´ kh√≥a');
                return false;
            }
            if (!apiKey) {
                alert('Vui l√≤ng nh·∫≠p Gemini API Key');
                return false;
            }
            if (requireTopic && !topic) {
                alert('Vui l√≤ng ch·ªçn m·ªôt ch·ªß ƒë·ªÅ');
                return false;
            }
            return true;
        }

        // Topic Generation
        async function generateTopics() {
            const keyword = document.getElementById('keywordInput').value.trim();
            const category = document.getElementById('categorySelect').value;
            const audience = document.getElementById('audienceSelect').value;
            const apiKey = decryptApiKey();

            if (!validateInputs(keyword, apiKey)) return;

            const topicSelect = document.getElementById('topicSelect');
            topicSelect.innerHTML = '<option value="">ƒêang t·∫°o ch·ªß ƒë·ªÅ...</option>';

            const categoryNames = {
                'tips': 'Tips - M·∫πo s·ª≠ d·ª•ng',
                'hack': 'Hack - Th·ªß thu·∫≠t',
                'material': 'Ch·∫•t li·ªáu',
                'design': 'Thi·∫øt k·∫ø',
                'seasonal': 'M√πa l·ªÖ h·ªôi',
                'mixmatch': 'Mix & Match',
                'color': 'M√†u s·∫Øc'
            };

            const audienceNames = {
                'women': 'Ph·ª• n·ªØ',
                'men': 'Nam gi·ªõi',
                'children': 'Tr·∫ª em',
                'students': 'H·ªçc sinh',
                'homewear': 'Homewear'
            };

            try {
                const prompt = `T·∫°o danh s√°ch 10 ch·ªß ƒë·ªÅ storytelling h·∫•p d·∫´n v·ªÅ n·ªôi y:
                - T·ª´ kh√≥a: "${keyword}"
                - Danh m·ª•c: "${categoryNames[category]}"
                - ƒê·ªëi t∆∞·ª£ng: "${audienceNames[audience]}"
                
                Y√™u c·∫ßu:
                1. M·ªói ch·ªß ƒë·ªÅ ng·∫Øn g·ªçn (1-2 c√¢u)
                2. H·∫•p d·∫´n, g√¢y t√≤ m√≤
                3. Ph√π h·ª£p v·ªõi framework Hook-Problem-Solution-Benefit-CTA
                4. Tr·∫£ v·ªÅ d·∫°ng danh s√°ch ƒë√°nh s·ªë t·ª´ 1-10
                5. M·ªói ch·ªß ƒë·ªÅ tr√™n m·ªôt d√≤ng ri√™ng`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.8,
                            maxOutputTokens: 1500,
                            topP: 0.9
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('Invalid response format from Gemini API');
                }

                const topicsText = data.candidates[0].content.parts[0].text;
                const topics = topicsText.split('\n')
                    .filter(t => t.trim())
                    .map(t => t.replace(/^\d+\.\s*/, '').trim())
                    .filter(t => t.length > 10)
                    .slice(0, 10);
                
                topicSelect.innerHTML = '<option value="">Ch·ªçn m·ªôt ch·ªß ƒë·ªÅ...</option>';
                
                if (topics.length > 0) {
                    topics.forEach((topic, index) => {
                        const option = document.createElement('option');
                        option.value = topic;
                        option.textContent = `${index + 1}. ${topic}`;
                        topicSelect.appendChild(option);
                    });
                } else {
                    topicSelect.innerHTML = '<option value="">Kh√¥ng t√¨m ƒë∆∞·ª£c ch·ªß ƒë·ªÅ ph√π h·ª£p. Vui l√≤ng th·ª≠ l·∫°i.</option>';
                }

            } catch (error) {
                console.error('Error generating topics:', error);
                topicSelect.innerHTML = '<option value="">L·ªói khi t·∫°o ch·ªß ƒë·ªÅ. Vui l√≤ng ki·ªÉm tra API key v√† th·ª≠ l·∫°i.</option>';
            }
        }

        // Story Generation
        async function generateStory() {
            const keyword = document.getElementById('keywordInput').value.trim();
            const audience = document.getElementById('audienceSelect').value;
            const category = document.getElementById('categorySelect').value;
            const topic = document.getElementById('topicSelect').value;
            const apiKey = decryptApiKey();

            if (!validateInputs(keyword, apiKey, true, topic)) return;

            showLoading('storyOutput', 'Gemini AI ƒëang t·∫°o storytelling...');

            const categoryNames = {
                'tips': 'Tips - M·∫πo s·ª≠ d·ª•ng',
                'hack': 'Hack - Th·ªß thu·∫≠t',
                'material': 'Ch·∫•t li·ªáu',
                'design': 'Thi·∫øt k·∫ø',
                'seasonal': 'M√πa l·ªÖ h·ªôi',
                'mixmatch': 'Mix & Match',
                'color': 'M√†u s·∫Øc'
            };

            const audienceNames = {
                'women': 'Ph·ª• n·ªØ',
                'men': 'Nam gi·ªõi',
                'children': 'Tr·∫ª em',
                'students': 'H·ªçc sinh',
                'homewear': 'Homewear'
            };

            try {
                const prompt = `T·∫°o storytelling chuy√™n nghi·ªáp cho s·∫£n ph·∫©m n·ªôi y:

                TH√îNG TIN:
                - T·ª´ kh√≥a: "${keyword}"
                - Ch·ªß ƒë·ªÅ: "${topic}"
                - Danh m·ª•c: "${categoryNames[category]}"
                - ƒê·ªëi t∆∞·ª£ng: "${audienceNames[audience]}"

                FRAMEWORK Y√äU C·∫¶U:
                1. HOOK (C√¢u m·ªü ƒë·∫ßu): T·∫°o s·ª± ch√∫ √Ω, g√¢y t√≤ m√≤
                2. PROBLEM (V·∫•n ƒë·ªÅ): X√°c ƒë·ªãnh pain point c·ªßa kh√°ch h√†ng
                3. STORY (C√¢u chuy·ªán): K·ªÉ chuy·ªán c·∫£m x√∫c, d·ªÖ ƒë·ªìng c·∫£m
                4. SOLUTION (Gi·∫£i ph√°p): Gi·ªõi thi·ªáu s·∫£n ph·∫©m/l·ªùi khuy√™n
                5. BENEFIT (L·ª£i √≠ch): M√¥ t·∫£ c·ª• th·ªÉ gi√° tr·ªã mang l·∫°i
                6. CTA (K√™u g·ªçi h√†nh ƒë·ªông): ƒê·ªông vi√™n h√†nh ƒë·ªông c·ª• th·ªÉ

                Y√äU C·∫¶U CONTENT:
                - ƒê·ªô d√†i: 300-500 t·ª´
                - Ng√¥n ng·ªØ: Ti·∫øng Vi·ªát th√¢n thi·ªán, d·ªÖ hi·ªÉu
                - T√¥ng ƒëi·ªáu: T·ª± tin, chuy√™n nghi·ªáp nh∆∞ng g·∫ßn g≈©i
                - C√≥ emoji ph√π h·ª£p ƒë·ªÉ tƒÉng engagement
                - Bao g·ªìm hashtag li√™n quan

                H√£y t·∫°o n·ªôi dung storytelling ho√†n ch·ªânh theo framework tr√™n.`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 2048,
                            topP: 0.8
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('Invalid response format from Gemini API');
                }

                const story = data.candidates[0].content.parts[0].text;
                generatedStoryContent = story;
                displayGeneratedStory(story, keyword, category, topic);

            } catch (error) {
                console.error('API Error:', error);
                showError('storyOutput', 'L·ªói khi t·∫°o storytelling. Vui l√≤ng ki·ªÉm tra API key v√† th·ª≠ l·∫°i.');
            }
        }

        // Display generated story
        function displayGeneratedStory(story, keyword, category, topic) {
            const categoryNames = {
                'tips': 'TIPS',
                'hack': 'HACK',
                'material': 'CH·∫§T LI·ªÜU',
                'design': 'THI·∫æT K·∫æ',
                'seasonal': 'M√ôA L·ªÑ H·ªòI',
                'mixmatch': 'MIX & MATCH',
                'color': 'M√ÄU S·∫ÆC'
            };

            // Format story content with proper paragraphs
            const formattedStory = story
                .split('\n')
                .filter(line => line.trim())
                .map(line => `<p class="mb-4">${line.trim()}</p>`)
                .join('');

            document.getElementById('storyOutput').innerHTML = `
                <div class="border-b border-gray-200 pb-4 mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <span class="bg-gradient-to-r from-blue-600 to-purple-600 text-white text-xs font-semibold px-3 py-1 rounded-full">
                                ${categoryNames[category]}
                            </span>
                            <span class="text-sm text-gray-500">
                                <i class="fas fa-key mr-1"></i>
                                ${keyword}
                            </span>
                        </div>
                        <div class="flex items-center space-x-2 text-xs text-gray-500">
                            <i class="fas fa-robot"></i>
                            <span>Generated by Gemini AI</span>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">${topic}</h3>
                </div>
                
                <div class="prose max-w-none text-gray-700 leading-relaxed">
                    ${formattedStory}
                </div>
                
                <div class="mt-8 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        <div>
                            <h4 class="font-semibold text-green-800 mb-1">Storytelling ho√†n th√†nh!</h4>
                            <p class="text-sm text-green-700">
                                N·ªôi dung ƒë√£ ƒë∆∞·ª£c t·ªëi ∆∞u cho engagement v√† conversion theo framework chuy√™n nghi·ªáp. 
                                B·∫°n c√≥ th·ªÉ copy v√† s·ª≠ d·ª•ng ngay cho chi·∫øn d·ªãch marketing.
                            </p>
                        </div>
                    </div>
                </div>
            `;

            // Show copy button
            document.getElementById('copyButton').classList.remove('hidden');
        }

        // Copy to clipboard function
        async function copyToClipboard() {
            if (!generatedStoryContent) {
                alert('Kh√¥ng c√≥ n·ªôi dung ƒë·ªÉ copy');
                return;
            }

            try {
                await navigator.clipboard.writeText(generatedStoryContent);
                
                const button = document.getElementById('copyButton');
                const originalContent = button.innerHTML;
                
                button.innerHTML = '<i class="fas fa-check mr-2"></i>ƒê√£ Copy!';
                button.classList.remove('bg-gray-600', 'hover:bg-gray-700');
                button.classList.add('bg-green-600', 'hover:bg-green-700');
                
                setTimeout(() => {
                    button.innerHTML = originalContent;
                    button.classList.remove('bg-green-600', 'hover:bg-green-700');
                    button.classList.add('bg-gray-600', 'hover:bg-gray-700');
                }, 2000);
                
            } catch (error) {
                console.error('Copy failed:', error);
                alert('Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng.');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Add intersection observer for animations
            const cards = document.querySelectorAll('.story-card');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.transform = 'translateY(0)';
                        entry.target.style.opacity = '1';
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            cards.forEach((card, index) => {
                card.style.transform = 'translateY(20px)';
                card.style.opacity = '0';
                card.style.transition = `all 0.6s ease ${index * 0.1}s`;
                observer.observe(card);
            });

            // Add smooth scrolling for better UX
            document.documentElement.style.scrollBehavior = 'smooth';

            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'Enter':
                            e.preventDefault();
                            if (document.getElementById('topicSelect').value) {
                                generateStory();
                            } else {
                                generateTopics();
                            }
                            break;
                        case 'c':
                            if (generatedStoryContent) {
                                e.preventDefault();
                                copyToClipboard();
                            }
                            break;
                    }
                }
            });
        });
    </script>
</body>
</html>
        </div>
        
        <div class="tab-content" id="lingerie_desriptions.html">
            <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫°o M√¥ T·∫£ S·∫£n Ph·∫©m N·ªôi Y & ƒê·ªì M·∫∑c Nh√† - SEO AI Generator</title>
    <meta name="description" content="·ª®ng d·ª•ng t·∫°o m√¥ t·∫£ s·∫£n ph·∫©m n·ªôi y, ƒë·ªì m·∫∑c nh√† chu·∫©n SEO s·ª≠ d·ª•ng AI. T·ªëi ∆∞u h√≥a n·ªôi dung cho website b√°n h√†ng th·ªùi trang n·ªØ, nam, tr·∫ª em.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js"></script>
    <style>
        :root {
            --primary: #ec4899;
            --secondary: #be185d;
        }
        .bg-primary { background-color: var(--primary); }
        .text-primary { color: var(--primary); }
        .border-primary { border-color: var(--primary); }
        .hover\:bg-secondary:hover { background-color: var(--secondary); }
        .focus\:ring-primary:focus { --tw-ring-color: var(--primary); }
        .border-b-2.border-primary { border-bottom: 2px solid var(--primary); }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-50 to-purple-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-heart text-3xl text-primary"></i>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">AI Product Description Generator</h1>
                        <p class="text-sm text-gray-600">N·ªôi Y & ƒê·ªì M·∫∑c Nh√† - Gemini 2.0 Flash</p>
                    </div>
                </div>
                <div class="text-sm text-gray-600">
                    <i class="fas fa-search mr-1"></i>
                    SEO Optimized
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- API Key Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex items-center space-x-3 mb-4">
                <i class="fas fa-key text-2xl text-yellow-500"></i>
                <h2 class="text-xl font-semibold text-gray-900">C·∫•u H√¨nh API Key</h2>
            </div>
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                <div class="flex">
                    <i class="fas fa-exclamation-triangle text-yellow-400 mr-2 mt-1"></i>
                    <div>
                        <p class="text-sm text-yellow-700">
                            <strong>L∆∞u √Ω:</strong> API Key ch·ªâ ƒë∆∞·ª£c l∆∞u trong phi√™n l√†m vi·ªác hi·ªán t·∫°i v√† kh√¥ng ƒë∆∞·ª£c g·ª≠i ƒë·∫øn server kh√°c.
                        </p>
                        <p class="text-sm text-yellow-700 mt-1">
                            ƒê·ªÉ l·∫•y API Key, truy c·∫≠p: 
                            <a href="https://aistudio.google.com/apikey" target="_blank" class="underline font-medium">
                                Google AI Studio API Key
                            </a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="flex space-x-4">
                <input 
                    type="password" 
                    id="apiKey" 
                    placeholder="Nh·∫≠p Google Gemini API Key..." 
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                />
                <button 
                    onclick="saveApiKey()" 
                    class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors duration-200">
                    <i class="fas fa-save mr-2"></i>
                    L∆∞u Key
                </button>
            </div>
            <div id="apiKeyStatus" class="mt-2 text-sm"></div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Input Form -->
            <div class="space-y-8">
                <!-- Product Info Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <i class="fas fa-tshirt text-2xl text-primary"></i>
                        <h2 class="text-xl font-semibold text-gray-900">INPUT A - Th√¥ng Tin S·∫£n Ph·∫©m</h2>
                    </div>
                    
                    <form id="productForm" class="space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">T√™n s·∫£n ph·∫©m *</label>
                                <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: √Åo ng·ªß l·ª•a cao c·∫•p">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Lo·∫°i s·∫£n ph·∫©m</label>
                                <select name="type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Ch·ªçn lo·∫°i s·∫£n ph·∫©m</option>
                                    <option value="√Åo bra">√Åo bra</option>
                                    <option value="Qu·∫ßn l√≥t">Qu·∫ßn l√≥t</option>
                                    <option value="B·ªô ƒë·ªì l√≥t">B·ªô ƒë·ªì l√≥t</option>
                                    <option value="√Åo ng·ªß">√Åo ng·ªß</option>
                                    <option value="V√°y ng·ªß">V√°y ng·ªß</option>
                                    <option value="Pyjama">Pyjama</option>
                                    <option value="B·ªô m·∫∑c nh√†">B·ªô m·∫∑c nh√†</option>
                                    <option value="√Åo l√≥t">√Åo l√≥t</option>
                                    <option value="Qu·∫ßn boxer">Qu·∫ßn boxer</option>
                                    <option value="ƒê·ªì l√≥t tr·∫ª em">ƒê·ªì l√≥t tr·∫ª em</option>
                                    <option value="Bodysuit">Bodysuit</option>
                                    <option value="Shapewear">Shapewear</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ch·∫•t li·ªáu</label>
                                <input type="text" name="material" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: Cotton 95%, Spandex 5%">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ki·ªÉu d√°ng</label>
                                <input type="text" name="style" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: √îm body, tho·∫£i m√°i">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Thi·∫øt k·∫ø</label>
                            <input type="text" name="design" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: H·ªça ti·∫øt hoa, vi·ªÅn ren, m√†u tr∆°n">
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phom √°o</label>
                                <input type="text" name="top_fit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: √îm v·ª´a, t√¥n d√°ng">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phom qu·∫ßn</label>
                                <input type="text" name="bottom_fit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: Low-rise, high-waist">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">M√∫t √°o bra</label>
                                <input type="text" name="padding" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: C√≥ m√∫t d√†y, push-up, m√∫t gel...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">D√¢y vai</label>
                                <input type="text" name="strap" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: D√¢y to, d√¢y ch√©o, kh√¥ng d√¢y...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">BƒÉng l∆∞ng</label>
                                <input type="text" name="back_band" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: BƒÉng cao, c√≥ wire, bƒÉng ren...">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">M·∫Øc c√†i</label>
                                <input type="text" name="clasp" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: M·∫Øc c√†i sau, kh√≥a k√©o, n√∫t b·∫•m...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">M√†u s·∫Øc</label>
                                <input type="text" name="color" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: ƒêen, tr·∫Øng, h·ªìng nude">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">K√≠ch th∆∞·ªõc</label>
                                <input type="text" name="size" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: 32A, 34B, S, M, L">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Gi·ªõi t√≠nh</label>
                                <select name="gender" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Ch·ªçn gi·ªõi t√≠nh</option>
                                    <option value="N·ªØ">N·ªØ</option>
                                    <option value="Nam">Nam</option>
                                    <option value="Tr·∫ª em n·ªØ">Tr·∫ª em n·ªØ</option>
                                    <option value="Tr·∫ª em nam">Tr·∫ª em nam</option>
                                    <option value="Unisex">Unisex</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ƒê·ªô tu·ªïi</label>
                                <select name="age_group" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Ch·ªçn ƒë·ªô tu·ªïi</option>
                                    <option value="Tr·∫ª em (3-12 tu·ªïi)">Tr·∫ª em (3-12 tu·ªïi)</option>
                                    <option value="Teen (13-17 tu·ªïi)">Teen (13-17 tu·ªïi)</option>
                                    <option value="Ng∆∞·ªùi l·ªõn (18-40 tu·ªïi)">Ng∆∞·ªùi l·ªõn (18-40 tu·ªïi)</option>
                                    <option value="Trung ni√™n (40+ tu·ªïi)">Trung ni√™n (40+ tu·ªïi)</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Phong c√°ch m√¥ t·∫£</label>
                            <select name="description_style" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Ch·ªçn phong c√°ch</option>
                                <option value="Tho·∫£i m√°i ti·ªán l·ª£i">Tho·∫£i m√°i & Ti·ªán l·ª£i (H√†ng ng√†y)</option>
                                <option value="Cao c·∫•p sang tr·ªçng">Cao c·∫•p & Sang tr·ªçng (Premium)</option>
                                <option value="Quy·∫øn r≈© g·ª£i c·∫£m">Quy·∫øn r≈© & G·ª£i c·∫£m (Romantic)</option>
                                <option value="Tr·∫ª trung nƒÉng ƒë·ªông">Tr·∫ª trung & NƒÉng ƒë·ªông (Teen/Young)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Phong c√°ch ·∫£nh h∆∞·ªüng ƒë·∫øn tone vi·∫øt v√† t·ª´ kh√≥a SEO</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">T√≠nh nƒÉng ƒë·∫∑c bi·ªát</label>
                            <textarea name="other_content" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: Kh√°ng khu·∫©n, th·∫•m h√∫t m·ªì h√¥i, ƒë·ªãnh h√¨nh, n√¢ng ng·ª±c..."></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ph·ªëi ƒë·ªì & S·ª≠ d·ª•ng</label>
                            <textarea name="mix_match" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: Ph√π h·ª£p m·∫∑c nh√†, ng·ªß, k·∫øt h·ª£p v·ªõi √°o kho√°c..."></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Th√†nh ph·∫ßn ch·∫•t li·ªáu</label>
                            <textarea name="composition" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="VD: 95% Cotton, 5% Spandex - m·ªÅm m·∫°i, co gi√£n t·ªët"></textarea>
                        </div>
                    </form>
                </div>

                <!-- Image Upload Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <i class="fas fa-images text-2xl text-purple-500"></i>
                        <h2 class="text-xl font-semibold text-gray-900">INPUT B - H√¨nh ·∫¢nh S·∫£n Ph·∫©m (T√πy ch·ªçn)</h2>
                    </div>
                    
                    <div class="space-y-4">
                        <!-- Upload Area -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-colors duration-200" 
                             ondrop="dropHandler(event)" 
                             ondragover="dragOverHandler(event)" 
                             ondragleave="dragLeaveHandler(event)">
                            <div id="uploadArea" class="space-y-4">
                                <div class="mx-auto w-16 h-16 bg-gradient-to-r from-pink-100 to-purple-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-cloud-upload-alt text-2xl text-primary"></i>
                                </div>
                                <div>
                                    <p class="text-lg font-medium text-gray-700 mb-2">K√©o th·∫£ h√¨nh ·∫£nh v√†o ƒë√¢y</p>
                                    <p class="text-sm text-gray-500 mb-4">ho·∫∑c</p>
                                    <label for="imageInput" class="inline-flex items-center px-6 py-3 bg-primary text-white rounded-lg hover:bg-secondary transition-colors duration-200 cursor-pointer">
                                        <i class="fas fa-folder-open mr-2"></i>
                                        Ch·ªçn H√¨nh ·∫¢nh
                                    </label>
                                    <input type="file" id="imageInput" accept="image/*" multiple class="hidden" onchange="handleFileSelect(event)">
                                </div>
                                <p class="text-xs text-gray-400">H·ªó tr·ª£: JPG, PNG, WebP (T·ªëi ƒëa 5MB m·ªói file)</p>
                            </div>
                        </div>

                        <!-- Image Preview Grid -->
                        <div id="imagePreview" class="grid grid-cols-2 md:grid-cols-3 gap-4 hidden">
                            <!-- Images will be displayed here -->
                        </div>

                        <!-- Clear Images Button -->
                        <div id="clearImagesBtn" class="text-center hidden">
                            <button onclick="clearImages()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-200">
                                <i class="fas fa-trash-alt mr-2"></i>
                                X√≥a T·∫•t C·∫£ H√¨nh
                            </button>
                        </div>

                        <!-- Image Analysis Toggle -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" id="useImageAnalysis" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                                <label for="useImageAnalysis" class="text-sm font-medium text-gray-700">
                                    S·ª≠ d·ª•ng AI ph√¢n t√≠ch h√¨nh ·∫£nh ƒë·ªÉ c·∫£i thi·ªán m√¥ t·∫£
                                </label>
                            </div>
                            <p class="text-xs text-gray-500 mt-2 ml-7">
                                AI s·∫Ω ph√¢n t√≠ch h√¨nh ·∫£nh ƒë·ªÉ b·ªï sung th√¥ng tin v·ªÅ m√†u s·∫Øc, thi·∫øt k·∫ø, ch·∫•t li·ªáu v√† ki·ªÉu d√°ng
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex space-x-4">
                        <button onclick="generateDescription()" class="flex-1 px-6 py-3 bg-gradient-to-r from-pink-600 to-purple-600 text-white rounded-lg hover:from-pink-700 hover:to-purple-700 transition-all duration-200 font-medium">
                            <i class="fas fa-magic mr-2"></i>
                            T·∫°o M√¥ T·∫£ AI
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="space-y-8">
                <!-- Loading State -->
                <div id="loadingState" class="bg-white rounded-xl shadow-lg p-8 text-center hidden">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
                    <p class="text-gray-600">ƒêang t·∫°o m√¥ t·∫£ s·∫£n ph·∫©m chuy√™n nghi·ªáp...</p>
                </div>

                <!-- Generated Description -->
                <div id="resultPanel" class="bg-white rounded-xl shadow-lg p-6 hidden">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-file-text text-2xl text-purple-500"></i>
                            <h2 class="text-xl font-semibold text-gray-900">M√¥ T·∫£ S·∫£n Ph·∫©m AI</h2>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="copyDescription()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200 text-sm">
                                <i class="fas fa-copy mr-1"></i>
                                Copy
                            </button>
                            <button onclick="exportToDocx()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm">
                                <i class="fas fa-file-word mr-1"></i>
                                T·∫£i DOCX
                            </button>
                        </div>
                    </div>
                    
                    <div id="descriptionContent" class="space-y-6">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Instructions -->
                <div class="bg-gradient-to-r from-pink-100 to-purple-100 rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3 mb-4">
                        <i class="fas fa-info-circle text-2xl text-pink-600"></i>
                        <h2 class="text-xl font-semibold text-gray-900">H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng</h2>
                    </div>
                    
                    <div class="space-y-3 text-sm text-gray-700">
                        <div class="flex items-start space-x-2">
                            <span class="bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">1</span>
                            <p>Nh·∫≠p API Key Google Gemini (mi·ªÖn ph√≠ t·∫°i aistudio.google.com)</p>
                        </div>
                        <div class="flex items-start space-x-2">
                            <span class="bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">2</span>
                            <p>ƒêi·ªÅn th√¥ng tin s·∫£n ph·∫©m n·ªôi y/ƒë·ªì m·∫∑c nh√† chi ti·∫øt</p>
                        </div>
                        <div class="flex items-start space-x-2">
                            <span class="bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">3</span>
                            <p>Upload h√¨nh ·∫£nh s·∫£n ph·∫©m (t√πy ch·ªçn) v√† b·∫≠t ph√¢n t√≠ch AI</p>
                        </div>
                        <div class="flex items-start space-x-2">
                            <span class="bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">4</span>
                            <p>Nh·∫•n "T·∫°o M√¥ T·∫£ AI" ƒë·ªÉ t·∫°o n·ªôi dung chu·∫©n SEO</p>
                        </div>
                        <div class="flex items-start space-x-2">
                            <span class="bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">5</span>
                            <p>Copy n·ªôi dung ho·∫∑c t·∫£i xu·ªëng file DOCX</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white shadow-lg mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center text-gray-600">
                <p class="text-sm">
                    ¬© 2025 <strong>Hoang Tien</strong>. All rights reserved. | 
                    AI Product Description Generator for Lingerie & Sleepwear
                </p>
                <p class="text-xs mt-2 text-gray-500">
                    T·∫°o m√¥ t·∫£ s·∫£n ph·∫©m n·ªôi y, ƒë·ªì m·∫∑c nh√† chuy√™n nghi·ªáp v·ªõi c√¥ng ngh·ªá AI
                </p>
            </div>
        </div>
    </footer>

    <script>
        let currentDescription = null;
        let uploadedImages = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const savedKey = sessionStorage.getItem('gemini_api_key');
            if (savedKey) {
                showStatus('apiKeyStatus', 'API Key ƒë√£ ƒë∆∞·ª£c l∆∞u tr∆∞·ªõc ƒë√≥!', 'success');
            }
        });

        // Image Upload Functions
        function dragOverHandler(e) {
            e.preventDefault();
            e.currentTarget.classList.add('border-primary', 'bg-pink-50');
        }

        function dragLeaveHandler(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('border-primary', 'bg-pink-50');
        }

        function dropHandler(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('border-primary', 'bg-pink-50');
            
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }

        function handleFiles(files) {
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                alert('Vui l√≤ng ch·ªçn file h√¨nh ·∫£nh h·ª£p l·ªá!');
                return;
            }

            imageFiles.forEach(file => {
                if (file.size > 5 * 1024 * 1024) { // 5MB
                    alert(`File ${file.name} qu√° l·ªõn. Vui l√≤ng ch·ªçn file nh·ªè h∆°n 5MB.`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImages.push({
                        file: file,
                        dataUrl: e.target.result,
                        name: file.name
                    });
                    displayImages();
                };
                reader.readAsDataURL(file);
            });
        }

        function displayImages() {
            const previewContainer = document.getElementById('imagePreview');
            const clearBtn = document.getElementById('clearImagesBtn');

            if (uploadedImages.length === 0) {
                previewContainer.classList.add('hidden');
                clearBtn.classList.add('hidden');
                return;
            }

            previewContainer.classList.remove('hidden');
            clearBtn.classList.remove('hidden');

            previewContainer.innerHTML = uploadedImages.map((img, index) => `
                <div class="relative group">
                    <img src="${img.dataUrl}" alt="${sanitizeHtml(img.name)}" 
                         class="w-full h-32 object-cover rounded-lg border border-gray-200">
                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 rounded-lg flex items-center justify-center">
                        <button onclick="removeImage(${index})" 
                                class="opacity-0 group-hover:opacity-100 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-all duration-200">
                            <i class="fas fa-times text-sm"></i>
                        </button>
                    </div>
                    <div class="absolute bottom-2 left-2 right-2">
                        <div class="bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded truncate">
                            ${sanitizeHtml(img.name)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function removeImage(index) {
            uploadedImages.splice(index, 1);
            displayImages();
        }

        function clearImages() {
            uploadedImages = [];
            displayImages();
            document.getElementById('imageInput').value = '';
        }

        // Sanitize HTML to prevent XSS
        function sanitizeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // Convert image to base64 for Gemini API
        function imageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1]; // Remove data:image/...;base64, prefix
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // API Key Management - Changed to sessionStorage for better security
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (apiKey) {
                sessionStorage.setItem('gemini_api_key', apiKey);
                showStatus('apiKeyStatus', 'API Key ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng!', 'success');
                document.getElementById('apiKey').value = '';
            } else {
                showStatus('apiKeyStatus', 'Vui l√≤ng nh·∫≠p API Key!', 'error');
            }
        }

        function getApiKey() {
            return sessionStorage.getItem('gemini_api_key');
        }

        // Status Message Helper
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'mt-2 text-sm ' + (type === 'success' ? 'text-green-600' : 'text-red-600');
        }

        // Form Data Collection
        function collectFormData() {
            const form = document.getElementById('productForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (value.trim()) {
                    data[key] = value.trim();
                }
            }
            
            return data;
        }

        // Generate Description with AI
        async function generateDescription() {
            const apiKey = getApiKey();
            if (!apiKey) {
                alert('Vui l√≤ng nh·∫≠p API Key tr∆∞·ªõc!');
                return;
            }

            const formData = collectFormData();
            if (!formData.name) {
                alert('Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m!');
                return;
            }

            // Show loading
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('resultPanel').classList.add('hidden');

            try {
                const useImageAnalysis = document.getElementById('useImageAnalysis').checked;
                let imageAnalysis = '';

                // Analyze images if enabled and images available
                if (useImageAnalysis && uploadedImages.length > 0) {
                    try {
                        imageAnalysis = await analyzeImages(apiKey);
                    } catch (error) {
                        console.warn('Image analysis failed:', error);
                        // Continue without image analysis
                    }
                }

                const prompt = buildPrompt(formData, imageAnalysis);
                const description = await callGeminiAPI(apiKey, prompt);
                
                currentDescription = description;
                displayDescription(description);
                
            } catch (error) {
                console.error('Error:', error);
                alert('C√≥ l·ªói x·∫£y ra khi t·∫°o m√¥ t·∫£: ' + error.message);
            } finally {
                document.getElementById('loadingState').classList.add('hidden');
            }
        }

        // Analyze Images with Gemini Vision API - Updated to Gemini 2.0 Flash
        async function analyzeImages(apiKey) {
            if (uploadedImages.length === 0) return '';

            try {
                const firstImage = uploadedImages[0];
                const base64Image = await imageToBase64(firstImage.file);

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {
                                    text: "Ph√¢n t√≠ch h√¨nh ·∫£nh s·∫£n ph·∫©m n·ªôi y/ƒë·ªì m·∫∑c nh√† n√†y v√† m√¥ t·∫£ chi ti·∫øt v·ªÅ: 1) M√†u s·∫Øc ch√≠nh v√† ph·ª•, 2) Ch·∫•t li·ªáu (d·ª±a tr√™n v·∫ª ngo√†i), 3) Ki·ªÉu d√°ng v√† thi·∫øt k·∫ø, 4) H·ªça ti·∫øt ho·∫∑c chi ti·∫øt ƒë·∫∑c bi·ªát, 5) Phong c√°ch t·ªïng th·ªÉ. Tr·∫£ l·ªùi b·∫±ng ti·∫øng Vi·ªát, ng·∫Øn g·ªçn v√† ch√≠nh x√°c."
                                },
                                {
                                    inline_data: {
                                        mime_type: firstImage.file.type,
                                        data: base64Image
                                    }
                                }
                            ]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`Image analysis failed: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                }
                
                return '';
            } catch (error) {
                console.error('Image analysis error:', error);
                return '';
            }
        }

        // Build AI Prompt with fixed format
        function buildPrompt(data, imageAnalysis = '') {
            let prompt = `T·∫°o m√¥ t·∫£ s·∫£n ph·∫©m n·ªôi y/ƒë·ªì m·∫∑c nh√† theo format chu·∫©n v·ªõi th√¥ng tin:

TH√îNG TIN S·∫¢N PH·∫®M:
- T√™n: ${data.name}
${data.type ? `- Lo·∫°i: ${data.type}` : ''}
${data.material ? `- Ch·∫•t li·ªáu: ${data.material}` : ''}
${data.style ? `- Ki·ªÉu d√°ng: ${data.style}` : ''}
${data.design ? `- Thi·∫øt k·∫ø: ${data.design}` : ''}
${data.top_fit ? `- Phom √°o: ${data.top_fit}` : ''}
${data.bottom_fit ? `- Phom qu·∫ßn: ${data.bottom_fit}` : ''}
${data.padding ? `- M√∫t: ${data.padding}` : ''}
${data.strap ? `- D√¢y vai: ${data.strap}` : ''}
${data.back_band ? `- BƒÉng l∆∞ng: ${data.back_band}` : ''}
${data.clasp ? `- M·∫Øc c√†i: ${data.clasp}` : ''}
${data.color ? `- M√†u s·∫Øc: ${data.color}` : ''}
${data.size ? `- Size: ${data.size}` : ''}
${data.gender ? `- Gi·ªõi t√≠nh: ${data.gender}` : ''}
${data.age_group ? `- ƒê·ªô tu·ªïi: ${data.age_group}` : ''}
${data.description_style ? `- Phong c√°ch: ${data.description_style}` : ''}
${data.other_content ? `- T√≠nh nƒÉng ƒë·∫∑c bi·ªát: ${data.other_content}` : ''}
${data.mix_match ? `- Ph·ªëi ƒë·ªì: ${data.mix_match}` : ''}
${data.composition ? `- Th√†nh ph·∫ßn: ${data.composition}` : ''}`;

            if (imageAnalysis) {
                prompt += `

PH√ÇN T√çCH H√åNH ·∫¢NH:
${imageAnalysis}
(S·ª≠ d·ª•ng th√¥ng tin n√†y ƒë·ªÉ b·ªï sung v√† c·∫£i thi·ªán m√¥ t·∫£ s·∫£n ph·∫©m)`;
            }

            prompt += `

FORMAT Y√äU C·∫¶U:
Tr·∫£ v·ªÅ format JSON v·ªõi 4 ph·∫ßn CH√çNH X√ÅC:
{
  "title": "T√™n s·∫£n ph·∫©m l√†m ti√™u ƒë·ªÅ ch√≠nh (60-80 t·ª´)",
  "short_description": "T·∫°o CH√çNH X√ÅC 4 c√¢u m√¥ t·∫£ ng·∫Øn, m·ªói c√¢u 15-20 t·ª´, c√°ch nhau b·ªüi \\n",
  "detailed_description": "1 ƒëo·∫°n vƒÉn d√†i CH√çNH X√ÅC 150-200 t·ª´ mi√™u t·∫£ chi ti·∫øt s·∫£n ph·∫©m",
  "specifications": {
    "Ch·∫•t li·ªáu": "...",
    "Size": "...", 
    "M√†u s·∫Øc": "...",
    "Xu·∫•t x·ª©": "Vi·ªát Nam"
  }
}

QUAN TR·ªåNG:
- M√¥ t·∫£ ng·∫Øn: CH√çNH X√ÅC 4 c√¢u, m·ªói c√¢u 15-20 t·ª´
- M√¥ t·∫£ chi ti·∫øt: CH√çNH X√ÅC 150-200 t·ª´
- S·ª≠ d·ª•ng t·ª´ kh√≥a SEO ph√π h·ª£p v·ªõi phong c√°ch ƒë√£ ch·ªçn
- ƒê·∫£m b·∫£o n·ªôi dung ph√π h·ª£p v·ªõi s·∫£n ph·∫©m n·ªôi y/ƒë·ªì m·∫∑c nh√†
- Title ph·∫£i l·∫•y ch√≠nh x√°c t√™n s·∫£n ph·∫©m t·ª´ input: "${data.name}"`;

            return prompt;
        }

        // Call Gemini API - Updated to Gemini 2.0 Flash with improved error handling
        async function callGeminiAPI(apiKey, prompt, retryCount = 0) {
            const maxRetries = 3;
            const baseDelay = 2000;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 2048,
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    
                    if ((response.status === 503 || response.status === 429 || response.status === 500) && retryCount < maxRetries) {
                        const delay = baseDelay * Math.pow(2, retryCount);
                        console.log(`API error ${response.status}, retrying in ${delay}ms... (attempt ${retryCount + 1}/${maxRetries})`);
                        
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return callGeminiAPI(apiKey, prompt, retryCount + 1);
                    }
                    
                    let errorMessage = `API l·ªói (${response.status})`;
                    if (response.status === 503) {
                        errorMessage = 'API hi·ªán ƒëang qu√° t·∫£i. Vui l√≤ng th·ª≠ l·∫°i sau v√†i ph√∫t.';
                    } else if (response.status === 429) {
                        errorMessage = 'ƒê√£ v∆∞·ª£t qu√° gi·ªõi h·∫°n request. Vui l√≤ng ch·ªù m·ªôt ch√∫t r·ªìi th·ª≠ l·∫°i.';
                    } else if (response.status === 500) {
                        errorMessage = 'L·ªói server API. Vui l√≤ng th·ª≠ l·∫°i sau.';
                    } else if (response.status === 401 || response.status === 403) {
                        errorMessage = 'API Key kh√¥ng h·ª£p l·ªá ho·∫∑c h·∫øt h·∫°n. Vui l√≤ng ki·ªÉm tra l·∫°i API Key.';
                    } else if (response.status === 400) {
                        errorMessage = 'Y√™u c·∫ßu kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra th√¥ng tin nh·∫≠p v√†o.';
                    }
                    
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                console.log('API Response:', data);
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi h·ª£p l·ªá t·ª´ API. Vui l√≤ng th·ª≠ l·∫°i.');
                }

                const text = data.candidates[0].content.parts[0].text;
                
                // Try to parse JSON response with improved validation
                try {
                    const jsonStart = text.indexOf('{');
                    const jsonEnd = text.lastIndexOf('}') + 1;
                    if (jsonStart >= 0 && jsonEnd > jsonStart) {
                        const jsonText = text.substring(jsonStart, jsonEnd);
                        const parsedResult = JSON.parse(jsonText);
                        
                        // Validate and sanitize required fields
                        const result = {
                            title: sanitizeText(parsedResult.title) || sanitizeText(collectFormData().name) || "M√¥ t·∫£ s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng cao",
                            short_description: sanitizeText(parsedResult.short_description) || "Thi·∫øt k·∫ø th·ªùi trang, hi·ªán ƒë·∫°i\nCh·∫•t li·ªáu cao c·∫•p, b·ªÅn ƒë·∫πp\nTho·∫£i m√°i khi s·ª≠ d·ª•ng\nPh√π h·ª£p nhi·ªÅu d√°ng ng∆∞·ªùi",
                            detailed_description: sanitizeText(parsedResult.detailed_description) || "S·∫£n ph·∫©m ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi ch·∫•t li·ªáu cao c·∫•p, mang ƒë·∫øn s·ª± tho·∫£i m√°i v√† phong c√°ch cho ng∆∞·ªùi s·ª≠ d·ª•ng.",
                            specifications: sanitizeSpecifications(parsedResult.specifications) || {
                                "Ch·∫•t li·ªáu": "Cotton cao c·∫•p",
                                "Size": "S, M, L, XL", 
                                "M√†u s·∫Øc": "ƒêen, tr·∫Øng, h·ªìng nude",
                                "Xu·∫•t x·ª©": "Vi·ªát Nam"
                            }
                        };
                        
                        return result;
                    }
                } catch (e) {
                    console.warn('Could not parse JSON, using fallback format', e);
                }
                
                // Fallback: Create structured data from plain text
                return createFallbackDescription(text);
                
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn API. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi internet.');
                }
                console.error('API call error:', error);
                throw error;
            }
        }

        // Sanitize text to prevent XSS attacks
        function sanitizeText(text) {
            if (!text || typeof text !== 'string') return '';
            
            // Remove potential HTML/script tags
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML
                .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                .replace(/<[^>]*>/g, '')
                .trim();
        }

        // Sanitize specifications object
        function sanitizeSpecifications(specs) {
            if (!specs || typeof specs !== 'object') return null;
            
            const sanitized = {};
            Object.keys(specs).forEach(key => {
                const sanitizedKey = sanitizeText(key);
                const sanitizedValue = sanitizeText(specs[key]);
                if (sanitizedKey && sanitizedValue) {
                    sanitized[sanitizedKey] = sanitizedValue;
                }
            });
            
            return Object.keys(sanitized).length > 0 ? sanitized : null;
        }

        // Create fallback description structure
        function createFallbackDescription(text) {
            const formData = collectFormData();
            
            return {
                title: formData.name || "M√¥ t·∫£ s·∫£n ph·∫©m ch·∫•t l∆∞·ª£ng cao",
                short_description: "Thi·∫øt k·∫ø th·ªùi trang, hi·ªán ƒë·∫°i v√† tinh t·∫ø\nCh·∫•t li·ªáu cao c·∫•p, m·ªÅm m·∫°i v√† b·ªÅn ƒë·∫πp\nMang l·∫°i c·∫£m gi√°c tho·∫£i m√°i khi m·∫∑c\nPh√π h·ª£p v·ªõi nhi·ªÅu d√°ng ng∆∞·ªùi kh√°c nhau",
                detailed_description: sanitizeText(text) || "S·∫£n ph·∫©m ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi ch·∫•t li·ªáu cao c·∫•p, mang ƒë·∫øn s·ª± tho·∫£i m√°i v√† phong c√°ch cho ng∆∞·ªùi s·ª≠ d·ª•ng. V·ªõi ki·ªÉu d√°ng hi·ªán ƒë·∫°i v√† t√≠nh nƒÉng ∆∞u vi·ªát, ƒë√¢y l√† l·ª±a ch·ªçn ho√†n h·∫£o cho nhu c·∫ßu h√†ng ng√†y.",
                specifications: {
                    "Ch·∫•t li·ªáu": formData.material || formData.composition || "Cotton cao c·∫•p",
                    "Size": formData.size || "S, M, L, XL", 
                    "M√†u s·∫Øc": formData.color || "ƒêen, tr·∫Øng, h·ªìng nude",
                    "Xu·∫•t x·ª©": "Vi·ªát Nam"
                }
            };
        }

        // Display Generated Description with XSS protection
        function displayDescription(description) {
            const content = document.getElementById('descriptionContent');
            
            if (!description || typeof description !== 'object') {
                description = createFallbackDescription();
            }
            
            // Process short description safely
            let shortDescItems = [];
            if (description.short_description && typeof description.short_description === 'string') {
                shortDescItems = description.short_description
                    .split('\n')
                    .filter(item => item.trim() !== '')
                    .map(item => sanitizeText(item.replace(/^[‚Ä¢\-\*]\s*/, '').trim()))
                    .filter(item => item.length > 0);
            }
            
            // Ensure we have at least 4 bullet points
            if (shortDescItems.length < 4) {
                const defaultItems = [
                    "Thi·∫øt k·∫ø th·ªùi trang, hi·ªán ƒë·∫°i v√† tinh t·∫ø",
                    "Ch·∫•t li·ªáu cao c·∫•p, m·ªÅm m·∫°i v√† b·ªÅn ƒë·∫πp", 
                    "Mang l·∫°i c·∫£m gi√°c tho·∫£i m√°i khi m·∫∑c",
                    "Ph√π h·ª£p v·ªõi nhi·ªÅu d√°ng ng∆∞·ªùi kh√°c nhau"
                ];
                shortDescItems = [...shortDescItems, ...defaultItems].slice(0, 4);
            }
            
            // Sanitize all content before displaying
            const safeTitle = sanitizeText(description.title);
            const safeDetailedDescription = sanitizeText(description.detailed_description);
            
            content.innerHTML = `
                <div class="space-y-8">
                    <!-- Title (H2) -->
                    <div class="border-b-2 border-primary pb-4">
                        <h2 class="text-3xl font-bold text-gray-900 leading-tight">${safeTitle}</h2>
                    </div>

                    <!-- Short Description (4 bullet points) -->
                    <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl p-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">M√¥ T·∫£ Ng·∫Øn</h3>
                        <ul class="space-y-3">
                            ${shortDescItems.map(item => `
                                <li class="flex items-start space-x-3">
                                    <div class="w-2 h-2 bg-primary rounded-full mt-2 flex-shrink-0"></div>
                                    <span class="text-gray-700 leading-relaxed">${item}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <!-- Detailed Description (Long paragraph) -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">M√¥ T·∫£ Chi Ti·∫øt</h3>
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <div class="prose prose-gray max-w-none">
                                <p class="text-gray-700 leading-loose text-justify indent-8">${safeDetailedDescription}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Specifications -->
                    ${description.specifications && Object.keys(description.specifications).length ? `
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Th√¥ng S·ªë K·ªπ Thu·∫≠t</h3>
                        <div class="bg-gray-50 border border-gray-200 rounded-lg overflow-hidden">
                            <table class="w-full">
                                <tbody class="divide-y divide-gray-200">
                                    ${Object.entries(description.specifications).map(([key, value]) => `
                                        <tr class="hover:bg-gray-100 transition-colors">
                                            <td class="px-6 py-4 font-medium text-gray-900 bg-gray-100 w-1/3">${sanitizeText(key)}</td>
                                            <td class="px-6 py-4 text-gray-700">${sanitizeText(value)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('resultPanel').classList.remove('hidden');
        }

        // Copy to Clipboard with improved handling
        function copyDescription() {
            if (!currentDescription) {
                alert('Ch∆∞a c√≥ m√¥ t·∫£ ƒë·ªÉ copy!');
                return;
            }

            let textToCopy = `${currentDescription.title}\n\n`;
            
            // Short description (4 bullet points)
            textToCopy += `M√î T·∫¢ NG·∫ÆN:\n`;
            if (currentDescription.short_description && typeof currentDescription.short_description === 'string') {
                const shortDescItems = currentDescription.short_description
                    .split('\n')
                    .filter(item => item.trim() !== '')
                    .map(item => item.replace(/^[‚Ä¢\-\*]\s*/, '').trim())
                    .filter(item => item.length > 0);
                    
                shortDescItems.forEach(item => {
                    textToCopy += `‚Ä¢ ${item}\n`;
                });
            }
            textToCopy += '\n';
            
            // Detailed description
            textToCopy += `M√î T·∫¢ CHI TI·∫æT:\n${currentDescription.detailed_description}\n\n`;
            
            // Technical specifications
            if (currentDescription.specifications && Object.keys(currentDescription.specifications).length) {
                textToCopy += `TH√îNG S·ªê K·ª∏ THU·∫¨T:\n`;
                Object.entries(currentDescription.specifications).forEach(([key, value]) => {
                    textToCopy += `${key}: ${value}\n`;
                });
                textToCopy += '\n';
            }

            navigator.clipboard.writeText(textToCopy).then(() => {
                alert('ƒê√£ copy m√¥ t·∫£ s·∫£n ph·∫©m!');
            }).catch(err => {
                console.error('Copy failed:', err);
                
                // Fallback: create a temporary textarea
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    alert('ƒê√£ copy m√¥ t·∫£ s·∫£n ph·∫©m!');
                } catch (e) {
                    alert('Kh√¥ng th·ªÉ copy t·ª± ƒë·ªông. Vui l√≤ng copy th·ªß c√¥ng t·ª´ k·∫øt qu·∫£ hi·ªÉn th·ªã!');
                }
                
                document.body.removeChild(textarea);
            });
        }

        // Export to DOCX with improved error handling
        async function exportToDocx() {
            if (!currentDescription) {
                alert('Ch∆∞a c√≥ m√¥ t·∫£ ƒë·ªÉ xu·∫•t file!');
                return;
            }

            try {
                // Check if docx library is loaded
                if (typeof docx === 'undefined') {
                    await loadDocxLibrary();
                    if (typeof docx === 'undefined') {
                        throw new Error('Kh√¥ng th·ªÉ t·∫£i th∆∞ vi·ªán DOCX');
                    }
                }

                const children = [];
                
                // Main title
                children.push(
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: currentDescription.title || 'M√¥ t·∫£ s·∫£n ph·∫©m',
                                bold: true,
                                size: 32,
                                font: "Times New Roman"
                            })
                        ],
                        alignment: docx.AlignmentType.CENTER,
                        spacing: { after: 400 }
                    })
                );

                // Short description
                children.push(
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: "M√î T·∫¢ NG·∫ÆN:",
                                bold: true,
                                size: 24,
                                font: "Times New Roman"
                            })
                        ],
                        spacing: { after: 200, before: 300 }
                    })
                );

                if (currentDescription.short_description) {
                    const shortDescItems = currentDescription.short_description
                        .split('\n')
                        .filter(item => item.trim() !== '')
                        .map(item => item.replace(/^[‚Ä¢\-\*]\s*/, '').trim())
                        .filter(item => item.length > 0);
                        
                    shortDescItems.forEach(item => {
                        children.push(
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: `‚Ä¢ ${item}`,
                                        font: "Times New Roman",
                                        size: 22
                                    })
                                ],
                                spacing: { after: 100 }
                            })
                        );
                    });
                }

                // Detailed description
                children.push(
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: "M√î T·∫¢ CHI TI·∫æT:",
                                bold: true,
                                size: 24,
                                font: "Times New Roman"
                            })
                        ],
                        spacing: { after: 200, before: 400 }
                    }),
                    new docx.Paragraph({
                        children: [
                            new docx.TextRun({
                                text: currentDescription.detailed_description || '',
                                font: "Times New Roman",
                                size: 22
                            })
                        ],
                        spacing: { after: 400 },
                        alignment: docx.AlignmentType.JUSTIFIED
                    })
                );

                // Technical specifications
                if (currentDescription.specifications && Object.keys(currentDescription.specifications).length) {
                    children.push(
                        new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: "TH√îNG S·ªê K·ª∏ THU·∫¨T:",
                                    bold: true,
                                    size: 24,
                                    font: "Times New Roman"
                                })
                            ],
                            spacing: { after: 200, before: 300 }
                        })
                    );

                    Object.entries(currentDescription.specifications).forEach(([key, value]) => {
                        children.push(
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: `${key}: `,
                                        bold: true,
                                        font: "Times New Roman",
                                        size: 22
                                    }),
                                    new docx.TextRun({
                                        text: String(value),
                                        font: "Times New Roman",
                                        size: 22
                                    })
                                ],
                                spacing: { after: 100 }
                            })
                        );
                    });
                }

                // Create document
                const doc = new docx.Document({
                    sections: [{
                        properties: {
                            page: {
                                margin: {
                                    top: 720,
                                    right: 720,
                                    bottom: 720,
                                    left: 720
                                }
                            }
                        },
                        children: children
                    }],
                    styles: {
                        default: {
                            document: {
                                run: {
                                    font: "Times New Roman",
                                    size: 22
                                }
                            }
                        }
                    }
                });

                // Generate and download file
                const blob = await docx.Packer.toBlob(doc);
                const fileName = `mo-ta-san-pham-${new Date().getTime()}.docx`;
                
                downloadBlob(blob, fileName);
                alert('ƒê√£ t·∫£i xu·ªëng file Word th√†nh c√¥ng!');
                    
            } catch (error) {
                console.error('Export error:', error);
                
                // Fallback: create text file
                exportToText();
            }
        }

        // Load DOCX library dynamically
        function loadDocxLibrary() {
            return new Promise((resolve, reject) => {
                if (typeof docx !== 'undefined') {
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.min.js';
                script.onload = () => resolve();
                script.onerror = () => reject(new Error('Failed to load DOCX library'));
                document.head.appendChild(script);
            });
        }

        // Download blob as file
        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Export to text file as fallback
        function exportToText() {
            try {
                let textContent = `${currentDescription.title}\n\n`;
                
                textContent += `M√î T·∫¢ NG·∫ÆN:\n`;
                if (currentDescription.short_description) {
                    const shortDescItems = currentDescription.short_description
                        .split('\n')
                        .filter(item => item.trim() !== '');
                    shortDescItems.forEach(item => {
                        textContent += `‚Ä¢ ${item.replace(/^[‚Ä¢\-\*]\s*/, '')}\n`;
                    });
                }
                textContent += '\n';
                
                textContent += `M√î T·∫¢ CHI TI·∫æT:\n${currentDescription.detailed_description}\n\n`;
                
                if (currentDescription.specifications) {
                    textContent += `TH√îNG S·ªê K·ª∏ THU·∫¨T:\n`;
                    Object.entries(currentDescription.specifications).forEach(([key, value]) => {
                        textContent += `${key}: ${value}\n`;
                    });
                }
                
                const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
                const fileName = `mo-ta-san-pham-${new Date().getTime()}.txt`;
                
                downloadBlob(blob, fileName);
                alert('ƒê√£ t·∫£i xu·ªëng file TXT (do l·ªói t·∫°o DOCX). B·∫°n c√≥ th·ªÉ copy v√†o Word ƒë·ªÉ ƒë·ªãnh d·∫°ng l·∫°i!');
            } catch (fallbackError) {
                alert('Kh√¥ng th·ªÉ xu·∫•t file. Vui l√≤ng copy n·ªôi dung th·ªß c√¥ng!');
            }
        }
    </script>
</body>
</html>
                        
        </div>
        
        <div class="tab-content" id="smooth_thumbnail_maker.html">
            <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thumbnail Maker Tool - Professional Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        h1::before {
            content: 'üé®';
            position: absolute;
            left: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            animation: rotate 4s linear infinite;
        }

        h1::after {
            content: '‚ú®';
            position: absolute;
            right: -60px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes rotate {
            from { transform: translateY(-50%) rotate(0deg); }
            to { transform: translateY(-50%) rotate(360deg); }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: translateY(-50%) scale(1); }
            50% { opacity: 0.5; transform: translateY(-50%) scale(1.2); }
        }

        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .upload-box {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            transition: all 0.3s ease;
        }

        .upload-box:hover {
            border-color: #764ba2;
            background: rgba(118, 75, 162, 0.1);
            transform: translateY(-2px);
        }

        .upload-box h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .status.error {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .controls-section {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .controls-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-item label {
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        .control-item input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .control-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .control-item input[type="number"] {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .control-item input[type="number"]:focus {
            border-color: #667eea;
            outline: none;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .removal-settings {
            background: rgba(255, 193, 7, 0.05);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .removal-settings h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .download-section {
            background: rgba(118, 75, 162, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .download-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .download-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .download-btn {
            background: linear-gradient(45deg, #764ba2, #667eea);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.4);
        }

        .download-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(45deg, transparent 33%, rgba(255,255,255,0.3) 33%, rgba(255,255,255,0.3) 66%, transparent 66%);
            animation: progress-animation 1s linear infinite;
        }

        @keyframes progress-animation {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .thumbnails-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .thumbnail-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            border: 3px solid transparent;
        }

        .thumbnail-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .thumbnail-item.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        }

        .thumbnail-canvas {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            object-fit: cover;
            margin: 0 auto;
        }

        .thumbnail-info {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .thumbnail-name {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #d32f2f;
            transform: scale(1.05);
        }

        .workspace-info {
            text-align: center;
            color: #666;
            margin-top: 20px;
            font-size: 14px;
        }

        .copyright-section {
            margin-top: 40px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 20px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.2);
            position: relative;
            overflow: hidden;
        }

        .copyright-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .copyright-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .copyright-text {
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
        }

        .copyright-icon {
            font-size: 20px;
            animation: bounce 2s infinite;
        }

        .copyright-icon:nth-child(1) {
            animation-delay: 0s;
        }

        .copyright-icon:nth-child(3) {
            animation-delay: 0.3s;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }

        .cute-icons {
            display: flex;
            justify-content: center;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .cute-icon {
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

        .cute-icon:nth-child(1) { animation-delay: 0s; }
        .cute-icon:nth-child(2) { animation-delay: 0.6s; }
        .cute-icon:nth-child(3) { animation-delay: 1.2s; }
        .cute-icon:nth-child(4) { animation-delay: 1.8s; }
        .cute-icon:nth-child(5) { animation-delay: 2.4s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(5deg); }
            50% { transform: translateY(-5px) rotate(-5deg); }
            75% { transform: translateY(-15px) rotate(3deg); }
        }

        .cute-icon:hover {
            transform: scale(1.5) rotate(360deg);
            filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5));
        }

        .selected-info {
            background: rgba(102, 126, 234, 0.2);
            border: 3px solid rgba(102, 126, 234, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            animation: pulse-selection 2s infinite;
        }

        @keyframes pulse-selection {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
            }
        }

        .current-editing {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #333;
        }

        @media (max-width: 768px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                grid-template-columns: 1fr;
            }
            
            .thumbnails-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Thumbnail Maker Tool - Professional Enhanced</h1>
        
        <!-- Upload Section -->
        <div class="upload-section">
            <div class="upload-box">
                <h3>üì∑ Upload Ph√¥ng N·ªÅn</h3>
                <p>K√≠ch th∆∞·ªõc khuy·∫øn ngh·ªã: 1200x1200px</p>
                <input type="file" id="backgroundInput" class="file-input" accept="image/*">
                <button class="upload-btn" onclick="document.getElementById('backgroundInput').click()">
                    Ch·ªçn Ph√¥ng N·ªÅn
                </button>
                <div id="backgroundStatus" class="status"></div>
            </div>
            
            <div class="upload-box">
                <h3>üõçÔ∏è Upload S·∫£n Ph·∫©m</h3>
                <p>Ch·ªçn nhi·ªÅu file, t·ª± ƒë·ªông x√≥a ph√¥ng n·ªÅn th√¥ng minh</p>
                <input type="file" id="productInput" class="file-input" accept="image/*" multiple>
                <button class="upload-btn" onclick="document.getElementById('productInput').click()">
                    Ch·ªçn S·∫£n Ph·∫©m
                </button>
                <div id="productStatus" class="status"></div>
            </div>
        </div>

        <!-- Background Removal Settings -->
        <div class="removal-settings">
            <h4>üéØ C√†i ƒê·∫∑t X√≥a N·ªÅn Th√¥ng Minh</h4>
            <div class="control-group">
                <div class="control-item">
                    <label>ƒê·ªô Nh·∫°y (10-100)</label>
                    <input type="range" id="sensitivity" min="10" max="100" step="5" value="40">
                    <span id="sensitivityValue">40</span>
                </div>
                
                <div class="control-item">
                    <label>Blur Edge M∆∞·ª£t (0-10px)</label>
                    <input type="range" id="edgeBlur" min="0" max="10" step="1" value="3">
                    <span id="edgeBlurValue">3px</span>
                </div>
                
                <div class="control-item">
                    <label>Preserve White Details</label>
                    <input type="checkbox" id="preserveWhite" checked>
                </div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <h3>‚öôÔ∏è Ch·ªânh S·ª≠a</h3>
            
            <div class="current-editing" id="currentEditing" style="display: none;">
                <strong>ƒêang ch·ªânh s·ª≠a:</strong> <span id="currentProductName">Kh√¥ng c√≥</span>
            </div>
            
            <div class="selected-info" id="selectedInfo" style="display: none;">
                <strong>üéØ ƒê√É CH·ªåN H√ÄNG LO·∫†T:</strong> <span id="selectedCount">0</span> thumbnail(s) - S·∫µn s√†ng ch·ªânh s·ª≠a!
            </div>
            
            <div class="control-group">
                <div class="control-item">
                    <label>Scale (0.1x - 3x)</label>
                    <input type="range" id="globalScale" min="0.1" max="3" step="0.1" value="0.6">
                    <span id="globalScaleValue">0.6x</span>
                </div>
                
                <div class="control-item">
                    <label>V·ªã Tr√≠ X</label>
                    <input type="number" id="globalX" min="-600" max="600" value="0" placeholder="V·ªã tr√≠ X">
                </div>
                
                <div class="control-item">
                    <label>V·ªã Tr√≠ Y</label>
                    <input type="number" id="globalY" min="-600" max="600" value="0" placeholder="V·ªã tr√≠ Y">
                </div>
                
                <div class="control-item">
                    <label>G√≥c Xoay (0-360¬∞)</label>
                    <input type="range" id="rotation" min="0" max="360" step="1" value="0">
                    <span id="rotationValue">0¬∞</span>
                </div>
            </div>
            
            <div class="control-buttons">
                <button class="control-btn" onclick="applyChanges()">√Åp D·ª•ng</button>
                <button class="control-btn" onclick="centerProducts()">CƒÉn Gi·ªØa</button>
                <button class="control-btn" onclick="resetPositions()">Reset V·ªã Tr√≠</button>
                <button class="control-btn" onclick="selectAllThumbnails()">Ch·ªçn T·∫•t C·∫£</button>
                <button class="control-btn" onclick="deselectAllThumbnails()">B·ªè Ch·ªçn T·∫•t C·∫£</button>
                <button class="control-btn" onclick="reprocessBackgrounds()">X·ª≠ L√Ω L·∫°i N·ªÅn</button>
            </div>
        </div>

        <!-- Download Section -->
        <div class="download-section">
            <h3>üíæ T·∫£i Xu·ªëng</h3>
            <div class="download-buttons">
                <button class="download-btn" id="downloadSelected" onclick="downloadSelected()" disabled>
                    T·∫£i Thumbnail ƒê√£ Ch·ªçn
                </button>
                <button class="download-btn" id="downloadAll" onclick="downloadAll()" disabled>
                    T·∫£i T·∫•t C·∫£ Thumbnail
                </button>
            </div>
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Thumbnails Grid -->
        <div class="thumbnails-grid" id="thumbnailsGrid"></div>
        
        <div class="workspace-info" id="workspaceInfo">
            T·∫£i l√™n ph√¥ng n·ªÅn v√† s·∫£n ph·∫©m ƒë·ªÉ b·∫Øt ƒë·∫ßu t·∫°o thumbnail
        </div>
        
        <!-- Copyright Section -->
        <div class="copyright-section">
            <div class="copyright-content">
                <span class="copyright-icon">üé®</span>
                <span class="copyright-text">Copyright ¬© 2025 Tien Hoang</span>
                <span class="copyright-icon">‚ú®</span>
            </div>
            <div class="cute-icons">
                <span class="cute-icon">üê±</span>
                <span class="cute-icon">üå∏</span>
                <span class="cute-icon">üí´</span>
                <span class="cute-icon">ü¶Ñ</span>
                <span class="cute-icon">üåà</span>
            </div>
        </div>
    </div>

    <script>
        let backgroundImage = null;
        let products = [];
        let selectedThumbnails = new Set();
        let currentEditingProduct = null;

        // Advanced background removal with smooth edge detection
        function advancedBackgroundRemoval(imageData, canvas, sensitivity = 40, preserveWhite = true, edgeBlur = 2) {
            const ctx = canvas.getContext('2d');
            const data = imageData.data;
            const width = canvas.width;
            const height = canvas.height;
            
            // Sample multiple edge points for better background detection
            const samplePoints = [];
            const edge = 5; // Avoid exact corners
            
            // Top edge
            for (let x = edge; x < width - edge; x += Math.floor(width / 20)) {
                samplePoints.push([x, edge]);
            }
            // Bottom edge
            for (let x = edge; x < width - edge; x += Math.floor(width / 20)) {
                samplePoints.push([x, height - edge]);
            }
            // Left edge
            for (let y = edge; y < height - edge; y += Math.floor(height / 20)) {
                samplePoints.push([edge, y]);
            }
            // Right edge
            for (let y = edge; y < height - edge; y += Math.floor(height / 20)) {
                samplePoints.push([width - edge, y]);
            }
            
            // Collect background colors
            let bgColors = [];
            samplePoints.forEach(([x, y]) => {
                const idx = (y * width + x) * 4;
                bgColors.push({
                    r: data[idx],
                    g: data[idx + 1],
                    b: data[idx + 2],
                    brightness: (data[idx] + data[idx + 1] + data[idx + 2]) / 3
                });
            });
            
            // Find dominant background color
            let dominantBg = bgColors.reduce((prev, curr) => {
                let prevCount = bgColors.filter(c => 
                    Math.abs(c.r - prev.r) < 30 && 
                    Math.abs(c.g - prev.g) < 30 && 
                    Math.abs(c.b - prev.b) < 30
                ).length;
                let currCount = bgColors.filter(c => 
                    Math.abs(c.r - curr.r) < 30 && 
                    Math.abs(c.g - curr.g) < 30 && 
                    Math.abs(c.b - curr.b) < 30
                ).length;
                return currCount > prevCount ? curr : prev;
            });
            
            // Create alpha map for smooth transitions
            let alphaMap = new Array(width * height).fill(255);
            
            // First pass: Detect background pixels
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const idx = (y * width + x) * 4;
                    const r = data[idx];
                    const g = data[idx + 1];
                    const b = data[idx + 2];
                    
                    // Calculate similarity to dominant background
                    const colorDiff = Math.abs(r - dominantBg.r) + 
                                    Math.abs(g - dominantBg.g) + 
                                    Math.abs(b - dominantBg.b);
                    
                    const brightness = (r + g + b) / 3;
                    
                    // Decide whether to make transparent
                    let makeTransparent = false;
                    let alpha = 255;
                    
                    // If very similar to background color
                    if (colorDiff < sensitivity) {
                        makeTransparent = true;
                        alpha = Math.max(0, 255 - ((sensitivity - colorDiff) / sensitivity) * 255);
                    }
                    
                    // Special handling for white/light colors
                    if (brightness > 240 && !preserveWhite) {
                        makeTransparent = true;
                        alpha = Math.max(0, 255 - ((brightness - 240) / 15) * 255);
                    } else if (brightness > 250 && preserveWhite) {
                        if (colorDiff < sensitivity * 0.7) {
                            makeTransparent = true;
                            alpha = Math.max(0, 255 - ((sensitivity * 0.7 - colorDiff) / (sensitivity * 0.7)) * 255);
                        }
                    }
                    
                    if (makeTransparent) {
                        alphaMap[y * width + x] = alpha;
                    }
                }
            }
            
            // Second pass: Apply smooth edge blur
            if (edgeBlur > 0) {
                let smoothedAlphaMap = [...alphaMap];
                
                for (let y = edgeBlur; y < height - edgeBlur; y++) {
                    for (let x = edgeBlur; x < width - edgeBlur; x++) {
                        const centerIdx = y * width + x;
                        const centerAlpha = alphaMap[centerIdx];
                        
                        // Skip if already fully opaque
                        if (centerAlpha === 255) continue;
                        
                        // Check if this pixel is near an edge (transition zone)
                        let isNearEdge = false;
                        let minAlpha = centerAlpha;
                        let maxAlpha = centerAlpha;
                        
                        // Check surrounding pixels within blur radius
                        for (let dy = -edgeBlur; dy <= edgeBlur && !isNearEdge; dy++) {
                            for (let dx = -edgeBlur; dx <= edgeBlur && !isNearEdge; dx++) {
                                if (dx === 0 && dy === 0) continue;
                                
                                const neighborIdx = (y + dy) * width + (x + dx);
                                const neighborAlpha = alphaMap[neighborIdx];
                                
                                minAlpha = Math.min(minAlpha, neighborAlpha);
                                maxAlpha = Math.max(maxAlpha, neighborAlpha);
                                
                                // If there's a significant alpha difference nearby, this is an edge
                                if (Math.abs(centerAlpha - neighborAlpha) > 100) {
                                    isNearEdge = true;
                                }
                            }
                        }
                        
                        // Apply gaussian-like blur for smooth edges
                        if (isNearEdge && centerAlpha < 255) {
                            let totalAlpha = 0;
                            let totalWeight = 0;
                            
                            for (let dy = -edgeBlur; dy <= edgeBlur; dy++) {
                                for (let dx = -edgeBlur; dx <= edgeBlur; dx++) {
                                    const distance = Math.sqrt(dx * dx + dy * dy);
                                    if (distance <= edgeBlur) {
                                        // Gaussian weight
                                        const weight = Math.exp(-(distance * distance) / (2 * (edgeBlur / 3) * (edgeBlur / 3)));
                                        const neighborIdx = (y + dy) * width + (x + dx);
                                        
                                        if (neighborIdx >= 0 && neighborIdx < alphaMap.length) {
                                            totalAlpha += alphaMap[neighborIdx] * weight;
                                            totalWeight += weight;
                                        }
                                    }
                                }
                            }
                            
                            if (totalWeight > 0) {
                                smoothedAlphaMap[centerIdx] = Math.round(totalAlpha / totalWeight);
                            }
                        }
                    }
                }
                
                alphaMap = smoothedAlphaMap;
            }
            
            // Apply the final alpha values
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const idx = (y * width + x) * 4;
                    const mapIdx = y * width + x;
                    data[idx + 3] = alphaMap[mapIdx];
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            return canvas;
        }

        // Handle background upload
        document.getElementById('backgroundInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        backgroundImage = img;
                        showStatus('backgroundStatus', 'Ph√¥ng n·ªÅn ƒë√£ t·∫£i l√™n th√†nh c√¥ng!', 'success');
                        updateDownloadButtons();
                        updateWorkspaceInfo();
                        generateThumbnails();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Handle product upload with improved processing
        document.getElementById('productInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            
            showStatus('productStatus', `ƒêang x·ª≠ l√Ω ${files.length} s·∫£n ph·∫©m v·ªõi thu·∫≠t to√°n x√≥a n·ªÅn th√¥ng minh...`, 'success');
            
            let processed = 0;
            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        // Create canvas for advanced background removal
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        
                        ctx.drawImage(img, 0, 0);
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        
                        // Apply advanced background removal
                        const sensitivity = parseInt(document.getElementById('sensitivity').value);
                        const preserveWhite = document.getElementById('preserveWhite').checked;
                        const edgeBlur = parseInt(document.getElementById('edgeBlur').value);
                        
                        advancedBackgroundRemoval(imageData, canvas, sensitivity, preserveWhite, edgeBlur);
                        
                        // Create product object
                        const product = {
                            id: Date.now() + index,
                            name: file.name.replace(/\.[^/.]+$/, ""),
                            originalImage: img,
                            image: img,
                            canvas: canvas,
                            scale: 0.6,
                            x: 0,
                            y: 0,
                            rotation: 0
                        };
                        
                        products.push(product);
                        processed++;
                        
                        if (processed === files.length) {
                            showStatus('productStatus', `ƒê√£ x·ª≠ l√Ω ${files.length} s·∫£n ph·∫©m v·ªõi c√¥ng ngh·ªá x√≥a n·ªÅn th√¥ng minh!`, 'success');
                            generateThumbnails();
                            updateDownloadButtons();
                            updateWorkspaceInfo();
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        });

        // Reprocess backgrounds with new settings
        function reprocessBackgrounds() {
            if (products.length === 0) return;
            
            showStatus('productStatus', 'ƒêang x·ª≠ l√Ω l·∫°i n·ªÅn v·ªõi c√†i ƒë·∫∑t m·ªõi...', 'success');
            
            const sensitivity = parseInt(document.getElementById('sensitivity').value);
            const preserveWhite = document.getElementById('preserveWhite').checked;
            const edgeBlur = parseInt(document.getElementById('edgeBlur').value);
            
            products.forEach(product => {
                const canvas = document.createElement('canvas');
                canvas.width = product.originalImage.width;
                canvas.height = product.originalImage.height;
                const ctx = canvas.getContext('2d');
                
                ctx.drawImage(product.originalImage, 0, 0);
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                
                advancedBackgroundRemoval(imageData, canvas, sensitivity, preserveWhite, edgeBlur);
                product.canvas = canvas;
            });
            
            generateThumbnails();
            showStatus('productStatus', 'ƒê√£ x·ª≠ l√Ω l·∫°i n·ªÅn th√†nh c√¥ng!', 'success');
        }

        // Generate thumbnails with rotation support
        function generateThumbnails() {
            const grid = document.getElementById('thumbnailsGrid');
            grid.innerHTML = '';
            
            products.forEach(product => {
                const thumbnailDiv = document.createElement('div');
                thumbnailDiv.className = 'thumbnail-item';
                thumbnailDiv.setAttribute('data-id', product.id);
                
                // Update selection state
                if (selectedThumbnails.has(product.id)) {
                    thumbnailDiv.classList.add('selected');
                }
                
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                canvas.className = 'thumbnail-canvas';
                
                const ctx = canvas.getContext('2d');
                
                // Clear canvas with white background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw background if available (fit to square)
                if (backgroundImage) {
                    // Calculate scale to fit square while maintaining aspect ratio
                    const bgScale = Math.min(canvas.width / backgroundImage.width, canvas.height / backgroundImage.height);
                    const bgWidth = backgroundImage.width * bgScale;
                    const bgHeight = backgroundImage.height * bgScale;
                    const bgX = (canvas.width - bgWidth) / 2;
                    const bgY = (canvas.height - bgHeight) / 2;
                    
                    ctx.drawImage(backgroundImage, bgX, bgY, bgWidth, bgHeight);
                }
                
                // Draw product with rotation
                const productCanvas = product.canvas;
                const scale = product.scale;
                const x = product.x * (canvas.width / 1200) + canvas.width / 2;
                const y = product.y * (canvas.height / 1200) + canvas.height / 2;
                const rotation = (product.rotation || 0) * Math.PI / 180;
                
                const scaledWidth = productCanvas.width * scale * (canvas.width / 1200);
                const scaledHeight = productCanvas.height * scale * (canvas.height / 1200);
                
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(rotation);
                ctx.drawImage(
                    productCanvas,
                    -scaledWidth / 2,
                    -scaledHeight / 2,
                    scaledWidth,
                    scaledHeight
                );
                ctx.restore();
                
                // Create thumbnail info
                const info = document.createElement('div');
                info.className = 'thumbnail-info';
                info.innerHTML = `
                    <span class="thumbnail-name">${product.name}</span>
                    <button class="delete-btn" onclick="deleteProduct(${product.id})">X√≥a</button>
                `;
                
                thumbnailDiv.appendChild(canvas);
                thumbnailDiv.appendChild(info);
                
                // Add click event for selection/editing
                thumbnailDiv.addEventListener('click', function(e) {
                    if (e.target.classList.contains('delete-btn')) return;
                    
                    // If holding Ctrl/Cmd, toggle selection for batch editing
                    if (e.ctrlKey || e.metaKey) {
                        toggleThumbnailSelection(product.id);
                    } else {
                        // Single click - select for individual editing
                        setCurrentEditingProduct(product.id);
                    }
                });
                
                grid.appendChild(thumbnailDiv);
            });
        }

        // Set current editing product
        function setCurrentEditingProduct(productId) {
            currentEditingProduct = productId;
            const product = products.find(p => p.id === productId);
            
            if (product) {
                // Update control values to match current product
                document.getElementById('globalScale').value = product.scale;
                document.getElementById('globalX').value = product.x;
                document.getElementById('globalY').value = product.y;
                document.getElementById('rotation').value = product.rotation || 0;
                document.getElementById('globalScaleValue').textContent = product.scale + 'x';
                document.getElementById('rotationValue').textContent = (product.rotation || 0) + '¬∞';
                
                // Update current editing display
                document.getElementById('currentEditing').style.display = 'block';
                document.getElementById('currentProductName').textContent = product.name;
                
                // Clear batch selection when editing individual product
                selectedThumbnails.clear();
                updateSelectedInfo();
                updateDownloadButtons();
                
                // Remove all selection highlights and add editing highlight
                document.querySelectorAll('.thumbnail-item').forEach(item => {
                    item.classList.remove('selected');
                    if (item.getAttribute('data-id') == productId) {
                        item.style.border = '3px solid #ffc107';
                    } else {
                        item.style.border = '3px solid transparent';
                    }
                });
            }
        }

        // Toggle thumbnail selection for batch editing
        function toggleThumbnailSelection(productId) {
            // Clear individual editing mode
            currentEditingProduct = null;
            document.getElementById('currentEditing').style.display = 'none';
            document.querySelectorAll('.thumbnail-item').forEach(item => {
                item.style.border = '3px solid transparent';
            });
            
            const thumbnailDiv = document.querySelector(`[data-id="${productId}"]`);
            
            if (selectedThumbnails.has(productId)) {
                selectedThumbnails.delete(productId);
                thumbnailDiv.classList.remove('selected');
            } else {
                selectedThumbnails.add(productId);
                thumbnailDiv.classList.add('selected');
            }
            
            updateSelectedInfo();
            updateDownloadButtons();
        }

        // Select all thumbnails
        function selectAllThumbnails() {
            currentEditingProduct = null;
            document.getElementById('currentEditing').style.display = 'none';
            document.querySelectorAll('.thumbnail-item').forEach(item => {
                item.style.border = '3px solid transparent';
            });
            
            products.forEach(product => {
                selectedThumbnails.add(product.id);
                const thumbnailDiv = document.querySelector(`[data-id="${product.id}"]`);
                thumbnailDiv.classList.add('selected');
            });
            updateSelectedInfo();
            updateDownloadButtons();
        }

        // Deselect all thumbnails
        function deselectAllThumbnails() {
            currentEditingProduct = null;
            document.getElementById('currentEditing').style.display = 'none';
            
            selectedThumbnails.clear();
            document.querySelectorAll('.thumbnail-item').forEach(item => {
                item.classList.remove('selected');
                item.style.border = '3px solid transparent';
            });
            updateSelectedInfo();
            updateDownloadButtons();
        }

        // Update selected info
        function updateSelectedInfo() {
            const selectedInfo = document.getElementById('selectedInfo');
            const selectedCount = document.getElementById('selectedCount');
            
            if (selectedThumbnails.size > 0) {
                selectedInfo.style.display = 'block';
                selectedCount.textContent = selectedThumbnails.size;
            } else {
                selectedInfo.style.display = 'none';
            }
        }

        // Delete product
        function deleteProduct(productId) {
            products = products.filter(p => p.id !== productId);
            selectedThumbnails.delete(productId);
            if (currentEditingProduct === productId) {
                currentEditingProduct = null;
                document.getElementById('currentEditing').style.display = 'none';
            }
            generateThumbnails();
            updateSelectedInfo();
            updateDownloadButtons();
            updateWorkspaceInfo();
        }

        // Apply changes with rotation support
        function applyChanges() {
            const scale = parseFloat(document.getElementById('globalScale').value);
            const x = parseInt(document.getElementById('globalX').value) || 0;
            const y = parseInt(document.getElementById('globalY').value) || 0;
            const rotation = parseInt(document.getElementById('rotation').value) || 0;
            
            let targetProducts = [];
            
            // If editing individual product
            if (currentEditingProduct) {
                targetProducts = products.filter(p => p.id === currentEditingProduct);
            }
            // If batch editing selected products
            else if (selectedThumbnails.size > 0) {
                targetProducts = products.filter(p => selectedThumbnails.has(p.id));
            }
            // If nothing selected, apply to all
            else {
                targetProducts = products;
            }
            
            targetProducts.forEach(product => {
                product.scale = scale;
                product.x = x;
                product.y = y;
                product.rotation = rotation;
            });
            
            generateThumbnails();
        }

        // Center products
        function centerProducts() {
            let targetProducts = [];
            
            // If editing individual product
            if (currentEditingProduct) {
                targetProducts = products.filter(p => p.id === currentEditingProduct);
            }
            // If batch editing selected products
            else if (selectedThumbnails.size > 0) {
                targetProducts = products.filter(p => selectedThumbnails.has(p.id));
            }
            // If nothing selected, apply to all
            else {
                targetProducts = products;
            }
            
            targetProducts.forEach(product => {
                product.x = 0;
                product.y = 0;
            });
            
            document.getElementById('globalX').value = 0;
            document.getElementById('globalY').value = 0;
            
            generateThumbnails();
        }

        // Reset positions
        function resetPositions() {
            let targetProducts = [];
            
            // If editing individual product
            if (currentEditingProduct) {
                targetProducts = products.filter(p => p.id === currentEditingProduct);
            }
            // If batch editing selected products
            else if (selectedThumbnails.size > 0) {
                targetProducts = products.filter(p => selectedThumbnails.has(p.id));
            }
            // If nothing selected, apply to all
            else {
                targetProducts = products;
            }
            
            targetProducts.forEach(product => {
                product.scale = 0.6;
                product.x = 0;
                product.y = 0;
                product.rotation = 0;
            });
            
            document.getElementById('globalScale').value = 0.6;
            document.getElementById('globalX').value = 0;
            document.getElementById('globalY').value = 0;
            document.getElementById('rotation').value = 0;
            document.getElementById('globalScaleValue').textContent = '0.6x';
            document.getElementById('rotationValue').textContent = '0¬∞';
            
            generateThumbnails();
        }

        // Update value displays
        document.getElementById('globalScale').addEventListener('input', function() {
            document.getElementById('globalScaleValue').textContent = this.value + 'x';
        });

        document.getElementById('rotation').addEventListener('input', function() {
            document.getElementById('rotationValue').textContent = this.value + '¬∞';
        });

        document.getElementById('sensitivity').addEventListener('input', function() {
            document.getElementById('sensitivityValue').textContent = this.value;
        });

        document.getElementById('edgeBlur').addEventListener('input', function() {
            document.getElementById('edgeBlurValue').textContent = this.value + 'px';
        });

        // Download selected thumbnails
        function downloadSelected() {
            if (selectedThumbnails.size === 0) return;
            
            const selectedProducts = products.filter(p => selectedThumbnails.has(p.id));
            
            if (selectedProducts.length === 1) {
                // Download single file
                downloadSingleThumbnail(selectedProducts[0]);
            } else {
                // Download multiple files
                downloadMultipleThumbnails(selectedProducts);
            }
        }

        // Download all thumbnails
        function downloadAll() {
            if (products.length === 0) return;
            
            if (products.length === 1) {
                downloadSingleThumbnail(products[0]);
            } else {
                downloadMultipleThumbnails(products);
            }
        }

        // Download single thumbnail with rotation support
        function downloadSingleThumbnail(product) {
            const canvas = document.createElement('canvas');
            canvas.width = 1200;
            canvas.height = 1200;
            const ctx = canvas.getContext('2d');
            
            // Draw background
            if (backgroundImage) {
                ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
            }
            
            // Draw product with rotation
            const productCanvas = product.canvas;
            const scale = product.scale;
            const x = product.x + canvas.width / 2;
            const y = product.y + canvas.height / 2;
            const rotation = (product.rotation || 0) * Math.PI / 180;
            
            const scaledWidth = productCanvas.width * scale;
            const scaledHeight = productCanvas.height * scale;
            
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.drawImage(
                productCanvas,
                -scaledWidth / 2,
                -scaledHeight / 2,
                scaledWidth,
                scaledHeight
            );
            ctx.restore();
            
            // Download
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${product.name}_thumbnail.png`;
                a.click();
                URL.revokeObjectURL(url);
            }, 'image/png');
        }

        // Download multiple thumbnails
        function downloadMultipleThumbnails(targetProducts) {
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';
            
            let processed = 0;
            
            targetProducts.forEach((product, index) => {
                setTimeout(() => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 1200;
                    canvas.height = 1200;
                    const ctx = canvas.getContext('2d');
                    
                    // Draw background
                    if (backgroundImage) {
                        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                    }
                    
                    // Draw product with rotation
                    const productCanvas = product.canvas;
                    const scale = product.scale;
                    const x = product.x + canvas.width / 2;
                    const y = product.y + canvas.height / 2;
                    const rotation = (product.rotation || 0) * Math.PI / 180;
                    
                    const scaledWidth = productCanvas.width * scale;
                    const scaledHeight = productCanvas.height * scale;
                    
                    ctx.save();
                    ctx.translate(x, y);
                    ctx.rotate(rotation);
                    ctx.drawImage(
                        productCanvas,
                        -scaledWidth / 2,
                        -scaledHeight / 2,
                        scaledWidth,
                        scaledHeight
                    );
                    ctx.restore();
                    
                    // Download
                    canvas.toBlob(function(blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${product.name}_thumbnail.png`;
                        a.click();
                        URL.revokeObjectURL(url);
                        
                        processed++;
                        const progress = (processed / targetProducts.length) * 100;
                        progressFill.style.width = progress + '%';
                        
                        if (processed === targetProducts.length) {
                            setTimeout(() => {
                                progressBar.style.display = 'none';
                            }, 1000);
                        }
                    }, 'image/png');
                }, index * 100); // Delay each download by 100ms
            });
        }

        // Show status message
        function showStatus(elementId, message, type) {
            const statusEl = document.getElementById(elementId);
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            }
        }

        // Update download buttons
        function updateDownloadButtons() {
            const downloadSelected = document.getElementById('downloadSelected');
            const downloadAll = document.getElementById('downloadAll');
            
            downloadSelected.disabled = selectedThumbnails.size === 0 || !backgroundImage;
            downloadAll.disabled = products.length === 0 || !backgroundImage;
        }

        // Update workspace info
        function updateWorkspaceInfo() {
            const info = document.getElementById('workspaceInfo');
            if (products.length === 0) {
                info.textContent = 'T·∫£i l√™n ph√¥ng n·ªÅn v√† s·∫£n ph·∫©m ƒë·ªÉ b·∫Øt ƒë·∫ßu t·∫°o thumbnail';
            } else {
                info.textContent = `Workspace: ${products.length} s·∫£n ph·∫©m ƒë√£ t·∫£i l√™n${backgroundImage ? ' | Ph√¥ng n·ªÅn: ƒê√£ s·∫µn s√†ng' : ' | C·∫ßn t·∫£i ph√¥ng n·ªÅn'}`;
            }
        }

        // Initialize
        updateDownloadButtons();
        updateWorkspaceInfo();
    </script>
</body>
</html>
        </div>
        
        <div class="tab-content" id="enhanced_dashboard_fixed.html">
            <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Ph√¢n T√≠ch Metrics Th∆∞∆°ng M·∫°i ƒêi·ªán T·ª≠ - Enhanced</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Y2K Gradient Schemes */
            --gradient-primary: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            --gradient-secondary: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            --gradient-tertiary: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            --gradient-success: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            --gradient-warning: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            --gradient-info: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            --gradient-danger: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            
            /* Y2K Pastel Colors */
            --pastel-lavender: #e8e4ff;
            --pastel-mint: #e0fff4;
            --pastel-peach: #ffe8f0;
            --pastel-sky: #e6f3ff;
            --pastel-cream: #fff8e7;
            --pastel-rose: #ffebf0;
            --pastel-purple: #f0ebff;
            --pastel-cyan: #e0ffff;
            
            /* Text Colors */
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --text-light: #74b9ff;
        }

        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #6c5ce7 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 12px 40px rgba(116, 185, 255, 0.2);
        }

        .glass-card-secondary {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 30px rgba(116, 185, 255, 0.15);
        }

        .gradient-text {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-gradient {
            background: var(--gradient-primary);
            transition: all 0.4s ease;
            transform: translateY(0);
            border: none;
        }

        .btn-gradient:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 107, 157, 0.4);
        }

        .btn-secondary {
            background: var(--gradient-secondary);
        }

        .btn-secondary:hover {
            box-shadow: 0 15px 35px rgba(116, 185, 255, 0.4);
        }

        .btn-tertiary {
            background: var(--gradient-tertiary);
        }

        .btn-tertiary:hover {
            box-shadow: 0 15px 35px rgba(253, 121, 168, 0.4);
        }

        .btn-success {
            background: var(--gradient-success);
        }

        .btn-success:hover {
            box-shadow: 0 15px 35px rgba(0, 184, 148, 0.4);
        }

        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .upload-area {
            background: var(--pastel-lavender);
            border: 3px dashed rgba(116, 185, 255, 0.4);
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: var(--pastel-mint);
            border-color: rgba(0, 184, 148, 0.6);
            transform: translateY(-2px);
        }

        .metric-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
        }

        .metric-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(116, 185, 255, 0.2);
        }

        .status-badge {
            background: var(--gradient-success);
            color: white;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(0, 184, 148, 0.3);
        }

        .data-type-badge {
            background: var(--gradient-info);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(162, 155, 254, 0.3);
            transition: all 0.3s ease;
        }

        .data-type-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(162, 155, 254, 0.4);
        }

        .modal-overlay {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.3);
        }

        .input-field {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid transparent;
            border-radius: 20px;
            padding: 16px 24px;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 25px rgba(116, 185, 255, 0.1);
            color: var(--text-primary);
        }

        .input-field:focus {
            border-color: rgba(116, 185, 255, 0.5);
            box-shadow: 0 10px 35px rgba(116, 185, 255, 0.2);
            outline: none;
        }

        .section-header {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .icon-wrapper {
            background: var(--gradient-primary);
            width: 56px;
            height: 56px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 16px;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
        }

        .text-readable {
            color: var(--text-primary) !important;
            font-weight: 500;
        }

        .text-secondary-readable {
            color: var(--text-secondary) !important;
        }

        /* Enhanced Comparison Badges */
        .comparison-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            animation: pulse 2s infinite;
        }

        .comparison-positive {
            background: linear-gradient(135deg, #10b981, #059669);
            border: 1px solid #065f46;
        }

        .comparison-negative {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: 1px solid #991b1b;
        }

        .comparison-neutral {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: 1px solid #92400e;
        }

        .comparison-badge i {
            font-size: 10px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Performance Highlight Styles */
        .performance-good {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-left: 5px solid #28a745;
        }

        .performance-bad {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border-left: 5px solid #dc3545;
        }

        .performance-neutral {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 5px solid #ffc107;
        }

        .highlight-section {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(116, 185, 255, 0.1));
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 107, 157, 0.2);
        }

        .floating-animation {
            animation: floating 6s ease-in-out infinite;
        }

        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .slide-in {
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .insights-table {
            border-collapse: collapse;
            width: 100%;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .insights-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .insights-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            vertical-align: top;
        }

        .insights-table tr:hover {
            background: rgba(116, 185, 255, 0.05);
        }

        .metric-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .highlight-text {
            font-size: 14px;
            line-height: 1.4;
        }

        .action-text {
            font-size: 14px;
            line-height: 1.4;
            color: var(--text-secondary);
        }

        /* Enhanced Pivot Table */
        .pivot-table {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }

        .pivot-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            font-weight: 600;
            text-align: left;
            font-size: 14px;
        }

        .pivot-table td {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            vertical-align: top;
        }

        .pivot-table tr:hover {
            background: rgba(116, 185, 255, 0.02);
        }

        .metric-cell {
            background: rgba(255,255,255,0.9);
            border-radius: 12px;
            padding: 12px;
            margin: 4px 0;
            border: 1px solid rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .metric-cell:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.15);
        }

        .metric-value {
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .copyright {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            text-align: center;
            margin-top: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .copyright-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 500;
        }

        .copyright-link {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
            text-decoration: none;
        }

        /* Error message styling */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            margin-top: 8px;
            color: #dc2626;
            font-size: 14px;
        }

        .success-message {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            margin-top: 8px;
            color: #059669;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="min-h-screen p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-12 floating-animation">
                <h1 class="text-4xl md:text-6xl font-bold gradient-text mb-4">
                    Dashboard Analytics Enhanced
                </h1>
                <p class="text-white/90 text-lg md:text-xl font-medium">
                    Ph√¢n t√≠ch th√¥ng minh v·ªõi MOM Comparison & Performance Tracking
                </p>
            </div>

            <div class="glass-card p-8 mb-8 slide-in">
                <div class="icon-wrapper">
                    <i class="fas fa-brain text-xl"></i>
                </div>
                <h2 class="section-header">C·∫•u h√¨nh Gemini AI</h2>
                <input
                    type="password"
                    id="geminiApiKey"
                    placeholder="Nh·∫≠p Gemini API Key ƒë·ªÉ k√≠ch ho·∫°t AI insights..."
                    class="w-full input-field"
                />
                <div id="apiKeyStatus" class="mt-4"></div>
            </div>

            <div class="glass-card p-8 mb-8 slide-in">
                <div class="icon-wrapper">
                    <i class="fas fa-cloud-upload-alt text-xl"></i>
                </div>
                <h2 class="section-header">Upload D·ªØ Li·ªáu Excel</h2>
                
                <div class="mb-8 p-6 glass-card-secondary">
                    <h3 class="text-lg font-semibold text-readable mb-4">
                        <i class="fas fa-download mr-2"></i>
                        T·∫£i File Excel M·∫´u
                    </h3>
                    <p class="text-secondary-readable text-sm mb-4">
                        File m·∫´u bao g·ªìm d√≤ng Target v√† d·ªØ li·ªáu so s√°nh MOM
                    </p>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="generateSampleFile('BAU')" class="btn-gradient text-white px-6 py-3 rounded-full font-semibold shadow-lg">
                            <i class="fas fa-download mr-2"></i>
                            M·∫´u BAU
                        </button>
                        <button onclick="generateSampleFile('Double day')" class="btn-secondary text-white px-6 py-3 rounded-full font-semibold shadow-lg">
                            <i class="fas fa-download mr-2"></i>
                            M·∫´u Double day
                        </button>
                        <button onclick="generateSampleFile('15th, 25th')" class="btn-tertiary text-white px-6 py-3 rounded-full font-semibold shadow-lg">
                            <i class="fas fa-download mr-2"></i>
                            M·∫´u 15th, 25th
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="upload-area rounded-2xl p-8 text-center">
                        <i class="fas fa-calendar-day text-4xl text-purple-600 mb-4"></i>
                        <h3 class="font-semibold text-readable mb-2">BAU Days</h3>
                        <p class="text-sm text-secondary-readable mb-4">Business as usual</p>
                        <label class="cursor-pointer">
                            <input type="file" accept=".xlsx,.xls" onchange="handleFileUpload(event, 'BAU')" class="hidden">
                            <span class="btn-gradient text-white px-4 py-2 rounded-full text-sm font-semibold">
                                Ch·ªçn file
                            </span>
                        </label>
                        <div id="status-BAU" class="mt-4"></div>
                    </div>
                    
                    <div class="upload-area rounded-2xl p-8 text-center">
                        <i class="fas fa-fire text-4xl text-red-500 mb-4"></i>
                        <h3 class="font-semibold text-readable mb-2">Double Days</h3>
                        <p class="text-sm text-secondary-readable mb-4">Peak performance days</p>
                        <label class="cursor-pointer">
                            <input type="file" accept=".xlsx,.xls" onchange="handleFileUpload(event, 'Double day')" class="hidden">
                            <span class="btn-secondary text-white px-4 py-2 rounded-full text-sm font-semibold">
                                Ch·ªçn file
                            </span>
                        </label>
                        <div id="status-Double day" class="mt-4"></div>
                    </div>
                    
                    <div class="upload-area rounded-2xl p-8 text-center">
                        <i class="fas fa-star text-4xl text-yellow-500 mb-4"></i>
                        <h3 class="font-semibold text-readable mb-2">Special Days</h3>
                        <p class="text-sm text-secondary-readable mb-4">15th & 25th monthly</p>
                        <label class="cursor-pointer">
                            <input type="file" accept=".xlsx,.xls" onchange="handleFileUpload(event, '15th, 25th')" class="hidden">
                            <span class="btn-tertiary text-white px-4 py-2 rounded-full text-sm font-semibold">
                                Ch·ªçn file
                            </span>
                        </label>
                        <div id="status-15th, 25th" class="mt-4"></div>
                    </div>
                </div>
            </div>

            <div id="dataTypeSelection" class="glass-card p-8 mb-8 slide-in" style="display: none;">
                <div class="icon-wrapper">
                    <i class="fas fa-filter text-xl"></i>
                </div>
                <h2 class="section-header">Ch·ªçn Lo·∫°i D·ªØ Li·ªáu Hi·ªÉn Th·ªã</h2>
                <div class="flex flex-wrap gap-4" id="dataTypeCheckboxes">
                </div>
            </div>

            <!-- Performance Highlights Section -->
            <div id="performanceHighlights" class="glass-card p-8 mb-8 slide-in" style="display: none;">
                <div class="icon-wrapper">
                    <i class="fas fa-exclamation-triangle text-xl"></i>
                </div>
                <h2 class="section-header">Performance Highlights</h2>
                <div class="highlight-section">
                    <h3 class="text-lg font-semibold text-readable mb-4">
                        <i class="fas fa-trending-down mr-2 text-red-500"></i>
                        Metrics C·∫ßn C·∫£i Thi·ªán (So v·ªõi MOM)
                    </h3>
                    <div id="badPerformanceMetrics" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
                </div>
            </div>

            <div id="actionButtons" class="glass-card p-8 mb-8 slide-in" style="display: none;">
                <div class="icon-wrapper">
                    <i class="fas fa-magic text-xl"></i>
                </div>
                <h2 class="section-header">Ph√¢n T√≠ch D·ªØ Li·ªáu</h2>
                <div class="flex flex-wrap gap-4">
                    <button onclick="generateInsights()" class="btn-gradient text-white px-8 py-4 rounded-2xl font-semibold shadow-2xl">
                        <i class="fas fa-brain mr-3"></i>
                        <span id="insightButtonText">T·∫°o AI Insights</span>
                    </button>
                    <button onclick="exportToExcel()" class="btn-tertiary text-white px-8 py-4 rounded-2xl font-semibold shadow-2xl">
                        <i class="fas fa-download mr-3"></i>
                        Xu·∫•t Excel Report
                    </button>
                </div>
                <div id="insightStatus" class="mt-4"></div>
            </div>

            <div id="pivotTableSection" class="glass-card p-8 mb-8 slide-in" style="display: none;">
                <div class="icon-wrapper">
                    <i class="fas fa-table text-xl"></i>
                </div>
                <h2 class="section-header">B·∫£ng Pivot Metrics v·ªõi MOM Comparison</h2>
                <div class="overflow-x-auto rounded-2xl">
                    <table id="pivotTable" class="min-w-full pivot-table">
                    </table>
                </div>
            </div>

            <div id="insightsSection" class="glass-card p-8 mb-8 slide-in" style="display: none;">
                <div class="icon-wrapper">
                    <i class="fas fa-lightbulb text-xl"></i>
                </div>
                <h2 class="section-header">AI Insights & Ph√¢n T√≠ch Structured</h2>
                <div id="insightsTableContainer" class="mb-6">
                    <table id="insightsTable" class="insights-table">
                        <thead>
                            <tr>
                                <th width="20%">Metrics</th>
                                <th width="40%">Highlight</th>
                                <th width="40%">Action ƒê·ªÅ Xu·∫•t</th>
                            </tr>
                        </thead>
                        <tbody id="insightsTableBody">
                        </tbody>
                    </table>
                </div>
                <div class="glass-card-secondary rounded-2xl p-6">
                    <h3 class="font-semibold text-readable mb-3">
                        <i class="fas fa-robot mr-2"></i>
                        AI Analysis Details
                    </h3>
                    <pre id="insightsContent" class="whitespace-pre-wrap text-readable font-medium leading-relaxed text-sm"></pre>
                </div>
            </div>

            <div class="copyright">
                <p class="copyright-text">
                    ¬© 2025 Created with ‚ù§Ô∏è by 
                    <a href="#" class="copyright-link">Tien Hoang</a>
                    | Enhanced Dashboard Analytics System with MOM Comparison
                </p>
            </div>

            <!-- Enhanced Chart Modal -->
            <div id="chartModal" class="fixed inset-0 modal-overlay flex items-center justify-center z-50" style="display: none;">
                <div class="glass-card p-8 max-w-6xl max-h-[90vh] overflow-y-auto m-4 w-full">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="section-header text-2xl">
                            <i class="fas fa-chart-bar mr-3"></i>
                            <span id="chartTitle">Bi·ªÉu ƒë·ªì Ph√¢n t√≠ch Metrics</span>
                        </h3>
                        <button onclick="closeChartModal()" class="text-gray-600 hover:text-gray-800 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="chartContainer" class="chart-container">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let uploadedData = {};
        let selectedDataTypes = [];
        let pivotData = null;
        let targetData = {};
        let compareData = {};
        let chartInstance = null;

        // Enhanced metrics configuration v·ªõi ph√¢n lo·∫°i theo nh√≥m
        const metricsConfig = {
            // Performance metrics
            'Ad cost': { type: 'input', unit: 'VND', category: 'Performance', goodDirection: 'lower' },
            'Ad CIR': { 
                type: 'calculated', 
                formula: (data) => (data['Ad cost'] || 0) / (data['Ad GMV'] || 1) * 100,
                unit: '%',
                category: 'Performance',
                goodDirection: 'lower'
            },
            'CPC Paid Ad': { type: 'input', unit: 'VND', category: 'Performance', goodDirection: 'lower' },
            
            // Doanh thu metrics
            'Total GMV': { type: 'input', unit: 'VND', category: 'Doanh thu', goodDirection: 'higher' },
            'Ad GMV': { type: 'input', unit: 'VND', category: 'Doanh thu', goodDirection: 'higher' },
            'Live GMV': { type: 'input', unit: 'VND', category: 'Doanh thu', goodDirection: 'higher' },
            'Order': { type: 'input', unit: 'count', category: 'Doanh thu', goodDirection: 'higher' },
            
            // Traffic metrics
            'Product click': { type: 'input', unit: 'count', category: 'Traffic', goodDirection: 'higher' },
            'Ad Click': { type: 'input', unit: 'count', category: 'Traffic', goodDirection: 'higher' },
            'Unique User': { type: 'input', unit: 'count', category: 'Traffic', goodDirection: 'higher' },
            'ATC': { type: 'input', unit: 'count', category: 'Traffic', goodDirection: 'higher' },
            'Buyer': { type: 'input', unit: 'count', category: 'Traffic', goodDirection: 'higher' },
            'View Live': { type: 'input', unit: 'count', category: 'Traffic', goodDirection: 'higher' },
            
            // Chuy·ªÉn ƒë·ªïi metrics
            'CR of product click': { 
                type: 'calculated', 
                formula: (data) => (data['Order'] || 0) / (data['Product click'] || 1) * 100,
                unit: '%',
                category: 'Chuy·ªÉn ƒë·ªïi',
                goodDirection: 'higher'
            },
            'CR of buyer': { 
                type: 'calculated', 
                formula: (data) => (data['Buyer'] || 0) / (data['Unique User'] || 1) * 100,
                unit: '%',
                category: 'Chuy·ªÉn ƒë·ªïi',
                goodDirection: 'higher'
            },
            'Ad CR': { 
                type: 'calculated', 
                formula: (data) => (data['ATC'] || 0) / (data['Unique User'] || 1) * 100,
                unit: '%',
                category: 'Chuy·ªÉn ƒë·ªïi',
                goodDirection: 'higher'
            },
            'CR Live': { type: 'input', unit: '%', category: 'Chuy·ªÉn ƒë·ªïi', goodDirection: 'higher' },
            '%ATC': { 
                type: 'calculated', 
                formula: (data) => (data['ATC'] || 0) / (data['Unique User'] || 1) * 100,
                unit: '%',
                category: 'Chuy·ªÉn ƒë·ªïi',
                goodDirection: 'higher'
            },
            
            // Gi√° tr·ªã ƒë∆°n h√†ng metrics
            'AOV': { type: 'input', unit: 'VND', category: 'Gi√° tr·ªã ƒë∆°n', goodDirection: 'higher' },
            'ASP': { type: 'input', unit: 'VND', category: 'Gi√° tr·ªã ƒë∆°n', goodDirection: 'higher' },
            'ABS': { 
                type: 'calculated', 
                formula: (data) => (data['AOV'] || 0) / (data['ASP'] || 1),
                unit: 'count',
                category: 'Gi√° tr·ªã ƒë∆°n',
                goodDirection: 'higher'
            }
        };

        // Format currency in Vietnamese Dong
        function formatVND(value) {
            if (value >= 1000000000) {
                return `${(value / 1000000000).toFixed(1)}B VND`;
            }
            if (value >= 1000000) {
                return `${(value / 1000000).toFixed(1)}M VND`;
            }
            if (value >= 1000) {
                return `${(value / 1000).toFixed(1)}K VND`;
            }
            return `${value.toFixed(0)} VND`;
        }

        // Format value based on unit
        function formatValue(value, unit) {
            if (unit === 'VND') return formatVND(value);
            if (unit === '%') return `${value.toFixed(2)}%`;
            return value.toFixed(0);
        }

        // Calculate metrics based on input data
        function calculateMetrics(inputData) {
            const calculatedData = { ...inputData };
            
            Object.entries(metricsConfig).forEach(([metric, config]) => {
                if (config.type === 'calculated' && config.formula) {
                    calculatedData[metric] = config.formula(inputData);
                }
            });
            
            return calculatedData;
        }

        // Calculate percentage change for MOM comparison
        function calculatePercentageChange(current, previous) {
            if (!previous || previous === 0) return 0;
            return ((current - previous) / previous) * 100;
        }

        // Enhanced comparison badge with good/bad performance logic
        function createComparisonBadge(change, metricName) {
            let icon, className;
            const metricConfig = metricsConfig[metricName];
            const goodDirection = metricConfig ? metricConfig.goodDirection : 'higher';
            
            // Determine if change is good or bad based on metric type
            let isGood = false;
            if (goodDirection === 'higher') {
                isGood = change > 0;
            } else if (goodDirection === 'lower') {
                isGood = change < 0;
            }
            
            if (Math.abs(change) > 5) {
                if (isGood) {
                    icon = 'fas fa-arrow-up';
                    className = 'comparison-positive';
                } else {
                    icon = 'fas fa-arrow-down';
                    className = 'comparison-negative';
                }
            } else {
                icon = 'fas fa-minus';
                className = 'comparison-neutral';
            }

            return `
                <span class="${className} comparison-badge">
                    <i class="${icon}"></i>
                    ${change > 0 ? '+' : ''}${change.toFixed(1)}%
                </span>
            `;
        }

        // Show notification helper
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? 'fas fa-check' : 'fas fa-exclamation-triangle';
            
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
            notification.innerHTML = `<i class="${icon} mr-2"></i>${message}`;
            document.body.appendChild(notification);
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }

        // Show status message in specific container
        function showStatusMessage(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const messageClass = type === 'success' ? 'success-message' : 'error-message';
            const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
            
            container.innerHTML = `
                <div class="${messageClass}">
                    <i class="${icon} mr-2"></i>${message}
                </div>
            `;
        }

        // Generate enhanced sample Excel file with Target, Compare, and Today data
        function generateSampleFile(dataType) {
            try {
                const baseSampleData = [
                    // Target row
                    {
                        date: 'Target',
                        type: 'Target',
                        AOV: 300000,
                        'Product click': 2000,
                        'Ad GMV': 6000000,
                        'Ad cost': 1000000,
                        'Live GMV': 2500000,
                        'Total GMV': 8500000,
                        Order: 150,
                        'Ad Click': 3500,
                        'CPC Paid Ad': 16000,
                        'Unique User': 3000,
                        ATC: 500,
                        Buyer: 120,
                        'View Live': 8200,
                        'CR Live': 5.5,
                        ASP: 185000
                    },
                    // Compare MOM row
                    {
                        date: 'Compare MOM',
                        type: 'Compare',
                        AOV: 250000,
                        'Product click': 1800,
                        'Ad GMV': 5500000,
                        'Ad cost': 950000,
                        'Live GMV': 2200000,
                        'Total GMV': 7700000,
                        Order: 140,
                        'Ad Click': 3200,
                        'CPC Paid Ad': 15500,
                        'Unique User': 2700,
                        ATC: 450,
                        Buyer: 110,
                        'View Live': 8000,
                        'CR Live': 5.2,
                        ASP: 175000
                    },
                    // Today/Current data
                    {
                        date: 'Today',
                        type: 'Current',
                        AOV: 275000,
                        'Product click': 1900,
                        'Ad GMV': 5800000,
                        'Ad cost': 920000,
                        'Live GMV': 2300000,
                        'Total GMV': 8100000,
                        Order: 145,
                        'Ad Click': 3300,
                        'CPC Paid Ad': 15800,
                        'Unique User': 2800,
                        ATC: 480,
                        Buyer: 115,
                        'View Live': 8500,
                        'CR Live': 5.8,
                        ASP: 190000
                    },
                    // Additional sample data rows
                    {
                        date: '01/01/2024',
                        type: 'Historical',
                        AOV: 260000,
                        'Product click': 1700,
                        'Ad GMV': 5200000,
                        'Ad cost': 880000,
                        'Live GMV': 2100000,
                        'Total GMV': 7300000,
                        Order: 130,
                        'Ad Click': 3000,
                        'CPC Paid Ad': 15200,
                        'Unique User': 2600,
                        ATC: 420,
                        Buyer: 105,
                        'View Live': 7800,
                        'CR Live': 5.2,
                        ASP: 175000
                    }
                ];

                // Adjust sample data based on data type
                const sampleData = baseSampleData.map(row => {
                    if (row.type === 'Target') return row; // Don't adjust target
                    
                    const multiplier = dataType === 'Double day' ? 1.5 : 
                                    dataType === '15th, 25th' ? 1.2 : 1.0;
                    
                    const adjustedRow = { ...row };
                    Object.keys(adjustedRow).forEach(key => {
                        if (key !== 'date' && key !== 'type' && typeof adjustedRow[key] === 'number') {
                            adjustedRow[key] = Math.round(adjustedRow[key] * multiplier);
                        }
                    });
                    return adjustedRow;
                });

                // Create Excel file and download
                const worksheet = XLSX.utils.json_to_sheet(sampleData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, dataType);

                XLSX.writeFile(workbook, `Enhanced_Sample_${dataType.replace(/[^a-zA-Z0-9]/g, '_')}.xlsx`);
                
                // Show success message
                showNotification(`ƒê√£ t·∫£i file m·∫´u ${dataType} v·ªõi Target & MOM data`, 'success');
                
            } catch (error) {
                console.error('Error generating sample file:', error);
                showNotification(`L·ªói khi t·∫°o file m·∫´u: ${error.message}`, 'error');
            }
        }

        // Enhanced file upload handler
        function handleFileUpload(event, dataType) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const workbook = XLSX.read(e.target.result, { type: 'binary' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" });

                    const processedData = jsonData.map(row => calculateMetrics(row));
                    
                    // Separate Target, Compare, and other data
                    processedData.forEach(row => {
                        const dateStr = (row.date || row.Date || '').toString().toLowerCase();
                        const typeStr = (row.type || '').toString().toLowerCase();
                        
                        if (dateStr.includes('target') || typeStr.includes('target')) {
                            if (!targetData[dataType]) targetData[dataType] = {};
                            targetData[dataType] = row;
                        } else if (dateStr.includes('compare') || typeStr.includes('compare') || 
                                 dateStr.includes('mom') || typeStr.includes('mom')) {
                            if (!compareData[dataType]) compareData[dataType] = {};
                            compareData[dataType] = row;
                        }
                    });
                    
                    uploadedData[dataType] = processedData;
                    
                    document.getElementById(`status-${dataType}`).innerHTML = 
                        `<span class="status-badge">‚úì ${processedData.length} rows uploaded</span>`;
                    
                    if (!selectedDataTypes.includes(dataType)) {
                        selectedDataTypes.push(dataType);
                    }
                    
                    updateDataTypeSelection();
                    updatePivotData();
                } catch (error) {
                    showNotification(`L·ªói khi ƒë·ªçc file Excel: ${error.message}`, 'error');
                }
            };
            reader.readAsBinaryString(file);
        }

        // Update data type selection
        function updateDataTypeSelection() {
            const container = document.getElementById('dataTypeCheckboxes');
            container.innerHTML = '';
            
            const dataTypes = ['BAU', 'Double day', '15th, 25th'];
            dataTypes.forEach(dataType => {
                if (uploadedData[dataType]) {
                    const label = document.createElement('label');
                    label.className = 'flex items-center cursor-pointer';
                    label.innerHTML = `
                        <input type="checkbox" ${selectedDataTypes.includes(dataType) ? 'checked' : ''} 
                               onchange="toggleDataType('${dataType}')" class="mr-3 scale-125">
                        <span class="data-type-badge">${dataType}</span>
                    `;
                    container.appendChild(label);
                }
            });
            
            if (Object.keys(uploadedData).length > 0) {
                document.getElementById('dataTypeSelection').style.display = 'block';
            }
        }

        // Toggle data type selection
        function toggleDataType(dataType) {
            if (selectedDataTypes.includes(dataType)) {
                selectedDataTypes = selectedDataTypes.filter(t => t !== dataType);
            } else {
                selectedDataTypes.push(dataType);
            }
            updatePivotData();
        }

        // Update pivot data with enhanced MOM comparison
        function updatePivotData() {
            if (selectedDataTypes.length === 0) {
                pivotData = null;
                document.getElementById('pivotTableSection').style.display = 'none';
                document.getElementById('actionButtons').style.display = 'none';
                document.getElementById('performanceHighlights').style.display = 'none';
                return;
            }

            const pivot = {};
            selectedDataTypes.forEach(dataType => {
                if (uploadedData[dataType]) {
                    uploadedData[dataType].forEach(row => {
                        const date = row.date || row.Date || 'Unknown';
                        if (!pivot[date]) pivot[date] = {};
                        pivot[date][dataType] = row;
                    });
                }
            });

            pivotData = pivot;
            renderPivotTable();
            updatePerformanceHighlights();
            document.getElementById('pivotTableSection').style.display = 'block';
            document.getElementById('actionButtons').style.display = 'block';
        }

        // Update performance highlights v·ªõi th√¥ng tin chi ti·∫øt h∆°n
        function updatePerformanceHighlights() {
            const badMetrics = identifyBadPerformanceMetrics();
            const container = document.getElementById('badPerformanceMetrics');
            
            if (badMetrics.length === 0) {
                document.getElementById('performanceHighlights').style.display = 'none';
                return;
            }

            container.innerHTML = '';
            badMetrics.forEach(metric => {
                const metricCard = document.createElement('div');
                metricCard.className = 'performance-bad rounded-lg p-4';
                
                // Icon based on category
                let categoryIcon = 'fas fa-exclamation-triangle';
                switch(metric.category) {
                    case 'Performance': categoryIcon = 'fas fa-chart-line'; break;
                    case 'Doanh thu': categoryIcon = 'fas fa-dollar-sign'; break;
                    case 'Traffic': categoryIcon = 'fas fa-users'; break;
                    case 'Chuy·ªÉn ƒë·ªïi': categoryIcon = 'fas fa-exchange-alt'; break;
                    case 'Gi√° tr·ªã ƒë∆°n': categoryIcon = 'fas fa-shopping-cart'; break;
                }

                metricCard.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <i class="${categoryIcon} text-red-600 mr-2"></i>
                            <h4 class="font-semibold text-readable">${metric.name}</h4>
                        </div>
                        ${createComparisonBadge(metric.change, metric.name.split(' (')[0])}
                    </div>
                    <div class="text-sm text-secondary-readable mb-2">
                        <div class="flex justify-between">
                            <span>Current:</span>
                            <span class="font-semibold">${formatValue(metric.current, metric.unit)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>MOM:</span>
                            <span>${formatValue(metric.previous, metric.unit)}</span>
                        </div>
                        ${metric.target ? `
                        <div class="flex justify-between">
                            <span>Target:</span>
                            <span class="text-blue-600 font-semibold">${formatValue(metric.target, metric.unit)}</span>
                        </div>` : ''}
                    </div>
                    <div class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">
                        <i class="fas fa-info-circle mr-1"></i>
                        ${metric.reason} ‚Ä¢ ${metric.category}
                    </div>
                `;
                container.appendChild(metricCard);
            });

            document.getElementById('performanceHighlights').style.display = 'block';
        }

        // Identify bad performance metrics v·ªõi logic t·ªët/x·∫•u chi ti·∫øt
        function identifyBadPerformanceMetrics() {
            if (!pivotData) return [];

            const badMetrics = [];
            const todayData = pivotData['Today'];
            const compareData = pivotData['Compare MOM'];
            
            if (!todayData || !compareData) return [];

            Object.keys(metricsConfig).forEach(metric => {
                selectedDataTypes.forEach(dataType => {
                    const currentValue = todayData[dataType]?.[metric];
                    const previousValue = compareData[dataType]?.[metric];
                    const targetValue = pivotData['Target']?.[dataType]?.[metric];
                    const metricConfig = metricsConfig[metric];

                    if (currentValue !== undefined && previousValue !== undefined && metricConfig) {
                        const change = calculatePercentageChange(currentValue, previousValue);
                        const goodDirection = metricConfig.goodDirection;
                        
                        // X√°c ƒë·ªãnh metric c√≥ performance x·∫•u hay kh√¥ng
                        let isBadPerformance = false;
                        
                        if (goodDirection === 'higher') {
                            // V·ªõi metrics c√†ng cao c√†ng t·ªët (GMV, Order, CR, etc.)
                            isBadPerformance = change < -5; // Gi·∫£m > 5% l√† x·∫•u
                        } else if (goodDirection === 'lower') {
                            // V·ªõi metrics c√†ng th·∫•p c√†ng t·ªët (Cost, CIR, CPC, etc.)
                            isBadPerformance = change > 5; // TƒÉng > 5% l√† x·∫•u
                        }
                        
                        // Ki·ªÉm tra so v·ªõi target (n·∫øu c√≥)
                        const isBelowTarget = targetValue ? 
                            (goodDirection === 'higher' ? (currentValue / targetValue) < 0.9 : 
                             goodDirection === 'lower' ? (currentValue / targetValue) > 1.1 : false) : 
                            false;
                        
                        if (isBadPerformance || isBelowTarget) {
                            badMetrics.push({
                                name: `${metric} (${dataType})`,
                                current: currentValue,
                                previous: previousValue,
                                target: targetValue,
                                change: change,
                                unit: metricConfig.unit,
                                category: metricConfig.category,
                                goodDirection: goodDirection,
                                reason: isBadPerformance ? 'MOM Performance' : 'Below Target'
                            });
                        }
                    }
                });
            });

            return badMetrics.sort((a, b) => {
                // S·∫Øp x·∫øp theo m·ª©c ƒë·ªô nghi√™m tr·ªçng
                if (a.goodDirection === 'higher') {
                    return a.change - b.change; // Metric gi·∫£m nhi·ªÅu nh·∫•t l√™n ƒë·∫ßu
                } else {
                    return b.change - a.change; // Metric tƒÉng nhi·ªÅu nh·∫•t l√™n ƒë·∫ßu
                }
            });
        }

        // Enhanced pivot table v·ªõi group theo category
        function renderPivotTable() {
            if (!pivotData) return;

            const dates = Object.keys(pivotData).sort((a, b) => {
                // Sort order: Target, Compare MOM, Today, then others
                if (a.includes('Target')) return -1;
                if (b.includes('Target')) return 1;
                if (a.includes('Compare')) return -1;
                if (b.includes('Compare')) return 1;
                if (a.includes('Today')) return -1;
                if (b.includes('Today')) return 1;
                return a.localeCompare(b);
            });
            
            // Group metrics by category
            const metricsGrouped = {};
            Object.entries(metricsConfig).forEach(([metric, config]) => {
                const category = config.category || 'Other';
                if (!metricsGrouped[category]) metricsGrouped[category] = [];
                metricsGrouped[category].push(metric);
            });
            
            let tableHTML = `
                <thead class="bg-gradient-to-r from-purple-500 to-blue-500 text-white">
                    <tr>
                        <th class="px-6 py-4 text-left text-sm font-semibold rounded-tl-2xl">Category / Metric</th>
                        ${dates.map((date, index) => `
                            <th class="px-6 py-4 text-left text-sm font-semibold ${index === dates.length - 1 ? 'rounded-tr-2xl' : ''}">
                                ${date}
                                ${date.includes('Today') ? '<br><small>vs MOM</small>' : ''}
                            </th>
                        `).join('')}
                    </tr>
                </thead>
                <tbody>
            `;

            let rowIndex = 0;
            Object.entries(metricsGrouped).forEach(([category, metrics]) => {
                // Category header row
                const bgClass = rowIndex % 2 === 0 ? 'bg-blue-50' : 'bg-purple-50';
                tableHTML += `
                    <tr class="${bgClass}">
                        <td colspan="${dates.length + 1}" class="px-6 py-3 font-bold text-lg text-blue-800 border-b-2 border-blue-200">
                            <i class="fas fa-folder-open mr-2"></i>${category}
                        </td>
                    </tr>
                `;
                rowIndex++;

                // Metrics rows for this category
                metrics.forEach((metric) => {
                    const bgClass = rowIndex % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                    tableHTML += `<tr class="hover:bg-blue-50 transition-colors ${bgClass}">
                        <td class="px-6 py-4 text-sm font-semibold text-readable pl-12">
                            <span class="text-gray-600 mr-2">‚îî‚îÄ</span>${metric}
                        </td>`;
                    
                    dates.forEach(date => {
                        tableHTML += '<td class="px-6 py-4 text-sm">';
                        
                        selectedDataTypes.forEach((dataType, index) => {
                            const value = pivotData[date]?.[dataType]?.[metric];
                            
                            if (value !== undefined) {
                                // Calculate MOM comparison for Today data
                                let comparisonHTML = '';
                                if (date.includes('Today')) {
                                    const compareValue = pivotData['Compare MOM']?.[dataType]?.[metric];
                                    if (compareValue !== undefined) {
                                        const change = calculatePercentageChange(value, compareValue);
                                        comparisonHTML = `<div class="mt-2">${createComparisonBadge(change, metric)}</div>`;
                                    }
                                }

                                const cardBgClass = date.includes('Target') ? 'bg-blue-100 border-blue-300' :
                                                  date.includes('Compare') ? 'bg-yellow-100 border-yellow-300' :
                                                  date.includes('Today') ? 'bg-green-100 border-green-300' :
                                                  'bg-gray-100 border-gray-300';

                                tableHTML += `
                                    <div class="metric-cell ${cardBgClass} border" onclick="showMetricChart('${metric}', '${dataType}')">
                                        <div class="metric-label">${dataType}</div>
                                        <div class="metric-value">${formatValue(value, metricsConfig[metric]?.unit || 'count')}</div>
                                        ${comparisonHTML}
                                    </div>
                                `;
                            }
                        });
                        tableHTML += '</td>';
                    });
                    
                    tableHTML += '</tr>';
                    rowIndex++;
                });
            });

            tableHTML += '</tbody>';
            document.getElementById('pivotTable').innerHTML = tableHTML;
        }

        // Show chart for specific metric
        function showMetricChart(metric, dataType) {
            if (!pivotData) return;

            const chartData = [];
            const labels = [];
            const values = [];
            const backgroundColors = [];
            const borderColors = [];

            // Collect data for the specific metric and data type
            Object.entries(pivotData).forEach(([date, typeData]) => {
                const value = typeData[dataType]?.[metric];
                if (value !== undefined && !date.includes('Target')) {
                    labels.push(date);
                    values.push(value);
                    
                    // Color coding based on date type
                    if (date.includes('Today')) {
                        backgroundColors.push('rgba(34, 197, 94, 0.8)');
                        borderColors.push('rgb(34, 197, 94)');
                    } else if (date.includes('Compare')) {
                        backgroundColors.push('rgba(251, 146, 60, 0.8)');
                        borderColors.push('rgb(251, 146, 60)');
                    } else {
                        backgroundColors.push('rgba(99, 102, 241, 0.8)');
                        borderColors.push('rgb(99, 102, 241)');
                    }
                }
            });

            // Add target line if available
            const targetValue = pivotData['Target']?.[dataType]?.[metric];

            if (labels.length === 0) {
                showNotification('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì', 'error');
                return;
            }

            // Update chart title
            document.getElementById('chartTitle').textContent = `${metric} - ${dataType}`;

            // Destroy existing chart
            if (chartInstance) {
                chartInstance.destroy();
            }

            // Create new chart
            const ctx = document.getElementById('mainChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: metric,
                        data: values,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }].concat(targetValue ? [{
                        label: 'Target',
                        data: Array(labels.length).fill(targetValue),
                        type: 'line',
                        borderColor: 'rgb(239, 68, 68)',
                        borderWidth: 3,
                        borderDash: [10, 5],
                        fill: false,
                        pointBackgroundColor: 'rgb(239, 68, 68)',
                        pointBorderColor: 'rgb(239, 68, 68)',
                        pointRadius: 6,
                    }] : [])
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${metric} - ${dataType}`,
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: '#374151'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const unit = metricsConfig[metric]?.unit || 'count';
                                    return `${context.dataset.label}: ${formatValue(context.parsed.y, unit)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    const unit = metricsConfig[metric]?.unit || 'count';
                                    return formatValue(value, unit);
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            // Show modal
            document.getElementById('chartModal').style.display = 'flex';
        }

        // Close chart modal
        function closeChartModal() {
            document.getElementById('chartModal').style.display = 'none';
            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }
        }

        // Enhanced AI insights generation with fixed Gemini API
        async function generateInsights() {
            const geminiApiKey = document.getElementById('geminiApiKey').value.trim();
            
            // Clear previous status
            document.getElementById('insightStatus').innerHTML = '';
            
            if (!geminiApiKey) {
                showStatusMessage('insightStatus', 'Vui l√≤ng nh·∫≠p Gemini API Key', 'error');
                return;
            }
            
            if (!pivotData) {
                showStatusMessage('insightStatus', 'Vui l√≤ng t·∫£i d·ªØ li·ªáu tr∆∞·ªõc khi t·∫°o insights', 'error');
                return;
            }

            const button = document.getElementById('insightButtonText');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner loading mr-2"></i>ƒêang t·∫°o Insights...';
            
            try {
                // Show API key validation
                showStatusMessage('apiKeyStatus', 'ƒêang x√°c th·ª±c API Key...', 'success');
                
                const analysisData = prepareAnalysisData();
                
                if (!analysisData || Object.keys(analysisData).length === 0) {
                    throw new Error('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ ph√¢n t√≠ch');
                }
                
                const dataForAnalysis = JSON.stringify(analysisData, null, 2);
                
                const prompt = `
                    B·∫°n l√† m·ªôt chuy√™n gia ph√¢n t√≠ch th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠. H√£y ph√¢n t√≠ch d·ªØ li·ªáu sau v√† ƒë∆∞a ra insights chi ti·∫øt b·∫±ng ti·∫øng Vi·ªát.

                    D·ªØ li·ªáu bao g·ªìm:
                    - Target: M·ª•c ti√™u ƒë·∫∑t ra
                    - Compare MOM: D·ªØ li·ªáu th√°ng tr∆∞·ªõc (Month over Month)
                    - Today: D·ªØ li·ªáu hi·ªán t·∫°i
                    - Historical: D·ªØ li·ªáu l·ªãch s·ª≠

                    H√£y ph√¢n t√≠ch v√† ƒë∆∞a ra:
                    1. Nh·ªØng metric performance t·ªët nh·∫•t
                    2. Nh·ªØng metric c·∫ßn c·∫£i thi·ªán
                    3. So s√°nh v·ªõi target v√† MOM
                    4. ƒê·ªÅ xu·∫•t action c·ª• th·ªÉ cho t·ª´ng v·∫•n ƒë·ªÅ
                    5. D·ª± ƒëo√°n xu h∆∞·ªõng

                    D·ªØ li·ªáu: ${dataForAnalysis}
                `;

                showStatusMessage('insightStatus', 'ƒêang g·ª≠i y√™u c·∫ßu ƒë·∫øn Gemini AI...', 'success');

                // Updated API endpoint and model reference
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 2048
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMessage = `HTTP error! status: ${response.status}`;
                    
                    try {
                        const errorData = JSON.parse(errorText);
                        if (errorData.error && errorData.error.message) {
                            errorMessage = errorData.error.message;
                        }
                    } catch (e) {
                        // Keep original error message if JSON parsing fails
                    }
                    
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi h·ª£p l·ªá t·ª´ Gemini AI');
                }

                const insights = data.candidates[0].content.parts[0].text;

                // Display insights
                document.getElementById('insightsContent').textContent = insights;
                document.getElementById('insightsSection').style.display = 'block';

                // Generate structured insights table
                generateStructuredInsights();
                
                showStatusMessage('insightStatus', 'AI Insights ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!', 'success');
                showStatusMessage('apiKeyStatus', 'API Key h·ª£p l·ªá v√† ho·∫°t ƒë·ªông t·ªët', 'success');
                
            } catch (error) {
                console.error('Error generating insights:', error);
                let errorMessage = 'L·ªói kh√¥ng x√°c ƒë·ªãnh';
                
                if (error.message.includes('API_KEY_INVALID') || error.message.includes('403')) {
                    errorMessage = 'API Key kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra l·∫°i.';
                    showStatusMessage('apiKeyStatus', errorMessage, 'error');
                } else if (error.message.includes('QUOTA_EXCEEDED') || error.message.includes('429')) {
                    errorMessage = 'ƒê√£ v∆∞·ª£t qu√° gi·ªõi h·∫°n s·ª≠ d·ª•ng API. Vui l√≤ng th·ª≠ l·∫°i sau.';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn API. Ki·ªÉm tra k·∫øt n·ªëi internet.';
                } else if (error.message.includes('404')) {
                    errorMessage = 'Model kh√¥ng t√¨m th·∫•y. API ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t ƒë·ªÉ s·ª≠ d·ª•ng gemini-1.5-flash.';
                } else {
                    errorMessage = error.message;
                }
                
                showStatusMessage('insightStatus', `L·ªói khi t·∫°o insights: ${errorMessage}`, 'error');
            } finally {
                button.innerHTML = originalText;
            }
        }

        // Prepare analysis data for AI with better structure
        function prepareAnalysisData() {
            if (!pivotData) return {};

            const analysis = {
                summary: {},
                comparison: {},
                performance: {},
                dataTypes: selectedDataTypes
            };

            // Calculate summary statistics
            selectedDataTypes.forEach(dataType => {
                analysis.summary[dataType] = {};
                
                Object.keys(metricsConfig).forEach(metric => {
                    const currentValue = pivotData['Today']?.[dataType]?.[metric];
                    const compareValue = pivotData['Compare MOM']?.[dataType]?.[metric];
                    const targetValue = pivotData['Target']?.[dataType]?.[metric];
                    
                    if (currentValue !== undefined) {
                        analysis.summary[dataType][metric] = {
                            current: currentValue,
                            target: targetValue,
                            compare: compareValue,
                            unit: metricsConfig[metric]?.unit || 'count',
                            category: metricsConfig[metric]?.category || 'Other'
                        };

                        if (compareValue !== undefined) {
                            const change = calculatePercentageChange(currentValue, compareValue);
                            analysis.comparison[`${metric}_${dataType}`] = {
                                metric: metric,
                                dataType: dataType,
                                change: change,
                                direction: metricsConfig[metric]?.goodDirection || 'higher',
                                isGood: metricsConfig[metric]?.goodDirection === 'higher' ? change > 0 : change < 0
                            };
                        }
                    }
                });
            });

            // Add performance summary
            const badMetrics = identifyBadPerformanceMetrics();
            const goodMetrics = identifyGoodPerformanceMetrics();
            
            analysis.performance = {
                badMetricsCount: badMetrics.length,
                goodMetricsCount: goodMetrics.length,
                badMetrics: badMetrics.slice(0, 5).map(m => ({
                    name: m.name,
                    change: m.change,
                    category: m.category
                })),
                goodMetrics: goodMetrics.slice(0, 5).map(m => ({
                    name: m.name,
                    change: m.change,
                    category: m.category
                }))
            };

            return analysis;
        }

        // Generate structured insights table
        function generateStructuredInsights() {
            const tableBody = document.getElementById('insightsTableBody');
            tableBody.innerHTML = '';

            const badMetrics = identifyBadPerformanceMetrics();
            const goodMetrics = identifyGoodPerformanceMetrics();

            // Add bad performance metrics first
            badMetrics.slice(0, 5).forEach(metric => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="metric-name">${metric.name}</td>
                    <td class="highlight-text">
                        <div class="mb-2">
                            <span class="text-red-600 font-semibold">Underperforming:</span> 
                            ${createComparisonBadge(metric.change, metric.name.split(' (')[0])}
                        </div>
                        <div class="text-sm">
                            Current: <strong>${formatValue(metric.current, metric.unit)}</strong><br>
                            MOM: ${formatValue(metric.previous, metric.unit)}<br>
                            ${metric.target ? `Target: ${formatValue(metric.target, metric.unit)}` : ''}
                        </div>
                    </td>
                    <td class="action-text">
                        ${getActionRecommendation(metric)}
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Add good performance metrics
            goodMetrics.slice(0, 3).forEach(metric => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="metric-name">${metric.name}</td>
                    <td class="highlight-text">
                        <div class="mb-2">
                            <span class="text-green-600 font-semibold">Strong Performance:</span> 
                            ${createComparisonBadge(metric.change, metric.name.split(' (')[0])}
                        </div>
                        <div class="text-sm">
                            Current: <strong>${formatValue(metric.current, metric.unit)}</strong><br>
                            MOM: ${formatValue(metric.previous, metric.unit)}
                        </div>
                    </td>
                    <td class="action-text">
                        <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                        Maintain current strategy. Consider scaling successful tactics to underperforming areas.
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Identify good performance metrics
        function identifyGoodPerformanceMetrics() {
            if (!pivotData) return [];

            const goodMetrics = [];
            const todayData = pivotData['Today'];
            const compareData = pivotData['Compare MOM'];
            
            if (!todayData || !compareData) return [];

            Object.keys(metricsConfig).forEach(metric => {
                selectedDataTypes.forEach(dataType => {
                    const currentValue = todayData[dataType]?.[metric];
                    const previousValue = compareData[dataType]?.[metric];
                    const metricConfig = metricsConfig[metric];

                    if (currentValue !== undefined && previousValue !== undefined && metricConfig) {
                        const change = calculatePercentageChange(currentValue, previousValue);
                        const goodDirection = metricConfig.goodDirection;
                        
                        let isGoodPerformance = false;
                        
                        if (goodDirection === 'higher') {
                            isGoodPerformance = change > 10; // TƒÉng > 10% l√† t·ªët
                        } else if (goodDirection === 'lower') {
                            isGoodPerformance = change < -10; // Gi·∫£m > 10% l√† t·ªët
                        }
                        
                        if (isGoodPerformance) {
                            goodMetrics.push({
                                name: `${metric} (${dataType})`,
                                current: currentValue,
                                previous: previousValue,
                                change: change,
                                unit: metricConfig.unit,
                                category: metricConfig.category,
                                goodDirection: goodDirection
                            });
                        }
                    }
                });
            });

            return goodMetrics.sort((a, b) => {
                // S·∫Øp x·∫øp theo performance t·ªët nh·∫•t
                if (a.goodDirection === 'higher') {
                    return b.change - a.change; // Metric tƒÉng nhi·ªÅu nh·∫•t l√™n ƒë·∫ßu
                } else {
                    return a.change - b.change; // Metric gi·∫£m nhi·ªÅu nh·∫•t l√™n ƒë·∫ßu
                }
            });
        }

        // Get action recommendation for metrics
        function getActionRecommendation(metric) {
            const category = metric.category;
            const metricName = metric.name.split(' (')[0];
            
            const recommendations = {
                'Performance': {
                    'Ad cost': 'üîç Review ad targeting v√† bid strategy. Optimize cho high-converting keywords.',
                    'Ad CIR': '‚ö° Improve ad creative quality v√† landing page conversion rate.',
                    'CPC Paid Ad': 'üéØ Refine audience targeting, test ad scheduling v√† device targeting.'
                },
                'Doanh thu': {
                    'Total GMV': 'üìà Launch promotional campaigns, expand product range, improve cross-selling.',
                    'Ad GMV': 'üöÄ Increase ad budget cho high-performing campaigns, A/B test ad creatives.',
                    'Live GMV': 'üì∫ Enhance live streaming quality, train hosts, promote live events.',
                    'Order': 'üõí Optimize checkout process, reduce cart abandonment, offer incentives.'
                },
                'Traffic': {
                    'Product click': 'üîó Improve product titles, images, v√† SEO optimization.',
                    'Ad Click': '‚ú® Create more compelling ad copy v√† visual creatives.',
                    'Unique User': 'üì± Expand marketing channels, improve brand awareness campaigns.',
                    'ATC': 'üõçÔ∏è Optimize product pages, add social proof, improve product descriptions.',
                    'View Live': 'üì¢ Increase live streaming promotion across all channels.'
                },
                'Chuy·ªÉn ƒë·ªïi': {
                    'CR of product click': 'üéØ A/B test product pages, improve trust signals, optimize pricing.',
                    'CR of buyer': 'üí∞ Enhance user experience, simplify purchase flow, add payment options.',
                    'Ad CR': 'üîÑ Retarget website visitors, improve ad relevance score.',
                    'CR Live': 'üé™ Train live hosts on sales techniques, create urgency in live sessions.'
                },
                'Gi√° tr·ªã ƒë∆°n': {
                    'AOV': 'üì¶ Implement bundle deals, cross-sell related products, minimum order incentives.',
                    'ASP': 'üíé Focus on higher-margin products, improve product mix strategy.',
                    'ABS': 'üõí Encourage bulk purchases, offer volume discounts.'
                }
            };
            
            const categoryRecs = recommendations[category] || {};
            const specificRec = categoryRecs[metricName];
            
            if (specificRec) {
                return specificRec;
            }
            
            // Default recommendations by category
            const defaultRecs = {
                'Performance': 'üîß Review campaign settings v√† optimize budget allocation.',
                'Doanh thu': 'üìä Analyze sales funnel v√† identify revenue growth opportunities.',
                'Traffic': 'üö¶ Enhance marketing reach v√† improve user acquisition strategies.',
                'Chuy·ªÉn ƒë·ªïi': '‚ö° Optimize user journey v√† reduce conversion barriers.',
                'Gi√° tr·ªã ƒë∆°n': 'üí∞ Focus on increasing transaction value through strategic promotions.'
            };
            
            return defaultRecs[category] || 'üéØ Monitor closely v√† develop improvement strategy.';
        }

        // Export to Excel functionality
        function exportToExcel() {
            if (!pivotData) {
                showNotification('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t', 'error');
                return;
            }

            try {
                const exportData = [];
                
                // Prepare data for export
                Object.entries(pivotData).forEach(([date, typeData]) => {
                    selectedDataTypes.forEach(dataType => {
                        const rowData = typeData[dataType];
                        if (rowData) {
                            const exportRow = {
                                Date: date,
                                Type: dataType,
                                ...rowData
                            };
                            
                            // Add MOM comparison if it's Today data
                            if (date.includes('Today')) {
                                Object.keys(metricsConfig).forEach(metric => {
                                    const currentValue = rowData[metric];
                                    const compareValue = pivotData['Compare MOM']?.[dataType]?.[metric];
                                    
                                    if (currentValue !== undefined && compareValue !== undefined) {
                                        const change = calculatePercentageChange(currentValue, compareValue);
                                        exportRow[`${metric}_MOM_Change_%`] = change.toFixed(2);
                                    }
                                });
                            }
                            
                            exportData.push(exportRow);
                        }
                    });
                });

                // Create insights summary sheet
                const insightsData = [];
                const badMetrics = identifyBadPerformanceMetrics();
                const goodMetrics = identifyGoodPerformanceMetrics();

                // Add performance summary
                insightsData.push({
                    Category: 'SUMMARY',
                    Metric: 'Bad Performance Count',
                    Value: badMetrics.length,
                    Note: 'Metrics underperforming vs MOM'
                });

                insightsData.push({
                    Category: 'SUMMARY', 
                    Metric: 'Good Performance Count',
                    Value: goodMetrics.length,
                    Note: 'Metrics outperforming vs MOM'
                });

                // Add detailed bad performance metrics
                badMetrics.forEach(metric => {
                    insightsData.push({
                        Category: 'BAD_PERFORMANCE',
                        Metric: metric.name,
                        Value: `${metric.change.toFixed(1)}%`,
                        Current: formatValue(metric.current, metric.unit),
                        Previous: formatValue(metric.previous, metric.unit),
                        Target: metric.target ? formatValue(metric.target, metric.unit) : '',
                        Action: getActionRecommendation(metric),
                        Note: `${metric.category} - ${metric.reason}`
                    });
                });

                // Add good performance metrics
                goodMetrics.forEach(metric => {
                    insightsData.push({
                        Category: 'GOOD_PERFORMANCE',
                        Metric: metric.name,
                        Value: `${metric.change.toFixed(1)}%`,
                        Current: formatValue(metric.current, metric.unit),
                        Previous: formatValue(metric.previous, metric.unit),
                        Action: 'Maintain strategy and scale',
                        Note: `${metric.category} - Strong performance`
                    });
                });

                // Create workbook with multiple sheets
                const workbook = XLSX.utils.book_new();
                
                // Main data sheet
                const dataSheet = XLSX.utils.json_to_sheet(exportData);
                XLSX.utils.book_append_sheet(workbook, dataSheet, 'Raw Data');
                
                // Insights sheet
                const insightsSheet = XLSX.utils.json_to_sheet(insightsData);
                XLSX.utils.book_append_sheet(workbook, insightsSheet, 'Insights & Actions');

                // Export file
                const fileName = `Dashboard_Analytics_Report_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                
                showNotification('Report ƒë√£ ƒë∆∞·ª£c xu·∫•t th√†nh c√¥ng!', 'success');
                
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                showNotification(`L·ªói khi xu·∫•t Excel: ${error.message}`, 'error');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Add any initialization code here
            console.log('Dashboard Analytics Enhanced loaded successfully!');
            
            // Test API key input validation
            const apiKeyInput = document.getElementById('geminiApiKey');
            apiKeyInput.addEventListener('input', function() {
                const apiKey = this.value.trim();
                if (apiKey.length > 0) {
                    if (apiKey.startsWith('AIza')) {
                        showStatusMessage('apiKeyStatus', 'API Key format looks correct', 'success');
                    } else {
                        showStatusMessage('apiKeyStatus', 'API Key should start with "AIza"', 'error');
                    }
                } else {
                    document.getElementById('apiKeyStatus').innerHTML = '';
                }
            });
        });

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('chartModal');
            if (event.target === modal) {
                closeChartModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Close modal with Escape key
            if (event.key === 'Escape') {
                closeChartModal();
            }
        });
    </script>
</body>
</html>
        </div>
        
    <script>
        // M·∫∑c ƒë·ªãnh m·ªü tab ƒë·∫ßu ti√™n
        document.addEventListener("DOMContentLoaded", function() {
            openTab("livestream_dashboard.html");
        });
    </script>
</body>
</html>
